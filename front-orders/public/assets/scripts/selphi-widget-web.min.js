let my_widget = localStorage.getItem('my_widget');

let widgetInstanceNAME = `facephi-selphi-${my_widget}`;
var e = {
    280: (e) => {
      var t = (() => {
        var e = Object.defineProperty,
          t = Object.getOwnPropertyDescriptor,
          i = Object.getOwnPropertyNames,
          l = Object.getOwnPropertySymbols,
          a = Object.prototype.hasOwnProperty,
          c = Object.prototype.propertyIsEnumerable,
          s = Math.pow,
          d = (t, i, l) =>
            i in t
              ? e(t, i, {
                  enumerable: !0,
                  configurable: !0,
                  writable: !0,
                  value: l,
                })
              : (t[i] = l),
          h = (e, t, i) => {
            if (!t.has(e)) throw TypeError('Cannot ' + i);
          },
          n = (e, t, i) => (
            h(e, t, 'read from private field'), i ? i.call(e) : t.get(e)
          ),
          m = (e, t, i) => {
            if (t.has(e))
              throw TypeError(
                'Cannot add the same private member more than once'
              );
            t instanceof WeakSet ? t.add(e) : t.set(e, i);
          },
          o = (e, t, i, l) => (
            h(e, t, 'write to private field'), l ? l.call(e, i) : t.set(e, i), i
          ),
          b = (e, t, i) => (h(e, t, 'access private method'), i),
          Z = {};
        ((t, i) => {
          for (var l in i) e(t, l, { get: i[l], enumerable: !0 });
        })(Z, {
          ArrayBufferTarget: () => ae,
          FileSystemWritableFileStreamTarget: () => se,
          Muxer: () => it,
          StreamTarget: () => ce,
        });
        var r,
          u,
          g,
          y,
          I,
          G,
          X,
          p = new Uint8Array(8),
          W = new DataView(p.buffer),
          V = (e) => [((e % 256) + 256) % 256],
          R = (e) => (W.setUint16(0, e, !1), [p[0], p[1]]),
          C = (e) => (W.setUint32(0, e, !1), [p[1], p[2], p[3]]),
          v = (e) => (W.setUint32(0, e, !1), [p[0], p[1], p[2], p[3]]),
          Y = (e) => (W.setUint8(0, e), W.setUint8(1, e << 8), [p[0], p[1]]),
          F = (e) => (
            W.setUint16(0, e, !1),
            W.setUint16(2, e << 16, !1),
            [p[0], p[1], p[2], p[3]]
          ),
          S = (e, t = !1) => {
            let i = Array(e.length)
              .fill(null)
              .map((t, i) => e.charCodeAt(i));
            return t && i.push(0), i;
          },
          J = (e) => e && e[e.length - 1],
          H = (e, t, i = !0) => {
            let l = e * t;
            return i ? Math.round(l) : l;
          },
          K = [65536, 0, 0, 0, 65536, 0, 0, 0, 1073741824].map(v),
          k = (e, t, i) => ({
            type: e,
            contents: t && new Uint8Array(t.flat(10)),
            children: i,
          }),
          x = (e, t, i, l, a) => k(e, [V(t), C(i), null != l ? l : []], a),
          N = (e, t) => {
            let i = H(
                Math.max(
                  0,
                  ...t
                    .filter((e) => e.samples.length > 0)
                    .map((e) => J(e.samples).timestamp + J(e.samples).duration)
                ),
                qe
              ),
              l = Math.max(...t.map((e) => e.id)) + 1;
            return x('mvhd', 0, 0, [
              v(e),
              v(e),
              v(qe),
              v(i),
              F(1),
              Y(1),
              Array(10).fill(0),
              K,
              Array(24).fill(0),
              v(l),
            ]);
          },
          U = (e, t) => {
            let i = J(e.samples),
              l = H(i ? i.timestamp + i.duration : 0, qe);
            return x('tkhd', 0, 3, [
              v(t),
              v(t),
              v(e.id),
              v(0),
              v(l),
              Array(8).fill(0),
              R(0),
              R(0),
              Y('audio' === e.info.type ? 1 : 0),
              R(0),
              K,
              F('video' === e.info.type ? e.info.width : 0),
              F('video' === e.info.type ? e.info.height : 0),
            ]);
          },
          L = (e, t) =>
            k('mdia', null, [
              w(e, t),
              f('video' === e.info.type ? 'vide' : 'soun'),
              T(e),
            ]),
          w = (e, t) => {
            let i = J(e.samples),
              l = H(i ? i.timestamp + i.duration : 0, e.timescale);
            return x('mdhd', 0, 0, [
              v(t),
              v(t),
              v(e.timescale),
              v(l),
              R(21956),
              R(0),
            ]);
          },
          f = (e) =>
            x('hdlr', 0, 0, [
              S('mhlr'),
              S(e),
              v(0),
              v(0),
              v(0),
              S('mp4-muxer-hdlr'),
            ]),
          T = (e) =>
            k('minf', null, ['video' === e.info.type ? B() : z(), A(), M(e)]),
          B = () => x('vmhd', 0, 1, [R(0), R(0), R(0), R(0)]),
          z = () => x('smhd', 0, 0, [R(0), R(0)]),
          A = () => k('dinf', null, [P()]),
          P = () => x('dref', 0, 0, [v(1)], [Q()]),
          Q = () => x('url ', 0, 1),
          M = (e) => k('stbl', null, [j(e), $(e), ee(e), te(e), ie(e), le(e)]),
          j = (e) =>
            x(
              'stsd',
              0,
              0,
              [v(1)],
              [
                'video' === e.info.type
                  ? E(
                      'avc' === e.info.codec ? 'avc1' : 'hvc1',
                      e,
                      'avc' === e.info.codec ? D(e) : O(e)
                    )
                  : _('mp4a', e, q(e)),
              ]
            ),
          E = (e, t, i) =>
            k(
              e,
              [
                Array(6).fill(0),
                R(1),
                R(0),
                R(0),
                Array(12).fill(0),
                R(t.info.width),
                R(t.info.height),
                v(4718592),
                v(4718592),
                v(0),
                R(1),
                Array(32).fill(0),
                R(24),
                (65535, W.setInt16(0, 65535, !1), [p[0], p[1]]),
              ],
              [i]
            ),
          D = (e) => e.codecPrivate && k('avcC', [...e.codecPrivate]),
          O = (e) => e.codecPrivate && k('hvcC', [...e.codecPrivate]),
          _ = (e, t, i) =>
            k(
              e,
              [
                Array(6).fill(0),
                R(1),
                R(0),
                R(0),
                v(0),
                R(t.info.numberOfChannels),
                R(16),
                R(0),
                R(0),
                F(t.info.sampleRate),
              ],
              [i]
            ),
          q = (e) =>
            x('esds', 0, 0, [
              v(58753152),
              V(32 + e.codecPrivate.byteLength),
              R(1),
              V(0),
              v(75530368),
              V(18 + e.codecPrivate.byteLength),
              V(64),
              V(21),
              C(0),
              v(130071),
              v(130071),
              v(92307584),
              V(e.codecPrivate.byteLength),
              ...e.codecPrivate,
              v(109084800),
              V(1),
              V(2),
            ]),
          $ = (e) =>
            x('stts', 0, 0, [
              v(e.timeToSampleTable.length),
              e.timeToSampleTable.map((e) => [
                v(e.sampleCount),
                v(e.sampleDelta),
              ]),
            ]),
          ee = (e) => {
            if (e.samples.every((e) => 'key' === e.type)) return null;
            let t = [...e.samples.entries()].filter(
              ([, e]) => 'key' === e.type
            );
            return x('stss', 0, 0, [v(t.length), t.map(([e]) => v(e + 1))]);
          },
          te = (e) =>
            x('stsc', 0, 0, [
              v(e.compactlyCodedChunkTable.length),
              e.compactlyCodedChunkTable.map((e) => [
                v(e.firstChunk),
                v(e.samplesPerChunk),
                v(1),
              ]),
            ]),
          ie = (e) =>
            x('stsz', 0, 0, [
              v(0),
              v(e.samples.length),
              e.samples.map((e) => v(e.size)),
            ]),
          le = (e) =>
            e.writtenChunks.length > 0 && J(e.writtenChunks).offset >= s(2, 32)
              ? x('co64', 0, 0, [
                  v(e.writtenChunks.length),
                  e.writtenChunks.map((e) => {
                    return (
                      (t = e.offset),
                      W.setUint32(0, Math.floor(t / s(2, 32)), !1),
                      W.setUint32(4, t, !1),
                      [p[0], p[1], p[2], p[3], p[4], p[5], p[6], p[7]]
                    );
                  }),
                ])
              : x('stco', 0, 0, [
                  v(e.writtenChunks.length),
                  e.writtenChunks.map((e) => v(e.offset)),
                ]),
          ae = class {
            constructor() {
              this.buffer = null;
            }
          },
          ce = class {
            constructor(e, t, i) {
              (this.onData = e), (this.onDone = t), (this.options = i);
            }
          },
          se = class {
            constructor(e, t) {
              (this.stream = e), (this.options = t);
            }
          },
          de = class {
            constructor() {
              (this.pos = 0),
                m(this, r, new Uint8Array(8)),
                m(this, u, new DataView(n(this, r).buffer)),
                (this.offsets = new WeakMap());
            }
            seek(e) {
              this.pos = e;
            }
            writeU32(e) {
              n(this, u).setUint32(0, e, !1),
                this.write(n(this, r).subarray(0, 4));
            }
            writeU64(e) {
              n(this, u).setUint32(0, Math.floor(e / s(2, 32)), !1),
                n(this, u).setUint32(4, e, !1),
                this.write(n(this, r).subarray(0, 8));
            }
            writeAscii(e) {
              for (let t = 0; t < e.length; t++)
                n(this, u).setUint8(t % 8, e.charCodeAt(t)),
                  t % 8 == 7 && this.write(n(this, r));
              e.length % 8 != 0 &&
                this.write(n(this, r).subarray(0, e.length % 8));
            }
            writeBox(e) {
              var t, i;
              if ((this.offsets.set(e, this.pos), e.contents && !e.children))
                this.writeBoxHeader(
                  e,
                  null != (t = e.size) ? t : e.contents.byteLength + 8
                ),
                  this.write(e.contents);
              else {
                let t = this.pos;
                if (
                  (this.writeBoxHeader(e, 0),
                  e.contents && this.write(e.contents),
                  e.children)
                )
                  for (let t of e.children) t && this.writeBox(t);
                let l = this.pos,
                  a = null != (i = e.size) ? i : l - t;
                this.seek(t), this.writeBoxHeader(e, a), this.seek(l);
              }
            }
            writeBoxHeader(e, t) {
              this.writeU32(e.largeSize ? 1 : t),
                this.writeAscii(e.type),
                e.largeSize && this.writeU64(t);
            }
            patchBox(e) {
              let t = this.pos;
              this.seek(this.offsets.get(e)), this.writeBox(e), this.seek(t);
            }
          };
        (r = new WeakMap()), (u = new WeakMap());
        var he,
          ne,
          me = class extends de {
            constructor(e) {
              super(),
                m(this, G),
                m(this, g, void 0),
                m(this, y, new ArrayBuffer(s(2, 16))),
                m(this, I, new Uint8Array(n(this, y))),
                o(this, g, e);
            }
            write(e) {
              b(this, G, X).call(this, this.pos + e.byteLength),
                n(this, I).set(e, this.pos),
                (this.pos += e.byteLength);
            }
            finalize() {
              b(this, G, X).call(this, this.pos),
                (n(this, g).buffer = n(this, y).slice(0, this.pos));
            }
          };
        (g = new WeakMap()),
          (y = new WeakMap()),
          (I = new WeakMap()),
          (G = new WeakSet()),
          (X = function (e) {
            let t = n(this, y).byteLength;
            for (; t < e; ) t *= 2;
            if (t === n(this, y).byteLength) return;
            let i = new ArrayBuffer(t),
              l = new Uint8Array(i);
            l.set(n(this, I), 0), o(this, y, i), o(this, I, l);
          });
        var oe = class extends de {
          constructor(e) {
            super(), m(this, he, void 0), m(this, ne, []), o(this, he, e);
          }
          write(e) {
            n(this, ne).push({ data: e.slice(), start: this.pos }),
              (this.pos += e.byteLength);
          }
          flush() {
            if (0 === n(this, ne).length) return;
            let e = [],
              t = [...n(this, ne)].sort((e, t) => e.start - t.start);
            e.push({ start: t[0].start, size: t[0].data.byteLength });
            for (let i = 1; i < t.length; i++) {
              let l = e[e.length - 1],
                a = t[i];
              a.start <= l.start + l.size
                ? (l.size = Math.max(
                    l.size,
                    a.start + a.data.byteLength - l.start
                  ))
                : e.push({ start: a.start, size: a.data.byteLength });
            }
            for (let t of e) {
              t.data = new Uint8Array(t.size);
              for (let e of n(this, ne))
                t.start <= e.start &&
                  e.start < t.start + t.size &&
                  t.data.set(e.data, e.start - t.start);
              n(this, he).onData(t.data, t.start);
            }
            n(this, ne).length = 0;
          }
          finalize() {
            var e, t;
            null == (t = (e = n(this, he)).onDone) || t.call(e);
          }
        };
        (he = new WeakMap()), (ne = new WeakMap());
        var be,
          Ze,
          re,
          ue,
          ge,
          ye,
          Ie,
          Ge,
          Xe,
          pe,
          We,
          Ve = s(2, 24),
          Re = class extends de {
            constructor(e) {
              var t, i;
              if (
                (super(),
                m(this, ue),
                m(this, ye),
                m(this, Ge),
                m(this, pe),
                m(this, be, void 0),
                m(this, Ze, void 0),
                m(this, re, []),
                o(this, be, e),
                o(
                  this,
                  Ze,
                  null != (i = null == (t = e.options) ? void 0 : t.chunkSize)
                    ? i
                    : Ve
                ),
                !Number.isInteger(n(this, Ze)) || n(this, Ze) < s(2, 10))
              )
                throw new Error(
                  'Invalid StreamTarget options: chunkSize must be an integer not smaller than 1024.'
                );
            }
            write(e) {
              b(this, ue, ge).call(this, e, this.pos),
                b(this, pe, We).call(this),
                (this.pos += e.byteLength);
            }
            finalize() {
              var e, t;
              b(this, pe, We).call(this, !0),
                null == (t = (e = n(this, be)).onDone) || t.call(e);
            }
          };
        (be = new WeakMap()),
          (Ze = new WeakMap()),
          (re = new WeakMap()),
          (ue = new WeakSet()),
          (ge = function (e, t) {
            let i = n(this, re).findIndex(
              (e) => e.start <= t && t < e.start + n(this, Ze)
            );
            -1 === i && (i = b(this, Ge, Xe).call(this, t));
            let l = n(this, re)[i],
              a = t - l.start,
              c = e.subarray(0, Math.min(n(this, Ze) - a, e.byteLength));
            l.data.set(c, a);
            let s = { start: a, end: a + c.byteLength };
            if (
              (b(this, ye, Ie).call(this, l, s),
              0 === l.written[0].start &&
                l.written[0].end === n(this, Ze) &&
                (l.shouldFlush = !0),
              n(this, re).length > 2)
            ) {
              for (let e = 0; e < n(this, re).length - 1; e++)
                n(this, re)[e].shouldFlush = !0;
              b(this, pe, We).call(this);
            }
            c.byteLength < e.byteLength &&
              b(this, ue, ge).call(
                this,
                e.subarray(c.byteLength),
                t + c.byteLength
              );
          }),
          (ye = new WeakSet()),
          (Ie = function (e, t) {
            let i = 0,
              l = e.written.length - 1,
              a = -1;
            for (; i <= l; ) {
              let c = Math.floor(i + (l - i + 1) / 2);
              e.written[c].start <= t.start
                ? ((i = c + 1), (a = c))
                : (l = c - 1);
            }
            for (
              e.written.splice(a + 1, 0, t),
                (-1 === a || e.written[a].end < t.start) && a++;
              a < e.written.length - 1 &&
              e.written[a].end >= e.written[a + 1].start;

            )
              (e.written[a].end = Math.max(
                e.written[a].end,
                e.written[a + 1].end
              )),
                e.written.splice(a + 1, 1);
          }),
          (Ge = new WeakSet()),
          (Xe = function (e) {
            let t = {
              start: Math.floor(e / n(this, Ze)) * n(this, Ze),
              data: new Uint8Array(n(this, Ze)),
              written: [],
              shouldFlush: !1,
            };
            return (
              n(this, re).push(t),
              n(this, re).sort((e, t) => e.start - t.start),
              n(this, re).indexOf(t)
            );
          }),
          (pe = new WeakSet()),
          (We = function (e = !1) {
            for (let t = 0; t < n(this, re).length; t++) {
              let i = n(this, re)[t];
              if (i.shouldFlush || e) {
                for (let e of i.written)
                  n(this, be).onData(
                    i.data.subarray(e.start, e.end),
                    i.start + e.start
                  );
                n(this, re).splice(t--, 1);
              }
            }
          });
        var Ce,
          ve,
          Ye,
          Fe,
          Se,
          Je,
          He,
          Ke,
          ke,
          xe,
          Ne,
          Ue,
          Le,
          we,
          fe,
          Te,
          Be,
          ze,
          Ae,
          Pe,
          Qe,
          Me,
          je,
          Ee,
          De,
          Oe,
          _e = class extends Re {
            constructor(e) {
              var t;
              super(
                new ce(
                  (t, i) =>
                    e.stream.write({ type: 'write', data: t, position: i }),
                  void 0,
                  { chunkSize: null == (t = e.options) ? void 0 : t.chunkSize }
                )
              );
            }
          },
          qe = 1e3,
          $e = ['avc', 'hevc'],
          et = ['aac'],
          tt = ['strict', 'offset'],
          it = class {
            constructor(e) {
              var t;
              if (
                (m(this, Ke),
                m(this, xe),
                m(this, Ue),
                m(this, we),
                m(this, Te),
                m(this, ze),
                m(this, Pe),
                m(this, Me),
                m(this, Ee),
                m(this, Ce, void 0),
                m(this, ve, void 0),
                m(this, Ye, void 0),
                m(this, Fe, null),
                m(this, Se, null),
                m(this, Je, Math.floor(Date.now() / 1e3) + 2082844800),
                m(this, He, !1),
                b(this, Ke, ke).call(this, e),
                (this.target = e.target),
                o(
                  this,
                  Ce,
                  ((e, t) => {
                    for (var i in (t ||= {})) a.call(t, i) && d(e, i, t[i]);
                    if (l) for (var i of l(t)) c.call(t, i) && d(e, i, t[i]);
                    return e;
                  })({ firstTimestampBehavior: 'strict' }, e)
                ),
                e.target instanceof ae)
              )
                o(this, ve, new me(e.target));
              else if (e.target instanceof ce)
                o(
                  this,
                  ve,
                  (null == (t = e.target.options) ? void 0 : t.chunked)
                    ? new Re(e.target)
                    : new oe(e.target)
                );
              else {
                if (!(e.target instanceof se))
                  throw new Error(`Invalid target: ${e.target}`);
                o(this, ve, new _e(e.target));
              }
              b(this, xe, Ne).call(this), b(this, Ue, Le).call(this);
            }
            addVideoChunk(e, t, i) {
              let l = new Uint8Array(e.byteLength);
              e.copyTo(l),
                this.addVideoChunkRaw(
                  l,
                  e.type,
                  null != i ? i : e.timestamp,
                  e.duration,
                  t
                );
            }
            addVideoChunkRaw(e, t, i, l, a) {
              if ((b(this, Ee, De).call(this), !n(this, Ce).video))
                throw new Error('No video track declared.');
              b(this, Te, Be).call(this, n(this, Fe), e, t, i, l, a);
            }
            addAudioChunk(e, t, i) {
              let l = new Uint8Array(e.byteLength);
              e.copyTo(l),
                this.addAudioChunkRaw(
                  l,
                  e.type,
                  null != i ? i : e.timestamp,
                  e.duration,
                  t
                );
            }
            addAudioChunkRaw(e, t, i, l, a) {
              if ((b(this, Ee, De).call(this), !n(this, Ce).audio))
                throw new Error('No audio track declared.');
              b(this, Te, Be).call(this, n(this, Se), e, t, i, l, a);
            }
            finalize() {
              n(this, Fe) && b(this, Pe, Qe).call(this, n(this, Fe)),
                n(this, Se) && b(this, Pe, Qe).call(this, n(this, Se));
              let e = n(this, ve).offsets.get(n(this, Ye)),
                t = n(this, ve).pos - e;
              (n(this, Ye).size = t), n(this, ve).patchBox(n(this, Ye));
              let i =
                ((l = [n(this, Fe), n(this, Se)].filter(Boolean)),
                (a = n(this, Je)),
                k('moov', null, [
                  N(a, l),
                  ...l.map((e) =>
                    ((e, t) => k('trak', null, [U(e, t), L(e, t)]))(e, a)
                  ),
                ]));
              var l, a;
              n(this, ve).writeBox(i),
                b(this, Me, je).call(this),
                n(this, ve).finalize(),
                o(this, He, !0);
            }
          };
        return (
          (Ce = new WeakMap()),
          (ve = new WeakMap()),
          (Ye = new WeakMap()),
          (Fe = new WeakMap()),
          (Se = new WeakMap()),
          (Je = new WeakMap()),
          (He = new WeakMap()),
          (Ke = new WeakSet()),
          (ke = function (e) {
            if (e.video && !$e.includes(e.video.codec))
              throw new Error(`Unsupported video codec: ${e.video.codec}`);
            if (e.audio && !et.includes(e.audio.codec))
              throw new Error(`Unsupported audio codec: ${e.audio.codec}`);
            if (
              e.firstTimestampBehavior &&
              !tt.includes(e.firstTimestampBehavior)
            )
              throw new Error(
                `Invalid first timestamp behavior: ${e.firstTimestampBehavior}`
              );
          }),
          (xe = new WeakSet()),
          (Ne = function () {
            var e;
            let t =
              'hevc' === (null == (e = n(this, Ce).video) ? void 0 : e.codec);
            n(this, ve).writeBox(
              ((e) =>
                k(
                  'ftyp',
                  e
                    ? [S('isom'), v(0), S('iso4'), S('hvc1')]
                    : [S('isom'), v(0), S('isom'), S('avc1'), S('mp41')]
                ))(t)
            ),
              o(this, Ye, { type: 'mdat', largeSize: !0 }),
              n(this, ve).writeBox(n(this, Ye)),
              b(this, Me, je).call(this);
          }),
          (Ue = new WeakSet()),
          (Le = function () {
            if (
              (n(this, Ce).video &&
                o(this, Fe, {
                  id: 1,
                  info: {
                    type: 'video',
                    codec: n(this, Ce).video.codec,
                    width: n(this, Ce).video.width,
                    height: n(this, Ce).video.height,
                  },
                  timescale: 720,
                  codecPrivate: new Uint8Array(0),
                  samples: [],
                  writtenChunks: [],
                  currentChunk: null,
                  firstTimestamp: void 0,
                  lastTimestamp: -1,
                  timeToSampleTable: [],
                  lastTimescaleUnits: null,
                  compactlyCodedChunkTable: [],
                }),
              n(this, Ce).audio)
            ) {
              let e = b(this, we, fe).call(
                this,
                2,
                n(this, Ce).audio.sampleRate,
                n(this, Ce).audio.numberOfChannels
              );
              o(this, Se, {
                id: n(this, Ce).video ? 2 : 1,
                info: {
                  type: 'audio',
                  codec: n(this, Ce).audio.codec,
                  numberOfChannels: n(this, Ce).audio.numberOfChannels,
                  sampleRate: n(this, Ce).audio.sampleRate,
                },
                timescale: n(this, Ce).audio.sampleRate,
                codecPrivate: e,
                samples: [],
                writtenChunks: [],
                currentChunk: null,
                firstTimestamp: void 0,
                lastTimestamp: -1,
                timeToSampleTable: [],
                lastTimescaleUnits: null,
                compactlyCodedChunkTable: [],
              });
            }
          }),
          (we = new WeakSet()),
          (fe = function (e, t, i) {
            let l = [
                96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3,
                11025, 8e3, 7350,
              ].indexOf(t),
              a = i,
              c = '';
            (c += e.toString(2).padStart(5, '0')),
              (c += l.toString(2).padStart(4, '0')),
              15 === l && (c += t.toString(2).padStart(24, '0')),
              (c += a.toString(2).padStart(4, '0'));
            let s = 8 * Math.ceil(c.length / 8);
            c = c.padEnd(s, '0');
            let d = new Uint8Array(c.length / 8);
            for (let e = 0; e < c.length; e += 8)
              d[e / 8] = parseInt(c.slice(e, e + 8), 2);
            return d;
          }),
          (Te = new WeakSet()),
          (Be = function (e, t, i, l, a, c) {
            var s;
            let d = l / 1e6,
              h = a / 1e6;
            if (
              (void 0 === e.firstTimestamp && (e.firstTimestamp = d),
              (d = b(this, ze, Ae).call(this, d, e)),
              (!e.currentChunk || d - e.currentChunk.startTimestamp >= 0.5) &&
                (e.currentChunk && b(this, Pe, Qe).call(this, e),
                (e.currentChunk = {
                  startTimestamp: d,
                  sampleData: [],
                  sampleCount: 0,
                })),
              e.currentChunk.sampleData.push(t),
              e.currentChunk.sampleCount++,
              (null == (s = null == c ? void 0 : c.decoderConfig)
                ? void 0
                : s.description) &&
                (e.codecPrivate = new Uint8Array(c.decoderConfig.description)),
              e.samples.push({
                timestamp: d,
                duration: h,
                size: t.byteLength,
                type: i,
              }),
              null !== e.lastTimescaleUnits)
            ) {
              let t = H(d, e.timescale, !1),
                i = Math.round(t - e.lastTimescaleUnits);
              e.lastTimescaleUnits += i;
              let l = J(e.timeToSampleTable);
              1 === l.sampleCount
                ? ((l.sampleDelta = i), l.sampleCount++)
                : l.sampleDelta === i
                ? l.sampleCount++
                : (l.sampleCount--,
                  e.timeToSampleTable.push({ sampleCount: 2, sampleDelta: i }));
            } else
              (e.lastTimescaleUnits = 0),
                e.timeToSampleTable.push({
                  sampleCount: 1,
                  sampleDelta: H(h, e.timescale),
                });
          }),
          (ze = new WeakSet()),
          (Ae = function (e, t) {
            if (
              'strict' === n(this, Ce).firstTimestampBehavior &&
              -1 === t.lastTimestamp &&
              0 !== e
            )
              throw new Error(
                `The first chunk for your media track must have a timestamp of 0 (received ${e}). Non-zero first timestamps are often caused by directly piping frames or audio data from a MediaStreamTrack into the encoder. Their timestamps are typically relative to the age of the document, which is probably what you want.\n\nIf you want to offset all timestamps of a track such that the first one is zero, set firstTimestampBehavior: 'offset' in the options.\n`
              );
            if (
              ('offset' === n(this, Ce).firstTimestampBehavior &&
                (e -= t.firstTimestamp),
              e < t.lastTimestamp)
            )
              throw new Error(
                `Timestamps must be monotonically increasing (went from ${
                  1e6 * t.lastTimestamp
                } to ${1e6 * e}).`
              );
            return e;
          }),
          (Pe = new WeakSet()),
          (Qe = function (e) {
            if (e.currentChunk) {
              e.currentChunk.offset = n(this, ve).pos;
              for (let t of e.currentChunk.sampleData) n(this, ve).write(t);
              (e.currentChunk.sampleData = null),
                (0 !== e.compactlyCodedChunkTable.length &&
                  J(e.compactlyCodedChunkTable).samplesPerChunk ===
                    e.currentChunk.sampleCount) ||
                  e.compactlyCodedChunkTable.push({
                    firstChunk: e.writtenChunks.length + 1,
                    samplesPerChunk: e.currentChunk.sampleCount,
                  }),
                e.writtenChunks.push(e.currentChunk),
                b(this, Me, je).call(this);
            }
          }),
          (Me = new WeakSet()),
          (je = function () {
            n(this, ve) instanceof oe && n(this, ve).flush();
          }),
          (Ee = new WeakSet()),
          (De = function () {
            if (n(this, He))
              throw new Error(
                'Cannot add new video or audio chunks after the file has been finalized.'
              );
          }),
          (Oe = Z),
          ((l, c, s, d) => {
            if ((c && 'object' == typeof c) || 'function' == typeof c)
              for (let s of i(c))
                a.call(l, s) ||
                  undefined === s ||
                  e(l, s, {
                    get: () => c[s],
                    enumerable: !(d = t(c, s)) || d.enumerable,
                  });
            return l;
          })(e({}, '__esModule', { value: !0 }), Oe)
        );
      })();
      'object' == typeof e.exports &&
        ((e.exports.Muxer = t.Muxer),
        (e.exports.ArrayBufferTarget = t.ArrayBufferTarget),
        (e.exports.StreamTarget = t.StreamTarget),
        (e.exports.FileSystemWritableFileStreamTarget =
          t.FileSystemWritableFileStreamTarget));
    },
  },
  t = {};
function i(l) {
  var a = t[l];
  if (void 0 !== a) return a.exports;
  var c = (t[l] = { exports: {} });
  return e[l](c, c.exports, i), c.exports;
}
(i.d = (e, t) => {
  for (var l in t)
    i.o(t, l) &&
      !i.o(e, l) &&
      Object.defineProperty(e, l, { enumerable: !0, get: t[l] });
}),
  (i.g = (function () {
    if ('object' == typeof globalThis) return globalThis;
    try {
      return this || new Function('return this')();
    } catch (e) {
      if ('object' == typeof window) return window;
    }
  })()),
  (i.o = (e, t) => Object.prototype.hasOwnProperty.call(e, t));
var l = {};
(() => {
  i.d(l, { l: () => p });
  let e = {
    LivenessMode: { None: 0, Passive: 3 },
    ExceptionType: {
      CameraError: 0,
      ExtractorError: 1,
      ControlNotInitializedError: 2,
      ImageCropResizeError: 3,
      UnexpectedCaptureError: 4,
      InitializingEngineError: 5,
    },
    TemplateFormat: { ByteArray: 0, Base64: 1 },
    ImageFormat: {
      None: 0,
      Gray_8bpp: 1,
      RGB_24bpp: 2,
      BGR_24bpp: 3,
      ARGB_32bpp: 4,
      YUV_NV21: 5,
      ABGR_32bpp: 6,
      BGRA_32bpp: 7,
      RGBA_32bpp: 8,
    },
    SampleDiagnostic: {
      Ok: 0,
      FaceNotFound: 1,
      RightEyeNotFound: 2,
      LeftEyeNotFound: 3,
      EyesNotFound: 4,
      FaceTooFar: 5,
      FaceTooClose: 6,
      TooCloseToWindowSide: 7,
      AngleExceeded: 8,
      QualityCheckFailed: 9,
      NotRated: 10,
      TooManyFaces: 11,
    },
    FinalDiagnostic: {
      InsufficientValidSamples: 0,
      TemplateCreationInProgress: 1,
      TemplateCreated: 2,
    },
    LivenessDiagnostic: {
      NotRated: 0,
      PhotoDetected: 1,
      LivenessDetected: 2,
      Unsuccess: 3,
      UnsuccessLowPerformance: 4,
      UnsuccessGlasses: 5,
      UnsuccessLight: 6,
      UnsuccessNoMovement: 7,
      UnsuccessWrongDirection: 8,
      UnsuccessTooFar: 9,
    },
    RecorderType: { Local: 0, Remote: 1 },
    CameraType: { Front: 0, Back: 1 },
    TrackStatus: {
      ChangeState: 0,
      Tap: 1,
      FaceState: 2,
      AccessibilityData: 3,
      Diagnostic: 4,
    },
    Version: '5.37.0',
  };
  class t {
    constructor(e, t, i) {
      (this.graphUrl = e),
        (this.graphReadyEvent = t),
        (this.graphNewStateEvent = i),
        (this.xmlHttpWidget = new XMLHttpRequest()),
        (this.xmlHttpWidget.onreadystatechange = this.readyEvent.bind(this)),
        this.xmlHttpWidget.open('GET', this.graphUrl),
        this.xmlHttpWidget.send(null);
    }
    readyEvent(e) {
      if (4 == e.target.readyState && 200 == e.target.status) {
        var t = new DOMParser();
        (this.xmlDoc = t.parseFromString(e.target.responseText, 'text/xml')),
          this.graphReadyEvent();
      }
    }
    setInitialState(e) {
      null != this.xmlDoc.querySelector("[name='" + e + "']") &&
        ((this.state = e), this.graphNewStateEvent(this.state));
    }
    sendMessage(e) {
      var t = this.xmlDoc.querySelector("[name='" + this.state + "']");
      if (null != t) {
        var i = t.querySelector("[message='" + e + "']");
        if (
          null != i ||
          ((e = e.split('//')[0]),
          null != (i = t.querySelector("[message='" + e + "']")))
        ) {
          var l = i.getAttribute('to');
          (this.state = l), this.graphNewStateEvent(this.state);
        }
      }
    }
  }
  class a {
    constructor(e, t, i, l, a, c, s) {
      var d = '';
      (this.status = 0),
        (this.logDebug = !1),
        (this.eventStatus = l),
        (this.caller = i),
        (this.baseURL = e),
        t.length > 0 && (d = t + '.'),
        (this.widgetLoaded = 0),
        (this.languageCustomLoaded = 0),
        (this.languageDefaultLoaded = 0),
        (this.urlWidget = e + '/widget.xml'),
        (this.urlLanguageCustom = e + '/strings/strings.' + d + 'xml'),
        (this.urlLanguageDefault = e + '/strings/strings.es.xml'),
        (this.resourceDict = {}),
        (this.dpiList = a),
        (this.browserDpi = c),
        (this.scaleFactor = s);
      for (
        var h = 163 * c * s, n = this.dpiList.length - 1, m = 0;
        m < this.dpiList.length;
        m++
      )
        if (this.dpiList[m] > h) {
          n = m;
          break;
        }
      (this.dpi = this.dpiList[n]),
        (this.imageScale = 163 / this.dpi),
        (this.xmlHttpWidget = new XMLHttpRequest()),
        (this.xmlHttpWidget.rm = this),
        (this.xmlHttpWidget.onreadystatechange = (e) => {
          if (4 == e.target.readyState && 200 == e.target.status) {
            var t = new DOMParser();
            (e.target.rm.widgetLoaded = 1),
              (e.target.rm.xmlDoc = t.parseFromString(
                e.target.responseText,
                'text/xml'
              ));
          } else
            4 == e.target.readyState &&
              200 != e.target.status &&
              (e.target.rm.widgetLoaded = -1);
          e.target.rm.readyEvent(e);
        }),
        this.xmlHttpWidget.open('GET', this.urlWidget),
        this.xmlHttpWidget.send(null),
        (this.xmlHttpLanguageCustom = new XMLHttpRequest()),
        (this.xmlHttpLanguageCustom.rm = this),
        (this.xmlHttpLanguageCustom.onreadystatechange = (e) => {
          4 == e.target.readyState && 200 == e.target.status
            ? (e.target.rm.languageCustomLoaded = 1)
            : 4 == e.target.readyState &&
              200 != e.target.status &&
              (e.target.rm.languageCustomLoaded = -1),
            e.target.rm.readyEvent(e);
        }),
        this.xmlHttpLanguageCustom.open('GET', this.urlLanguageCustom),
        this.xmlHttpLanguageCustom.send(null);
    }
    readyEvent(e) {
      if (
        0 !== e.target.rm.widgetLoaded &&
        (0 !== e.target.rm.languageCustomLoaded ||
          0 !== e.target.rm.languageDefaultLoaded)
      ) {
        if (-1 == e.target.rm.widgetLoaded) e.target.rm.status = -1;
        else if (1 == e.target.rm.languageCustomLoaded) {
          var t = e.target.rm.xmlHttpLanguageCustom.responseText,
            i = new DOMParser();
          (e.target.rm.xmlLang = i.parseFromString(t, 'text/xml')),
            (e.target.rm.status = 1);
        } else
          1 == e.target.rm.languageDefaultLoaded
            ? ((t = e.target.rm.xmlHttpLanguageDefault.responseText),
              (i = new DOMParser()),
              (e.target.rm.xmlLang = i.parseFromString(t, 'text/xml')),
              (e.target.rm.status = 1))
            : (e.target.rm.status = -1);
        if (1 == e.target.rm.status) {
          let t,
            i = {},
            l = e.target.rm.xmlDoc.querySelectorAll('[font]');
          for (let e = 0; e < l.length; e++)
            (t = l[e].getAttribute('font')), t.length > 0 && (i[t] = t);
          e.target.rm.fontRequestVector = [];
          let a,
            c = document.getElementById('FPhi_Widget_style');
          for (a in (null != c && c.remove(),
          (c = document.createElement('style')),
          (c.id = 'FPhi_Widget_style'),
          i)) {
            let t = e.target.rm.getResourceUrlBase(i[a]),
              l = i[a],
              s = new XMLHttpRequest();
            s.open('GET', t, !1),
              s.send(),
              200 == s.status &&
                c.appendChild(
                  document.createTextNode(
                    "@font-face { font-family: '" +
                      l +
                      "'; src: url('" +
                      t +
                      "'); }"
                  )
                );
          }
          document.head.appendChild(c),
            e.target.rm.eventStatus(e.target.rm.caller, !0);
        } else e.target.rm.eventStatus(e.target.rm.caller, !1);
      }
    }
    static httpGet(e, t) {
      var i = new XMLHttpRequest();
      return (
        (i.onreadystatechange = t),
        i.open('GET', e),
        i.send(null),
        200 != i.status ? '' : i.responseText
      );
    }
    getElement(e, t, i) {
      if ('facephi-widget-conf' == e)
        return this.xmlDoc.getElementsByTagName('facephi-widget-conf')[0];
      var l = '_portrait';
      i && (l = '_landscape');
      var a = this.xmlDoc.querySelector('[id=' + e + l + ']');
      if (
        ((null != a && null != a) ||
          (a = this.xmlDoc.querySelector('[id=' + e + ']')),
        this.logDebug && console.log(a),
        null != a)
      ) {
        var c = a.querySelector('[id=' + t + ']');
        return (
          this.logDebug && console.log(c),
          null == c
            ? void console.log(
                'ResourceManager::getElement Error. elementId=' +
                  t +
                  " undefined. Please verify resource's bundle."
              )
            : c
        );
      }
      console.log(
        'ResourceManager::getElement Error. viewId=' +
          e +
          " undefined. Please verify resource's bundle."
      );
    }
    getElements(e, t) {
      var i = '_portrait';
      t && (i = '_landscape');
      var l = this.xmlDoc.querySelector('[id=' + e + i + ']');
      (null != l && null != l) ||
        (l = this.xmlDoc.querySelector('[id=' + e + ']'));
      var a = [];
      if (l)
        for (var c = 0; c < l.childNodes.length; c++)
          if (l.childNodes[c].nodeType == Node.ELEMENT_NODE) {
            var s = null;
            void 0 !== l.childNodes[c].attributes.mode &&
              (s = l.childNodes[c].attributes.mode.value),
              a.push({
                type: l.childNodes[c].nodeName,
                id: l.childNodes[c].attributes.id.value,
                mode: s,
              });
          }
      return (
        0 == a.length &&
          console.log('FPhi.ResourceManager: No elements for view=' + e),
        a
      );
    }
    isAttributeAvailable(e, t, i, l) {
      var a = null;
      if ('facephi-widget-conf' == e)
        a = this.xmlDoc.getElementsByTagName('facephi-widget-conf')[0];
      else {
        var c = '_portrait';
        i && (c = '_landscape');
        var s = this.xmlDoc.querySelector('[id=' + e + c + ']');
        if (
          ((null != s && null != s) ||
            (s = this.xmlDoc.querySelector('[id=' + e + ']')),
          null != s)
        ) {
          var d = s.querySelector('[id=' + t + ']');
          null != d && (a = d);
        }
      }
      if (null == a || null == a) return !1;
      var h = a.getAttribute(l);
      return null != h && null != h;
    }
    getSetupColor(e, t, i, l) {
      var a = this.getElement(e, t, i);
      if (null == a || null == a) return null;
      var c,
        s,
        d,
        h,
        n = a.getAttribute(l);
      return null == n || null == n
        ? null
        : (9 == n.length &&
            ((c = parseInt(n.substring(1, 3), 16)),
            (s = parseInt(n.substring(3, 5), 16)),
            (d = parseInt(n.substring(5, 7), 16)),
            (h = parseInt(n.substring(7, 9), 16)),
            (n =
              'rgba(' +
              c +
              ', ' +
              s +
              ', ' +
              d +
              ', ' +
              (h /= 255).toFixed(3) +
              ')')),
          n);
    }
    getSetupColorWithAlpha(e, t, i, l, a) {
      var c = this.getElement(e, t, i).getAttribute(l);
      return (
        'rgba(' +
        parseInt(c.substring(1, 3), 16) +
        ', ' +
        parseInt(c.substring(3, 5), 16) +
        ', ' +
        parseInt(c.substring(5, 7), 16) +
        ', ' +
        a.toFixed(3) +
        ')'
      );
    }
    getSetupFloat(e, t, i, l) {
      var a = this.getElement(e, t, i).getAttribute(l);
      return parseFloat(a);
    }
    getSetupAlign(e, t, i, l) {
      return this.getElement(e, t, i).getAttribute(l);
    }
    getSetupResourceId(e, t, i, l) {
      var a = this.getElement(e, t, i).getAttribute(l),
        c = a.split(',');
      return c && c.length > 1
        ? c[Math.floor(Math.random() * c.length)].trim()
        : a;
    }
    getSetupTextId(e, t, i, l) {
      return this.getElement(e, t, i).getAttribute(l);
    }
    getSetupNodeType(e, t, i) {
      return this.getElement(e, t, i).getAttribute('content_type');
    }
    getResourceUrl(e) {
      return this.baseURL + '/resources/' + this.dpi + 'dpi/' + e;
    }
    getResourceUrlBase(e) {
      return this.baseURL + '/resources/' + this.dpiList[0] + 'dpi/' + e;
    }
    getImageScale() {
      return this.imageScale;
    }
    getImage(e) {
      if (!(e in this.resourceDict)) {
        var t = this.getResourceUrl(e),
          i = document.createElement('img');
        (i.src = t), (this.resourceDict[e] = i);
      }
      return this.resourceDict[e];
    }
    translate(e) {
      var t = e,
        i = this.xmlLang.querySelector('[id=' + e + ']');
      return (
        this.logDebug && console.log(i), null != i && (t = i.textContent), t
      );
    }
  }
  class c {
    constructor(e) {
      (this.width = 0), (this.height = 0), (this.landscape = !1);
    }
    cacheResources() {}
    setCanvasSize(e, t) {
      (this.width = e),
        (this.height = t),
        (this.landscape = this.width >= this.height);
    }
    getCameraRect(e, t, i, l) {
      this.setCanvasSize(e.canvas.clientWidth, e.canvas.clientHeight);
      var a = this.scaleRect(
        { width: t, height: i },
        { x: 0, y: 0, width: this.width, height: this.height }
      );
      return (a.visible = !0), a;
    }
    getResourceIdForState(e) {
      throw new Error(
        "FPhi.Widget.drawer.abstract.js: Can't instantiate abstract class"
      );
    }
    onMouseMove(e, t, i, l, a) {
      e.style.cursor =
        'button' == a || 'buttonImage' == a ? 'pointer' : 'default';
    }
    draw(e, t, i, l, a, c, s, d, h) {
      throw new Error("Can't instantiate abstract class");
    }
    getLayout(e, t, i, l, a, c, s) {
      throw new Error("Can't instantiate abstract class");
    }
    cacheAnimation(e, t) {
      if (this.rm.isAttributeAvailable(e, t, this.landscape, 'id'))
        for (
          var i = this.rm.getSetupResourceId(e, t, this.landscape, 'name'),
            l = this.rm.getSetupResourceId(e, t, this.landscape, 'ext'),
            a = parseInt(
              this.rm.getSetupResourceId(e, t, this.landscape, 'start')
            ),
            c = parseInt(
              this.rm.getSetupResourceId(e, t, this.landscape, 'end')
            ),
            s = a;
          s <= c;
          s++
        ) {
          var d = i + ('0' + s).slice(-2) + '.' + l;
          this.rm.getImage(d);
        }
    }
    scaleRect(e, t, i) {
      var l = t.x + t.width / 2,
        a = t.y + t.height / 2,
        c = t.width / e.width,
        s = t.height / e.height,
        d = e.width * c,
        h = e.height * c;
      return (
        null == i
          ? h < t.height && ((d = e.width * s), (h = e.height * s))
          : h >= t.height && ((d = e.width * s), (h = e.height * s)),
        { x: l - d / 2, y: a - h / 2, width: d, height: h }
      );
    }
    drawButtonImage(e, t, i, l, a, c, s, d) {
      var h = this.rm.getSetupResourceId(i, l, this.landscape, 'value'),
        n = this.rm.getImage(h),
        m = this.canvasSizeFactor * this.rm.getImageScale(),
        o = n.width * m,
        b = n.height * m;
      e.drawImage(
        n,
        t.x + t.width / 2 - o / 2,
        t.y + t.height / 2 - b / 2,
        o,
        b
      );
    }
    fillRoundRect(e, t, i, l, a, c) {
      l < 2 * c && (c = l / 2),
        a < 2 * c && (c = a / 2),
        e.beginPath(),
        e.moveTo(t + c, i),
        e.arcTo(t + l, i, t + l, i + a, c),
        e.arcTo(t + l, i + a, t, i + a, c),
        e.arcTo(t, i + a, t, i, c),
        e.arcTo(t, i, t + l, i, c),
        e.closePath(),
        e.fill();
    }
    drawButton(e, t, i, l) {
      if (this.rm.isAttributeAvailable(i, l, this.landscape, 'radius')) {
        let a = this.rm.getSetupFloat(i, l, this.landscape, 'radius');
        (e.fillStyle = this.rm.getSetupColor(
          i,
          l,
          this.landscape,
          'decorator'
        )),
          this.fillRoundRect(e, t.x, t.y + 4, t.width, t.height - 4, a),
          (e.fillStyle = this.rm.getSetupColor(
            i,
            l,
            this.landscape,
            'background'
          )),
          this.fillRoundRect(e, t.x, t.y, t.width, t.height - 4, a);
      } else
        (e.fillStyle = this.rm.getSetupColor(
          i,
          l,
          this.landscape,
          'decorator'
        )),
          e.fillRect(t.x, t.y + 4, t.width, t.height - 4),
          (e.fillStyle = this.rm.getSetupColor(
            i,
            l,
            this.landscape,
            'background'
          )),
          e.fillRect(t.x, t.y, t.width, t.height - 4);
      var a = this.rm.getSetupAlign(i, l, this.landscape, 'align'),
        c = this.rm.getSetupNodeType(i, l),
        s = 10 * this.canvasSizeFactor;
      if ('TEXT_ID' == c) {
        var d = this.rm.getSetupTextId(i, l, this.landscape, 'content'),
          h = this.rm.translate(d),
          n = this.rm.getSetupFloat(i, l, this.landscape, 'font_size');
        n = Math.round(n * this.fontSizeFactor);
        var m = this.rm.getSetupResourceId(i, l, this.landscape, 'font');
        (e.font = n + "px '" + m + "'"),
          (e.fillStyle = this.rm.getSetupColor(
            i,
            l,
            this.landscape,
            'foreground'
          ));
        var o = e.measureText(h);
        'LEFT' == a
          ? e.fillText(h, t.x + s, t.y + t.height / 2)
          : 'RIGHT' == a
          ? e.fillText(h, t.x + t.width - o.width - s, t.y + t.height / 2)
          : e.fillText(h, t.x + t.width / 2 - o.width / 2, t.y + t.height / 2);
      } else {
        d = this.rm.getSetupResourceId(i, l, this.landscape, 'content');
        var b = this.rm.getImage(d),
          Z = this.canvasSizeFactor * this.rm.getImageScale();
        'LEFT' == a
          ? e.drawImage(
              b,
              t.x + s,
              t.y + t.height / 2 - (b.height * Z) / 2,
              b.width * Z,
              b.height * Z
            )
          : 'RIGHT' == a
          ? e.drawImage(
              b,
              t.x + t.width - b.width * Z - s,
              t.y + t.height / 2 - (b.height * Z) / 2,
              b.width * Z,
              b.height * Z
            )
          : e.drawImage(
              b,
              t.x + t.width / 2 - (b.width * Z) / 2,
              t.y + t.height / 2 - (b.height * Z) / 2,
              b.width * Z,
              b.height * Z
            );
      }
    }
    drawImage(e, t, i, l, a, c, s, d) {
      var h = this.rm.getSetupResourceId(i, l, this.landscape, 'value'),
        n = this.rm.getImage(h),
        m = !1;
      if (
        (this.rm.isAttributeAvailable(i, l, this.landscape, 'scale') &&
          'CONTAINER' ==
            this.rm.getSetupResourceId(i, l, this.landscape, 'scale') &&
          (m = !0),
        m)
      )
        e.drawImage(n, t.x, t.y, t.width, t.height);
      else {
        var o = this.canvasSizeFactor * this.rm.getImageScale(),
          b = n.width * o,
          Z = n.height * o;
        e.drawImage(
          n,
          t.x + t.width / 2 - b / 2,
          t.y + t.height / 2 - Z / 2,
          b,
          Z
        );
      }
    }
    drawImageWithClippingCircle(e, t, i, l, a, c) {
      e.save(),
        e.beginPath(),
        e.arc(l, a, c, 0, 2 * Math.PI, !1),
        e.clip(),
        e.drawImage(i, t.x, t.y, t.width, t.height),
        e.restore();
    }
    drawStringMultiline(e, t, i, l, a, c, s, d, h, n = []) {
      if (!(c <= 0)) {
        (e.imageSmoothingEnabled = !1),
          (c = Math.round(c * this.fontSizeFactor)),
          (e.font = c + "px '" + a + "'"),
          (e.fillStyle = l),
          (e.textBaseline = 'middle');
        var m = t.split('\n');
        if (n.length > 0) {
          let Z = !0;
          for (var o = 0; o < m.length; o++) {
            var b = e.measureText(m[o]);
            let t = o;
            t >= n.length && (t = n.length - 1),
              b.width > i.width * n[t] && (Z = !1);
          }
          if (0 == Z)
            return void this.drawStringMultiline(
              e,
              t,
              i,
              l,
              a,
              c - 1,
              s,
              d,
              h,
              n
            );
        }
        var Z = i.y;
        if ('CENTER' == h) {
          var r = m.length * s;
          Z = i.y + i.height / 2 - r / 2 + c / 2;
        } else 'BOTTOM' == h && ((r = m.length * s), (Z = i.y + i.height - r));
        for (o = 0; o < m.length; o++) {
          b = e.measureText(m[o]);
          var u = i.width / 2 - b.width / 2;
          'LEFT' == d ? (u = 0) : 'RIGHT' == d && (u = i.width - b.width),
            e.fillText(m[o], i.x + u, Z + o * s);
        }
      }
    }
  }
  if (!s) var s = {};
  s.SelphID = e;
  class d extends c {
    constructor(e) {
      super(e),
        (this.livenessMode = e.livenessMode),
        (this.stabilizationStage = e.stabilizationStage),
        (this.canvasSizeFactor = e.canvasSizeFactor),
        (this.fontSizeFactor = e.fontSizeFactor),
        (this.buttonHeight = 60 * this.canvasSizeFactor),
        (this.faceCenterOffset = { x: 0, y: 0 }),
        (this.faceCenterOffsetTarget = { x: 0, y: 0 }),
        (this.enableButtonCamera = e.enableButtonCamera),
        (this.cameraCount = 0);
    }
    setCanvasSize(e, t) {
      (this.width = e),
        (this.height = t),
        (this.landscape = this.width >= this.height),
        (this.circleX = this.width / 2),
        (this.circleY = 0.38 * this.height),
        (this.circleRadius = 0.31 * this.height),
        this.circleRadius > this.width / 2 - 15 &&
          (this.circleRadius = this.width / 2 - 15);
    }
    getCameraRect(e, t, i, l) {
      this.setCanvasSize(e.canvas.clientWidth, e.canvas.clientHeight);
      var a = this.scaleRect(
        { width: t, height: i },
        {
          x: this.circleX - this.circleRadius,
          y: this.circleY - this.circleRadius,
          width: 2 * this.circleRadius,
          height: 2 * this.circleRadius,
        }
      );
      return (a.visible = !0), a;
    }
    faceInsideCircle(e) {
      var t = this.circleRadius,
        i = this.circleX,
        l = this.circleY,
        a = i - t,
        c = i + t,
        s = l - t,
        d = l + t,
        h = { x: e.x, y: e.y, width: e.width, height: e.height };
      return (
        (Math.max(0, Math.min(h.x + h.width, c) - Math.max(h.x, a)) *
          Math.max(0, Math.min(h.y + h.height, d) - Math.max(h.y, s))) /
          (h.width * h.height) >
        0.75
      );
    }
    getResourceIdForState(e) {
      return 'UCWaitingFaceStart' == e || 'UCCameraSwitch' == e
        ? 'StartExtractor'
        : 'UCExtracting' == e ||
          'UCLivenessDetectionStep1' == e ||
          'UCLivenessDetectionStep2' == e ||
          'UCLivenessDetectionStep3' == e ||
          'UCWaitingEyeDetection' == e
        ? 'Extractor'
        : 'UCLivenessMoveStabilizing' == e ||
          'UCLivenessMoveStabilized' == e ||
          'UCLivenessMoveDetecting' == e ||
          'UCLivenessMoveProcessing' == e
        ? 'LivenessMove'
        : 'UCLivenessMoveInfo' == e
        ? 'LivenessInfo'
        : 'UCTutorialRegister1' == e
        ? 'RegistrationTips'
        : 'UCTutorialRegister2' == e
        ? 'FaceMovementTips'
        : 'UCShowResults' == e
        ? 'Results'
        : 'UCWizardCompleted' == e
        ? 'Success'
        : 'UCTutorialBlink1' == e
        ? 'Tutorial1'
        : 'UCTutorialBlink2' == e
        ? 'Tutorial2'
        : 'UCTutorialBlink3' == e
        ? 'Tutorial3'
        : 'UCTutorialMove1' == e
        ? 'TutorialMove1'
        : 'UCTutorialMove2' == e
        ? 'TutorialMove2'
        : 'UCTutorialMove3' == e
        ? 'TutorialMove3'
        : 'UCWaitRecording' == e
        ? 'WaitRecording'
        : 'UCErrors' == e || 'UCErrorFinish' == e
        ? 'Error'
        : 'UCFinish' == e
        ? 'Finish'
        : null;
    }
    onMouseMove(e, t, i, l, a) {
      e.style.cursor =
        'button' == a || 'buttonImage' == a ? 'pointer' : 'default';
    }
    draw(e, t, i, l, a, c, s, d, h) {
      if (((e.imageSmoothingEnabled = !0), 'background' == a))
        this.drawBackground(e, t, i, l, c, s, d, h);
      else if ('backgroundFull' == a)
        this.drawBackgroundFull(e, t, i, l, c, s, d, h);
      else if ('button' == a) this.drawButton(e, t, i, l);
      else if ('buttonImage' == a) this.drawButtonImage(e, t, i, l, c, s, d, h);
      else if ('image' == a) this.drawImage(e, t, i, l, c, s, d, h);
      else if ('imageError' == a) this.drawImageError(e, t, i, l, c, s, d, h);
      else if ('text' == a) this.drawText(e, t, i, l, c, s, d, h);
      else if ('faceSearcher' == a)
        this.drawFaceSearcher(e, t, i, l, c, s, d, h);
      else if ('video' == a)
        'Extractor' == i ||
          this.drawImageWithClippingCircle(
            e,
            t,
            h.player,
            t.x + t.width / 2,
            t.y + t.height / 2,
            t.width / 2
          );
      else if ('camera' == a) {
        var n = h.progress,
          m = this.rm.getSetupFloat(
            'facephi-widget-conf',
            '',
            this.landscape,
            'width_progress_bar'
          ),
          o = this.rm.getSetupColor(
            'facephi-widget-conf',
            '',
            this.landscape,
            'color_progress_bar'
          ),
          b = this.rm.getSetupColor(
            'facephi-widget-conf',
            '',
            this.landscape,
            'color_warning_message'
          ),
          Z = this.rm.getSetupColor(
            'facephi-widget-conf',
            '',
            this.landscape,
            'color_quality_excellent'
          ),
          r = this.rm.getSetupColor(
            'facephi-widget-conf',
            '',
            this.landscape,
            'color_quality_low'
          );
        let a = 'solid';
        this.rm.isAttributeAvailable(i, l, this.landscape, 'type') &&
          (a = this.rm.getSetupResourceId(i, l, this.landscape, 'type')),
          e.save(),
          e.beginPath(),
          e.arc(
            this.circleX,
            this.circleY,
            this.circleRadius,
            0,
            2 * Math.PI,
            !1
          ),
          e.clip(),
          ('UCLivenessMoveStabilizing' != h.state &&
            'UCLivenessMoveStabilized' != h.state &&
            'UCLivenessMoveDetecting' != h.state &&
            'UCLivenessMoveProcessing' != h.state) ||
            ((e.fillStyle = '#00000033'),
            e.fillRect(t.x, t.y, t.width, t.height)),
          e.restore();
        var u = o;
        if (
          ('Warning' == d && (u = b),
          'UCLivenessMoveStabilized' == h.state ||
            'UCLivenessMoveDetecting' == h.state ||
            'UCLivenessMoveProcessing' == h.state)
        )
          (n = 1),
            (u = h.liveness_move_last_result ? Z : r),
            ('UCLivenessMoveDetecting' != h.state &&
              'UCLivenessMoveProcessing' != h.state) ||
              (e.beginPath(),
              (e.strokeStyle = o),
              (e.lineWidth = m),
              (e.lineCap = 'round'),
              e.arc(
                this.circleX,
                this.circleY,
                this.circleRadius - e.lineWidth / 2 + 0.5,
                -Math.PI / 2,
                2 * Math.PI - Math.PI / 2
              ),
              e.stroke());
        else if ((n > 1 && (n = 1), (n = n * n * (3 - 2 * n)), 'solid' == a))
          'UCLivenessMoveStabilizing' == h.state && (n = 1),
            0 == n &&
              'Warning' == d &&
              (e.beginPath(),
              (e.strokeStyle = r),
              (e.lineWidth = m),
              (e.lineCap = 'round'),
              e.arc(
                this.circleX,
                this.circleY,
                this.circleRadius - e.lineWidth / 2 + 0.5,
                -Math.PI / 2,
                2 * Math.PI - Math.PI / 2
              ),
              e.stroke()),
            e.beginPath(),
            (e.strokeStyle = u),
            (e.lineWidth = m),
            (e.lineCap = 'round'),
            e.arc(
              this.circleX,
              this.circleY,
              this.circleRadius - e.lineWidth / 2 + 0.5,
              -Math.PI / 2,
              2 * Math.PI * n - Math.PI / 2
            ),
            e.stroke();
        else if ('bars' == a) {
          let t = this.rm.getSetupFloat(i, l, this.landscape, 'elements'),
            a = this.rm.getSetupFloat(i, l, this.landscape, 'area');
          a = ((2 * Math.PI * this.circleRadius) / t) * a;
          let c = 2;
          this.rm.isAttributeAvailable(i, l, this.landscape, 'offset') &&
            (c = this.rm.getSetupFloat(i, l, this.landscape, 'offset'));
          let s = '#939298';
          this.rm.isAttributeAvailable(
            i,
            l,
            this.landscape,
            'background_color'
          ) &&
            (s = this.rm.getSetupColor(
              i,
              l,
              this.landscape,
              'background_color'
            )),
            'Warning' != d && 0 == n && (u = s);
          let o = 2 * Math.PI * n;
          e.save(), e.translate(this.circleX, this.circleY);
          let b = (2 * Math.PI) / t;
          for (let i = 0; i < t; i++)
            (b * i < o || 0 == o) && 'UCExtracting' == h.state
              ? (e.fillStyle = u)
              : (e.fillStyle = s),
              e.fillRect(-a / 2, -this.circleRadius - c - m, a, m),
              e.rotate(b);
          e.restore();
        }
      } else if ('results' == a) {
        var g = s / (1 + 1.5 * h.progress);
        g > 1 && (g = 1),
          (g = (g *= 2 - g) < 0.5 ? 2 * g * g : (4 - 2 * g) * g - 1),
          e.beginPath(),
          (e.fillStyle = this.rm.getSetupColor(
            i,
            l,
            this.landscape,
            'background_color'
          )),
          e.arc(
            this.circleX,
            this.circleY,
            this.circleRadius,
            -Math.PI / 2,
            2 * Math.PI - Math.PI / 2
          ),
          e.fill();
        var y = this.rm.getSetupColor(
          'facephi-widget-conf',
          '',
          this.landscape,
          'color_quality_excellent'
        );
        h.progress <= 0.33
          ? (y = this.rm.getSetupColor(
              'facephi-widget-conf',
              '',
              this.landscape,
              'color_quality_low'
            ))
          : h.progress <= 0.66 &&
            (y = this.rm.getSetupColor(
              'facephi-widget-conf',
              '',
              this.landscape,
              'color_quality_good'
            )),
          e.beginPath(),
          (e.strokeStyle = y),
          (e.lineWidth = this.rm.getSetupFloat(
            'facephi-widget-conf',
            '',
            this.landscape,
            'width_progress_bar'
          )),
          (e.lineCap = 'round'),
          e.arc(
            this.circleX,
            this.circleY,
            this.circleRadius - (e.lineWidth / 2) * 0.5,
            -Math.PI / 2,
            2 * Math.PI * h.progress * g - Math.PI / 2
          ),
          e.stroke();
        var I = '',
          G = '';
        h.progress >= 1
          ? ((I = this.rm.translate('results_quality_excellent')),
            (G = this.rm.translate('results_quality_message')))
          : h.progress >= 0.333
          ? ((I = this.rm.translate('results_quality_good')),
            (G = this.rm.translate('results_quality_message')))
          : ((I = this.rm.translate('results_quality_low')),
            (G = this.rm.translate('results_quality_message')));
        var X = this.rm.getSetupFloat(i, l, this.landscape, 'fontResult_size'),
          p = X + 1,
          W = this.rm.getSetupResourceId(i, l, this.landscape, 'fontResult'),
          V = 'CENTER',
          R = 'TOP';
        this.drawStringMultiline(
          e,
          I,
          { x: 0, y: this.circleY - 5, width: this.width, height: this.height },
          y,
          W,
          X,
          p,
          V,
          R
        ),
          (p =
            (X = this.rm.getSetupFloat(
              i,
              l,
              this.landscape,
              'fontQuality_size'
            )) + 1),
          (W = this.rm.getSetupResourceId(i, l, this.landscape, 'fontQuality')),
          (V = 'CENTER'),
          (R = 'TOP'),
          this.drawStringMultiline(
            e,
            G,
            {
              x: 0,
              y: this.circleY + 5 + X,
              width: this.width,
              height: this.height,
            },
            y,
            W,
            X,
            p,
            V,
            R
          );
      } else if ('animation' == a) {
        var C = 0;
        'livenessMoveDirection' in h && (C = h.livenessMoveDirection),
          'liveness_move' != l && (C = 0),
          this.drawAnimation(e, t, i, l, c, s, d, h, C);
      } else if ('progress' == l)
        (e.fillStyle = this.rm.getSetupColor(
          i,
          l,
          this.landscape,
          'background_color'
        )),
          e.fillRect(t.x, t.y, t.width, t.height),
          (e.fillStyle = this.rm.getSetupColor(
            i,
            l,
            this.landscape,
            'progress_color'
          )),
          e.fillRect(t.x, t.y, t.width * h.progress, t.height);
      else if ('progressRecord' == l) {
        (e.fillStyle = this.rm.getSetupColor(
          i,
          l,
          this.landscape,
          'background_color'
        )),
          e.fillRect(t.x, t.y, t.width, t.height),
          (e.fillStyle = this.rm.getSetupColor(
            i,
            l,
            this.landscape,
            'progress_color'
          ));
        let a = 0.2 * t.width,
          c = (s % 2) / 1.6,
          d = t.width * c - a,
          h = d + a;
        d < 0 && (d = 0),
          d > t.width && (d = t.width),
          h > t.width && (h = t.width),
          e.fillRect(t.x + d, t.y, h - d, t.height);
      }
    }
    getLayout(e, t, i, l, a, c, s) {
      if (
        'Tutorial1' == e ||
        'Tutorial2' == e ||
        'Tutorial3' == e ||
        'TutorialMove1' == e ||
        'TutorialMove2' == e ||
        'TutorialMove3' == e
      ) {
        if ('background' == t)
          return { x: 0, y: 0, width: this.width, height: this.height };
        if ('backgroundFull' == i)
          return { x: 0, y: 0, width: this.width, height: this.height };
        if ('video' == i)
          return {
            x: this.circleX - this.circleRadius,
            y: this.circleY - this.circleRadius,
            width: 2 * this.circleRadius,
            height: 2 * this.circleRadius,
          };
        if ('tip' == t)
          return {
            x: 0,
            y: 0.75 * this.height,
            width: this.width,
            height: 0.1 * this.height,
          };
        if ('tip_detail' == t)
          return {
            x: 0,
            y: 0.82 * this.height,
            width: this.width,
            height: 0.1 * this.height,
          };
        if ('button_skip' == t)
          return {
            x: 0,
            y: this.height - this.buttonHeight,
            width: this.width / 2,
            height: this.buttonHeight,
          };
        if ('button_back' == t)
          return {
            x: 0,
            y: this.height - this.buttonHeight,
            width: this.width / 2,
            height: this.buttonHeight,
          };
        if ('button_next' == t)
          return {
            x: this.width / 2,
            y: this.height - this.buttonHeight,
            width: this.width / 2,
            height: this.buttonHeight,
          };
        if ('button_done' == t)
          return {
            x: this.width / 2,
            y: this.height - this.buttonHeight,
            width: this.width / 2,
            height: this.buttonHeight,
          };
        if ('button_exit' == t) {
          var d = this.rm.getSetupResourceId(e, t, this.landscape, 'value'),
            h = this.rm.getImage(d),
            n = this.canvasSizeFactor * this.rm.getImageScale(),
            m = h.width * n,
            o = h.height * n;
          return {
            x: this.width - m - 30,
            y: 0,
            width: m + 30,
            height: o + 30,
          };
        }
        if ('liveness_move' == t)
          return {
            x: this.circleX - this.circleRadius,
            y: this.circleY - this.circleRadius,
            width: 2 * this.circleRadius,
            height: 2 * this.circleRadius,
          };
      } else {
        if ('background' == t)
          return { x: 0, y: 0, width: this.width, height: this.height };
        if ('backgroundFull' == i)
          return { x: 0, y: 0, width: this.width, height: this.height };
        if ('tip_video' == t)
          return {
            x: this.circleX - this.circleRadius,
            y: this.circleY - this.circleRadius,
            width: 2 * this.circleRadius,
            height: 2 * this.circleRadius,
          };
        if ('imageError' == t)
          return {
            x: this.circleX - this.circleRadius,
            y: this.circleY - this.circleRadius,
            width: 2 * this.circleRadius,
            height: 2 * this.circleRadius,
          };
        if ('video_success' == t)
          return {
            x: this.circleX - this.circleRadius,
            y: this.circleY - this.circleRadius,
            width: 2 * this.circleRadius,
            height: 2 * this.circleRadius,
          };
        if ('extraction_video' == t)
          return {
            x: this.width / 2 - 0.1 * this.width,
            y: 0.73 * this.height,
            width: 0.2 * this.width,
            height: 0.2 * this.width,
          };
        if ('tip' == t)
          return {
            x: 0,
            y: 0.75 * this.height,
            width: this.width,
            height: 0.1 * this.height,
          };
        if ('text_error' == t)
          return {
            x: 0,
            y: 0.75 * this.height,
            width: this.width,
            height: 0.1 * this.height,
          };
        if ('text' == t)
          return {
            x: 0,
            y: this.circleY + this.circleRadius + 10,
            width: this.width,
            height:
              this.height -
              this.buttonHeight +
              10 -
              (this.circleY + this.circleRadius),
          };
        if ('tip_detail' == t)
          return {
            x: 0,
            y: 0.82 * this.height,
            width: this.width,
            height: 0.1 * this.height,
          };
        if ('button_skip' == t)
          return {
            x: 0,
            y: this.height - this.buttonHeight,
            width: this.width / 2,
            height: this.buttonHeight,
          };
        if ('button_next' == t)
          return {
            x: this.width / 2,
            y: this.height - this.buttonHeight,
            width: this.width / 2,
            height: this.buttonHeight,
          };
        if ('button_done' == t)
          return {
            x: this.width / 2,
            y: this.height - this.buttonHeight,
            width: this.width / 2,
            height: this.buttonHeight,
          };
        if ('button_audio' == t)
          return { x: this.width / 2 - 100, y: 0, width: 37, height: 37 };
        if ('button_audio_text' == t)
          return { x: this.width / 2 - 60, y: 0, width: 125, height: 35 };
        if ('button_start' == t) {
          let e = 209 * this.canvasSizeFactor;
          return {
            x: this.width / 2 - e / 2,
            y: this.height - this.buttonHeight + 10,
            width: e,
            height: this.buttonHeight - 10,
          };
        }
        if ('button_error' == t)
          return {
            x: this.width / 4,
            y: this.height - this.buttonHeight + 10,
            width: this.width / 2,
            height: this.buttonHeight - 10,
          };
        if ('button_back' == t)
          return {
            x: 0,
            y: this.height - this.buttonHeight,
            width: this.width / 2,
            height: this.buttonHeight,
          };
        if ('button_repeat' == t)
          return {
            x: 0.05 * this.width,
            y: this.height - this.buttonHeight,
            width: 0.4 * this.width,
            height: this.buttonHeight,
          };
        if ('button_finish' == t)
          return {
            x: 0.55 * this.width,
            y: this.height - this.buttonHeight,
            width: 0.4 * this.width,
            height: this.buttonHeight,
          };
        if ('button_exit' == t)
          return (
            (d = this.rm.getSetupResourceId(e, t, this.landscape, 'value')),
            (h = this.rm.getImage(d)),
            (n = this.canvasSizeFactor * this.rm.getImageScale()),
            (m = h.width * n),
            (o = h.height * n),
            { x: this.width - m - 30, y: 0, width: m + 30, height: o + 30 }
          );
        if ('button_info' == t);
        else {
          if ('button_camera' == t)
            return this.cameraCount < 2 || !this.enableButtonCamera
              ? null
              : ((d = this.rm.getSetupResourceId(
                  e,
                  t,
                  this.landscape,
                  'value'
                )),
                (h = this.rm.getImage(d)),
                (n = this.canvasSizeFactor * this.rm.getImageScale()),
                (m = h.width * n),
                (o = h.height * n),
                {
                  x: this.width - m - 30,
                  y: this.height - o - 18,
                  width: m + 30,
                  height: o + 18,
                });
          if ('warning' == t)
            return {
              x: 0,
              y: this.circleY + this.circleRadius + 10,
              width: this.width,
              height:
                this.height -
                this.buttonHeight +
                10 -
                (this.circleY + this.circleRadius),
            };
          if ('warningTooFar' == t)
            return {
              x: 0,
              y: 0.89 * this.height,
              width: this.width,
              height: 0.1 * this.height,
            };
          if ('camera' == i)
            return {
              x: this.circleX - this.circleRadius,
              y: this.circleY - this.circleRadius,
              width: 2 * this.circleRadius,
              height: 2 * this.circleRadius,
            };
          if ('results' == i)
            return {
              x: this.circleX - this.circleRadius,
              y: this.circleY - this.circleRadius,
              width: 2 * this.circleRadius,
              height: 2 * this.circleRadius,
            };
          if ('liveness_move_text' == t)
            return 'UCLivenessMoveProcessing' == s.state && a < 0.5
              ? null
              : {
                  x: 0,
                  y: this.circleY + this.circleRadius + 10,
                  width: this.width,
                  height:
                    this.height -
                    this.buttonHeight +
                    10 -
                    (this.circleY + this.circleRadius),
                };
          if ('liveness_move_tip_text' == t)
            return {
              x: this.circleX - this.circleRadius,
              y: this.circleY - 0.39 * this.circleRadius,
              width: 2 * this.circleRadius,
              height: 2 * this.circleRadius,
            };
          if ('livenessInfo_text' == t)
            return {
              x: 0,
              y: 0.89 * this.height,
              width: this.width,
              height: 0.1 * this.height,
            };
          if ('liveness_move' == t) {
            if ('UCLivenessMoveDetecting' == s.state && a >= 0.25 && a < 1.75) {
              var b = !1;
              return (
                this.rm.isAttributeAvailable(
                  e,
                  t,
                  this.landscape,
                  'fullscreen'
                ) &&
                  'true' ==
                    this.rm.getSetupResourceId(
                      e,
                      t,
                      this.landscape,
                      'fullscreen'
                    ) &&
                  (b = !0),
                b
                  ? { x: 0, y: 0, width: this.width, height: this.height }
                  : {
                      x: this.circleX - this.circleRadius,
                      y: this.circleY - this.circleRadius,
                      width: 2 * this.circleRadius,
                      height: 2 * this.circleRadius,
                    }
              );
            }
            return null;
          }
          if (
            'liveness_move_left' == t ||
            'liveness_move_right' == t ||
            'liveness_move_top' == t ||
            'liveness_move_bottom' == t
          )
            return 'UCLivenessMoveDetecting' == s.state && a >= 0.25 && a < 1.75
              ? (0 == s.livenessMoveDirection && 'liveness_move_top' != t) ||
                (2 == s.livenessMoveDirection && 'liveness_move_bottom' != t) ||
                (1 == s.livenessMoveDirection && 'liveness_move_right' != t) ||
                (3 == s.livenessMoveDirection && 'liveness_move_left' != t)
                ? null
                : ((b = !1),
                  this.rm.isAttributeAvailable(
                    e,
                    t,
                    this.landscape,
                    'fullscreen'
                  ) &&
                    'true' ==
                      this.rm.getSetupResourceId(
                        e,
                        t,
                        this.landscape,
                        'fullscreen'
                      ) &&
                    (b = !0),
                  b
                    ? { x: 0, y: 0, width: this.width, height: this.height }
                    : {
                        x: this.circleX - this.circleRadius,
                        y: this.circleY - this.circleRadius,
                        width: 2 * this.circleRadius,
                        height: 2 * this.circleRadius,
                      })
              : null;
          if ('face_searcher' == t)
            return { x: 0, y: 0, width: this.width, height: this.height };
          if ('livenessMoveGlasses' == t) {
            if (0 == s.livenessMoveFailReason)
              return {
                x: this.circleX - this.circleRadius,
                y: this.circleY - this.circleRadius,
                width: 2 * this.circleRadius,
                height: 2 * this.circleRadius,
              };
          } else if ('livenessMoveInfo' == t) {
            if (1 == s.livenessMoveFailReason)
              return {
                x: this.circleX - this.circleRadius,
                y: this.circleY - this.circleRadius,
                width: 2 * this.circleRadius,
                height: 2 * this.circleRadius,
              };
          } else if ('progress' == t) {
            if (
              'UCLivenessMoveProcessing' == s.state &&
              a > this.processingMoveProgressStartTime
            )
              return {
                x: this.circleX - this.circleRadius,
                y: 0.8 * this.height,
                width: 2 * this.circleRadius,
                height: 19,
              };
          } else if ('progressRecord' == t)
            return {
              x: 0.146 * this.width,
              y: 0.52 * this.height,
              width: 0.7 * this.width,
              height: 18,
            };
        }
      }
      return null;
    }
    drawBackground(e, t, i, l, a, c, s, d) {
      (e.fillStyle = this.rm.getSetupColor(i, l, this.landscape, 'top')),
        e.fillRect(t.x, t.y, t.width, this.circleY - this.circleRadius + 1),
        'true' ==
          this.rm
            .getSetupResourceId(i, l, this.landscape, 'clipped')
            .toLowerCase() &&
          (e.save(),
          e.beginPath(),
          e.arc(
            this.circleX,
            this.circleY,
            this.circleRadius,
            0,
            2 * Math.PI,
            !1
          ),
          e.rect(0, 0, this.width, this.height),
          e.clip('evenodd')),
        (e.fillStyle = this.rm.getSetupColor(
          i,
          l,
          this.landscape,
          'middle_top'
        )),
        e.fillRect(
          t.x,
          this.circleY - this.circleRadius,
          t.width,
          2 * this.circleRadius + 1
        ),
        'true' ==
          this.rm
            .getSetupResourceId(i, l, this.landscape, 'clipped')
            .toLowerCase() && e.restore(),
        (e.fillStyle = this.rm.getSetupColor(
          i,
          l,
          this.landscape,
          'middle_bottom'
        )),
        e.fillRect(
          t.x,
          this.circleY + this.circleRadius,
          t.width,
          this.height -
            this.buttonHeight -
            (this.circleY + this.circleRadius) +
            1
        ),
        (e.fillStyle = this.rm.getSetupColor(i, l, this.landscape, 'bottom')),
        e.fillRect(
          t.x,
          this.height - this.buttonHeight,
          t.width,
          this.buttonHeight
        );
      var h = this.rm.getSetupColor(
        i,
        l,
        this.landscape,
        'pagination_separator'
      );
      null != h &&
        ((e.fillStyle = h),
        e.fillRect(0, this.height - this.buttonHeight - 1, t.width, 1));
    }
    drawBackgroundFull(e, t, i, l, a, c, s, d) {
      'true' ==
        this.rm
          .getSetupResourceId(i, l, this.landscape, 'clipped')
          .toLowerCase() &&
        (e.save(),
        e.beginPath(),
        e.arc(
          this.circleX,
          this.circleY,
          this.circleRadius,
          0,
          2 * Math.PI,
          !1
        ),
        e.rect(0, 0, this.width, this.height),
        e.clip('evenodd')),
        (e.fillStyle = this.rm.getSetupColor(i, l, this.landscape, 'color')),
        e.fillRect(t.x, t.y, t.width, t.height),
        'true' ==
          this.rm
            .getSetupResourceId(i, l, this.landscape, 'clipped')
            .toLowerCase() && e.restore();
    }
    drawPoint(e, t, i, l, a) {
      (e.fillStyle = a),
        e.beginPath(),
        e.arc(t, i, l, 0, 2 * Math.PI),
        e.fill();
    }
    drawLine(e, t, i, l, a, c) {
      (e.lineWidth = 1),
        (e.strokeStyle = c),
        e.beginPath(),
        e.moveTo(t, i),
        e.lineTo(l, a),
        e.stroke();
    }
    drawFaceSearcher(e, t, i, l, a, c, s, d) {
      d.progress;
      var h = d.leftEyeData,
        n = d.rightEyeData,
        m = d.faceDataRect;
      m &&
        ((this.lastMoveFace = m),
        null == this.moveFace && (this.moveFace = this.lastMoveFace)),
        h &&
          ((this.lastMoveLeftEye = h),
          null == this.moveLeftEye &&
            (this.moveLeftEye = this.lastMoveLeftEye)),
        n &&
          ((this.lastMoveRightEye = n),
          null == this.moveRightEye &&
            (this.moveRightEye = this.lastMoveRightEye)),
        this.moveFace &&
          ((this.moveFace.x += 0.1 * (this.lastMoveFace.x - this.moveFace.x)),
          (this.moveFace.y += 0.1 * (this.lastMoveFace.y - this.moveFace.y)),
          (this.moveFace.width +=
            0.1 * (this.lastMoveFace.width - this.moveFace.width)),
          (this.moveFace.height +=
            0.1 * (this.lastMoveFace.height - this.moveFace.height))),
        this.moveLeftEye &&
          ((this.moveLeftEye.x +=
            0.15 * (this.lastMoveLeftEye.x - this.moveLeftEye.x)),
          (this.moveLeftEye.y +=
            0.15 * (this.lastMoveLeftEye.y - this.moveLeftEye.y)),
          this.drawPoint(
            e,
            this.moveLeftEye.x - 0.05 * this.width,
            this.moveLeftEye.y,
            2,
            '#ffffff'
          ),
          this.drawPoint(
            e,
            this.moveLeftEye.x + 0.04 * this.width,
            this.moveLeftEye.y,
            2,
            '#ffffff'
          ),
          this.drawPoint(
            e,
            this.moveLeftEye.x - 0.02 * this.width,
            this.moveLeftEye.y - 0.05 * this.height,
            2,
            '#ffffff'
          ),
          this.drawLine(
            e,
            this.moveLeftEye.x - 0.05 * this.width,
            this.moveLeftEye.y,
            this.moveLeftEye.x + 0.04 * this.width,
            this.moveLeftEye.y,
            '#ffffff'
          ),
          this.drawLine(
            e,
            this.moveLeftEye.x - 0.05 * this.width,
            this.moveLeftEye.y,
            this.moveLeftEye.x - 0.02 * this.width,
            this.moveLeftEye.y - 0.05 * this.height,
            '#ffffff'
          ),
          this.drawLine(
            e,
            this.moveLeftEye.x + 0.04 * this.width,
            this.moveLeftEye.y,
            this.moveLeftEye.x - 0.02 * this.width,
            this.moveLeftEye.y - 0.05 * this.height,
            '#ffffff'
          ),
          this.moveFace &&
            (this.drawLine(
              e,
              this.moveLeftEye.x + 0.04 * this.width,
              this.moveLeftEye.y,
              this.moveFace.x + this.moveFace.width / 2,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.05 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveLeftEye.x - 0.05 * this.width,
              this.moveLeftEye.y,
              this.moveFace.x + this.moveFace.width / 2,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.05 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveFace.x + this.moveFace.width / 2,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.05 * this.moveFace.height,
              this.moveFace.x +
                this.moveFace.width / 2 -
                0.15 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.02 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveFace.x +
                this.moveFace.width / 2 -
                0.15 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.02 * this.moveFace.height,
              this.moveFace.x +
                this.moveFace.width / 2 -
                0.35 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.3 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveFace.x + this.moveFace.width / 2,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.05 * this.moveFace.height,
              this.moveFace.x +
                this.moveFace.width / 2 -
                0.2 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.25 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveFace.x +
                this.moveFace.width / 2 -
                0.2 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.25 * this.moveFace.height,
              this.moveFace.x + this.moveFace.width / 2,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.5 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveFace.x +
                this.moveFace.width / 2 -
                0.2 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.25 * this.moveFace.height,
              this.moveFace.x +
                this.moveFace.width / 2 -
                0.35 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.3 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveFace.x +
                this.moveFace.width / 2 -
                0.35 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.3 * this.moveFace.height,
              this.moveFace.x + this.moveFace.width / 2,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.5 * this.moveFace.height,
              '#ffffff'
            ))),
        this.moveRightEye &&
          ((this.moveRightEye.x +=
            0.15 * (this.lastMoveRightEye.x - this.moveRightEye.x)),
          (this.moveRightEye.y +=
            0.15 * (this.lastMoveRightEye.y - this.moveRightEye.y)),
          this.drawPoint(
            e,
            this.moveRightEye.x + 0.05 * this.width,
            this.moveRightEye.y,
            2,
            '#ffffff'
          ),
          this.drawPoint(
            e,
            this.moveRightEye.x - 0.04 * this.width,
            this.moveRightEye.y,
            2,
            '#ffffff'
          ),
          this.drawPoint(
            e,
            this.moveRightEye.x + 0.02 * this.width,
            this.moveRightEye.y - 0.05 * this.height,
            2,
            '#ffffff'
          ),
          this.drawLine(
            e,
            this.moveRightEye.x + 0.05 * this.width,
            this.moveRightEye.y,
            this.moveRightEye.x - 0.04 * this.width,
            this.moveRightEye.y,
            '#ffffff'
          ),
          this.drawLine(
            e,
            this.moveRightEye.x + 0.05 * this.width,
            this.moveRightEye.y,
            this.moveRightEye.x + 0.02 * this.width,
            this.moveRightEye.y - 0.05 * this.height,
            '#ffffff'
          ),
          this.drawLine(
            e,
            this.moveRightEye.x - 0.04 * this.width,
            this.moveRightEye.y,
            this.moveRightEye.x + 0.02 * this.width,
            this.moveRightEye.y - 0.05 * this.height,
            '#ffffff'
          ),
          this.moveFace &&
            (this.drawLine(
              e,
              this.moveRightEye.x - 0.04 * this.width,
              this.moveRightEye.y,
              this.moveFace.x + this.moveFace.width / 2,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.05 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveRightEye.x + 0.05 * this.width,
              this.moveRightEye.y,
              this.moveFace.x + this.moveFace.width / 2,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.05 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveFace.x + this.moveFace.width / 2,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.05 * this.moveFace.height,
              this.moveFace.x +
                this.moveFace.width / 2 +
                0.15 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.02 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveFace.x +
                this.moveFace.width / 2 +
                0.15 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.02 * this.moveFace.height,
              this.moveFace.x +
                this.moveFace.width / 2 +
                0.35 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.3 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveFace.x + this.moveFace.width / 2,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.05 * this.moveFace.height,
              this.moveFace.x +
                this.moveFace.width / 2 +
                0.2 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.25 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveFace.x +
                this.moveFace.width / 2 +
                0.2 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.25 * this.moveFace.height,
              this.moveFace.x + this.moveFace.width / 2,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.5 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveFace.x +
                this.moveFace.width / 2 +
                0.2 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.25 * this.moveFace.height,
              this.moveFace.x +
                this.moveFace.width / 2 +
                0.35 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.3 * this.moveFace.height,
              '#ffffff'
            ),
            this.drawLine(
              e,
              this.moveFace.x +
                this.moveFace.width / 2 +
                0.35 * this.moveFace.width,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.3 * this.moveFace.height,
              this.moveFace.x + this.moveFace.width / 2,
              this.moveFace.y +
                this.moveFace.height / 2 +
                0.5 * this.moveFace.height,
              '#ffffff'
            )));
    }
    drawImageError(e, t, i, l, a, c, s, d) {
      var h = this.rm.getImage('livenessError.png');
      (h = this.rm.getImage('timeout.png')),
        this.canvasSizeFactor,
        this.rm.getImageScale(),
        h.width,
        h.height;
      var n = this.scaleRect({ width: h.width, height: h.height }, t);
      e.drawImage(h, n.x, n.y, n.width, n.height);
    }
    drawAnimation(e, t, i, l, a, c, s, d, h) {
      var n = c;
      switch (
        ((n /= 2) > 1 && (n = 1),
        'videoProgress' in d && (n = d.videoProgress),
        e.save(),
        e.translate(t.x + t.width / 2, t.y + t.height / 2),
        h)
      ) {
        case 1:
          e.rotate((3 * -Math.PI) / 2);
          break;
        case 2:
          e.rotate(Math.PI);
          break;
        case 3:
          e.rotate((1 * -Math.PI) / 2);
      }
      e.translate(-(t.x + t.width / 2), -(t.y + t.height / 2));
      var m = this.rm.getSetupResourceId(i, l, this.landscape, 'name'),
        o = this.rm.getSetupResourceId(i, l, this.landscape, 'ext'),
        b = parseInt(this.rm.getSetupResourceId(i, l, this.landscape, 'start')),
        Z = parseInt(this.rm.getSetupResourceId(i, l, this.landscape, 'end')),
        r = m + ('0' + Math.floor((Z - b) * n + b)).slice(-2) + '.' + o,
        u = this.rm.getImage(r);
      e.drawImage(u, t.x, t.y, t.width, t.height), e.restore();
    }
    drawText(e, t, i, l, a, c, s, d) {
      var h = this.rm.getSetupFloat(i, l, this.landscape, 'font_size'),
        n = h + 1;
      this.rm.isAttributeAvailable(i, l, this.landscape, 'line_height') &&
        (n = this.rm.getSetupFloat(i, l, this.landscape, 'line_height'));
      var m = this.rm.getSetupColor(i, l, this.landscape, 'color'),
        o = this.rm.getSetupResourceId(i, l, this.landscape, 'font'),
        b = 'CENTER';
      this.rm.isAttributeAvailable(i, l, this.landscape, 'align') &&
        (b = this.rm.getSetupAlign(i, l, this.landscape, 'align'));
      var Z = 'TOP';
      this.rm.isAttributeAvailable(i, l, this.landscape, 'valign') &&
        (Z = this.rm.getSetupAlign(i, l, this.landscape, 'valign'));
      var r = '';
      if ('Tutorial1' == i)
        r =
          'tip' == l
            ? this.rm.translate('tutorial1_tip')
            : this.rm.translate('tutorial1_tip_detail');
      else if ('Tutorial2' == i)
        r =
          'tip' == l
            ? this.rm.translate('tutorial2_tip')
            : this.rm.translate('tutorial2_tip_detail');
      else if ('Tutorial3' == i)
        r =
          'tip' == l
            ? this.rm.translate('tutorial3_tip')
            : this.rm.translate('tutorial3_tip_detail');
      else if ('TutorialMove1' == i)
        r =
          'tip' == l
            ? this.rm.translate('tutorialMove1_tip')
            : this.rm.translate('tutorialMove1_tip_detail');
      else if ('TutorialMove2' == i)
        r =
          'tip' == l
            ? this.rm.translate('tutorialMove2_tip')
            : this.rm.translate('tutorialMove2_tip_detail');
      else if ('TutorialMove3' == i)
        r =
          'tip' == l
            ? this.rm.translate('tutorialMove3_tip')
            : this.rm.translate('tutorialMove3_tip_detail');
      else if ('RegistrationTips' == i)
        r =
          'tip' == l
            ? this.rm.translate('registration_tips_title')
            : this.rm.translate('registration_tips_detail');
      else if ('FaceMovementTips' == i)
        r =
          'tip' == l
            ? this.rm.translate('face_movement_tips_title')
            : this.rm.translate('face_movement_tips_detail');
      else if ('WaitRecording' == i) r = this.rm.translate('waitRecording');
      else if ('StartExtractor' == i)
        'text' == l && (r = this.rm.translate('start_extractor_title'));
      else if ('Extractor' == i)
        'warning' == l && (r = this.rm.translate('error_message_face'));
      else if ('LivenessMove' == i) {
        if ('liveness_move_text' == l)
          if (
            'UCLivenessMoveStabilizing' == d.state ||
            'UCLivenessMoveStabilized' == d.state
          )
            r = this.rm.translate('extracting_title');
          else if ('UCLivenessMoveDetecting' == d.state)
            switch (d.livenessMoveDirection) {
              case 0:
                r = this.rm.translate('liveness_move_tip_up');
                break;
              case 1:
                r = this.rm.translate('liveness_move_tip_right');
                break;
              case 2:
                r = this.rm.translate('liveness_move_tip_down');
                break;
              case 3:
                r = this.rm.translate('liveness_move_tip_left');
            }
          else
            'UCLivenessMoveProcessing' == d.state &&
              (r = this.rm.translate('liveness_move_processing'));
        else if (
          'warning' == l &&
          ('UCLivenessMoveStabilizing' == d.state ||
            'UCLivenessMoveStabilized' == d.state)
        )
          switch (d.livenessMoveLastStabilizedStatus) {
            case 1:
              r = this.rm.translate('liveness_move_stabilizing_ok');
              break;
            case 2:
              r = this.rm.translate('liveness_move_stabilizing_not_stabilized');
              break;
            case 3:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_too_far'
              );
              break;
            case 4:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_sun_glasses'
              );
              break;
            case 5:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_too_close'
              );
              break;
            case 6:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_too_movement'
              );
              break;
            case 7:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_low_performance'
              );
              break;
            case 8:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_no_frontal'
              );
              break;
            case 9:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_no_frontal_too_left'
              );
              break;
            case 10:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_no_frontal_too_right'
              );
              break;
            case 11:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_no_frontal_too_down'
              );
              break;
            case 12:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_no_frontal_too_up'
              );
              break;
            case 13:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_no_color'
              );
              break;
            case 14:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_low_quality'
              );
              break;
            case 15:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_low_face_quality'
              );
              break;
            case 16:
              r = this.rm.translate(
                'liveness_move_stabilizing_not_stabilized_low_pattern_quality'
              );
              break;
            case 17:
              r = this.rm.translate('liveness_move_stabilizing_ok_glasses');
              break;
            default:
              r = this.rm.translate('extracting_title');
          }
      } else if ('LivenessInfo' == i)
        'livenessInfo_text' == l &&
          (r =
            0 == d.livenessMoveFailReason
              ? this.rm.translate('liveness_move_info_sunglasses')
              : this.rm.translate('liveness_move_info_unsuccess'));
      else if ('Results' == i) {
        if ('tip' == l) {
          if (c < 1) m = '#00000000';
          else if (c >= 1) {
            var u = 2 * (c - 1);
            u > 1 && (u = 1),
              (m = this.rm.getSetupColorWithAlpha(
                i,
                l,
                this.landscape,
                'color',
                u
              ));
          }
          r =
            d.progress >= 1
              ? this.rm.translate('results_message_excellent')
              : d.progress >= 0.333
              ? this.rm.translate('results_message_good')
              : this.rm.translate('results_message_low');
        }
      } else
        'Error' == i && 'text_error' == l && (r = this.rm.translate('timeout'));
      this.drawStringMultiline(e, r, t, m, o, h, n, b, Z);
    }
    drawBlind(e, t, i, l, a, c, s, d) {
      var h = ((a - i) / l) * 0.5 + 0.5,
        n = 2 * l * h,
        m = 2 * l * (1 - h);
      e.save(),
        e.beginPath(),
        e.arc(t, i, l, 0, 2 * Math.PI, !1),
        e.clip(),
        (e.fillStyle = s),
        e.fillRect(t - l, i - l, 2 * l, n * c),
        e.fillRect(t - l, i + l - m + m * (1 - c), 2 * l, m * c),
        e.restore();
      var o = this.rm.getSetupResourceId(
        'facephi-widget-conf',
        '',
        this.landscape,
        'font_shutter_text'
      );
      (e.fillStyle = this.rm.getSetupColor(
        'facephi-widget-conf',
        '',
        this.landscape,
        'color_shutter_text'
      )),
        (e.font = 26 * this.fontSizeFactor + "px '" + o + "'");
      var b = e.measureText(d);
      e.fillText(d, t - b.width / 2, i + l - m + m * (1 - c) + 30);
    }
  }
  let h = '',
    n = 2;
  class m {
    static printDebug(...e) {
      0 >= n && console.debug(`<D> [${h}] ${e}`);
    }
    static printInfo(...e) {
      1 >= n && console.debug(`<I> [${h}] ${e}`);
    }
    static printWarning(...e) {
      2 >= n && console.warn(`<W> [${h}] ${e}`);
    }
    static printError(...e) {
      3 >= n && console.error(`<E> [${h}] ${e}`);
    }
    static setLoggerLevel(e) {
      n = e;
    }
    static setLoggerTag(e) {
      h = e;
    }
  }
  if (!o) var o = {};
  o.Selphi = e;
  class b extends HTMLElement {
    constructor() {
      super(), m.setLoggerTag('selphi-widget-web'), m.setLoggerLevel(0);
      let e = 'closed';
      if (
        ('undefined' != typeof window &&
          void 0 !== window.openShadow &&
          !0 === window.openShadow &&
          (e = 'open'),
        (this.__widgetContainer = this.attachShadow({ mode: e })),
        (this.__widgetStyles = document.createElement('style')),
        (this.__widgetStyles.innerText =
          '\n            :host { display: block; position: relative; margin: 0; padding: 0; width: 100%; height: 100%; min-height: 300px; min-width: 300px }\n            #accessibilityContainer { position: absolute; z-index: 999; width: 100%; height: 100% }\n            #cameraContainer { width: 100%; height: 100%; min-height: 300px; min-width: 300px }\n        '),
        this.__widgetContainer.append(this.__widgetStyles),
        (this.__config = new o.Selphi.ConfigurationManager()),
        this.__config.setContainer(this.__widgetContainer),
        (this.__externalCamera = null),
        (this.__elementMounted = !1),
        (this.__accessibilityHasEnabled = !1),
        'function' == typeof queueMicrotask)
      )
        queueMicrotask.bind('undefined' != typeof window ? window : i.g);
      else {
        let e = null;
        window.queueMicrotask = (t) =>
          (e || (e = Promise.resolve())).then(t).catch((e) =>
            setTimeout(() => {
              throw e;
            }, 0)
          );
      }
    }
    static get attributes() {
      return {
        bundlepath: { type: 'string', property: 'bundlePath', private: !1 },
        resourcespath: {
          type: 'string',
          property: 'resourcesPath',
          private: !1,
        },
        graphpath: { type: 'string', property: 'graphPath', private: !1 },
        timeout: { type: 'number', property: 'timeout', private: !1 },
        language: { type: 'string', property: 'language', private: !1 },
        dpilist: { type: 'string', property: 'dpiList', private: !1 },
        tutorial: { type: 'boolean', property: 'tutorial', private: !1 },
        interactible: {
          type: 'boolean',
          property: 'interactible',
          private: !1,
        },
        logimages: { type: 'boolean', property: 'logImages', private: !1 },
        stabilizationstage: {
          type: 'boolean',
          property: 'stabilizationStage',
          private: !1,
        },
        camerawidth: { type: 'number', property: 'cameraWidth', private: !1 },
        cameraheight: { type: 'number', property: 'cameraHeight', private: !1 },
        camerarotation: {
          type: 'number',
          property: 'cameraRotation',
          private: !1,
        },
        cameratype: { type: 'number', property: 'cameraType', private: !1 },
        cameraswitchbutton: {
          type: 'boolean',
          property: 'cameraSwitchButton',
          private: !1,
        },
        cameraid: { type: 'string', property: 'cameraId', private: !1 },
        livenessmode: { type: 'number', property: 'livenessMode', private: !1 },
        livenessprecision: {
          type: 'number',
          property: 'livenessPrecision',
          private: !1,
        },
        livenessmodeinitialerror: {
          type: 'number',
          property: 'livenessMoveInitialError',
          private: !1,
        },
        livenessmoveinfotime: {
          type: 'number',
          property: 'livenessMoveInfoTime',
          private: !1,
        },
        cropfactor: { type: 'number', property: 'cropFactor', private: !1 },
        cropimage: { type: 'boolean', property: 'cropImage', private: !1 },
        authenticatetime: {
          type: 'number',
          property: 'authenticateTime',
          private: !1,
        },
        imageformat: { type: 'string', property: 'imageFormat', private: !1 },
        imagequality: { type: 'number', property: 'imageQuality', private: !1 },
        templateformat: {
          type: 'number',
          property: 'templateFormat',
          private: !1,
        },
        videorecord: { type: 'boolean', property: 'videoRecord', private: !1 },
        videorecordrate: {
          type: 'number',
          property: 'videoRecordRate',
          private: !1,
        },
        videorecordscale: {
          type: 'number',
          property: 'videoRecordScale',
          private: !1,
        },
        videorecordtype: {
          type: 'number',
          property: 'videoRecordType',
          private: !1,
        },
        showlog: { type: 'boolean', property: 'showLog', private: !1 },
        debugmode: { type: 'boolean', property: 'debugMode', private: !1 },
        externalcamera: {
          type: 'boolean',
          property: 'externalCamera',
          private: !0,
        },
        epheremalkey: { type: 'string', property: 'epheremalKey', private: !0 },
        facetracking: {
          type: 'boolean',
          property: 'faceTracking',
          private: !1,
        },
        accessibility: {
          type: 'boolean',
          property: 'accessibility',
          private: !1,
        },
        accessibleelements: {
          type: 'array',
          property: 'accessibleElements',
          private: !1,
        },
        onmoduleloaded: {
          type: 'event',
          property: 'FPhi.UserControl.ModuleLoaded.event',
          private: !1,
        },
        onstabilizing: {
          type: 'event',
          property: 'FPhi.UserControl.Stabilizing.event',
          private: !1,
        },
        onextractionfinish: {
          type: 'event',
          property: 'FPhi.UserControl.Finish.event',
          private: !1,
        },
        onusercancel: {
          type: 'event',
          property: 'FPhi.UserControl.UserCancel.event',
          private: !1,
        },
        onexceptioncaptured: {
          type: 'event',
          property: 'FPhi.UserControl.ExceptionCaptured.event',
          private: !1,
        },
        onlivenesserror: {
          type: 'event',
          property: 'FPhi.UserControl.LivenessError.event',
          private: !1,
        },
        onlivenesserrorbuttonclick: {
          type: 'event',
          property: 'FPhi.UserControl.LivenessErrorButtonClick.event',
          private: !1,
        },
        onextractiontimeout: {
          type: 'event',
          property: 'FPhi.UserControl.ExtractionTimeout.event',
          private: !1,
        },
        ontimeouterrorbuttonclick: {
          type: 'event',
          property: 'FPhi.UserControl.TimeoutErrorButtonClick.event',
          private: !1,
        },
        ontrackstatus: {
          type: 'event',
          property: 'FPhi.UserControl.TrackStatus.event',
          private: !1,
        },
        onaccessibilitystatus: {
          type: 'event',
          property: 'FPhi.UserControl.AccessibilityStatus.event',
          private: !1,
        },
      };
    }
    connectedCallback() {
      queueMicrotask(() =>
        this.__createUserControl(this.__config)
          .__startUserControl()
          .then(() => (this.__elementMounted = !0))
      );
    }
    disconnectedCallback() {
      queueMicrotask(() =>
        this.__stopUserControl().then(() => (this.__elementMounted = !1))
      );
    }
    reconnectedCallback() {
      queueMicrotask(async () => this.__restartUserControl(this.__config));
    }
    attributeChangedCallback(e, t, i) {
      this.__setNativeConfiguration(e, i) && this.reconnectedCallback();
    }
    addWidgetEventListener(e, t) {
      this.addEventListener(e, t, !0);
    }
    addEventListener(e, t, i) {
      const l = e.toLowerCase().replace('-', ''),
        a = b.attributes[l];
      this.__widgetContainer.addEventListener(a.property, t, i);
    }
    static get observedAttributes() {
      return Object.getOwnPropertyNames(this.attributes);
    }
    mountExternalCamera(e) {
      'true' === this.getAttribute('externalcamera')
        ? ((this.__externalCamera = e),
          this.__elementMounted && this.reconnectedCallback())
        : m.printWarning(
            "FPhi.Widget.Component: An external camera has been tried to be inserted, but we weren't expecting it, so it will be ignored...."
          );
    }
    static generateTemplateRawFromByteArray(e, t, i) {
      const l = new o.Selphi.ConfigurationManager();
      'string' == typeof e
        ? l.setBundlePath(e)
        : 'object' == typeof e &&
          Object.keys(e).forEach((t) => {
            const i = b.__getSetterAttr(t, l);
            (l ? i.bind(l) : i)(e[t]);
          }),
        l.setContainer(document.createElement('div')),
        new o.Selphi.Widget(l).GenerateTemplateRawFromByteArray(t, i);
    }
    static async checkCapabilities() {
      return await o.Selphi.CheckCapabilities();
    }
    routeClick(e, t) {
      this.__fphiWidget.routeClick(e, t);
    }
    __createUserControl(e) {
      return (
        (this.__fphiWidget = new o.Selphi.Widget(e)),
        ((null !== this.getAttribute('debugMode') &&
          void 0 !== this.getAttribute('debugMode')) ||
          (null !== this.getAttribute('debugmode') &&
            void 0 !== this.getAttribute('debugmode'))) &&
          (this.__fphiWidget.debug = b.__tryParsePrimitive(
            this.getAttribute('debugMode')
          )),
        this
      );
    }
    async __startUserControl() {
      return (
        this.__fphiWidget &&
          (null !== this.__externalCamera
            ? this.__fphiWidget.Start(this.__externalCamera)
            : this.__fphiWidget.Start()),
        this
      );
    }
    async __stopUserControl() {
      return (
        this.__fphiWidget &&
          (this.__fphiWidget.Stop(), (this.__fphiWidget = null)),
        this
      );
    }
    async __restartUserControl(e) {
      try {
        if (this.__fphiWidget) {
          const t = new o.Selphi.Widget(e),
            i = this.__fphiWidget;
          this.__cleanWidgetContainer(),
            (this.__fphiWidget = t),
            await this.__startUserControl(),
            i.Stop();
        }
      } catch (e) {}
    }
    __setNativeConfiguration(e, t) {
      let i = !1;
      if (void 0 !== b.attributes[e] && null !== b.attributes[e]) {
        const l = b.attributes[e].property,
          a = b.attributes[e].type,
          c = t,
          s = Reflect.get(this.__config, l);
        if (null != t && c !== s) {
          let e =
            'event' !== a ? b.__tryParsePrimitive(t) : b.__tryParseFunction(t);
          if ((m.printDebug(`${l} = ${e}`), 'debugMode' === l))
            void 0 !== this.__fphiWidget &&
              null !== this.__fphiWidget &&
              'function' != typeof e &&
              ((this.__fphiWidget.debug = e), (i = i || !1));
          else {
            if (
              ('accessibility' !== l ||
                !0 !== e ||
                this.__accessibilityHasEnabled ||
                ((this.accessibilityRoot = document.createElement('div')),
                (this.accessibilityRoot.id = 'accessibilityContainer'),
                this.__widgetContainer.append(this.accessibilityRoot),
                (this.__accessibilityHasEnabled = !0)),
              'function' == typeof e && 'event' === a)
            )
              this.__widgetContainer.addEventListener(l, e, !0);
            else {
              const t = b.__getSetterAttr(l, this.__config);
              (this.__config ? t.bind(this.__config) : t)(e);
            }
            i = this.__elementMounted;
          }
        }
      }
      return i;
    }
    __cleanWidgetContainer() {
      (this.__widgetContainer.innerHTML = ''),
        this.__widgetContainer.append(this.__widgetStyles);
    }
    static __getSetterAttr(e, t) {
      return t['set' + e.charAt(0).toUpperCase() + e.slice(1)];
    }
    static __tryParsePrimitive(e) {
      try {
        return JSON.parse(e);
      } catch (t) {
        return e.toString();
      }
    }
    static __tryParseFunction(e) {
      try {
        return new Function('event', e);
      } catch (t) {
        return e.toString();
      }
    }
  }
  let Z = null;
  class r {
    static async __checkWorker(e) {
      if (!r.worker) {
        let t = r,
          i = new Worker(
            (null === Z &&
              (Z = URL.createObjectURL(
                new Blob(
                  [
                    window.atob(
                      'dmFyIF9fd2VicGFja19leHBvcnRzX18gPSB7fTsKCjsvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93b3JrZXIvUnVudGltZS5qcwoKdmFyIE1vZHVsZSA9IChmdW5jdGlvbigpIHsKICB2YXIgX3NjcmlwdERpciA9IHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgZG9jdW1lbnQuY3VycmVudFNjcmlwdCA/IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjIDogdW5kZWZpbmVkOwogIAogIHJldHVybiAoCmZ1bmN0aW9uKE1vZHVsZSkgewogIE1vZHVsZSA9IE1vZHVsZSB8fCB7fTsKCnZhciBNb2R1bGU9dHlwZW9mIE1vZHVsZSE9PSJ1bmRlZmluZWQiP01vZHVsZTp7fTt2YXIgcmVhZHlQcm9taXNlUmVzb2x2ZSxyZWFkeVByb21pc2VSZWplY3Q7TW9kdWxlWyJyZWFkeSJdPW5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUscmVqZWN0KXtyZWFkeVByb21pc2VSZXNvbHZlPXJlc29sdmU7cmVhZHlQcm9taXNlUmVqZWN0PXJlamVjdH0pO3ZhciBtb2R1bGVPdmVycmlkZXM9e307dmFyIGtleTtmb3Ioa2V5IGluIE1vZHVsZSl7aWYoTW9kdWxlLmhhc093blByb3BlcnR5KGtleSkpe21vZHVsZU92ZXJyaWRlc1trZXldPU1vZHVsZVtrZXldfX12YXIgYXJndW1lbnRzXz1bXTt2YXIgdGhpc1Byb2dyYW09Ii4vdGhpcy5wcm9ncmFtIjt2YXIgcXVpdF89ZnVuY3Rpb24oc3RhdHVzLHRvVGhyb3cpe3Rocm93IHRvVGhyb3d9O3ZhciBFTlZJUk9OTUVOVF9JU19XRUI9dHJ1ZTt2YXIgRU5WSVJPTk1FTlRfSVNfV09SS0VSPWZhbHNlO3ZhciBzY3JpcHREaXJlY3Rvcnk9IiI7ZnVuY3Rpb24gbG9jYXRlRmlsZShwYXRoKXtpZihNb2R1bGVbImxvY2F0ZUZpbGUiXSl7cmV0dXJuIE1vZHVsZVsibG9jYXRlRmlsZSJdKHBhdGgsc2NyaXB0RGlyZWN0b3J5KX1yZXR1cm4gc2NyaXB0RGlyZWN0b3J5K3BhdGh9dmFyIHJlYWRfLHJlYWRBc3luYyxyZWFkQmluYXJ5LHNldFdpbmRvd1RpdGxlO2lmKEVOVklST05NRU5UX0lTX1dFQnx8RU5WSVJPTk1FTlRfSVNfV09SS0VSKXtpZihFTlZJUk9OTUVOVF9JU19XT1JLRVIpe3NjcmlwdERpcmVjdG9yeT1zZWxmLmxvY2F0aW9uLmhyZWZ9ZWxzZSBpZih0eXBlb2YgZG9jdW1lbnQhPT0idW5kZWZpbmVkIiYmZG9jdW1lbnQuY3VycmVudFNjcmlwdCl7c2NyaXB0RGlyZWN0b3J5PWRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjfWlmKF9zY3JpcHREaXIpe3NjcmlwdERpcmVjdG9yeT1fc2NyaXB0RGlyfWlmKHNjcmlwdERpcmVjdG9yeS5pbmRleE9mKCJibG9iOiIpIT09MCl7c2NyaXB0RGlyZWN0b3J5PXNjcmlwdERpcmVjdG9yeS5zdWJzdHIoMCxzY3JpcHREaXJlY3RvcnkubGFzdEluZGV4T2YoIi8iKSsxKX1lbHNle3NjcmlwdERpcmVjdG9yeT0iIn17cmVhZF89ZnVuY3Rpb24odXJsKXt2YXIgeGhyPW5ldyBYTUxIdHRwUmVxdWVzdDt4aHIub3BlbigiR0VUIix1cmwsZmFsc2UpO3hoci5zZW5kKG51bGwpO3JldHVybiB4aHIucmVzcG9uc2VUZXh0fTtpZihFTlZJUk9OTUVOVF9JU19XT1JLRVIpe3JlYWRCaW5hcnk9ZnVuY3Rpb24odXJsKXt2YXIgeGhyPW5ldyBYTUxIdHRwUmVxdWVzdDt4aHIub3BlbigiR0VUIix1cmwsZmFsc2UpO3hoci5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIjt4aHIuc2VuZChudWxsKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoeGhyLnJlc3BvbnNlKX19cmVhZEFzeW5jPWZ1bmN0aW9uKHVybCxvbmxvYWQsb25lcnJvcil7dmFyIHhocj1uZXcgWE1MSHR0cFJlcXVlc3Q7eGhyLm9wZW4oIkdFVCIsdXJsLHRydWUpO3hoci5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIjt4aHIub25sb2FkPWZ1bmN0aW9uKCl7aWYoeGhyLnN0YXR1cz09MjAwfHx4aHIuc3RhdHVzPT0wJiZ4aHIucmVzcG9uc2Upe29ubG9hZCh4aHIucmVzcG9uc2UpO3JldHVybn1vbmVycm9yKCl9O3hoci5vbmVycm9yPW9uZXJyb3I7eGhyLnNlbmQobnVsbCl9fXNldFdpbmRvd1RpdGxlPWZ1bmN0aW9uKHRpdGxlKXtkb2N1bWVudC50aXRsZT10aXRsZX19ZWxzZXt9dmFyIG91dD1Nb2R1bGVbInByaW50Il18fGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSk7dmFyIGVycj1Nb2R1bGVbInByaW50RXJyIl18fGNvbnNvbGUud2Fybi5iaW5kKGNvbnNvbGUpO2ZvcihrZXkgaW4gbW9kdWxlT3ZlcnJpZGVzKXtpZihtb2R1bGVPdmVycmlkZXMuaGFzT3duUHJvcGVydHkoa2V5KSl7TW9kdWxlW2tleV09bW9kdWxlT3ZlcnJpZGVzW2tleV19fW1vZHVsZU92ZXJyaWRlcz1udWxsO2lmKE1vZHVsZVsiYXJndW1lbnRzIl0pYXJndW1lbnRzXz1Nb2R1bGVbImFyZ3VtZW50cyJdO2lmKE1vZHVsZVsidGhpc1Byb2dyYW0iXSl0aGlzUHJvZ3JhbT1Nb2R1bGVbInRoaXNQcm9ncmFtIl07aWYoTW9kdWxlWyJxdWl0Il0pcXVpdF89TW9kdWxlWyJxdWl0Il07dmFyIHRlbXBSZXQwPTA7dmFyIHNldFRlbXBSZXQwPWZ1bmN0aW9uKHZhbHVlKXt0ZW1wUmV0MD12YWx1ZX07dmFyIHdhc21CaW5hcnk7aWYoTW9kdWxlWyJ3YXNtQmluYXJ5Il0pd2FzbUJpbmFyeT1Nb2R1bGVbIndhc21CaW5hcnkiXTt2YXIgbm9FeGl0UnVudGltZT1Nb2R1bGVbIm5vRXhpdFJ1bnRpbWUiXXx8dHJ1ZTtpZih0eXBlb2YgV2ViQXNzZW1ibHkhPT0ib2JqZWN0Iil7YWJvcnQoIm5vIG5hdGl2ZSB3YXNtIHN1cHBvcnQgZGV0ZWN0ZWQiKX12YXIgd2FzbU1lbW9yeTt2YXIgQUJPUlQ9ZmFsc2U7dmFyIEVYSVRTVEFUVVM7ZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbix0ZXh0KXtpZighY29uZGl0aW9uKXthYm9ydCgiQXNzZXJ0aW9uIGZhaWxlZDogIit0ZXh0KX19dmFyIFVURjhEZWNvZGVyPXR5cGVvZiBUZXh0RGVjb2RlciE9PSJ1bmRlZmluZWQiP25ldyBUZXh0RGVjb2RlcigidXRmOCIpOnVuZGVmaW5lZDtmdW5jdGlvbiBVVEY4QXJyYXlUb1N0cmluZyhoZWFwLGlkeCxtYXhCeXRlc1RvUmVhZCl7dmFyIGVuZElkeD1pZHgrbWF4Qnl0ZXNUb1JlYWQ7dmFyIGVuZFB0cj1pZHg7d2hpbGUoaGVhcFtlbmRQdHJdJiYhKGVuZFB0cj49ZW5kSWR4KSkrK2VuZFB0cjtpZihlbmRQdHItaWR4PjE2JiZoZWFwLnN1YmFycmF5JiZVVEY4RGVjb2Rlcil7cmV0dXJuIFVURjhEZWNvZGVyLmRlY29kZShoZWFwLnN1YmFycmF5KGlkeCxlbmRQdHIpKX1lbHNle3ZhciBzdHI9IiI7d2hpbGUoaWR4PGVuZFB0cil7dmFyIHUwPWhlYXBbaWR4KytdO2lmKCEodTAmMTI4KSl7c3RyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHUwKTtjb250aW51ZX12YXIgdTE9aGVhcFtpZHgrK10mNjM7aWYoKHUwJjIyNCk9PTE5Mil7c3RyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKCh1MCYzMSk8PDZ8dTEpO2NvbnRpbnVlfXZhciB1Mj1oZWFwW2lkeCsrXSY2MztpZigodTAmMjQwKT09MjI0KXt1MD0odTAmMTUpPDwxMnx1MTw8Nnx1Mn1lbHNle3UwPSh1MCY3KTw8MTh8dTE8PDEyfHUyPDw2fGhlYXBbaWR4KytdJjYzfWlmKHUwPDY1NTM2KXtzdHIrPVN0cmluZy5mcm9tQ2hhckNvZGUodTApfWVsc2V7dmFyIGNoPXUwLTY1NTM2O3N0cis9U3RyaW5nLmZyb21DaGFyQ29kZSg1NTI5NnxjaD4+MTAsNTYzMjB8Y2gmMTAyMyl9fX1yZXR1cm4gc3RyfWZ1bmN0aW9uIFVURjhUb1N0cmluZyhwdHIsbWF4Qnl0ZXNUb1JlYWQpe3JldHVybiBwdHI/VVRGOEFycmF5VG9TdHJpbmcoSEVBUFU4LHB0cixtYXhCeXRlc1RvUmVhZCk6IiJ9ZnVuY3Rpb24gc3RyaW5nVG9VVEY4QXJyYXkoc3RyLGhlYXAsb3V0SWR4LG1heEJ5dGVzVG9Xcml0ZSl7aWYoIShtYXhCeXRlc1RvV3JpdGU+MCkpcmV0dXJuIDA7dmFyIHN0YXJ0SWR4PW91dElkeDt2YXIgZW5kSWR4PW91dElkeCttYXhCeXRlc1RvV3JpdGUtMTtmb3IodmFyIGk9MDtpPHN0ci5sZW5ndGg7KytpKXt2YXIgdT1zdHIuY2hhckNvZGVBdChpKTtpZih1Pj01NTI5NiYmdTw9NTczNDMpe3ZhciB1MT1zdHIuY2hhckNvZGVBdCgrK2kpO3U9NjU1MzYrKCh1JjEwMjMpPDwxMCl8dTEmMTAyM31pZih1PD0xMjcpe2lmKG91dElkeD49ZW5kSWR4KWJyZWFrO2hlYXBbb3V0SWR4KytdPXV9ZWxzZSBpZih1PD0yMDQ3KXtpZihvdXRJZHgrMT49ZW5kSWR4KWJyZWFrO2hlYXBbb3V0SWR4KytdPTE5Mnx1Pj42O2hlYXBbb3V0SWR4KytdPTEyOHx1JjYzfWVsc2UgaWYodTw9NjU1MzUpe2lmKG91dElkeCsyPj1lbmRJZHgpYnJlYWs7aGVhcFtvdXRJZHgrK109MjI0fHU+PjEyO2hlYXBbb3V0SWR4KytdPTEyOHx1Pj42JjYzO2hlYXBbb3V0SWR4KytdPTEyOHx1JjYzfWVsc2V7aWYob3V0SWR4KzM+PWVuZElkeClicmVhaztoZWFwW291dElkeCsrXT0yNDB8dT4+MTg7aGVhcFtvdXRJZHgrK109MTI4fHU+PjEyJjYzO2hlYXBbb3V0SWR4KytdPTEyOHx1Pj42JjYzO2hlYXBbb3V0SWR4KytdPTEyOHx1JjYzfX1oZWFwW291dElkeF09MDtyZXR1cm4gb3V0SWR4LXN0YXJ0SWR4fWZ1bmN0aW9uIHN0cmluZ1RvVVRGOChzdHIsb3V0UHRyLG1heEJ5dGVzVG9Xcml0ZSl7cmV0dXJuIHN0cmluZ1RvVVRGOEFycmF5KHN0cixIRUFQVTgsb3V0UHRyLG1heEJ5dGVzVG9Xcml0ZSl9ZnVuY3Rpb24gbGVuZ3RoQnl0ZXNVVEY4KHN0cil7dmFyIGxlbj0wO2Zvcih2YXIgaT0wO2k8c3RyLmxlbmd0aDsrK2kpe3ZhciB1PXN0ci5jaGFyQ29kZUF0KGkpO2lmKHU+PTU1Mjk2JiZ1PD01NzM0Myl1PTY1NTM2KygodSYxMDIzKTw8MTApfHN0ci5jaGFyQ29kZUF0KCsraSkmMTAyMztpZih1PD0xMjcpKytsZW47ZWxzZSBpZih1PD0yMDQ3KWxlbis9MjtlbHNlIGlmKHU8PTY1NTM1KWxlbis9MztlbHNlIGxlbis9NH1yZXR1cm4gbGVufXZhciBVVEYxNkRlY29kZXI9dHlwZW9mIFRleHREZWNvZGVyIT09InVuZGVmaW5lZCI/bmV3IFRleHREZWNvZGVyKCJ1dGYtMTZsZSIpOnVuZGVmaW5lZDtmdW5jdGlvbiBVVEYxNlRvU3RyaW5nKHB0cixtYXhCeXRlc1RvUmVhZCl7dmFyIGVuZFB0cj1wdHI7dmFyIGlkeD1lbmRQdHI+PjE7dmFyIG1heElkeD1pZHgrbWF4Qnl0ZXNUb1JlYWQvMjt3aGlsZSghKGlkeD49bWF4SWR4KSYmSEVBUFUxNltpZHhdKSsraWR4O2VuZFB0cj1pZHg8PDE7aWYoZW5kUHRyLXB0cj4zMiYmVVRGMTZEZWNvZGVyKXtyZXR1cm4gVVRGMTZEZWNvZGVyLmRlY29kZShIRUFQVTguc3ViYXJyYXkocHRyLGVuZFB0cikpfWVsc2V7dmFyIHN0cj0iIjtmb3IodmFyIGk9MDshKGk+PW1heEJ5dGVzVG9SZWFkLzIpOysraSl7dmFyIGNvZGVVbml0PUhFQVAxNltwdHIraSoyPj4xXTtpZihjb2RlVW5pdD09MClicmVhaztzdHIrPVN0cmluZy5mcm9tQ2hhckNvZGUoY29kZVVuaXQpfXJldHVybiBzdHJ9fWZ1bmN0aW9uIHN0cmluZ1RvVVRGMTYoc3RyLG91dFB0cixtYXhCeXRlc1RvV3JpdGUpe2lmKG1heEJ5dGVzVG9Xcml0ZT09PXVuZGVmaW5lZCl7bWF4Qnl0ZXNUb1dyaXRlPTIxNDc0ODM2NDd9aWYobWF4Qnl0ZXNUb1dyaXRlPDIpcmV0dXJuIDA7bWF4Qnl0ZXNUb1dyaXRlLT0yO3ZhciBzdGFydFB0cj1vdXRQdHI7dmFyIG51bUNoYXJzVG9Xcml0ZT1tYXhCeXRlc1RvV3JpdGU8c3RyLmxlbmd0aCoyP21heEJ5dGVzVG9Xcml0ZS8yOnN0ci5sZW5ndGg7Zm9yKHZhciBpPTA7aTxudW1DaGFyc1RvV3JpdGU7KytpKXt2YXIgY29kZVVuaXQ9c3RyLmNoYXJDb2RlQXQoaSk7SEVBUDE2W291dFB0cj4+MV09Y29kZVVuaXQ7b3V0UHRyKz0yfUhFQVAxNltvdXRQdHI+PjFdPTA7cmV0dXJuIG91dFB0ci1zdGFydFB0cn1mdW5jdGlvbiBsZW5ndGhCeXRlc1VURjE2KHN0cil7cmV0dXJuIHN0ci5sZW5ndGgqMn1mdW5jdGlvbiBVVEYzMlRvU3RyaW5nKHB0cixtYXhCeXRlc1RvUmVhZCl7dmFyIGk9MDt2YXIgc3RyPSIiO3doaWxlKCEoaT49bWF4Qnl0ZXNUb1JlYWQvNCkpe3ZhciB1dGYzMj1IRUFQMzJbcHRyK2kqND4+Ml07aWYodXRmMzI9PTApYnJlYWs7KytpO2lmKHV0ZjMyPj02NTUzNil7dmFyIGNoPXV0ZjMyLTY1NTM2O3N0cis9U3RyaW5nLmZyb21DaGFyQ29kZSg1NTI5NnxjaD4+MTAsNTYzMjB8Y2gmMTAyMyl9ZWxzZXtzdHIrPVN0cmluZy5mcm9tQ2hhckNvZGUodXRmMzIpfX1yZXR1cm4gc3RyfWZ1bmN0aW9uIHN0cmluZ1RvVVRGMzIoc3RyLG91dFB0cixtYXhCeXRlc1RvV3JpdGUpe2lmKG1heEJ5dGVzVG9Xcml0ZT09PXVuZGVmaW5lZCl7bWF4Qnl0ZXNUb1dyaXRlPTIxNDc0ODM2NDd9aWYobWF4Qnl0ZXNUb1dyaXRlPDQpcmV0dXJuIDA7dmFyIHN0YXJ0UHRyPW91dFB0cjt2YXIgZW5kUHRyPXN0YXJ0UHRyK21heEJ5dGVzVG9Xcml0ZS00O2Zvcih2YXIgaT0wO2k8c3RyLmxlbmd0aDsrK2kpe3ZhciBjb2RlVW5pdD1zdHIuY2hhckNvZGVBdChpKTtpZihjb2RlVW5pdD49NTUyOTYmJmNvZGVVbml0PD01NzM0Myl7dmFyIHRyYWlsU3Vycm9nYXRlPXN0ci5jaGFyQ29kZUF0KCsraSk7Y29kZVVuaXQ9NjU1MzYrKChjb2RlVW5pdCYxMDIzKTw8MTApfHRyYWlsU3Vycm9nYXRlJjEwMjN9SEVBUDMyW291dFB0cj4+Ml09Y29kZVVuaXQ7b3V0UHRyKz00O2lmKG91dFB0cis0PmVuZFB0cilicmVha31IRUFQMzJbb3V0UHRyPj4yXT0wO3JldHVybiBvdXRQdHItc3RhcnRQdHJ9ZnVuY3Rpb24gbGVuZ3RoQnl0ZXNVVEYzMihzdHIpe3ZhciBsZW49MDtmb3IodmFyIGk9MDtpPHN0ci5sZW5ndGg7KytpKXt2YXIgY29kZVVuaXQ9c3RyLmNoYXJDb2RlQXQoaSk7aWYoY29kZVVuaXQ+PTU1Mjk2JiZjb2RlVW5pdDw9NTczNDMpKytpO2xlbis9NH1yZXR1cm4gbGVufXZhciBidWZmZXIsSEVBUDgsSEVBUFU4LEhFQVAxNixIRUFQVTE2LEhFQVAzMixIRUFQVTMyLEhFQVBGMzIsSEVBUEY2NDtmdW5jdGlvbiB1cGRhdGVHbG9iYWxCdWZmZXJBbmRWaWV3cyhidWYpe2J1ZmZlcj1idWY7TW9kdWxlWyJIRUFQOCJdPUhFQVA4PW5ldyBJbnQ4QXJyYXkoYnVmKTtNb2R1bGVbIkhFQVAxNiJdPUhFQVAxNj1uZXcgSW50MTZBcnJheShidWYpO01vZHVsZVsiSEVBUDMyIl09SEVBUDMyPW5ldyBJbnQzMkFycmF5KGJ1Zik7TW9kdWxlWyJIRUFQVTgiXT1IRUFQVTg9bmV3IFVpbnQ4QXJyYXkoYnVmKTtNb2R1bGVbIkhFQVBVMTYiXT1IRUFQVTE2PW5ldyBVaW50MTZBcnJheShidWYpO01vZHVsZVsiSEVBUFUzMiJdPUhFQVBVMzI9bmV3IFVpbnQzMkFycmF5KGJ1Zik7TW9kdWxlWyJIRUFQRjMyIl09SEVBUEYzMj1uZXcgRmxvYXQzMkFycmF5KGJ1Zik7TW9kdWxlWyJIRUFQRjY0Il09SEVBUEY2ND1uZXcgRmxvYXQ2NEFycmF5KGJ1Zil9dmFyIElOSVRJQUxfTUVNT1JZPU1vZHVsZVsiSU5JVElBTF9NRU1PUlkiXXx8ODM4ODYwODt2YXIgd2FzbVRhYmxlO3ZhciBfX0FUUFJFUlVOX189W107dmFyIF9fQVRJTklUX189W107dmFyIF9fQVRNQUlOX189W107dmFyIF9fQVRQT1NUUlVOX189W107dmFyIHJ1bnRpbWVJbml0aWFsaXplZD1mYWxzZTtfX0FUSU5JVF9fLnB1c2goe2Z1bmM6ZnVuY3Rpb24oKXtfX193YXNtX2NhbGxfY3RvcnMoKX19KTtmdW5jdGlvbiBwcmVSdW4oKXtpZihNb2R1bGVbInByZVJ1biJdKXtpZih0eXBlb2YgTW9kdWxlWyJwcmVSdW4iXT09ImZ1bmN0aW9uIilNb2R1bGVbInByZVJ1biJdPVtNb2R1bGVbInByZVJ1biJdXTt3aGlsZShNb2R1bGVbInByZVJ1biJdLmxlbmd0aCl7YWRkT25QcmVSdW4oTW9kdWxlWyJwcmVSdW4iXS5zaGlmdCgpKX19Y2FsbFJ1bnRpbWVDYWxsYmFja3MoX19BVFBSRVJVTl9fKX1mdW5jdGlvbiBpbml0UnVudGltZSgpe3J1bnRpbWVJbml0aWFsaXplZD10cnVlO2NhbGxSdW50aW1lQ2FsbGJhY2tzKF9fQVRJTklUX18pfWZ1bmN0aW9uIHByZU1haW4oKXtjYWxsUnVudGltZUNhbGxiYWNrcyhfX0FUTUFJTl9fKX1mdW5jdGlvbiBwb3N0UnVuKCl7aWYoTW9kdWxlWyJwb3N0UnVuIl0pe2lmKHR5cGVvZiBNb2R1bGVbInBvc3RSdW4iXT09ImZ1bmN0aW9uIilNb2R1bGVbInBvc3RSdW4iXT1bTW9kdWxlWyJwb3N0UnVuIl1dO3doaWxlKE1vZHVsZVsicG9zdFJ1biJdLmxlbmd0aCl7YWRkT25Qb3N0UnVuKE1vZHVsZVsicG9zdFJ1biJdLnNoaWZ0KCkpfX1jYWxsUnVudGltZUNhbGxiYWNrcyhfX0FUUE9TVFJVTl9fKX1mdW5jdGlvbiBhZGRPblByZVJ1bihjYil7X19BVFBSRVJVTl9fLnVuc2hpZnQoY2IpfWZ1bmN0aW9uIGFkZE9uUG9zdFJ1bihjYil7X19BVFBPU1RSVU5fXy51bnNoaWZ0KGNiKX12YXIgcnVuRGVwZW5kZW5jaWVzPTA7dmFyIHJ1bkRlcGVuZGVuY3lXYXRjaGVyPW51bGw7dmFyIGRlcGVuZGVuY2llc0Z1bGZpbGxlZD1udWxsO2Z1bmN0aW9uIGFkZFJ1bkRlcGVuZGVuY3koaWQpe3J1bkRlcGVuZGVuY2llcysrO2lmKE1vZHVsZVsibW9uaXRvclJ1bkRlcGVuZGVuY2llcyJdKXtNb2R1bGVbIm1vbml0b3JSdW5EZXBlbmRlbmNpZXMiXShydW5EZXBlbmRlbmNpZXMpfX1mdW5jdGlvbiByZW1vdmVSdW5EZXBlbmRlbmN5KGlkKXtydW5EZXBlbmRlbmNpZXMtLTtpZihNb2R1bGVbIm1vbml0b3JSdW5EZXBlbmRlbmNpZXMiXSl7TW9kdWxlWyJtb25pdG9yUnVuRGVwZW5kZW5jaWVzIl0ocnVuRGVwZW5kZW5jaWVzKX1pZihydW5EZXBlbmRlbmNpZXM9PTApe2lmKHJ1bkRlcGVuZGVuY3lXYXRjaGVyIT09bnVsbCl7Y2xlYXJJbnRlcnZhbChydW5EZXBlbmRlbmN5V2F0Y2hlcik7cnVuRGVwZW5kZW5jeVdhdGNoZXI9bnVsbH1pZihkZXBlbmRlbmNpZXNGdWxmaWxsZWQpe3ZhciBjYWxsYmFjaz1kZXBlbmRlbmNpZXNGdWxmaWxsZWQ7ZGVwZW5kZW5jaWVzRnVsZmlsbGVkPW51bGw7Y2FsbGJhY2soKX19fU1vZHVsZVsicHJlbG9hZGVkSW1hZ2VzIl09e307TW9kdWxlWyJwcmVsb2FkZWRBdWRpb3MiXT17fTtmdW5jdGlvbiBhYm9ydCh3aGF0KXtpZihNb2R1bGVbIm9uQWJvcnQiXSl7TW9kdWxlWyJvbkFib3J0Il0od2hhdCl9d2hhdCs9IiI7ZXJyKHdoYXQpO0FCT1JUPXRydWU7RVhJVFNUQVRVUz0xO3doYXQ9ImFib3J0KCIrd2hhdCsiKS4gQnVpbGQgd2l0aCAtcyBBU1NFUlRJT05TPTEgZm9yIG1vcmUgaW5mby4iO3ZhciBlPW5ldyBXZWJBc3NlbWJseS5SdW50aW1lRXJyb3Iod2hhdCk7cmVhZHlQcm9taXNlUmVqZWN0KGUpO3Rocm93IGV9ZnVuY3Rpb24gaGFzUHJlZml4KHN0cixwcmVmaXgpe3JldHVybiBTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGg/c3RyLnN0YXJ0c1dpdGgocHJlZml4KTpzdHIuaW5kZXhPZihwcmVmaXgpPT09MH12YXIgZGF0YVVSSVByZWZpeD0iZGF0YTphcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07YmFzZTY0LCI7ZnVuY3Rpb24gaXNEYXRhVVJJKGZpbGVuYW1lKXtyZXR1cm4gaGFzUHJlZml4KGZpbGVuYW1lLGRhdGFVUklQcmVmaXgpfXZhciB3YXNtQmluYXJ5RmlsZT0iRkJUb2tlbml6ZXIud2FzbSI7aWYoIWlzRGF0YVVSSSh3YXNtQmluYXJ5RmlsZSkpe3dhc21CaW5hcnlGaWxlPWxvY2F0ZUZpbGUod2FzbUJpbmFyeUZpbGUpfWZ1bmN0aW9uIGdldEJpbmFyeShmaWxlKXt0cnl7aWYoZmlsZT09d2FzbUJpbmFyeUZpbGUmJndhc21CaW5hcnkpe3JldHVybiBuZXcgVWludDhBcnJheSh3YXNtQmluYXJ5KX1pZihyZWFkQmluYXJ5KXtyZXR1cm4gcmVhZEJpbmFyeShmaWxlKX1lbHNle3Rocm93InN5bmMgZmV0Y2hpbmcgb2YgdGhlIHdhc20gZmFpbGVkOiB5b3UgY2FuIHByZWxvYWQgaXQgdG8gTW9kdWxlWyd3YXNtQmluYXJ5J10gbWFudWFsbHksIG9yIGVtY2MucHkgd2lsbCBkbyB0aGF0IGZvciB5b3Ugd2hlbiBnZW5lcmF0aW5nIEhUTUwgKGJ1dCBub3QgSlMpIn19Y2F0Y2goZXJyKXthYm9ydChlcnIpfX1mdW5jdGlvbiBpbnN0YW50aWF0ZVN5bmMoZmlsZSxpbmZvKXt2YXIgaW5zdGFuY2U7dmFyIG1vZHVsZTt2YXIgYmluYXJ5O3RyeXtiaW5hcnk9Z2V0QmluYXJ5KGZpbGUpO21vZHVsZT1uZXcgV2ViQXNzZW1ibHkuTW9kdWxlKGJpbmFyeSk7aW5zdGFuY2U9bmV3IFdlYkFzc2VtYmx5Lkluc3RhbmNlKG1vZHVsZSxpbmZvKX1jYXRjaChlKXt2YXIgc3RyPWUudG9TdHJpbmcoKTtlcnIoImZhaWxlZCB0byBjb21waWxlIHdhc20gbW9kdWxlOiAiK3N0cik7aWYoc3RyLmluZGV4T2YoImltcG9ydGVkIE1lbW9yeSIpPj0wfHxzdHIuaW5kZXhPZigibWVtb3J5IGltcG9ydCIpPj0wKXtlcnIoIk1lbW9yeSBzaXplIGluY29tcGF0aWJpbGl0eSBpc3N1ZXMgbWF5IGJlIGR1ZSB0byBjaGFuZ2luZyBJTklUSUFMX01FTU9SWSBhdCBydW50aW1lIHRvIHNvbWV0aGluZyB0b28gbGFyZ2UuIFVzZSBBTExPV19NRU1PUllfR1JPV1RIIHRvIGFsbG93IGFueSBzaXplIG1lbW9yeSAoYW5kIGFsc28gbWFrZSBzdXJlIG5vdCB0byBzZXQgSU5JVElBTF9NRU1PUlkgYXQgcnVudGltZSB0byBzb21ldGhpbmcgc21hbGxlciB0aGFuIGl0IHdhcyBhdCBjb21waWxlIHRpbWUpLiIpfXRocm93IGV9cmV0dXJuW2luc3RhbmNlLG1vZHVsZV19ZnVuY3Rpb24gY3JlYXRlV2FzbSgpe3ZhciBpbmZvPXsiYSI6YXNtTGlicmFyeUFyZ307ZnVuY3Rpb24gcmVjZWl2ZUluc3RhbmNlKGluc3RhbmNlLG1vZHVsZSl7dmFyIGV4cG9ydHM9aW5zdGFuY2UuZXhwb3J0cztNb2R1bGVbImFzbSJdPWV4cG9ydHM7d2FzbU1lbW9yeT1Nb2R1bGVbImFzbSJdWyJCIl07dXBkYXRlR2xvYmFsQnVmZmVyQW5kVmlld3Mod2FzbU1lbW9yeS5idWZmZXIpO3dhc21UYWJsZT1Nb2R1bGVbImFzbSJdWyJFIl07cmVtb3ZlUnVuRGVwZW5kZW5jeSgid2FzbS1pbnN0YW50aWF0ZSIpfWFkZFJ1bkRlcGVuZGVuY3koIndhc20taW5zdGFudGlhdGUiKTtpZihNb2R1bGVbImluc3RhbnRpYXRlV2FzbSJdKXt0cnl7dmFyIGV4cG9ydHM9TW9kdWxlWyJpbnN0YW50aWF0ZVdhc20iXShpbmZvLHJlY2VpdmVJbnN0YW5jZSk7cmV0dXJuIGV4cG9ydHN9Y2F0Y2goZSl7ZXJyKCJNb2R1bGUuaW5zdGFudGlhdGVXYXNtIGNhbGxiYWNrIGZhaWxlZCB3aXRoIGVycm9yOiAiK2UpO3JldHVybiBmYWxzZX19dmFyIHJlc3VsdD1pbnN0YW50aWF0ZVN5bmMod2FzbUJpbmFyeUZpbGUsaW5mbyk7cmVjZWl2ZUluc3RhbmNlKHJlc3VsdFswXSxyZXN1bHRbMV0pO3JldHVybiBNb2R1bGVbImFzbSJdfWZ1bmN0aW9uIGNhbGxSdW50aW1lQ2FsbGJhY2tzKGNhbGxiYWNrcyl7d2hpbGUoY2FsbGJhY2tzLmxlbmd0aD4wKXt2YXIgY2FsbGJhY2s9Y2FsbGJhY2tzLnNoaWZ0KCk7aWYodHlwZW9mIGNhbGxiYWNrPT0iZnVuY3Rpb24iKXtjYWxsYmFjayhNb2R1bGUpO2NvbnRpbnVlfXZhciBmdW5jPWNhbGxiYWNrLmZ1bmM7aWYodHlwZW9mIGZ1bmM9PT0ibnVtYmVyIil7aWYoY2FsbGJhY2suYXJnPT09dW5kZWZpbmVkKXt3YXNtVGFibGUuZ2V0KGZ1bmMpKCl9ZWxzZXt3YXNtVGFibGUuZ2V0KGZ1bmMpKGNhbGxiYWNrLmFyZyl9fWVsc2V7ZnVuYyhjYWxsYmFjay5hcmc9PT11bmRlZmluZWQ/bnVsbDpjYWxsYmFjay5hcmcpfX19dmFyIEV4Y2VwdGlvbkluZm9BdHRycz17REVTVFJVQ1RPUl9PRkZTRVQ6MCxSRUZDT1VOVF9PRkZTRVQ6NCxUWVBFX09GRlNFVDo4LENBVUdIVF9PRkZTRVQ6MTIsUkVUSFJPV05fT0ZGU0VUOjEzLFNJWkU6MTZ9O2Z1bmN0aW9uIF9fX2N4YV9hbGxvY2F0ZV9leGNlcHRpb24oc2l6ZSl7cmV0dXJuIF9tYWxsb2Moc2l6ZStFeGNlcHRpb25JbmZvQXR0cnMuU0laRSkrRXhjZXB0aW9uSW5mb0F0dHJzLlNJWkV9ZnVuY3Rpb24gRXhjZXB0aW9uSW5mbyhleGNQdHIpe3RoaXMuZXhjUHRyPWV4Y1B0cjt0aGlzLnB0cj1leGNQdHItRXhjZXB0aW9uSW5mb0F0dHJzLlNJWkU7dGhpcy5zZXRfdHlwZT1mdW5jdGlvbih0eXBlKXtIRUFQMzJbdGhpcy5wdHIrRXhjZXB0aW9uSW5mb0F0dHJzLlRZUEVfT0ZGU0VUPj4yXT10eXBlfTt0aGlzLmdldF90eXBlPWZ1bmN0aW9uKCl7cmV0dXJuIEhFQVAzMlt0aGlzLnB0citFeGNlcHRpb25JbmZvQXR0cnMuVFlQRV9PRkZTRVQ+PjJdfTt0aGlzLnNldF9kZXN0cnVjdG9yPWZ1bmN0aW9uKGRlc3RydWN0b3Ipe0hFQVAzMlt0aGlzLnB0citFeGNlcHRpb25JbmZvQXR0cnMuREVTVFJVQ1RPUl9PRkZTRVQ+PjJdPWRlc3RydWN0b3J9O3RoaXMuZ2V0X2Rlc3RydWN0b3I9ZnVuY3Rpb24oKXtyZXR1cm4gSEVBUDMyW3RoaXMucHRyK0V4Y2VwdGlvbkluZm9BdHRycy5ERVNUUlVDVE9SX09GRlNFVD4+Ml19O3RoaXMuc2V0X3JlZmNvdW50PWZ1bmN0aW9uKHJlZmNvdW50KXtIRUFQMzJbdGhpcy5wdHIrRXhjZXB0aW9uSW5mb0F0dHJzLlJFRkNPVU5UX09GRlNFVD4+Ml09cmVmY291bnR9O3RoaXMuc2V0X2NhdWdodD1mdW5jdGlvbihjYXVnaHQpe2NhdWdodD1jYXVnaHQ/MTowO0hFQVA4W3RoaXMucHRyK0V4Y2VwdGlvbkluZm9BdHRycy5DQVVHSFRfT0ZGU0VUPj4wXT1jYXVnaHR9O3RoaXMuZ2V0X2NhdWdodD1mdW5jdGlvbigpe3JldHVybiBIRUFQOFt0aGlzLnB0citFeGNlcHRpb25JbmZvQXR0cnMuQ0FVR0hUX09GRlNFVD4+MF0hPTB9O3RoaXMuc2V0X3JldGhyb3duPWZ1bmN0aW9uKHJldGhyb3duKXtyZXRocm93bj1yZXRocm93bj8xOjA7SEVBUDhbdGhpcy5wdHIrRXhjZXB0aW9uSW5mb0F0dHJzLlJFVEhST1dOX09GRlNFVD4+MF09cmV0aHJvd259O3RoaXMuZ2V0X3JldGhyb3duPWZ1bmN0aW9uKCl7cmV0dXJuIEhFQVA4W3RoaXMucHRyK0V4Y2VwdGlvbkluZm9BdHRycy5SRVRIUk9XTl9PRkZTRVQ+PjBdIT0wfTt0aGlzLmluaXQ9ZnVuY3Rpb24odHlwZSxkZXN0cnVjdG9yKXt0aGlzLnNldF90eXBlKHR5cGUpO3RoaXMuc2V0X2Rlc3RydWN0b3IoZGVzdHJ1Y3Rvcik7dGhpcy5zZXRfcmVmY291bnQoMCk7dGhpcy5zZXRfY2F1Z2h0KGZhbHNlKTt0aGlzLnNldF9yZXRocm93bihmYWxzZSl9O3RoaXMuYWRkX3JlZj1mdW5jdGlvbigpe3ZhciB2YWx1ZT1IRUFQMzJbdGhpcy5wdHIrRXhjZXB0aW9uSW5mb0F0dHJzLlJFRkNPVU5UX09GRlNFVD4+Ml07SEVBUDMyW3RoaXMucHRyK0V4Y2VwdGlvbkluZm9BdHRycy5SRUZDT1VOVF9PRkZTRVQ+PjJdPXZhbHVlKzF9O3RoaXMucmVsZWFzZV9yZWY9ZnVuY3Rpb24oKXt2YXIgcHJldj1IRUFQMzJbdGhpcy5wdHIrRXhjZXB0aW9uSW5mb0F0dHJzLlJFRkNPVU5UX09GRlNFVD4+Ml07SEVBUDMyW3RoaXMucHRyK0V4Y2VwdGlvbkluZm9BdHRycy5SRUZDT1VOVF9PRkZTRVQ+PjJdPXByZXYtMTtyZXR1cm4gcHJldj09PTF9fXZhciBleGNlcHRpb25MYXN0PTA7dmFyIHVuY2F1Z2h0RXhjZXB0aW9uQ291bnQ9MDtmdW5jdGlvbiBfX19jeGFfdGhyb3cocHRyLHR5cGUsZGVzdHJ1Y3Rvcil7dmFyIGluZm89bmV3IEV4Y2VwdGlvbkluZm8ocHRyKTtpbmZvLmluaXQodHlwZSxkZXN0cnVjdG9yKTtleGNlcHRpb25MYXN0PXB0cjt1bmNhdWdodEV4Y2VwdGlvbkNvdW50Kys7dGhyb3cgcHRyfWZ1bmN0aW9uIGdldFNoaWZ0RnJvbVNpemUoc2l6ZSl7c3dpdGNoKHNpemUpe2Nhc2UgMTpyZXR1cm4gMDtjYXNlIDI6cmV0dXJuIDE7Y2FzZSA0OnJldHVybiAyO2Nhc2UgODpyZXR1cm4gMztkZWZhdWx0OnRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gdHlwZSBzaXplOiAiK3NpemUpfX1mdW5jdGlvbiBlbWJpbmRfaW5pdF9jaGFyQ29kZXMoKXt2YXIgY29kZXM9bmV3IEFycmF5KDI1Nik7Zm9yKHZhciBpPTA7aTwyNTY7KytpKXtjb2Rlc1tpXT1TdHJpbmcuZnJvbUNoYXJDb2RlKGkpfWVtYmluZF9jaGFyQ29kZXM9Y29kZXN9dmFyIGVtYmluZF9jaGFyQ29kZXM9dW5kZWZpbmVkO2Z1bmN0aW9uIHJlYWRMYXRpbjFTdHJpbmcocHRyKXt2YXIgcmV0PSIiO3ZhciBjPXB0cjt3aGlsZShIRUFQVThbY10pe3JldCs9ZW1iaW5kX2NoYXJDb2Rlc1tIRUFQVThbYysrXV19cmV0dXJuIHJldH12YXIgYXdhaXRpbmdEZXBlbmRlbmNpZXM9e307dmFyIHJlZ2lzdGVyZWRUeXBlcz17fTt2YXIgdHlwZURlcGVuZGVuY2llcz17fTt2YXIgY2hhcl8wPTQ4O3ZhciBjaGFyXzk9NTc7ZnVuY3Rpb24gbWFrZUxlZ2FsRnVuY3Rpb25OYW1lKG5hbWUpe2lmKHVuZGVmaW5lZD09PW5hbWUpe3JldHVybiJfdW5rbm93biJ9bmFtZT1uYW1lLnJlcGxhY2UoL1teYS16QS1aMC05X10vZywiJCIpO3ZhciBmPW5hbWUuY2hhckNvZGVBdCgwKTtpZihmPj1jaGFyXzAmJmY8PWNoYXJfOSl7cmV0dXJuIl8iK25hbWV9ZWxzZXtyZXR1cm4gbmFtZX19ZnVuY3Rpb24gY3JlYXRlTmFtZWRGdW5jdGlvbihuYW1lLGJvZHkpe25hbWU9bWFrZUxlZ2FsRnVuY3Rpb25OYW1lKG5hbWUpO3JldHVybiBuZXcgRnVuY3Rpb24oImJvZHkiLCJyZXR1cm4gZnVuY3Rpb24gIituYW1lKyIoKSB7XG4iKycgICAgInVzZSBzdHJpY3QiOycrIiAgICByZXR1cm4gYm9keS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuIisifTtcbiIpKGJvZHkpfWZ1bmN0aW9uIGV4dGVuZEVycm9yKGJhc2VFcnJvclR5cGUsZXJyb3JOYW1lKXt2YXIgZXJyb3JDbGFzcz1jcmVhdGVOYW1lZEZ1bmN0aW9uKGVycm9yTmFtZSxmdW5jdGlvbihtZXNzYWdlKXt0aGlzLm5hbWU9ZXJyb3JOYW1lO3RoaXMubWVzc2FnZT1tZXNzYWdlO3ZhciBzdGFjaz1uZXcgRXJyb3IobWVzc2FnZSkuc3RhY2s7aWYoc3RhY2shPT11bmRlZmluZWQpe3RoaXMuc3RhY2s9dGhpcy50b1N0cmluZygpKyJcbiIrc3RhY2sucmVwbGFjZSgvXkVycm9yKDpbXlxuXSopP1xuLywiIil9fSk7ZXJyb3JDbGFzcy5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShiYXNlRXJyb3JUeXBlLnByb3RvdHlwZSk7ZXJyb3JDbGFzcy5wcm90b3R5cGUuY29uc3RydWN0b3I9ZXJyb3JDbGFzcztlcnJvckNsYXNzLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe2lmKHRoaXMubWVzc2FnZT09PXVuZGVmaW5lZCl7cmV0dXJuIHRoaXMubmFtZX1lbHNle3JldHVybiB0aGlzLm5hbWUrIjogIit0aGlzLm1lc3NhZ2V9fTtyZXR1cm4gZXJyb3JDbGFzc312YXIgQmluZGluZ0Vycm9yPXVuZGVmaW5lZDtmdW5jdGlvbiB0aHJvd0JpbmRpbmdFcnJvcihtZXNzYWdlKXt0aHJvdyBuZXcgQmluZGluZ0Vycm9yKG1lc3NhZ2UpfXZhciBJbnRlcm5hbEVycm9yPXVuZGVmaW5lZDtmdW5jdGlvbiB0aHJvd0ludGVybmFsRXJyb3IobWVzc2FnZSl7dGhyb3cgbmV3IEludGVybmFsRXJyb3IobWVzc2FnZSl9ZnVuY3Rpb24gd2hlbkRlcGVuZGVudFR5cGVzQXJlUmVzb2x2ZWQobXlUeXBlcyxkZXBlbmRlbnRUeXBlcyxnZXRUeXBlQ29udmVydGVycyl7bXlUeXBlcy5mb3JFYWNoKGZ1bmN0aW9uKHR5cGUpe3R5cGVEZXBlbmRlbmNpZXNbdHlwZV09ZGVwZW5kZW50VHlwZXN9KTtmdW5jdGlvbiBvbkNvbXBsZXRlKHR5cGVDb252ZXJ0ZXJzKXt2YXIgbXlUeXBlQ29udmVydGVycz1nZXRUeXBlQ29udmVydGVycyh0eXBlQ29udmVydGVycyk7aWYobXlUeXBlQ29udmVydGVycy5sZW5ndGghPT1teVR5cGVzLmxlbmd0aCl7dGhyb3dJbnRlcm5hbEVycm9yKCJNaXNtYXRjaGVkIHR5cGUgY29udmVydGVyIGNvdW50Iil9Zm9yKHZhciBpPTA7aTxteVR5cGVzLmxlbmd0aDsrK2kpe3JlZ2lzdGVyVHlwZShteVR5cGVzW2ldLG15VHlwZUNvbnZlcnRlcnNbaV0pfX12YXIgdHlwZUNvbnZlcnRlcnM9bmV3IEFycmF5KGRlcGVuZGVudFR5cGVzLmxlbmd0aCk7dmFyIHVucmVnaXN0ZXJlZFR5cGVzPVtdO3ZhciByZWdpc3RlcmVkPTA7ZGVwZW5kZW50VHlwZXMuZm9yRWFjaChmdW5jdGlvbihkdCxpKXtpZihyZWdpc3RlcmVkVHlwZXMuaGFzT3duUHJvcGVydHkoZHQpKXt0eXBlQ29udmVydGVyc1tpXT1yZWdpc3RlcmVkVHlwZXNbZHRdfWVsc2V7dW5yZWdpc3RlcmVkVHlwZXMucHVzaChkdCk7aWYoIWF3YWl0aW5nRGVwZW5kZW5jaWVzLmhhc093blByb3BlcnR5KGR0KSl7YXdhaXRpbmdEZXBlbmRlbmNpZXNbZHRdPVtdfWF3YWl0aW5nRGVwZW5kZW5jaWVzW2R0XS5wdXNoKGZ1bmN0aW9uKCl7dHlwZUNvbnZlcnRlcnNbaV09cmVnaXN0ZXJlZFR5cGVzW2R0XTsrK3JlZ2lzdGVyZWQ7aWYocmVnaXN0ZXJlZD09PXVucmVnaXN0ZXJlZFR5cGVzLmxlbmd0aCl7b25Db21wbGV0ZSh0eXBlQ29udmVydGVycyl9fSl9fSk7aWYoMD09PXVucmVnaXN0ZXJlZFR5cGVzLmxlbmd0aCl7b25Db21wbGV0ZSh0eXBlQ29udmVydGVycyl9fWZ1bmN0aW9uIHJlZ2lzdGVyVHlwZShyYXdUeXBlLHJlZ2lzdGVyZWRJbnN0YW5jZSxvcHRpb25zKXtvcHRpb25zPW9wdGlvbnN8fHt9O2lmKCEoImFyZ1BhY2tBZHZhbmNlImluIHJlZ2lzdGVyZWRJbnN0YW5jZSkpe3Rocm93IG5ldyBUeXBlRXJyb3IoInJlZ2lzdGVyVHlwZSByZWdpc3RlcmVkSW5zdGFuY2UgcmVxdWlyZXMgYXJnUGFja0FkdmFuY2UiKX12YXIgbmFtZT1yZWdpc3RlcmVkSW5zdGFuY2UubmFtZTtpZighcmF3VHlwZSl7dGhyb3dCaW5kaW5nRXJyb3IoJ3R5cGUgIicrbmFtZSsnIiBtdXN0IGhhdmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIHR5cGVpZCBwb2ludGVyJyl9aWYocmVnaXN0ZXJlZFR5cGVzLmhhc093blByb3BlcnR5KHJhd1R5cGUpKXtpZihvcHRpb25zLmlnbm9yZUR1cGxpY2F0ZVJlZ2lzdHJhdGlvbnMpe3JldHVybn1lbHNle3Rocm93QmluZGluZ0Vycm9yKCJDYW5ub3QgcmVnaXN0ZXIgdHlwZSAnIituYW1lKyInIHR3aWNlIil9fXJlZ2lzdGVyZWRUeXBlc1tyYXdUeXBlXT1yZWdpc3RlcmVkSW5zdGFuY2U7ZGVsZXRlIHR5cGVEZXBlbmRlbmNpZXNbcmF3VHlwZV07aWYoYXdhaXRpbmdEZXBlbmRlbmNpZXMuaGFzT3duUHJvcGVydHkocmF3VHlwZSkpe3ZhciBjYWxsYmFja3M9YXdhaXRpbmdEZXBlbmRlbmNpZXNbcmF3VHlwZV07ZGVsZXRlIGF3YWl0aW5nRGVwZW5kZW5jaWVzW3Jhd1R5cGVdO2NhbGxiYWNrcy5mb3JFYWNoKGZ1bmN0aW9uKGNiKXtjYigpfSl9fWZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX2Jvb2wocmF3VHlwZSxuYW1lLHNpemUsdHJ1ZVZhbHVlLGZhbHNlVmFsdWUpe3ZhciBzaGlmdD1nZXRTaGlmdEZyb21TaXplKHNpemUpO25hbWU9cmVhZExhdGluMVN0cmluZyhuYW1lKTtyZWdpc3RlclR5cGUocmF3VHlwZSx7bmFtZTpuYW1lLCJmcm9tV2lyZVR5cGUiOmZ1bmN0aW9uKHd0KXtyZXR1cm4hIXd0fSwidG9XaXJlVHlwZSI6ZnVuY3Rpb24oZGVzdHJ1Y3RvcnMsbyl7cmV0dXJuIG8/dHJ1ZVZhbHVlOmZhbHNlVmFsdWV9LCJhcmdQYWNrQWR2YW5jZSI6OCwicmVhZFZhbHVlRnJvbVBvaW50ZXIiOmZ1bmN0aW9uKHBvaW50ZXIpe3ZhciBoZWFwO2lmKHNpemU9PT0xKXtoZWFwPUhFQVA4fWVsc2UgaWYoc2l6ZT09PTIpe2hlYXA9SEVBUDE2fWVsc2UgaWYoc2l6ZT09PTQpe2hlYXA9SEVBUDMyfWVsc2V7dGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBib29sZWFuIHR5cGUgc2l6ZTogIituYW1lKX1yZXR1cm4gdGhpc1siZnJvbVdpcmVUeXBlIl0oaGVhcFtwb2ludGVyPj5zaGlmdF0pfSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfWZ1bmN0aW9uIENsYXNzSGFuZGxlX2lzQWxpYXNPZihvdGhlcil7aWYoISh0aGlzIGluc3RhbmNlb2YgQ2xhc3NIYW5kbGUpKXtyZXR1cm4gZmFsc2V9aWYoIShvdGhlciBpbnN0YW5jZW9mIENsYXNzSGFuZGxlKSl7cmV0dXJuIGZhbHNlfXZhciBsZWZ0Q2xhc3M9dGhpcy4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzczt2YXIgbGVmdD10aGlzLiQkLnB0cjt2YXIgcmlnaHRDbGFzcz1vdGhlci4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzczt2YXIgcmlnaHQ9b3RoZXIuJCQucHRyO3doaWxlKGxlZnRDbGFzcy5iYXNlQ2xhc3Mpe2xlZnQ9bGVmdENsYXNzLnVwY2FzdChsZWZ0KTtsZWZ0Q2xhc3M9bGVmdENsYXNzLmJhc2VDbGFzc313aGlsZShyaWdodENsYXNzLmJhc2VDbGFzcyl7cmlnaHQ9cmlnaHRDbGFzcy51cGNhc3QocmlnaHQpO3JpZ2h0Q2xhc3M9cmlnaHRDbGFzcy5iYXNlQ2xhc3N9cmV0dXJuIGxlZnRDbGFzcz09PXJpZ2h0Q2xhc3MmJmxlZnQ9PT1yaWdodH1mdW5jdGlvbiBzaGFsbG93Q29weUludGVybmFsUG9pbnRlcihvKXtyZXR1cm57Y291bnQ6by5jb3VudCxkZWxldGVTY2hlZHVsZWQ6by5kZWxldGVTY2hlZHVsZWQscHJlc2VydmVQb2ludGVyT25EZWxldGU6by5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSxwdHI6by5wdHIscHRyVHlwZTpvLnB0clR5cGUsc21hcnRQdHI6by5zbWFydFB0cixzbWFydFB0clR5cGU6by5zbWFydFB0clR5cGV9fWZ1bmN0aW9uIHRocm93SW5zdGFuY2VBbHJlYWR5RGVsZXRlZChvYmope2Z1bmN0aW9uIGdldEluc3RhbmNlVHlwZU5hbWUoaGFuZGxlKXtyZXR1cm4gaGFuZGxlLiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzLm5hbWV9dGhyb3dCaW5kaW5nRXJyb3IoZ2V0SW5zdGFuY2VUeXBlTmFtZShvYmopKyIgaW5zdGFuY2UgYWxyZWFkeSBkZWxldGVkIil9dmFyIGZpbmFsaXphdGlvbkdyb3VwPWZhbHNlO2Z1bmN0aW9uIGRldGFjaEZpbmFsaXplcihoYW5kbGUpe31mdW5jdGlvbiBydW5EZXN0cnVjdG9yKCQkKXtpZigkJC5zbWFydFB0cil7JCQuc21hcnRQdHJUeXBlLnJhd0Rlc3RydWN0b3IoJCQuc21hcnRQdHIpfWVsc2V7JCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3MucmF3RGVzdHJ1Y3RvcigkJC5wdHIpfX1mdW5jdGlvbiByZWxlYXNlQ2xhc3NIYW5kbGUoJCQpeyQkLmNvdW50LnZhbHVlLT0xO3ZhciB0b0RlbGV0ZT0wPT09JCQuY291bnQudmFsdWU7aWYodG9EZWxldGUpe3J1bkRlc3RydWN0b3IoJCQpfX1mdW5jdGlvbiBhdHRhY2hGaW5hbGl6ZXIoaGFuZGxlKXtpZigidW5kZWZpbmVkIj09PXR5cGVvZiBGaW5hbGl6YXRpb25Hcm91cCl7YXR0YWNoRmluYWxpemVyPWZ1bmN0aW9uKGhhbmRsZSl7cmV0dXJuIGhhbmRsZX07cmV0dXJuIGhhbmRsZX1maW5hbGl6YXRpb25Hcm91cD1uZXcgRmluYWxpemF0aW9uR3JvdXAoZnVuY3Rpb24oaXRlcil7Zm9yKHZhciByZXN1bHQ9aXRlci5uZXh0KCk7IXJlc3VsdC5kb25lO3Jlc3VsdD1pdGVyLm5leHQoKSl7dmFyICQkPXJlc3VsdC52YWx1ZTtpZighJCQucHRyKXtjb25zb2xlLndhcm4oIm9iamVjdCBhbHJlYWR5IGRlbGV0ZWQ6ICIrJCQucHRyKX1lbHNle3JlbGVhc2VDbGFzc0hhbmRsZSgkJCl9fX0pO2F0dGFjaEZpbmFsaXplcj1mdW5jdGlvbihoYW5kbGUpe2ZpbmFsaXphdGlvbkdyb3VwLnJlZ2lzdGVyKGhhbmRsZSxoYW5kbGUuJCQsaGFuZGxlLiQkKTtyZXR1cm4gaGFuZGxlfTtkZXRhY2hGaW5hbGl6ZXI9ZnVuY3Rpb24oaGFuZGxlKXtmaW5hbGl6YXRpb25Hcm91cC51bnJlZ2lzdGVyKGhhbmRsZS4kJCl9O3JldHVybiBhdHRhY2hGaW5hbGl6ZXIoaGFuZGxlKX1mdW5jdGlvbiBDbGFzc0hhbmRsZV9jbG9uZSgpe2lmKCF0aGlzLiQkLnB0cil7dGhyb3dJbnN0YW5jZUFscmVhZHlEZWxldGVkKHRoaXMpfWlmKHRoaXMuJCQucHJlc2VydmVQb2ludGVyT25EZWxldGUpe3RoaXMuJCQuY291bnQudmFsdWUrPTE7cmV0dXJuIHRoaXN9ZWxzZXt2YXIgY2xvbmU9YXR0YWNoRmluYWxpemVyKE9iamVjdC5jcmVhdGUoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpLHskJDp7dmFsdWU6c2hhbGxvd0NvcHlJbnRlcm5hbFBvaW50ZXIodGhpcy4kJCl9fSkpO2Nsb25lLiQkLmNvdW50LnZhbHVlKz0xO2Nsb25lLiQkLmRlbGV0ZVNjaGVkdWxlZD1mYWxzZTtyZXR1cm4gY2xvbmV9fWZ1bmN0aW9uIENsYXNzSGFuZGxlX2RlbGV0ZSgpe2lmKCF0aGlzLiQkLnB0cil7dGhyb3dJbnN0YW5jZUFscmVhZHlEZWxldGVkKHRoaXMpfWlmKHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkJiYhdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSl7dGhyb3dCaW5kaW5nRXJyb3IoIk9iamVjdCBhbHJlYWR5IHNjaGVkdWxlZCBmb3IgZGVsZXRpb24iKX1kZXRhY2hGaW5hbGl6ZXIodGhpcyk7cmVsZWFzZUNsYXNzSGFuZGxlKHRoaXMuJCQpO2lmKCF0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlKXt0aGlzLiQkLnNtYXJ0UHRyPXVuZGVmaW5lZDt0aGlzLiQkLnB0cj11bmRlZmluZWR9fWZ1bmN0aW9uIENsYXNzSGFuZGxlX2lzRGVsZXRlZCgpe3JldHVybiF0aGlzLiQkLnB0cn12YXIgZGVsYXlGdW5jdGlvbj11bmRlZmluZWQ7dmFyIGRlbGV0aW9uUXVldWU9W107ZnVuY3Rpb24gZmx1c2hQZW5kaW5nRGVsZXRlcygpe3doaWxlKGRlbGV0aW9uUXVldWUubGVuZ3RoKXt2YXIgb2JqPWRlbGV0aW9uUXVldWUucG9wKCk7b2JqLiQkLmRlbGV0ZVNjaGVkdWxlZD1mYWxzZTtvYmpbImRlbGV0ZSJdKCl9fWZ1bmN0aW9uIENsYXNzSGFuZGxlX2RlbGV0ZUxhdGVyKCl7aWYoIXRoaXMuJCQucHRyKXt0aHJvd0luc3RhbmNlQWxyZWFkeURlbGV0ZWQodGhpcyl9aWYodGhpcy4kJC5kZWxldGVTY2hlZHVsZWQmJiF0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlKXt0aHJvd0JpbmRpbmdFcnJvcigiT2JqZWN0IGFscmVhZHkgc2NoZWR1bGVkIGZvciBkZWxldGlvbiIpfWRlbGV0aW9uUXVldWUucHVzaCh0aGlzKTtpZihkZWxldGlvblF1ZXVlLmxlbmd0aD09PTEmJmRlbGF5RnVuY3Rpb24pe2RlbGF5RnVuY3Rpb24oZmx1c2hQZW5kaW5nRGVsZXRlcyl9dGhpcy4kJC5kZWxldGVTY2hlZHVsZWQ9dHJ1ZTtyZXR1cm4gdGhpc31mdW5jdGlvbiBpbml0X0NsYXNzSGFuZGxlKCl7Q2xhc3NIYW5kbGUucHJvdG90eXBlWyJpc0FsaWFzT2YiXT1DbGFzc0hhbmRsZV9pc0FsaWFzT2Y7Q2xhc3NIYW5kbGUucHJvdG90eXBlWyJjbG9uZSJdPUNsYXNzSGFuZGxlX2Nsb25lO0NsYXNzSGFuZGxlLnByb3RvdHlwZVsiZGVsZXRlIl09Q2xhc3NIYW5kbGVfZGVsZXRlO0NsYXNzSGFuZGxlLnByb3RvdHlwZVsiaXNEZWxldGVkIl09Q2xhc3NIYW5kbGVfaXNEZWxldGVkO0NsYXNzSGFuZGxlLnByb3RvdHlwZVsiZGVsZXRlTGF0ZXIiXT1DbGFzc0hhbmRsZV9kZWxldGVMYXRlcn1mdW5jdGlvbiBDbGFzc0hhbmRsZSgpe312YXIgcmVnaXN0ZXJlZFBvaW50ZXJzPXt9O2Z1bmN0aW9uIGVuc3VyZU92ZXJsb2FkVGFibGUocHJvdG8sbWV0aG9kTmFtZSxodW1hbk5hbWUpe2lmKHVuZGVmaW5lZD09PXByb3RvW21ldGhvZE5hbWVdLm92ZXJsb2FkVGFibGUpe3ZhciBwcmV2RnVuYz1wcm90b1ttZXRob2ROYW1lXTtwcm90b1ttZXRob2ROYW1lXT1mdW5jdGlvbigpe2lmKCFwcm90b1ttZXRob2ROYW1lXS5vdmVybG9hZFRhYmxlLmhhc093blByb3BlcnR5KGFyZ3VtZW50cy5sZW5ndGgpKXt0aHJvd0JpbmRpbmdFcnJvcigiRnVuY3Rpb24gJyIraHVtYW5OYW1lKyInIGNhbGxlZCB3aXRoIGFuIGludmFsaWQgbnVtYmVyIG9mIGFyZ3VtZW50cyAoIithcmd1bWVudHMubGVuZ3RoKyIpIC0gZXhwZWN0cyBvbmUgb2YgKCIrcHJvdG9bbWV0aG9kTmFtZV0ub3ZlcmxvYWRUYWJsZSsiKSEiKX1yZXR1cm4gcHJvdG9bbWV0aG9kTmFtZV0ub3ZlcmxvYWRUYWJsZVthcmd1bWVudHMubGVuZ3RoXS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9O3Byb3RvW21ldGhvZE5hbWVdLm92ZXJsb2FkVGFibGU9W107cHJvdG9bbWV0aG9kTmFtZV0ub3ZlcmxvYWRUYWJsZVtwcmV2RnVuYy5hcmdDb3VudF09cHJldkZ1bmN9fWZ1bmN0aW9uIGV4cG9zZVB1YmxpY1N5bWJvbChuYW1lLHZhbHVlLG51bUFyZ3VtZW50cyl7aWYoTW9kdWxlLmhhc093blByb3BlcnR5KG5hbWUpKXtpZih1bmRlZmluZWQ9PT1udW1Bcmd1bWVudHN8fHVuZGVmaW5lZCE9PU1vZHVsZVtuYW1lXS5vdmVybG9hZFRhYmxlJiZ1bmRlZmluZWQhPT1Nb2R1bGVbbmFtZV0ub3ZlcmxvYWRUYWJsZVtudW1Bcmd1bWVudHNdKXt0aHJvd0JpbmRpbmdFcnJvcigiQ2Fubm90IHJlZ2lzdGVyIHB1YmxpYyBuYW1lICciK25hbWUrIicgdHdpY2UiKX1lbnN1cmVPdmVybG9hZFRhYmxlKE1vZHVsZSxuYW1lLG5hbWUpO2lmKE1vZHVsZS5oYXNPd25Qcm9wZXJ0eShudW1Bcmd1bWVudHMpKXt0aHJvd0JpbmRpbmdFcnJvcigiQ2Fubm90IHJlZ2lzdGVyIG11bHRpcGxlIG92ZXJsb2FkcyBvZiBhIGZ1bmN0aW9uIHdpdGggdGhlIHNhbWUgbnVtYmVyIG9mIGFyZ3VtZW50cyAoIitudW1Bcmd1bWVudHMrIikhIil9TW9kdWxlW25hbWVdLm92ZXJsb2FkVGFibGVbbnVtQXJndW1lbnRzXT12YWx1ZX1lbHNle01vZHVsZVtuYW1lXT12YWx1ZTtpZih1bmRlZmluZWQhPT1udW1Bcmd1bWVudHMpe01vZHVsZVtuYW1lXS5udW1Bcmd1bWVudHM9bnVtQXJndW1lbnRzfX19ZnVuY3Rpb24gUmVnaXN0ZXJlZENsYXNzKG5hbWUsY29uc3RydWN0b3IsaW5zdGFuY2VQcm90b3R5cGUscmF3RGVzdHJ1Y3RvcixiYXNlQ2xhc3MsZ2V0QWN0dWFsVHlwZSx1cGNhc3QsZG93bmNhc3Qpe3RoaXMubmFtZT1uYW1lO3RoaXMuY29uc3RydWN0b3I9Y29uc3RydWN0b3I7dGhpcy5pbnN0YW5jZVByb3RvdHlwZT1pbnN0YW5jZVByb3RvdHlwZTt0aGlzLnJhd0Rlc3RydWN0b3I9cmF3RGVzdHJ1Y3Rvcjt0aGlzLmJhc2VDbGFzcz1iYXNlQ2xhc3M7dGhpcy5nZXRBY3R1YWxUeXBlPWdldEFjdHVhbFR5cGU7dGhpcy51cGNhc3Q9dXBjYXN0O3RoaXMuZG93bmNhc3Q9ZG93bmNhc3Q7dGhpcy5wdXJlVmlydHVhbEZ1bmN0aW9ucz1bXX1mdW5jdGlvbiB1cGNhc3RQb2ludGVyKHB0cixwdHJDbGFzcyxkZXNpcmVkQ2xhc3Mpe3doaWxlKHB0ckNsYXNzIT09ZGVzaXJlZENsYXNzKXtpZighcHRyQ2xhc3MudXBjYXN0KXt0aHJvd0JpbmRpbmdFcnJvcigiRXhwZWN0ZWQgbnVsbCBvciBpbnN0YW5jZSBvZiAiK2Rlc2lyZWRDbGFzcy5uYW1lKyIsIGdvdCBhbiBpbnN0YW5jZSBvZiAiK3B0ckNsYXNzLm5hbWUpfXB0cj1wdHJDbGFzcy51cGNhc3QocHRyKTtwdHJDbGFzcz1wdHJDbGFzcy5iYXNlQ2xhc3N9cmV0dXJuIHB0cn1mdW5jdGlvbiBjb25zdE5vU21hcnRQdHJSYXdQb2ludGVyVG9XaXJlVHlwZShkZXN0cnVjdG9ycyxoYW5kbGUpe2lmKGhhbmRsZT09PW51bGwpe2lmKHRoaXMuaXNSZWZlcmVuY2Upe3Rocm93QmluZGluZ0Vycm9yKCJudWxsIGlzIG5vdCBhIHZhbGlkICIrdGhpcy5uYW1lKX1yZXR1cm4gMH1pZighaGFuZGxlLiQkKXt0aHJvd0JpbmRpbmdFcnJvcignQ2Fubm90IHBhc3MgIicrX2VtYmluZF9yZXByKGhhbmRsZSkrJyIgYXMgYSAnK3RoaXMubmFtZSl9aWYoIWhhbmRsZS4kJC5wdHIpe3Rocm93QmluZGluZ0Vycm9yKCJDYW5ub3QgcGFzcyBkZWxldGVkIG9iamVjdCBhcyBhIHBvaW50ZXIgb2YgdHlwZSAiK3RoaXMubmFtZSl9dmFyIGhhbmRsZUNsYXNzPWhhbmRsZS4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzczt2YXIgcHRyPXVwY2FzdFBvaW50ZXIoaGFuZGxlLiQkLnB0cixoYW5kbGVDbGFzcyx0aGlzLnJlZ2lzdGVyZWRDbGFzcyk7cmV0dXJuIHB0cn1mdW5jdGlvbiBnZW5lcmljUG9pbnRlclRvV2lyZVR5cGUoZGVzdHJ1Y3RvcnMsaGFuZGxlKXt2YXIgcHRyO2lmKGhhbmRsZT09PW51bGwpe2lmKHRoaXMuaXNSZWZlcmVuY2Upe3Rocm93QmluZGluZ0Vycm9yKCJudWxsIGlzIG5vdCBhIHZhbGlkICIrdGhpcy5uYW1lKX1pZih0aGlzLmlzU21hcnRQb2ludGVyKXtwdHI9dGhpcy5yYXdDb25zdHJ1Y3RvcigpO2lmKGRlc3RydWN0b3JzIT09bnVsbCl7ZGVzdHJ1Y3RvcnMucHVzaCh0aGlzLnJhd0Rlc3RydWN0b3IscHRyKX1yZXR1cm4gcHRyfWVsc2V7cmV0dXJuIDB9fWlmKCFoYW5kbGUuJCQpe3Rocm93QmluZGluZ0Vycm9yKCdDYW5ub3QgcGFzcyAiJytfZW1iaW5kX3JlcHIoaGFuZGxlKSsnIiBhcyBhICcrdGhpcy5uYW1lKX1pZighaGFuZGxlLiQkLnB0cil7dGhyb3dCaW5kaW5nRXJyb3IoIkNhbm5vdCBwYXNzIGRlbGV0ZWQgb2JqZWN0IGFzIGEgcG9pbnRlciBvZiB0eXBlICIrdGhpcy5uYW1lKX1pZighdGhpcy5pc0NvbnN0JiZoYW5kbGUuJCQucHRyVHlwZS5pc0NvbnN0KXt0aHJvd0JpbmRpbmdFcnJvcigiQ2Fubm90IGNvbnZlcnQgYXJndW1lbnQgb2YgdHlwZSAiKyhoYW5kbGUuJCQuc21hcnRQdHJUeXBlP2hhbmRsZS4kJC5zbWFydFB0clR5cGUubmFtZTpoYW5kbGUuJCQucHRyVHlwZS5uYW1lKSsiIHRvIHBhcmFtZXRlciB0eXBlICIrdGhpcy5uYW1lKX12YXIgaGFuZGxlQ2xhc3M9aGFuZGxlLiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzO3B0cj11cGNhc3RQb2ludGVyKGhhbmRsZS4kJC5wdHIsaGFuZGxlQ2xhc3MsdGhpcy5yZWdpc3RlcmVkQ2xhc3MpO2lmKHRoaXMuaXNTbWFydFBvaW50ZXIpe2lmKHVuZGVmaW5lZD09PWhhbmRsZS4kJC5zbWFydFB0cil7dGhyb3dCaW5kaW5nRXJyb3IoIlBhc3NpbmcgcmF3IHBvaW50ZXIgdG8gc21hcnQgcG9pbnRlciBpcyBpbGxlZ2FsIil9c3dpdGNoKHRoaXMuc2hhcmluZ1BvbGljeSl7Y2FzZSAwOmlmKGhhbmRsZS4kJC5zbWFydFB0clR5cGU9PT10aGlzKXtwdHI9aGFuZGxlLiQkLnNtYXJ0UHRyfWVsc2V7dGhyb3dCaW5kaW5nRXJyb3IoIkNhbm5vdCBjb252ZXJ0IGFyZ3VtZW50IG9mIHR5cGUgIisoaGFuZGxlLiQkLnNtYXJ0UHRyVHlwZT9oYW5kbGUuJCQuc21hcnRQdHJUeXBlLm5hbWU6aGFuZGxlLiQkLnB0clR5cGUubmFtZSkrIiB0byBwYXJhbWV0ZXIgdHlwZSAiK3RoaXMubmFtZSl9YnJlYWs7Y2FzZSAxOnB0cj1oYW5kbGUuJCQuc21hcnRQdHI7YnJlYWs7Y2FzZSAyOmlmKGhhbmRsZS4kJC5zbWFydFB0clR5cGU9PT10aGlzKXtwdHI9aGFuZGxlLiQkLnNtYXJ0UHRyfWVsc2V7dmFyIGNsb25lZEhhbmRsZT1oYW5kbGVbImNsb25lIl0oKTtwdHI9dGhpcy5yYXdTaGFyZShwdHIsX19lbXZhbF9yZWdpc3RlcihmdW5jdGlvbigpe2Nsb25lZEhhbmRsZVsiZGVsZXRlIl0oKX0pKTtpZihkZXN0cnVjdG9ycyE9PW51bGwpe2Rlc3RydWN0b3JzLnB1c2godGhpcy5yYXdEZXN0cnVjdG9yLHB0cil9fWJyZWFrO2RlZmF1bHQ6dGhyb3dCaW5kaW5nRXJyb3IoIlVuc3VwcG9ydGluZyBzaGFyaW5nIHBvbGljeSIpfX1yZXR1cm4gcHRyfWZ1bmN0aW9uIG5vbkNvbnN0Tm9TbWFydFB0clJhd1BvaW50ZXJUb1dpcmVUeXBlKGRlc3RydWN0b3JzLGhhbmRsZSl7aWYoaGFuZGxlPT09bnVsbCl7aWYodGhpcy5pc1JlZmVyZW5jZSl7dGhyb3dCaW5kaW5nRXJyb3IoIm51bGwgaXMgbm90IGEgdmFsaWQgIit0aGlzLm5hbWUpfXJldHVybiAwfWlmKCFoYW5kbGUuJCQpe3Rocm93QmluZGluZ0Vycm9yKCdDYW5ub3QgcGFzcyAiJytfZW1iaW5kX3JlcHIoaGFuZGxlKSsnIiBhcyBhICcrdGhpcy5uYW1lKX1pZighaGFuZGxlLiQkLnB0cil7dGhyb3dCaW5kaW5nRXJyb3IoIkNhbm5vdCBwYXNzIGRlbGV0ZWQgb2JqZWN0IGFzIGEgcG9pbnRlciBvZiB0eXBlICIrdGhpcy5uYW1lKX1pZihoYW5kbGUuJCQucHRyVHlwZS5pc0NvbnN0KXt0aHJvd0JpbmRpbmdFcnJvcigiQ2Fubm90IGNvbnZlcnQgYXJndW1lbnQgb2YgdHlwZSAiK2hhbmRsZS4kJC5wdHJUeXBlLm5hbWUrIiB0byBwYXJhbWV0ZXIgdHlwZSAiK3RoaXMubmFtZSl9dmFyIGhhbmRsZUNsYXNzPWhhbmRsZS4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzczt2YXIgcHRyPXVwY2FzdFBvaW50ZXIoaGFuZGxlLiQkLnB0cixoYW5kbGVDbGFzcyx0aGlzLnJlZ2lzdGVyZWRDbGFzcyk7cmV0dXJuIHB0cn1mdW5jdGlvbiBzaW1wbGVSZWFkVmFsdWVGcm9tUG9pbnRlcihwb2ludGVyKXtyZXR1cm4gdGhpc1siZnJvbVdpcmVUeXBlIl0oSEVBUFUzMltwb2ludGVyPj4yXSl9ZnVuY3Rpb24gUmVnaXN0ZXJlZFBvaW50ZXJfZ2V0UG9pbnRlZShwdHIpe2lmKHRoaXMucmF3R2V0UG9pbnRlZSl7cHRyPXRoaXMucmF3R2V0UG9pbnRlZShwdHIpfXJldHVybiBwdHJ9ZnVuY3Rpb24gUmVnaXN0ZXJlZFBvaW50ZXJfZGVzdHJ1Y3RvcihwdHIpe2lmKHRoaXMucmF3RGVzdHJ1Y3Rvcil7dGhpcy5yYXdEZXN0cnVjdG9yKHB0cil9fWZ1bmN0aW9uIFJlZ2lzdGVyZWRQb2ludGVyX2RlbGV0ZU9iamVjdChoYW5kbGUpe2lmKGhhbmRsZSE9PW51bGwpe2hhbmRsZVsiZGVsZXRlIl0oKX19ZnVuY3Rpb24gZG93bmNhc3RQb2ludGVyKHB0cixwdHJDbGFzcyxkZXNpcmVkQ2xhc3Mpe2lmKHB0ckNsYXNzPT09ZGVzaXJlZENsYXNzKXtyZXR1cm4gcHRyfWlmKHVuZGVmaW5lZD09PWRlc2lyZWRDbGFzcy5iYXNlQ2xhc3Mpe3JldHVybiBudWxsfXZhciBydj1kb3duY2FzdFBvaW50ZXIocHRyLHB0ckNsYXNzLGRlc2lyZWRDbGFzcy5iYXNlQ2xhc3MpO2lmKHJ2PT09bnVsbCl7cmV0dXJuIG51bGx9cmV0dXJuIGRlc2lyZWRDbGFzcy5kb3duY2FzdChydil9ZnVuY3Rpb24gZ2V0SW5oZXJpdGVkSW5zdGFuY2VDb3VudCgpe3JldHVybiBPYmplY3Qua2V5cyhyZWdpc3RlcmVkSW5zdGFuY2VzKS5sZW5ndGh9ZnVuY3Rpb24gZ2V0TGl2ZUluaGVyaXRlZEluc3RhbmNlcygpe3ZhciBydj1bXTtmb3IodmFyIGsgaW4gcmVnaXN0ZXJlZEluc3RhbmNlcyl7aWYocmVnaXN0ZXJlZEluc3RhbmNlcy5oYXNPd25Qcm9wZXJ0eShrKSl7cnYucHVzaChyZWdpc3RlcmVkSW5zdGFuY2VzW2tdKX19cmV0dXJuIHJ2fWZ1bmN0aW9uIHNldERlbGF5RnVuY3Rpb24oZm4pe2RlbGF5RnVuY3Rpb249Zm47aWYoZGVsZXRpb25RdWV1ZS5sZW5ndGgmJmRlbGF5RnVuY3Rpb24pe2RlbGF5RnVuY3Rpb24oZmx1c2hQZW5kaW5nRGVsZXRlcyl9fWZ1bmN0aW9uIGluaXRfZW1iaW5kKCl7TW9kdWxlWyJnZXRJbmhlcml0ZWRJbnN0YW5jZUNvdW50Il09Z2V0SW5oZXJpdGVkSW5zdGFuY2VDb3VudDtNb2R1bGVbImdldExpdmVJbmhlcml0ZWRJbnN0YW5jZXMiXT1nZXRMaXZlSW5oZXJpdGVkSW5zdGFuY2VzO01vZHVsZVsiZmx1c2hQZW5kaW5nRGVsZXRlcyJdPWZsdXNoUGVuZGluZ0RlbGV0ZXM7TW9kdWxlWyJzZXREZWxheUZ1bmN0aW9uIl09c2V0RGVsYXlGdW5jdGlvbn12YXIgcmVnaXN0ZXJlZEluc3RhbmNlcz17fTtmdW5jdGlvbiBnZXRCYXNlc3RQb2ludGVyKGNsYXNzXyxwdHIpe2lmKHB0cj09PXVuZGVmaW5lZCl7dGhyb3dCaW5kaW5nRXJyb3IoInB0ciBzaG91bGQgbm90IGJlIHVuZGVmaW5lZCIpfXdoaWxlKGNsYXNzXy5iYXNlQ2xhc3Mpe3B0cj1jbGFzc18udXBjYXN0KHB0cik7Y2xhc3NfPWNsYXNzXy5iYXNlQ2xhc3N9cmV0dXJuIHB0cn1mdW5jdGlvbiBnZXRJbmhlcml0ZWRJbnN0YW5jZShjbGFzc18scHRyKXtwdHI9Z2V0QmFzZXN0UG9pbnRlcihjbGFzc18scHRyKTtyZXR1cm4gcmVnaXN0ZXJlZEluc3RhbmNlc1twdHJdfWZ1bmN0aW9uIG1ha2VDbGFzc0hhbmRsZShwcm90b3R5cGUscmVjb3JkKXtpZighcmVjb3JkLnB0clR5cGV8fCFyZWNvcmQucHRyKXt0aHJvd0ludGVybmFsRXJyb3IoIm1ha2VDbGFzc0hhbmRsZSByZXF1aXJlcyBwdHIgYW5kIHB0clR5cGUiKX12YXIgaGFzU21hcnRQdHJUeXBlPSEhcmVjb3JkLnNtYXJ0UHRyVHlwZTt2YXIgaGFzU21hcnRQdHI9ISFyZWNvcmQuc21hcnRQdHI7aWYoaGFzU21hcnRQdHJUeXBlIT09aGFzU21hcnRQdHIpe3Rocm93SW50ZXJuYWxFcnJvcigiQm90aCBzbWFydFB0clR5cGUgYW5kIHNtYXJ0UHRyIG11c3QgYmUgc3BlY2lmaWVkIil9cmVjb3JkLmNvdW50PXt2YWx1ZToxfTtyZXR1cm4gYXR0YWNoRmluYWxpemVyKE9iamVjdC5jcmVhdGUocHJvdG90eXBlLHskJDp7dmFsdWU6cmVjb3JkfX0pKX1mdW5jdGlvbiBSZWdpc3RlcmVkUG9pbnRlcl9mcm9tV2lyZVR5cGUocHRyKXt2YXIgcmF3UG9pbnRlcj10aGlzLmdldFBvaW50ZWUocHRyKTtpZighcmF3UG9pbnRlcil7dGhpcy5kZXN0cnVjdG9yKHB0cik7cmV0dXJuIG51bGx9dmFyIHJlZ2lzdGVyZWRJbnN0YW5jZT1nZXRJbmhlcml0ZWRJbnN0YW5jZSh0aGlzLnJlZ2lzdGVyZWRDbGFzcyxyYXdQb2ludGVyKTtpZih1bmRlZmluZWQhPT1yZWdpc3RlcmVkSW5zdGFuY2Upe2lmKDA9PT1yZWdpc3RlcmVkSW5zdGFuY2UuJCQuY291bnQudmFsdWUpe3JlZ2lzdGVyZWRJbnN0YW5jZS4kJC5wdHI9cmF3UG9pbnRlcjtyZWdpc3RlcmVkSW5zdGFuY2UuJCQuc21hcnRQdHI9cHRyO3JldHVybiByZWdpc3RlcmVkSW5zdGFuY2VbImNsb25lIl0oKX1lbHNle3ZhciBydj1yZWdpc3RlcmVkSW5zdGFuY2VbImNsb25lIl0oKTt0aGlzLmRlc3RydWN0b3IocHRyKTtyZXR1cm4gcnZ9fWZ1bmN0aW9uIG1ha2VEZWZhdWx0SGFuZGxlKCl7aWYodGhpcy5pc1NtYXJ0UG9pbnRlcil7cmV0dXJuIG1ha2VDbGFzc0hhbmRsZSh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0aGlzLnBvaW50ZWVUeXBlLHB0cjpyYXdQb2ludGVyLHNtYXJ0UHRyVHlwZTp0aGlzLHNtYXJ0UHRyOnB0cn0pfWVsc2V7cmV0dXJuIG1ha2VDbGFzc0hhbmRsZSh0aGlzLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0aGlzLHB0cjpwdHJ9KX19dmFyIGFjdHVhbFR5cGU9dGhpcy5yZWdpc3RlcmVkQ2xhc3MuZ2V0QWN0dWFsVHlwZShyYXdQb2ludGVyKTt2YXIgcmVnaXN0ZXJlZFBvaW50ZXJSZWNvcmQ9cmVnaXN0ZXJlZFBvaW50ZXJzW2FjdHVhbFR5cGVdO2lmKCFyZWdpc3RlcmVkUG9pbnRlclJlY29yZCl7cmV0dXJuIG1ha2VEZWZhdWx0SGFuZGxlLmNhbGwodGhpcyl9dmFyIHRvVHlwZTtpZih0aGlzLmlzQ29uc3Qpe3RvVHlwZT1yZWdpc3RlcmVkUG9pbnRlclJlY29yZC5jb25zdFBvaW50ZXJUeXBlfWVsc2V7dG9UeXBlPXJlZ2lzdGVyZWRQb2ludGVyUmVjb3JkLnBvaW50ZXJUeXBlfXZhciBkcD1kb3duY2FzdFBvaW50ZXIocmF3UG9pbnRlcix0aGlzLnJlZ2lzdGVyZWRDbGFzcyx0b1R5cGUucmVnaXN0ZXJlZENsYXNzKTtpZihkcD09PW51bGwpe3JldHVybiBtYWtlRGVmYXVsdEhhbmRsZS5jYWxsKHRoaXMpfWlmKHRoaXMuaXNTbWFydFBvaW50ZXIpe3JldHVybiBtYWtlQ2xhc3NIYW5kbGUodG9UeXBlLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTp0b1R5cGUscHRyOmRwLHNtYXJ0UHRyVHlwZTp0aGlzLHNtYXJ0UHRyOnB0cn0pfWVsc2V7cmV0dXJuIG1ha2VDbGFzc0hhbmRsZSh0b1R5cGUucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLHtwdHJUeXBlOnRvVHlwZSxwdHI6ZHB9KX19ZnVuY3Rpb24gaW5pdF9SZWdpc3RlcmVkUG9pbnRlcigpe1JlZ2lzdGVyZWRQb2ludGVyLnByb3RvdHlwZS5nZXRQb2ludGVlPVJlZ2lzdGVyZWRQb2ludGVyX2dldFBvaW50ZWU7UmVnaXN0ZXJlZFBvaW50ZXIucHJvdG90eXBlLmRlc3RydWN0b3I9UmVnaXN0ZXJlZFBvaW50ZXJfZGVzdHJ1Y3RvcjtSZWdpc3RlcmVkUG9pbnRlci5wcm90b3R5cGVbImFyZ1BhY2tBZHZhbmNlIl09ODtSZWdpc3RlcmVkUG9pbnRlci5wcm90b3R5cGVbInJlYWRWYWx1ZUZyb21Qb2ludGVyIl09c2ltcGxlUmVhZFZhbHVlRnJvbVBvaW50ZXI7UmVnaXN0ZXJlZFBvaW50ZXIucHJvdG90eXBlWyJkZWxldGVPYmplY3QiXT1SZWdpc3RlcmVkUG9pbnRlcl9kZWxldGVPYmplY3Q7UmVnaXN0ZXJlZFBvaW50ZXIucHJvdG90eXBlWyJmcm9tV2lyZVR5cGUiXT1SZWdpc3RlcmVkUG9pbnRlcl9mcm9tV2lyZVR5cGV9ZnVuY3Rpb24gUmVnaXN0ZXJlZFBvaW50ZXIobmFtZSxyZWdpc3RlcmVkQ2xhc3MsaXNSZWZlcmVuY2UsaXNDb25zdCxpc1NtYXJ0UG9pbnRlcixwb2ludGVlVHlwZSxzaGFyaW5nUG9saWN5LHJhd0dldFBvaW50ZWUscmF3Q29uc3RydWN0b3IscmF3U2hhcmUscmF3RGVzdHJ1Y3Rvcil7dGhpcy5uYW1lPW5hbWU7dGhpcy5yZWdpc3RlcmVkQ2xhc3M9cmVnaXN0ZXJlZENsYXNzO3RoaXMuaXNSZWZlcmVuY2U9aXNSZWZlcmVuY2U7dGhpcy5pc0NvbnN0PWlzQ29uc3Q7dGhpcy5pc1NtYXJ0UG9pbnRlcj1pc1NtYXJ0UG9pbnRlcjt0aGlzLnBvaW50ZWVUeXBlPXBvaW50ZWVUeXBlO3RoaXMuc2hhcmluZ1BvbGljeT1zaGFyaW5nUG9saWN5O3RoaXMucmF3R2V0UG9pbnRlZT1yYXdHZXRQb2ludGVlO3RoaXMucmF3Q29uc3RydWN0b3I9cmF3Q29uc3RydWN0b3I7dGhpcy5yYXdTaGFyZT1yYXdTaGFyZTt0aGlzLnJhd0Rlc3RydWN0b3I9cmF3RGVzdHJ1Y3RvcjtpZighaXNTbWFydFBvaW50ZXImJnJlZ2lzdGVyZWRDbGFzcy5iYXNlQ2xhc3M9PT11bmRlZmluZWQpe2lmKGlzQ29uc3Qpe3RoaXNbInRvV2lyZVR5cGUiXT1jb25zdE5vU21hcnRQdHJSYXdQb2ludGVyVG9XaXJlVHlwZTt0aGlzLmRlc3RydWN0b3JGdW5jdGlvbj1udWxsfWVsc2V7dGhpc1sidG9XaXJlVHlwZSJdPW5vbkNvbnN0Tm9TbWFydFB0clJhd1BvaW50ZXJUb1dpcmVUeXBlO3RoaXMuZGVzdHJ1Y3RvckZ1bmN0aW9uPW51bGx9fWVsc2V7dGhpc1sidG9XaXJlVHlwZSJdPWdlbmVyaWNQb2ludGVyVG9XaXJlVHlwZX19ZnVuY3Rpb24gcmVwbGFjZVB1YmxpY1N5bWJvbChuYW1lLHZhbHVlLG51bUFyZ3VtZW50cyl7aWYoIU1vZHVsZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSl7dGhyb3dJbnRlcm5hbEVycm9yKCJSZXBsYWNpbmcgbm9uZXhpc3RhbnQgcHVibGljIHN5bWJvbCIpfWlmKHVuZGVmaW5lZCE9PU1vZHVsZVtuYW1lXS5vdmVybG9hZFRhYmxlJiZ1bmRlZmluZWQhPT1udW1Bcmd1bWVudHMpe01vZHVsZVtuYW1lXS5vdmVybG9hZFRhYmxlW251bUFyZ3VtZW50c109dmFsdWV9ZWxzZXtNb2R1bGVbbmFtZV09dmFsdWU7TW9kdWxlW25hbWVdLmFyZ0NvdW50PW51bUFyZ3VtZW50c319ZnVuY3Rpb24gZHluQ2FsbExlZ2FjeShzaWcscHRyLGFyZ3Mpe3ZhciBmPU1vZHVsZVsiZHluQ2FsbF8iK3NpZ107cmV0dXJuIGFyZ3MmJmFyZ3MubGVuZ3RoP2YuYXBwbHkobnVsbCxbcHRyXS5jb25jYXQoYXJncykpOmYuY2FsbChudWxsLHB0cil9ZnVuY3Rpb24gZHluQ2FsbChzaWcscHRyLGFyZ3Mpe2lmKHNpZy5pbmRleE9mKCJqIikhPS0xKXtyZXR1cm4gZHluQ2FsbExlZ2FjeShzaWcscHRyLGFyZ3MpfXJldHVybiB3YXNtVGFibGUuZ2V0KHB0cikuYXBwbHkobnVsbCxhcmdzKX1mdW5jdGlvbiBnZXREeW5DYWxsZXIoc2lnLHB0cil7dmFyIGFyZ0NhY2hlPVtdO3JldHVybiBmdW5jdGlvbigpe2FyZ0NhY2hlLmxlbmd0aD1hcmd1bWVudHMubGVuZ3RoO2Zvcih2YXIgaT0wO2k8YXJndW1lbnRzLmxlbmd0aDtpKyspe2FyZ0NhY2hlW2ldPWFyZ3VtZW50c1tpXX1yZXR1cm4gZHluQ2FsbChzaWcscHRyLGFyZ0NhY2hlKX19ZnVuY3Rpb24gZW1iaW5kX19yZXF1aXJlRnVuY3Rpb24oc2lnbmF0dXJlLHJhd0Z1bmN0aW9uKXtzaWduYXR1cmU9cmVhZExhdGluMVN0cmluZyhzaWduYXR1cmUpO2Z1bmN0aW9uIG1ha2VEeW5DYWxsZXIoKXtpZihzaWduYXR1cmUuaW5kZXhPZigiaiIpIT0tMSl7cmV0dXJuIGdldER5bkNhbGxlcihzaWduYXR1cmUscmF3RnVuY3Rpb24pfXJldHVybiB3YXNtVGFibGUuZ2V0KHJhd0Z1bmN0aW9uKX12YXIgZnA9bWFrZUR5bkNhbGxlcigpO2lmKHR5cGVvZiBmcCE9PSJmdW5jdGlvbiIpe3Rocm93QmluZGluZ0Vycm9yKCJ1bmtub3duIGZ1bmN0aW9uIHBvaW50ZXIgd2l0aCBzaWduYXR1cmUgIitzaWduYXR1cmUrIjogIityYXdGdW5jdGlvbil9cmV0dXJuIGZwfXZhciBVbmJvdW5kVHlwZUVycm9yPXVuZGVmaW5lZDtmdW5jdGlvbiBnZXRUeXBlTmFtZSh0eXBlKXt2YXIgcHRyPV9fX2dldFR5cGVOYW1lKHR5cGUpO3ZhciBydj1yZWFkTGF0aW4xU3RyaW5nKHB0cik7X2ZyZWUocHRyKTtyZXR1cm4gcnZ9ZnVuY3Rpb24gdGhyb3dVbmJvdW5kVHlwZUVycm9yKG1lc3NhZ2UsdHlwZXMpe3ZhciB1bmJvdW5kVHlwZXM9W107dmFyIHNlZW49e307ZnVuY3Rpb24gdmlzaXQodHlwZSl7aWYoc2Vlblt0eXBlXSl7cmV0dXJufWlmKHJlZ2lzdGVyZWRUeXBlc1t0eXBlXSl7cmV0dXJufWlmKHR5cGVEZXBlbmRlbmNpZXNbdHlwZV0pe3R5cGVEZXBlbmRlbmNpZXNbdHlwZV0uZm9yRWFjaCh2aXNpdCk7cmV0dXJufXVuYm91bmRUeXBlcy5wdXNoKHR5cGUpO3NlZW5bdHlwZV09dHJ1ZX10eXBlcy5mb3JFYWNoKHZpc2l0KTt0aHJvdyBuZXcgVW5ib3VuZFR5cGVFcnJvcihtZXNzYWdlKyI6ICIrdW5ib3VuZFR5cGVzLm1hcChnZXRUeXBlTmFtZSkuam9pbihbIiwgIl0pKX1mdW5jdGlvbiBfX2VtYmluZF9yZWdpc3Rlcl9jbGFzcyhyYXdUeXBlLHJhd1BvaW50ZXJUeXBlLHJhd0NvbnN0UG9pbnRlclR5cGUsYmFzZUNsYXNzUmF3VHlwZSxnZXRBY3R1YWxUeXBlU2lnbmF0dXJlLGdldEFjdHVhbFR5cGUsdXBjYXN0U2lnbmF0dXJlLHVwY2FzdCxkb3duY2FzdFNpZ25hdHVyZSxkb3duY2FzdCxuYW1lLGRlc3RydWN0b3JTaWduYXR1cmUscmF3RGVzdHJ1Y3Rvcil7bmFtZT1yZWFkTGF0aW4xU3RyaW5nKG5hbWUpO2dldEFjdHVhbFR5cGU9ZW1iaW5kX19yZXF1aXJlRnVuY3Rpb24oZ2V0QWN0dWFsVHlwZVNpZ25hdHVyZSxnZXRBY3R1YWxUeXBlKTtpZih1cGNhc3Qpe3VwY2FzdD1lbWJpbmRfX3JlcXVpcmVGdW5jdGlvbih1cGNhc3RTaWduYXR1cmUsdXBjYXN0KX1pZihkb3duY2FzdCl7ZG93bmNhc3Q9ZW1iaW5kX19yZXF1aXJlRnVuY3Rpb24oZG93bmNhc3RTaWduYXR1cmUsZG93bmNhc3QpfXJhd0Rlc3RydWN0b3I9ZW1iaW5kX19yZXF1aXJlRnVuY3Rpb24oZGVzdHJ1Y3RvclNpZ25hdHVyZSxyYXdEZXN0cnVjdG9yKTt2YXIgbGVnYWxGdW5jdGlvbk5hbWU9bWFrZUxlZ2FsRnVuY3Rpb25OYW1lKG5hbWUpO2V4cG9zZVB1YmxpY1N5bWJvbChsZWdhbEZ1bmN0aW9uTmFtZSxmdW5jdGlvbigpe3Rocm93VW5ib3VuZFR5cGVFcnJvcigiQ2Fubm90IGNvbnN0cnVjdCAiK25hbWUrIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIsW2Jhc2VDbGFzc1Jhd1R5cGVdKX0pO3doZW5EZXBlbmRlbnRUeXBlc0FyZVJlc29sdmVkKFtyYXdUeXBlLHJhd1BvaW50ZXJUeXBlLHJhd0NvbnN0UG9pbnRlclR5cGVdLGJhc2VDbGFzc1Jhd1R5cGU/W2Jhc2VDbGFzc1Jhd1R5cGVdOltdLGZ1bmN0aW9uKGJhc2Upe2Jhc2U9YmFzZVswXTt2YXIgYmFzZUNsYXNzO3ZhciBiYXNlUHJvdG90eXBlO2lmKGJhc2VDbGFzc1Jhd1R5cGUpe2Jhc2VDbGFzcz1iYXNlLnJlZ2lzdGVyZWRDbGFzcztiYXNlUHJvdG90eXBlPWJhc2VDbGFzcy5pbnN0YW5jZVByb3RvdHlwZX1lbHNle2Jhc2VQcm90b3R5cGU9Q2xhc3NIYW5kbGUucHJvdG90eXBlfXZhciBjb25zdHJ1Y3Rvcj1jcmVhdGVOYW1lZEZ1bmN0aW9uKGxlZ2FsRnVuY3Rpb25OYW1lLGZ1bmN0aW9uKCl7aWYoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpIT09aW5zdGFuY2VQcm90b3R5cGUpe3Rocm93IG5ldyBCaW5kaW5nRXJyb3IoIlVzZSAnbmV3JyB0byBjb25zdHJ1Y3QgIituYW1lKX1pZih1bmRlZmluZWQ9PT1yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keSl7dGhyb3cgbmV3IEJpbmRpbmdFcnJvcihuYW1lKyIgaGFzIG5vIGFjY2Vzc2libGUgY29uc3RydWN0b3IiKX12YXIgYm9keT1yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keVthcmd1bWVudHMubGVuZ3RoXTtpZih1bmRlZmluZWQ9PT1ib2R5KXt0aHJvdyBuZXcgQmluZGluZ0Vycm9yKCJUcmllZCB0byBpbnZva2UgY3RvciBvZiAiK25hbWUrIiB3aXRoIGludmFsaWQgbnVtYmVyIG9mIHBhcmFtZXRlcnMgKCIrYXJndW1lbnRzLmxlbmd0aCsiKSAtIGV4cGVjdGVkICgiK09iamVjdC5rZXlzKHJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5KS50b1N0cmluZygpKyIpIHBhcmFtZXRlcnMgaW5zdGVhZCEiKX1yZXR1cm4gYm9keS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KTt2YXIgaW5zdGFuY2VQcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShiYXNlUHJvdG90eXBlLHtjb25zdHJ1Y3Rvcjp7dmFsdWU6Y29uc3RydWN0b3J9fSk7Y29uc3RydWN0b3IucHJvdG90eXBlPWluc3RhbmNlUHJvdG90eXBlO3ZhciByZWdpc3RlcmVkQ2xhc3M9bmV3IFJlZ2lzdGVyZWRDbGFzcyhuYW1lLGNvbnN0cnVjdG9yLGluc3RhbmNlUHJvdG90eXBlLHJhd0Rlc3RydWN0b3IsYmFzZUNsYXNzLGdldEFjdHVhbFR5cGUsdXBjYXN0LGRvd25jYXN0KTt2YXIgcmVmZXJlbmNlQ29udmVydGVyPW5ldyBSZWdpc3RlcmVkUG9pbnRlcihuYW1lLHJlZ2lzdGVyZWRDbGFzcyx0cnVlLGZhbHNlLGZhbHNlKTt2YXIgcG9pbnRlckNvbnZlcnRlcj1uZXcgUmVnaXN0ZXJlZFBvaW50ZXIobmFtZSsiKiIscmVnaXN0ZXJlZENsYXNzLGZhbHNlLGZhbHNlLGZhbHNlKTt2YXIgY29uc3RQb2ludGVyQ29udmVydGVyPW5ldyBSZWdpc3RlcmVkUG9pbnRlcihuYW1lKyIgY29uc3QqIixyZWdpc3RlcmVkQ2xhc3MsZmFsc2UsdHJ1ZSxmYWxzZSk7cmVnaXN0ZXJlZFBvaW50ZXJzW3Jhd1R5cGVdPXtwb2ludGVyVHlwZTpwb2ludGVyQ29udmVydGVyLGNvbnN0UG9pbnRlclR5cGU6Y29uc3RQb2ludGVyQ29udmVydGVyfTtyZXBsYWNlUHVibGljU3ltYm9sKGxlZ2FsRnVuY3Rpb25OYW1lLGNvbnN0cnVjdG9yKTtyZXR1cm5bcmVmZXJlbmNlQ29udmVydGVyLHBvaW50ZXJDb252ZXJ0ZXIsY29uc3RQb2ludGVyQ29udmVydGVyXX0pfWZ1bmN0aW9uIGhlYXAzMlZlY3RvclRvQXJyYXkoY291bnQsZmlyc3RFbGVtZW50KXt2YXIgYXJyYXk9W107Zm9yKHZhciBpPTA7aTxjb3VudDtpKyspe2FycmF5LnB1c2goSEVBUDMyWyhmaXJzdEVsZW1lbnQ+PjIpK2ldKX1yZXR1cm4gYXJyYXl9ZnVuY3Rpb24gcnVuRGVzdHJ1Y3RvcnMoZGVzdHJ1Y3RvcnMpe3doaWxlKGRlc3RydWN0b3JzLmxlbmd0aCl7dmFyIHB0cj1kZXN0cnVjdG9ycy5wb3AoKTt2YXIgZGVsPWRlc3RydWN0b3JzLnBvcCgpO2RlbChwdHIpfX1mdW5jdGlvbiBfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19jb25zdHJ1Y3RvcihyYXdDbGFzc1R5cGUsYXJnQ291bnQscmF3QXJnVHlwZXNBZGRyLGludm9rZXJTaWduYXR1cmUsaW52b2tlcixyYXdDb25zdHJ1Y3Rvcil7YXNzZXJ0KGFyZ0NvdW50PjApO3ZhciByYXdBcmdUeXBlcz1oZWFwMzJWZWN0b3JUb0FycmF5KGFyZ0NvdW50LHJhd0FyZ1R5cGVzQWRkcik7aW52b2tlcj1lbWJpbmRfX3JlcXVpcmVGdW5jdGlvbihpbnZva2VyU2lnbmF0dXJlLGludm9rZXIpO3ZhciBhcmdzPVtyYXdDb25zdHJ1Y3Rvcl07dmFyIGRlc3RydWN0b3JzPVtdO3doZW5EZXBlbmRlbnRUeXBlc0FyZVJlc29sdmVkKFtdLFtyYXdDbGFzc1R5cGVdLGZ1bmN0aW9uKGNsYXNzVHlwZSl7Y2xhc3NUeXBlPWNsYXNzVHlwZVswXTt2YXIgaHVtYW5OYW1lPSJjb25zdHJ1Y3RvciAiK2NsYXNzVHlwZS5uYW1lO2lmKHVuZGVmaW5lZD09PWNsYXNzVHlwZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keSl7Y2xhc3NUeXBlLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5PVtdfWlmKHVuZGVmaW5lZCE9PWNsYXNzVHlwZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keVthcmdDb3VudC0xXSl7dGhyb3cgbmV3IEJpbmRpbmdFcnJvcigiQ2Fubm90IHJlZ2lzdGVyIG11bHRpcGxlIGNvbnN0cnVjdG9ycyB3aXRoIGlkZW50aWNhbCBudW1iZXIgb2YgcGFyYW1ldGVycyAoIisoYXJnQ291bnQtMSkrIikgZm9yIGNsYXNzICciK2NsYXNzVHlwZS5uYW1lKyInISBPdmVybG9hZCByZXNvbHV0aW9uIGlzIGN1cnJlbnRseSBvbmx5IHBlcmZvcm1lZCB1c2luZyB0aGUgcGFyYW1ldGVyIGNvdW50LCBub3QgYWN0dWFsIHR5cGUgaW5mbyEiKX1jbGFzc1R5cGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbYXJnQ291bnQtMV09ZnVuY3Rpb24gdW5ib3VuZFR5cGVIYW5kbGVyKCl7dGhyb3dVbmJvdW5kVHlwZUVycm9yKCJDYW5ub3QgY29uc3RydWN0ICIrY2xhc3NUeXBlLm5hbWUrIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIscmF3QXJnVHlwZXMpfTt3aGVuRGVwZW5kZW50VHlwZXNBcmVSZXNvbHZlZChbXSxyYXdBcmdUeXBlcyxmdW5jdGlvbihhcmdUeXBlcyl7Y2xhc3NUeXBlLnJlZ2lzdGVyZWRDbGFzcy5jb25zdHJ1Y3Rvcl9ib2R5W2FyZ0NvdW50LTFdPWZ1bmN0aW9uIGNvbnN0cnVjdG9yX2JvZHkoKXtpZihhcmd1bWVudHMubGVuZ3RoIT09YXJnQ291bnQtMSl7dGhyb3dCaW5kaW5nRXJyb3IoaHVtYW5OYW1lKyIgY2FsbGVkIHdpdGggIithcmd1bWVudHMubGVuZ3RoKyIgYXJndW1lbnRzLCBleHBlY3RlZCAiKyhhcmdDb3VudC0xKSl9ZGVzdHJ1Y3RvcnMubGVuZ3RoPTA7YXJncy5sZW5ndGg9YXJnQ291bnQ7Zm9yKHZhciBpPTE7aTxhcmdDb3VudDsrK2kpe2FyZ3NbaV09YXJnVHlwZXNbaV1bInRvV2lyZVR5cGUiXShkZXN0cnVjdG9ycyxhcmd1bWVudHNbaS0xXSl9dmFyIHB0cj1pbnZva2VyLmFwcGx5KG51bGwsYXJncyk7cnVuRGVzdHJ1Y3RvcnMoZGVzdHJ1Y3RvcnMpO3JldHVybiBhcmdUeXBlc1swXVsiZnJvbVdpcmVUeXBlIl0ocHRyKX07cmV0dXJuW119KTtyZXR1cm5bXX0pfWZ1bmN0aW9uIG5ld18oY29uc3RydWN0b3IsYXJndW1lbnRMaXN0KXtpZighKGNvbnN0cnVjdG9yIGluc3RhbmNlb2YgRnVuY3Rpb24pKXt0aHJvdyBuZXcgVHlwZUVycm9yKCJuZXdfIGNhbGxlZCB3aXRoIGNvbnN0cnVjdG9yIHR5cGUgIit0eXBlb2YgY29uc3RydWN0b3IrIiB3aGljaCBpcyBub3QgYSBmdW5jdGlvbiIpfXZhciBkdW1teT1jcmVhdGVOYW1lZEZ1bmN0aW9uKGNvbnN0cnVjdG9yLm5hbWV8fCJ1bmtub3duRnVuY3Rpb25OYW1lIixmdW5jdGlvbigpe30pO2R1bW15LnByb3RvdHlwZT1jb25zdHJ1Y3Rvci5wcm90b3R5cGU7dmFyIG9iaj1uZXcgZHVtbXk7dmFyIHI9Y29uc3RydWN0b3IuYXBwbHkob2JqLGFyZ3VtZW50TGlzdCk7cmV0dXJuIHIgaW5zdGFuY2VvZiBPYmplY3Q/cjpvYmp9ZnVuY3Rpb24gY3JhZnRJbnZva2VyRnVuY3Rpb24oaHVtYW5OYW1lLGFyZ1R5cGVzLGNsYXNzVHlwZSxjcHBJbnZva2VyRnVuYyxjcHBUYXJnZXRGdW5jKXt2YXIgYXJnQ291bnQ9YXJnVHlwZXMubGVuZ3RoO2lmKGFyZ0NvdW50PDIpe3Rocm93QmluZGluZ0Vycm9yKCJhcmdUeXBlcyBhcnJheSBzaXplIG1pc21hdGNoISBNdXN0IGF0IGxlYXN0IGdldCByZXR1cm4gdmFsdWUgYW5kICd0aGlzJyB0eXBlcyEiKX12YXIgaXNDbGFzc01ldGhvZEZ1bmM9YXJnVHlwZXNbMV0hPT1udWxsJiZjbGFzc1R5cGUhPT1udWxsO3ZhciBuZWVkc0Rlc3RydWN0b3JTdGFjaz1mYWxzZTtmb3IodmFyIGk9MTtpPGFyZ1R5cGVzLmxlbmd0aDsrK2kpe2lmKGFyZ1R5cGVzW2ldIT09bnVsbCYmYXJnVHlwZXNbaV0uZGVzdHJ1Y3RvckZ1bmN0aW9uPT09dW5kZWZpbmVkKXtuZWVkc0Rlc3RydWN0b3JTdGFjaz10cnVlO2JyZWFrfX12YXIgcmV0dXJucz1hcmdUeXBlc1swXS5uYW1lIT09InZvaWQiO3ZhciBhcmdzTGlzdD0iIjt2YXIgYXJnc0xpc3RXaXJlZD0iIjtmb3IodmFyIGk9MDtpPGFyZ0NvdW50LTI7KytpKXthcmdzTGlzdCs9KGkhPT0wPyIsICI6IiIpKyJhcmciK2k7YXJnc0xpc3RXaXJlZCs9KGkhPT0wPyIsICI6IiIpKyJhcmciK2krIldpcmVkIn12YXIgaW52b2tlckZuQm9keT0icmV0dXJuIGZ1bmN0aW9uICIrbWFrZUxlZ2FsRnVuY3Rpb25OYW1lKGh1bWFuTmFtZSkrIigiK2FyZ3NMaXN0KyIpIHtcbiIrImlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAiKyhhcmdDb3VudC0yKSsiKSB7XG4iKyJ0aHJvd0JpbmRpbmdFcnJvcignZnVuY3Rpb24gIitodW1hbk5hbWUrIiBjYWxsZWQgd2l0aCAnICsgYXJndW1lbnRzLmxlbmd0aCArICcgYXJndW1lbnRzLCBleHBlY3RlZCAiKyhhcmdDb3VudC0yKSsiIGFyZ3MhJyk7XG4iKyJ9XG4iO2lmKG5lZWRzRGVzdHJ1Y3RvclN0YWNrKXtpbnZva2VyRm5Cb2R5Kz0idmFyIGRlc3RydWN0b3JzID0gW107XG4ifXZhciBkdG9yU3RhY2s9bmVlZHNEZXN0cnVjdG9yU3RhY2s/ImRlc3RydWN0b3JzIjoibnVsbCI7dmFyIGFyZ3MxPVsidGhyb3dCaW5kaW5nRXJyb3IiLCJpbnZva2VyIiwiZm4iLCJydW5EZXN0cnVjdG9ycyIsInJldFR5cGUiLCJjbGFzc1BhcmFtIl07dmFyIGFyZ3MyPVt0aHJvd0JpbmRpbmdFcnJvcixjcHBJbnZva2VyRnVuYyxjcHBUYXJnZXRGdW5jLHJ1bkRlc3RydWN0b3JzLGFyZ1R5cGVzWzBdLGFyZ1R5cGVzWzFdXTtpZihpc0NsYXNzTWV0aG9kRnVuYyl7aW52b2tlckZuQm9keSs9InZhciB0aGlzV2lyZWQgPSBjbGFzc1BhcmFtLnRvV2lyZVR5cGUoIitkdG9yU3RhY2srIiwgdGhpcyk7XG4ifWZvcih2YXIgaT0wO2k8YXJnQ291bnQtMjsrK2kpe2ludm9rZXJGbkJvZHkrPSJ2YXIgYXJnIitpKyJXaXJlZCA9IGFyZ1R5cGUiK2krIi50b1dpcmVUeXBlKCIrZHRvclN0YWNrKyIsIGFyZyIraSsiKTsgLy8gIithcmdUeXBlc1tpKzJdLm5hbWUrIlxuIjthcmdzMS5wdXNoKCJhcmdUeXBlIitpKTthcmdzMi5wdXNoKGFyZ1R5cGVzW2krMl0pfWlmKGlzQ2xhc3NNZXRob2RGdW5jKXthcmdzTGlzdFdpcmVkPSJ0aGlzV2lyZWQiKyhhcmdzTGlzdFdpcmVkLmxlbmd0aD4wPyIsICI6IiIpK2FyZ3NMaXN0V2lyZWR9aW52b2tlckZuQm9keSs9KHJldHVybnM/InZhciBydiA9ICI6IiIpKyJpbnZva2VyKGZuIisoYXJnc0xpc3RXaXJlZC5sZW5ndGg+MD8iLCAiOiIiKSthcmdzTGlzdFdpcmVkKyIpO1xuIjtpZihuZWVkc0Rlc3RydWN0b3JTdGFjayl7aW52b2tlckZuQm9keSs9InJ1bkRlc3RydWN0b3JzKGRlc3RydWN0b3JzKTtcbiJ9ZWxzZXtmb3IodmFyIGk9aXNDbGFzc01ldGhvZEZ1bmM/MToyO2k8YXJnVHlwZXMubGVuZ3RoOysraSl7dmFyIHBhcmFtTmFtZT1pPT09MT8idGhpc1dpcmVkIjoiYXJnIisoaS0yKSsiV2lyZWQiO2lmKGFyZ1R5cGVzW2ldLmRlc3RydWN0b3JGdW5jdGlvbiE9PW51bGwpe2ludm9rZXJGbkJvZHkrPXBhcmFtTmFtZSsiX2R0b3IoIitwYXJhbU5hbWUrIik7IC8vICIrYXJnVHlwZXNbaV0ubmFtZSsiXG4iO2FyZ3MxLnB1c2gocGFyYW1OYW1lKyJfZHRvciIpO2FyZ3MyLnB1c2goYXJnVHlwZXNbaV0uZGVzdHJ1Y3RvckZ1bmN0aW9uKX19fWlmKHJldHVybnMpe2ludm9rZXJGbkJvZHkrPSJ2YXIgcmV0ID0gcmV0VHlwZS5mcm9tV2lyZVR5cGUocnYpO1xuIisicmV0dXJuIHJldDtcbiJ9ZWxzZXt9aW52b2tlckZuQm9keSs9In1cbiI7YXJnczEucHVzaChpbnZva2VyRm5Cb2R5KTt2YXIgaW52b2tlckZ1bmN0aW9uPW5ld18oRnVuY3Rpb24sYXJnczEpLmFwcGx5KG51bGwsYXJnczIpO3JldHVybiBpbnZva2VyRnVuY3Rpb259ZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfY2xhc3NfZnVuY3Rpb24ocmF3Q2xhc3NUeXBlLG1ldGhvZE5hbWUsYXJnQ291bnQscmF3QXJnVHlwZXNBZGRyLGludm9rZXJTaWduYXR1cmUscmF3SW52b2tlcixjb250ZXh0LGlzUHVyZVZpcnR1YWwpe3ZhciByYXdBcmdUeXBlcz1oZWFwMzJWZWN0b3JUb0FycmF5KGFyZ0NvdW50LHJhd0FyZ1R5cGVzQWRkcik7bWV0aG9kTmFtZT1yZWFkTGF0aW4xU3RyaW5nKG1ldGhvZE5hbWUpO3Jhd0ludm9rZXI9ZW1iaW5kX19yZXF1aXJlRnVuY3Rpb24oaW52b2tlclNpZ25hdHVyZSxyYXdJbnZva2VyKTt3aGVuRGVwZW5kZW50VHlwZXNBcmVSZXNvbHZlZChbXSxbcmF3Q2xhc3NUeXBlXSxmdW5jdGlvbihjbGFzc1R5cGUpe2NsYXNzVHlwZT1jbGFzc1R5cGVbMF07dmFyIGh1bWFuTmFtZT1jbGFzc1R5cGUubmFtZSsiLiIrbWV0aG9kTmFtZTtpZihpc1B1cmVWaXJ0dWFsKXtjbGFzc1R5cGUucmVnaXN0ZXJlZENsYXNzLnB1cmVWaXJ0dWFsRnVuY3Rpb25zLnB1c2gobWV0aG9kTmFtZSl9ZnVuY3Rpb24gdW5ib3VuZFR5cGVzSGFuZGxlcigpe3Rocm93VW5ib3VuZFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgIitodW1hbk5hbWUrIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIscmF3QXJnVHlwZXMpfXZhciBwcm90bz1jbGFzc1R5cGUucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlO3ZhciBtZXRob2Q9cHJvdG9bbWV0aG9kTmFtZV07aWYodW5kZWZpbmVkPT09bWV0aG9kfHx1bmRlZmluZWQ9PT1tZXRob2Qub3ZlcmxvYWRUYWJsZSYmbWV0aG9kLmNsYXNzTmFtZSE9PWNsYXNzVHlwZS5uYW1lJiZtZXRob2QuYXJnQ291bnQ9PT1hcmdDb3VudC0yKXt1bmJvdW5kVHlwZXNIYW5kbGVyLmFyZ0NvdW50PWFyZ0NvdW50LTI7dW5ib3VuZFR5cGVzSGFuZGxlci5jbGFzc05hbWU9Y2xhc3NUeXBlLm5hbWU7cHJvdG9bbWV0aG9kTmFtZV09dW5ib3VuZFR5cGVzSGFuZGxlcn1lbHNle2Vuc3VyZU92ZXJsb2FkVGFibGUocHJvdG8sbWV0aG9kTmFtZSxodW1hbk5hbWUpO3Byb3RvW21ldGhvZE5hbWVdLm92ZXJsb2FkVGFibGVbYXJnQ291bnQtMl09dW5ib3VuZFR5cGVzSGFuZGxlcn13aGVuRGVwZW5kZW50VHlwZXNBcmVSZXNvbHZlZChbXSxyYXdBcmdUeXBlcyxmdW5jdGlvbihhcmdUeXBlcyl7dmFyIG1lbWJlckZ1bmN0aW9uPWNyYWZ0SW52b2tlckZ1bmN0aW9uKGh1bWFuTmFtZSxhcmdUeXBlcyxjbGFzc1R5cGUscmF3SW52b2tlcixjb250ZXh0KTtpZih1bmRlZmluZWQ9PT1wcm90b1ttZXRob2ROYW1lXS5vdmVybG9hZFRhYmxlKXttZW1iZXJGdW5jdGlvbi5hcmdDb3VudD1hcmdDb3VudC0yO3Byb3RvW21ldGhvZE5hbWVdPW1lbWJlckZ1bmN0aW9ufWVsc2V7cHJvdG9bbWV0aG9kTmFtZV0ub3ZlcmxvYWRUYWJsZVthcmdDb3VudC0yXT1tZW1iZXJGdW5jdGlvbn1yZXR1cm5bXX0pO3JldHVybltdfSl9dmFyIGVtdmFsX2ZyZWVfbGlzdD1bXTt2YXIgZW12YWxfaGFuZGxlX2FycmF5PVt7fSx7dmFsdWU6dW5kZWZpbmVkfSx7dmFsdWU6bnVsbH0se3ZhbHVlOnRydWV9LHt2YWx1ZTpmYWxzZX1dO2Z1bmN0aW9uIF9fZW12YWxfZGVjcmVmKGhhbmRsZSl7aWYoaGFuZGxlPjQmJjA9PT0tLWVtdmFsX2hhbmRsZV9hcnJheVtoYW5kbGVdLnJlZmNvdW50KXtlbXZhbF9oYW5kbGVfYXJyYXlbaGFuZGxlXT11bmRlZmluZWQ7ZW12YWxfZnJlZV9saXN0LnB1c2goaGFuZGxlKX19ZnVuY3Rpb24gY291bnRfZW12YWxfaGFuZGxlcygpe3ZhciBjb3VudD0wO2Zvcih2YXIgaT01O2k8ZW12YWxfaGFuZGxlX2FycmF5Lmxlbmd0aDsrK2kpe2lmKGVtdmFsX2hhbmRsZV9hcnJheVtpXSE9PXVuZGVmaW5lZCl7Kytjb3VudH19cmV0dXJuIGNvdW50fWZ1bmN0aW9uIGdldF9maXJzdF9lbXZhbCgpe2Zvcih2YXIgaT01O2k8ZW12YWxfaGFuZGxlX2FycmF5Lmxlbmd0aDsrK2kpe2lmKGVtdmFsX2hhbmRsZV9hcnJheVtpXSE9PXVuZGVmaW5lZCl7cmV0dXJuIGVtdmFsX2hhbmRsZV9hcnJheVtpXX19cmV0dXJuIG51bGx9ZnVuY3Rpb24gaW5pdF9lbXZhbCgpe01vZHVsZVsiY291bnRfZW12YWxfaGFuZGxlcyJdPWNvdW50X2VtdmFsX2hhbmRsZXM7TW9kdWxlWyJnZXRfZmlyc3RfZW12YWwiXT1nZXRfZmlyc3RfZW12YWx9ZnVuY3Rpb24gX19lbXZhbF9yZWdpc3Rlcih2YWx1ZSl7c3dpdGNoKHZhbHVlKXtjYXNlIHVuZGVmaW5lZDp7cmV0dXJuIDF9Y2FzZSBudWxsOntyZXR1cm4gMn1jYXNlIHRydWU6e3JldHVybiAzfWNhc2UgZmFsc2U6e3JldHVybiA0fWRlZmF1bHQ6e3ZhciBoYW5kbGU9ZW12YWxfZnJlZV9saXN0Lmxlbmd0aD9lbXZhbF9mcmVlX2xpc3QucG9wKCk6ZW12YWxfaGFuZGxlX2FycmF5Lmxlbmd0aDtlbXZhbF9oYW5kbGVfYXJyYXlbaGFuZGxlXT17cmVmY291bnQ6MSx2YWx1ZTp2YWx1ZX07cmV0dXJuIGhhbmRsZX19fWZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX2VtdmFsKHJhd1R5cGUsbmFtZSl7bmFtZT1yZWFkTGF0aW4xU3RyaW5nKG5hbWUpO3JlZ2lzdGVyVHlwZShyYXdUeXBlLHtuYW1lOm5hbWUsImZyb21XaXJlVHlwZSI6ZnVuY3Rpb24oaGFuZGxlKXt2YXIgcnY9ZW12YWxfaGFuZGxlX2FycmF5W2hhbmRsZV0udmFsdWU7X19lbXZhbF9kZWNyZWYoaGFuZGxlKTtyZXR1cm4gcnZ9LCJ0b1dpcmVUeXBlIjpmdW5jdGlvbihkZXN0cnVjdG9ycyx2YWx1ZSl7cmV0dXJuIF9fZW12YWxfcmVnaXN0ZXIodmFsdWUpfSwiYXJnUGFja0FkdmFuY2UiOjgsInJlYWRWYWx1ZUZyb21Qb2ludGVyIjpzaW1wbGVSZWFkVmFsdWVGcm9tUG9pbnRlcixkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfWZ1bmN0aW9uIGVudW1SZWFkVmFsdWVGcm9tUG9pbnRlcihuYW1lLHNoaWZ0LHNpZ25lZCl7c3dpdGNoKHNoaWZ0KXtjYXNlIDA6cmV0dXJuIGZ1bmN0aW9uKHBvaW50ZXIpe3ZhciBoZWFwPXNpZ25lZD9IRUFQODpIRUFQVTg7cmV0dXJuIHRoaXNbImZyb21XaXJlVHlwZSJdKGhlYXBbcG9pbnRlcl0pfTtjYXNlIDE6cmV0dXJuIGZ1bmN0aW9uKHBvaW50ZXIpe3ZhciBoZWFwPXNpZ25lZD9IRUFQMTY6SEVBUFUxNjtyZXR1cm4gdGhpc1siZnJvbVdpcmVUeXBlIl0oaGVhcFtwb2ludGVyPj4xXSl9O2Nhc2UgMjpyZXR1cm4gZnVuY3Rpb24ocG9pbnRlcil7dmFyIGhlYXA9c2lnbmVkP0hFQVAzMjpIRUFQVTMyO3JldHVybiB0aGlzWyJmcm9tV2lyZVR5cGUiXShoZWFwW3BvaW50ZXI+PjJdKX07ZGVmYXVsdDp0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGludGVnZXIgdHlwZTogIituYW1lKX19ZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfZW51bShyYXdUeXBlLG5hbWUsc2l6ZSxpc1NpZ25lZCl7dmFyIHNoaWZ0PWdldFNoaWZ0RnJvbVNpemUoc2l6ZSk7bmFtZT1yZWFkTGF0aW4xU3RyaW5nKG5hbWUpO2Z1bmN0aW9uIGN0b3IoKXt9Y3Rvci52YWx1ZXM9e307cmVnaXN0ZXJUeXBlKHJhd1R5cGUse25hbWU6bmFtZSxjb25zdHJ1Y3RvcjpjdG9yLCJmcm9tV2lyZVR5cGUiOmZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmNvbnN0cnVjdG9yLnZhbHVlc1tjXX0sInRvV2lyZVR5cGUiOmZ1bmN0aW9uKGRlc3RydWN0b3JzLGMpe3JldHVybiBjLnZhbHVlfSwiYXJnUGFja0FkdmFuY2UiOjgsInJlYWRWYWx1ZUZyb21Qb2ludGVyIjplbnVtUmVhZFZhbHVlRnJvbVBvaW50ZXIobmFtZSxzaGlmdCxpc1NpZ25lZCksZGVzdHJ1Y3RvckZ1bmN0aW9uOm51bGx9KTtleHBvc2VQdWJsaWNTeW1ib2wobmFtZSxjdG9yKX1mdW5jdGlvbiByZXF1aXJlUmVnaXN0ZXJlZFR5cGUocmF3VHlwZSxodW1hbk5hbWUpe3ZhciBpbXBsPXJlZ2lzdGVyZWRUeXBlc1tyYXdUeXBlXTtpZih1bmRlZmluZWQ9PT1pbXBsKXt0aHJvd0JpbmRpbmdFcnJvcihodW1hbk5hbWUrIiBoYXMgdW5rbm93biB0eXBlICIrZ2V0VHlwZU5hbWUocmF3VHlwZSkpfXJldHVybiBpbXBsfWZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX2VudW1fdmFsdWUocmF3RW51bVR5cGUsbmFtZSxlbnVtVmFsdWUpe3ZhciBlbnVtVHlwZT1yZXF1aXJlUmVnaXN0ZXJlZFR5cGUocmF3RW51bVR5cGUsImVudW0iKTtuYW1lPXJlYWRMYXRpbjFTdHJpbmcobmFtZSk7dmFyIEVudW09ZW51bVR5cGUuY29uc3RydWN0b3I7dmFyIFZhbHVlPU9iamVjdC5jcmVhdGUoZW51bVR5cGUuY29uc3RydWN0b3IucHJvdG90eXBlLHt2YWx1ZTp7dmFsdWU6ZW51bVZhbHVlfSxjb25zdHJ1Y3Rvcjp7dmFsdWU6Y3JlYXRlTmFtZWRGdW5jdGlvbihlbnVtVHlwZS5uYW1lKyJfIituYW1lLGZ1bmN0aW9uKCl7fSl9fSk7RW51bS52YWx1ZXNbZW51bVZhbHVlXT1WYWx1ZTtFbnVtW25hbWVdPVZhbHVlfWZ1bmN0aW9uIF9lbWJpbmRfcmVwcih2KXtpZih2PT09bnVsbCl7cmV0dXJuIm51bGwifXZhciB0PXR5cGVvZiB2O2lmKHQ9PT0ib2JqZWN0Inx8dD09PSJhcnJheSJ8fHQ9PT0iZnVuY3Rpb24iKXtyZXR1cm4gdi50b1N0cmluZygpfWVsc2V7cmV0dXJuIiIrdn19ZnVuY3Rpb24gZmxvYXRSZWFkVmFsdWVGcm9tUG9pbnRlcihuYW1lLHNoaWZ0KXtzd2l0Y2goc2hpZnQpe2Nhc2UgMjpyZXR1cm4gZnVuY3Rpb24ocG9pbnRlcil7cmV0dXJuIHRoaXNbImZyb21XaXJlVHlwZSJdKEhFQVBGMzJbcG9pbnRlcj4+Ml0pfTtjYXNlIDM6cmV0dXJuIGZ1bmN0aW9uKHBvaW50ZXIpe3JldHVybiB0aGlzWyJmcm9tV2lyZVR5cGUiXShIRUFQRjY0W3BvaW50ZXI+PjNdKX07ZGVmYXVsdDp0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGZsb2F0IHR5cGU6ICIrbmFtZSl9fWZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX2Zsb2F0KHJhd1R5cGUsbmFtZSxzaXplKXt2YXIgc2hpZnQ9Z2V0U2hpZnRGcm9tU2l6ZShzaXplKTtuYW1lPXJlYWRMYXRpbjFTdHJpbmcobmFtZSk7cmVnaXN0ZXJUeXBlKHJhd1R5cGUse25hbWU6bmFtZSwiZnJvbVdpcmVUeXBlIjpmdW5jdGlvbih2YWx1ZSl7cmV0dXJuIHZhbHVlfSwidG9XaXJlVHlwZSI6ZnVuY3Rpb24oZGVzdHJ1Y3RvcnMsdmFsdWUpe2lmKHR5cGVvZiB2YWx1ZSE9PSJudW1iZXIiJiZ0eXBlb2YgdmFsdWUhPT0iYm9vbGVhbiIpe3Rocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjb252ZXJ0ICInK19lbWJpbmRfcmVwcih2YWx1ZSkrJyIgdG8gJyt0aGlzLm5hbWUpfXJldHVybiB2YWx1ZX0sImFyZ1BhY2tBZHZhbmNlIjo4LCJyZWFkVmFsdWVGcm9tUG9pbnRlciI6ZmxvYXRSZWFkVmFsdWVGcm9tUG9pbnRlcihuYW1lLHNoaWZ0KSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfWZ1bmN0aW9uIGludGVnZXJSZWFkVmFsdWVGcm9tUG9pbnRlcihuYW1lLHNoaWZ0LHNpZ25lZCl7c3dpdGNoKHNoaWZ0KXtjYXNlIDA6cmV0dXJuIHNpZ25lZD9mdW5jdGlvbiByZWFkUzhGcm9tUG9pbnRlcihwb2ludGVyKXtyZXR1cm4gSEVBUDhbcG9pbnRlcl19OmZ1bmN0aW9uIHJlYWRVOEZyb21Qb2ludGVyKHBvaW50ZXIpe3JldHVybiBIRUFQVThbcG9pbnRlcl19O2Nhc2UgMTpyZXR1cm4gc2lnbmVkP2Z1bmN0aW9uIHJlYWRTMTZGcm9tUG9pbnRlcihwb2ludGVyKXtyZXR1cm4gSEVBUDE2W3BvaW50ZXI+PjFdfTpmdW5jdGlvbiByZWFkVTE2RnJvbVBvaW50ZXIocG9pbnRlcil7cmV0dXJuIEhFQVBVMTZbcG9pbnRlcj4+MV19O2Nhc2UgMjpyZXR1cm4gc2lnbmVkP2Z1bmN0aW9uIHJlYWRTMzJGcm9tUG9pbnRlcihwb2ludGVyKXtyZXR1cm4gSEVBUDMyW3BvaW50ZXI+PjJdfTpmdW5jdGlvbiByZWFkVTMyRnJvbVBvaW50ZXIocG9pbnRlcil7cmV0dXJuIEhFQVBVMzJbcG9pbnRlcj4+Ml19O2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBpbnRlZ2VyIHR5cGU6ICIrbmFtZSl9fWZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX2ludGVnZXIocHJpbWl0aXZlVHlwZSxuYW1lLHNpemUsbWluUmFuZ2UsbWF4UmFuZ2Upe25hbWU9cmVhZExhdGluMVN0cmluZyhuYW1lKTtpZihtYXhSYW5nZT09PS0xKXttYXhSYW5nZT00Mjk0OTY3Mjk1fXZhciBzaGlmdD1nZXRTaGlmdEZyb21TaXplKHNpemUpO3ZhciBmcm9tV2lyZVR5cGU9ZnVuY3Rpb24odmFsdWUpe3JldHVybiB2YWx1ZX07aWYobWluUmFuZ2U9PT0wKXt2YXIgYml0c2hpZnQ9MzItOCpzaXplO2Zyb21XaXJlVHlwZT1mdW5jdGlvbih2YWx1ZSl7cmV0dXJuIHZhbHVlPDxiaXRzaGlmdD4+PmJpdHNoaWZ0fX12YXIgaXNVbnNpZ25lZFR5cGU9bmFtZS5pbmRleE9mKCJ1bnNpZ25lZCIpIT0tMTtyZWdpc3RlclR5cGUocHJpbWl0aXZlVHlwZSx7bmFtZTpuYW1lLCJmcm9tV2lyZVR5cGUiOmZyb21XaXJlVHlwZSwidG9XaXJlVHlwZSI6ZnVuY3Rpb24oZGVzdHJ1Y3RvcnMsdmFsdWUpe2lmKHR5cGVvZiB2YWx1ZSE9PSJudW1iZXIiJiZ0eXBlb2YgdmFsdWUhPT0iYm9vbGVhbiIpe3Rocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjb252ZXJ0ICInK19lbWJpbmRfcmVwcih2YWx1ZSkrJyIgdG8gJyt0aGlzLm5hbWUpfWlmKHZhbHVlPG1pblJhbmdlfHx2YWx1ZT5tYXhSYW5nZSl7dGhyb3cgbmV3IFR5cGVFcnJvcignUGFzc2luZyBhIG51bWJlciAiJytfZW1iaW5kX3JlcHIodmFsdWUpKyciIGZyb20gSlMgc2lkZSB0byBDL0MrKyBzaWRlIHRvIGFuIGFyZ3VtZW50IG9mIHR5cGUgIicrbmFtZSsnIiwgd2hpY2ggaXMgb3V0c2lkZSB0aGUgdmFsaWQgcmFuZ2UgWycrbWluUmFuZ2UrIiwgIittYXhSYW5nZSsiXSEiKX1yZXR1cm4gaXNVbnNpZ25lZFR5cGU/dmFsdWU+Pj4wOnZhbHVlfDB9LCJhcmdQYWNrQWR2YW5jZSI6OCwicmVhZFZhbHVlRnJvbVBvaW50ZXIiOmludGVnZXJSZWFkVmFsdWVGcm9tUG9pbnRlcihuYW1lLHNoaWZ0LG1pblJhbmdlIT09MCksZGVzdHJ1Y3RvckZ1bmN0aW9uOm51bGx9KX1mdW5jdGlvbiBfX2VtYmluZF9yZWdpc3Rlcl9tZW1vcnlfdmlldyhyYXdUeXBlLGRhdGFUeXBlSW5kZXgsbmFtZSl7dmFyIHR5cGVNYXBwaW5nPVtJbnQ4QXJyYXksVWludDhBcnJheSxJbnQxNkFycmF5LFVpbnQxNkFycmF5LEludDMyQXJyYXksVWludDMyQXJyYXksRmxvYXQzMkFycmF5LEZsb2F0NjRBcnJheV07dmFyIFRBPXR5cGVNYXBwaW5nW2RhdGFUeXBlSW5kZXhdO2Z1bmN0aW9uIGRlY29kZU1lbW9yeVZpZXcoaGFuZGxlKXtoYW5kbGU9aGFuZGxlPj4yO3ZhciBoZWFwPUhFQVBVMzI7dmFyIHNpemU9aGVhcFtoYW5kbGVdO3ZhciBkYXRhPWhlYXBbaGFuZGxlKzFdO3JldHVybiBuZXcgVEEoYnVmZmVyLGRhdGEsc2l6ZSl9bmFtZT1yZWFkTGF0aW4xU3RyaW5nKG5hbWUpO3JlZ2lzdGVyVHlwZShyYXdUeXBlLHtuYW1lOm5hbWUsImZyb21XaXJlVHlwZSI6ZGVjb2RlTWVtb3J5VmlldywiYXJnUGFja0FkdmFuY2UiOjgsInJlYWRWYWx1ZUZyb21Qb2ludGVyIjpkZWNvZGVNZW1vcnlWaWV3fSx7aWdub3JlRHVwbGljYXRlUmVnaXN0cmF0aW9uczp0cnVlfSl9ZnVuY3Rpb24gX19lbWJpbmRfcmVnaXN0ZXJfc3RkX3N0cmluZyhyYXdUeXBlLG5hbWUpe25hbWU9cmVhZExhdGluMVN0cmluZyhuYW1lKTt2YXIgc3RkU3RyaW5nSXNVVEY4PW5hbWU9PT0ic3RkOjpzdHJpbmciO3JlZ2lzdGVyVHlwZShyYXdUeXBlLHtuYW1lOm5hbWUsImZyb21XaXJlVHlwZSI6ZnVuY3Rpb24odmFsdWUpe3ZhciBsZW5ndGg9SEVBUFUzMlt2YWx1ZT4+Ml07dmFyIHN0cjtpZihzdGRTdHJpbmdJc1VURjgpe3ZhciBkZWNvZGVTdGFydFB0cj12YWx1ZSs0O2Zvcih2YXIgaT0wO2k8PWxlbmd0aDsrK2kpe3ZhciBjdXJyZW50Qnl0ZVB0cj12YWx1ZSs0K2k7aWYoaT09bGVuZ3RofHxIRUFQVThbY3VycmVudEJ5dGVQdHJdPT0wKXt2YXIgbWF4UmVhZD1jdXJyZW50Qnl0ZVB0ci1kZWNvZGVTdGFydFB0cjt2YXIgc3RyaW5nU2VnbWVudD1VVEY4VG9TdHJpbmcoZGVjb2RlU3RhcnRQdHIsbWF4UmVhZCk7aWYoc3RyPT09dW5kZWZpbmVkKXtzdHI9c3RyaW5nU2VnbWVudH1lbHNle3N0cis9U3RyaW5nLmZyb21DaGFyQ29kZSgwKTtzdHIrPXN0cmluZ1NlZ21lbnR9ZGVjb2RlU3RhcnRQdHI9Y3VycmVudEJ5dGVQdHIrMX19fWVsc2V7dmFyIGE9bmV3IEFycmF5KGxlbmd0aCk7Zm9yKHZhciBpPTA7aTxsZW5ndGg7KytpKXthW2ldPVN0cmluZy5mcm9tQ2hhckNvZGUoSEVBUFU4W3ZhbHVlKzQraV0pfXN0cj1hLmpvaW4oIiIpfV9mcmVlKHZhbHVlKTtyZXR1cm4gc3RyfSwidG9XaXJlVHlwZSI6ZnVuY3Rpb24oZGVzdHJ1Y3RvcnMsdmFsdWUpe2lmKHZhbHVlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpe3ZhbHVlPW5ldyBVaW50OEFycmF5KHZhbHVlKX12YXIgZ2V0TGVuZ3RoO3ZhciB2YWx1ZUlzT2ZUeXBlU3RyaW5nPXR5cGVvZiB2YWx1ZT09PSJzdHJpbmciO2lmKCEodmFsdWVJc09mVHlwZVN0cmluZ3x8dmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5fHx2YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5fHx2YWx1ZSBpbnN0YW5jZW9mIEludDhBcnJheSkpe3Rocm93QmluZGluZ0Vycm9yKCJDYW5ub3QgcGFzcyBub24tc3RyaW5nIHRvIHN0ZDo6c3RyaW5nIil9aWYoc3RkU3RyaW5nSXNVVEY4JiZ2YWx1ZUlzT2ZUeXBlU3RyaW5nKXtnZXRMZW5ndGg9ZnVuY3Rpb24oKXtyZXR1cm4gbGVuZ3RoQnl0ZXNVVEY4KHZhbHVlKX19ZWxzZXtnZXRMZW5ndGg9ZnVuY3Rpb24oKXtyZXR1cm4gdmFsdWUubGVuZ3RofX12YXIgbGVuZ3RoPWdldExlbmd0aCgpO3ZhciBwdHI9X21hbGxvYyg0K2xlbmd0aCsxKTtIRUFQVTMyW3B0cj4+Ml09bGVuZ3RoO2lmKHN0ZFN0cmluZ0lzVVRGOCYmdmFsdWVJc09mVHlwZVN0cmluZyl7c3RyaW5nVG9VVEY4KHZhbHVlLHB0cis0LGxlbmd0aCsxKX1lbHNle2lmKHZhbHVlSXNPZlR5cGVTdHJpbmcpe2Zvcih2YXIgaT0wO2k8bGVuZ3RoOysraSl7dmFyIGNoYXJDb2RlPXZhbHVlLmNoYXJDb2RlQXQoaSk7aWYoY2hhckNvZGU+MjU1KXtfZnJlZShwdHIpO3Rocm93QmluZGluZ0Vycm9yKCJTdHJpbmcgaGFzIFVURi0xNiBjb2RlIHVuaXRzIHRoYXQgZG8gbm90IGZpdCBpbiA4IGJpdHMiKX1IRUFQVThbcHRyKzQraV09Y2hhckNvZGV9fWVsc2V7Zm9yKHZhciBpPTA7aTxsZW5ndGg7KytpKXtIRUFQVThbcHRyKzQraV09dmFsdWVbaV19fX1pZihkZXN0cnVjdG9ycyE9PW51bGwpe2Rlc3RydWN0b3JzLnB1c2goX2ZyZWUscHRyKX1yZXR1cm4gcHRyfSwiYXJnUGFja0FkdmFuY2UiOjgsInJlYWRWYWx1ZUZyb21Qb2ludGVyIjpzaW1wbGVSZWFkVmFsdWVGcm9tUG9pbnRlcixkZXN0cnVjdG9yRnVuY3Rpb246ZnVuY3Rpb24ocHRyKXtfZnJlZShwdHIpfX0pfWZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX3N0ZF93c3RyaW5nKHJhd1R5cGUsY2hhclNpemUsbmFtZSl7bmFtZT1yZWFkTGF0aW4xU3RyaW5nKG5hbWUpO3ZhciBkZWNvZGVTdHJpbmcsZW5jb2RlU3RyaW5nLGdldEhlYXAsbGVuZ3RoQnl0ZXNVVEYsc2hpZnQ7aWYoY2hhclNpemU9PT0yKXtkZWNvZGVTdHJpbmc9VVRGMTZUb1N0cmluZztlbmNvZGVTdHJpbmc9c3RyaW5nVG9VVEYxNjtsZW5ndGhCeXRlc1VURj1sZW5ndGhCeXRlc1VURjE2O2dldEhlYXA9ZnVuY3Rpb24oKXtyZXR1cm4gSEVBUFUxNn07c2hpZnQ9MX1lbHNlIGlmKGNoYXJTaXplPT09NCl7ZGVjb2RlU3RyaW5nPVVURjMyVG9TdHJpbmc7ZW5jb2RlU3RyaW5nPXN0cmluZ1RvVVRGMzI7bGVuZ3RoQnl0ZXNVVEY9bGVuZ3RoQnl0ZXNVVEYzMjtnZXRIZWFwPWZ1bmN0aW9uKCl7cmV0dXJuIEhFQVBVMzJ9O3NoaWZ0PTJ9cmVnaXN0ZXJUeXBlKHJhd1R5cGUse25hbWU6bmFtZSwiZnJvbVdpcmVUeXBlIjpmdW5jdGlvbih2YWx1ZSl7dmFyIGxlbmd0aD1IRUFQVTMyW3ZhbHVlPj4yXTt2YXIgSEVBUD1nZXRIZWFwKCk7dmFyIHN0cjt2YXIgZGVjb2RlU3RhcnRQdHI9dmFsdWUrNDtmb3IodmFyIGk9MDtpPD1sZW5ndGg7KytpKXt2YXIgY3VycmVudEJ5dGVQdHI9dmFsdWUrNCtpKmNoYXJTaXplO2lmKGk9PWxlbmd0aHx8SEVBUFtjdXJyZW50Qnl0ZVB0cj4+c2hpZnRdPT0wKXt2YXIgbWF4UmVhZEJ5dGVzPWN1cnJlbnRCeXRlUHRyLWRlY29kZVN0YXJ0UHRyO3ZhciBzdHJpbmdTZWdtZW50PWRlY29kZVN0cmluZyhkZWNvZGVTdGFydFB0cixtYXhSZWFkQnl0ZXMpO2lmKHN0cj09PXVuZGVmaW5lZCl7c3RyPXN0cmluZ1NlZ21lbnR9ZWxzZXtzdHIrPVN0cmluZy5mcm9tQ2hhckNvZGUoMCk7c3RyKz1zdHJpbmdTZWdtZW50fWRlY29kZVN0YXJ0UHRyPWN1cnJlbnRCeXRlUHRyK2NoYXJTaXplfX1fZnJlZSh2YWx1ZSk7cmV0dXJuIHN0cn0sInRvV2lyZVR5cGUiOmZ1bmN0aW9uKGRlc3RydWN0b3JzLHZhbHVlKXtpZighKHR5cGVvZiB2YWx1ZT09PSJzdHJpbmciKSl7dGhyb3dCaW5kaW5nRXJyb3IoIkNhbm5vdCBwYXNzIG5vbi1zdHJpbmcgdG8gQysrIHN0cmluZyB0eXBlICIrbmFtZSl9dmFyIGxlbmd0aD1sZW5ndGhCeXRlc1VURih2YWx1ZSk7dmFyIHB0cj1fbWFsbG9jKDQrbGVuZ3RoK2NoYXJTaXplKTtIRUFQVTMyW3B0cj4+Ml09bGVuZ3RoPj5zaGlmdDtlbmNvZGVTdHJpbmcodmFsdWUscHRyKzQsbGVuZ3RoK2NoYXJTaXplKTtpZihkZXN0cnVjdG9ycyE9PW51bGwpe2Rlc3RydWN0b3JzLnB1c2goX2ZyZWUscHRyKX1yZXR1cm4gcHRyfSwiYXJnUGFja0FkdmFuY2UiOjgsInJlYWRWYWx1ZUZyb21Qb2ludGVyIjpzaW1wbGVSZWFkVmFsdWVGcm9tUG9pbnRlcixkZXN0cnVjdG9yRnVuY3Rpb246ZnVuY3Rpb24ocHRyKXtfZnJlZShwdHIpfX0pfWZ1bmN0aW9uIF9fZW1iaW5kX3JlZ2lzdGVyX3ZvaWQocmF3VHlwZSxuYW1lKXtuYW1lPXJlYWRMYXRpbjFTdHJpbmcobmFtZSk7cmVnaXN0ZXJUeXBlKHJhd1R5cGUse2lzVm9pZDp0cnVlLG5hbWU6bmFtZSwiYXJnUGFja0FkdmFuY2UiOjAsImZyb21XaXJlVHlwZSI6ZnVuY3Rpb24oKXtyZXR1cm4gdW5kZWZpbmVkfSwidG9XaXJlVHlwZSI6ZnVuY3Rpb24oZGVzdHJ1Y3RvcnMsbyl7cmV0dXJuIHVuZGVmaW5lZH19KX1mdW5jdGlvbiBfX2VtdmFsX2luY3JlZihoYW5kbGUpe2lmKGhhbmRsZT40KXtlbXZhbF9oYW5kbGVfYXJyYXlbaGFuZGxlXS5yZWZjb3VudCs9MX19ZnVuY3Rpb24gX19lbXZhbF90YWtlX3ZhbHVlKHR5cGUsYXJndil7dHlwZT1yZXF1aXJlUmVnaXN0ZXJlZFR5cGUodHlwZSwiX2VtdmFsX3Rha2VfdmFsdWUiKTt2YXIgdj10eXBlWyJyZWFkVmFsdWVGcm9tUG9pbnRlciJdKGFyZ3YpO3JldHVybiBfX2VtdmFsX3JlZ2lzdGVyKHYpfWZ1bmN0aW9uIF9hYm9ydCgpe2Fib3J0KCl9dmFyIF9lbXNjcmlwdGVuX2dldF9ub3c7X2Vtc2NyaXB0ZW5fZ2V0X25vdz1mdW5jdGlvbigpe3JldHVybiBwZXJmb3JtYW5jZS5ub3coKX07dmFyIF9lbXNjcmlwdGVuX2dldF9ub3dfaXNfbW9ub3RvbmljPXRydWU7ZnVuY3Rpb24gc2V0RXJyTm8odmFsdWUpe0hFQVAzMltfX19lcnJub19sb2NhdGlvbigpPj4yXT12YWx1ZTtyZXR1cm4gdmFsdWV9ZnVuY3Rpb24gX2Nsb2NrX2dldHRpbWUoY2xrX2lkLHRwKXt2YXIgbm93O2lmKGNsa19pZD09PTApe25vdz1EYXRlLm5vdygpfWVsc2UgaWYoKGNsa19pZD09PTF8fGNsa19pZD09PTQpJiZfZW1zY3JpcHRlbl9nZXRfbm93X2lzX21vbm90b25pYyl7bm93PV9lbXNjcmlwdGVuX2dldF9ub3coKX1lbHNle3NldEVyck5vKDI4KTtyZXR1cm4tMX1IRUFQMzJbdHA+PjJdPW5vdy8xZTN8MDtIRUFQMzJbdHArND4+Ml09bm93JTFlMyoxZTMqMWUzfDA7cmV0dXJuIDB9ZnVuY3Rpb24gX2Vtc2NyaXB0ZW5fbWVtY3B5X2JpZyhkZXN0LHNyYyxudW0pe0hFQVBVOC5jb3B5V2l0aGluKGRlc3Qsc3JjLHNyYytudW0pfWZ1bmN0aW9uIGFib3J0T25DYW5ub3RHcm93TWVtb3J5KHJlcXVlc3RlZFNpemUpe2Fib3J0KCJPT00iKX1mdW5jdGlvbiBfZW1zY3JpcHRlbl9yZXNpemVfaGVhcChyZXF1ZXN0ZWRTaXplKXthYm9ydE9uQ2Fubm90R3Jvd01lbW9yeShyZXF1ZXN0ZWRTaXplKX12YXIgU1lTQ0FMTFM9e21hcHBpbmdzOnt9LGJ1ZmZlcnM6W251bGwsW10sW11dLHByaW50Q2hhcjpmdW5jdGlvbihzdHJlYW0sY3Vycil7dmFyIGJ1ZmZlcj1TWVNDQUxMUy5idWZmZXJzW3N0cmVhbV07aWYoY3Vycj09PTB8fGN1cnI9PT0xMCl7KHN0cmVhbT09PTE/b3V0OmVycikoVVRGOEFycmF5VG9TdHJpbmcoYnVmZmVyLDApKTtidWZmZXIubGVuZ3RoPTB9ZWxzZXtidWZmZXIucHVzaChjdXJyKX19LHZhcmFyZ3M6dW5kZWZpbmVkLGdldDpmdW5jdGlvbigpe1NZU0NBTExTLnZhcmFyZ3MrPTQ7dmFyIHJldD1IRUFQMzJbU1lTQ0FMTFMudmFyYXJncy00Pj4yXTtyZXR1cm4gcmV0fSxnZXRTdHI6ZnVuY3Rpb24ocHRyKXt2YXIgcmV0PVVURjhUb1N0cmluZyhwdHIpO3JldHVybiByZXR9LGdldDY0OmZ1bmN0aW9uKGxvdyxoaWdoKXtyZXR1cm4gbG93fX07ZnVuY3Rpb24gX2ZkX2Nsb3NlKGZkKXtyZXR1cm4gMH1mdW5jdGlvbiBfZmRfc2VlayhmZCxvZmZzZXRfbG93LG9mZnNldF9oaWdoLHdoZW5jZSxuZXdPZmZzZXQpe31mdW5jdGlvbiBfZmRfd3JpdGUoZmQsaW92LGlvdmNudCxwbnVtKXt2YXIgbnVtPTA7Zm9yKHZhciBpPTA7aTxpb3ZjbnQ7aSsrKXt2YXIgcHRyPUhFQVAzMltpb3YraSo4Pj4yXTt2YXIgbGVuPUhFQVAzMltpb3YrKGkqOCs0KT4+Ml07Zm9yKHZhciBqPTA7ajxsZW47aisrKXtTWVNDQUxMUy5wcmludENoYXIoZmQsSEVBUFU4W3B0citqXSl9bnVtKz1sZW59SEVBUDMyW3BudW0+PjJdPW51bTtyZXR1cm4gMH1mdW5jdGlvbiBfc2V0VGVtcFJldDAoJGkpe3NldFRlbXBSZXQwKCRpfDApfWZ1bmN0aW9uIF90aW1lKHB0cil7dmFyIHJldD1EYXRlLm5vdygpLzFlM3wwO2lmKHB0cil7SEVBUDMyW3B0cj4+Ml09cmV0fXJldHVybiByZXR9ZW1iaW5kX2luaXRfY2hhckNvZGVzKCk7QmluZGluZ0Vycm9yPU1vZHVsZVsiQmluZGluZ0Vycm9yIl09ZXh0ZW5kRXJyb3IoRXJyb3IsIkJpbmRpbmdFcnJvciIpO0ludGVybmFsRXJyb3I9TW9kdWxlWyJJbnRlcm5hbEVycm9yIl09ZXh0ZW5kRXJyb3IoRXJyb3IsIkludGVybmFsRXJyb3IiKTtpbml0X0NsYXNzSGFuZGxlKCk7aW5pdF9SZWdpc3RlcmVkUG9pbnRlcigpO2luaXRfZW1iaW5kKCk7VW5ib3VuZFR5cGVFcnJvcj1Nb2R1bGVbIlVuYm91bmRUeXBlRXJyb3IiXT1leHRlbmRFcnJvcihFcnJvciwiVW5ib3VuZFR5cGVFcnJvciIpO2luaXRfZW12YWwoKTt2YXIgYXNtTGlicmFyeUFyZz17ImMiOl9fX2N4YV9hbGxvY2F0ZV9leGNlcHRpb24sImIiOl9fX2N4YV90aHJvdywieSI6X19lbWJpbmRfcmVnaXN0ZXJfYm9vbCwiZyI6X19lbWJpbmRfcmVnaXN0ZXJfY2xhc3MsImYiOl9fZW1iaW5kX3JlZ2lzdGVyX2NsYXNzX2NvbnN0cnVjdG9yLCJhIjpfX2VtYmluZF9yZWdpc3Rlcl9jbGFzc19mdW5jdGlvbiwieCI6X19lbWJpbmRfcmVnaXN0ZXJfZW12YWwsIkEiOl9fZW1iaW5kX3JlZ2lzdGVyX2VudW0sImsiOl9fZW1iaW5kX3JlZ2lzdGVyX2VudW1fdmFsdWUsIm8iOl9fZW1iaW5kX3JlZ2lzdGVyX2Zsb2F0LCJlIjpfX2VtYmluZF9yZWdpc3Rlcl9pbnRlZ2VyLCJkIjpfX2VtYmluZF9yZWdpc3Rlcl9tZW1vcnlfdmlldywicCI6X19lbWJpbmRfcmVnaXN0ZXJfc3RkX3N0cmluZywiaiI6X19lbWJpbmRfcmVnaXN0ZXJfc3RkX3dzdHJpbmcsInoiOl9fZW1iaW5kX3JlZ2lzdGVyX3ZvaWQsImwiOl9fZW12YWxfZGVjcmVmLCJtIjpfX2VtdmFsX2luY3JlZiwiaCI6X19lbXZhbF90YWtlX3ZhbHVlLCJpIjpfYWJvcnQsInYiOl9jbG9ja19nZXR0aW1lLCJ0IjpfZW1zY3JpcHRlbl9tZW1jcHlfYmlnLCJ1IjpfZW1zY3JpcHRlbl9yZXNpemVfaGVhcCwidyI6X2ZkX2Nsb3NlLCJyIjpfZmRfc2VlaywibiI6X2ZkX3dyaXRlLCJzIjpfc2V0VGVtcFJldDAsInEiOl90aW1lfTt2YXIgYXNtPWNyZWF0ZVdhc20oKTt2YXIgX19fd2FzbV9jYWxsX2N0b3JzPU1vZHVsZVsiX19fd2FzbV9jYWxsX2N0b3JzIl09YXNtWyJDIl07dmFyIF9tYWxsb2M9TW9kdWxlWyJfbWFsbG9jIl09YXNtWyJEIl07dmFyIF9fX2dldFR5cGVOYW1lPU1vZHVsZVsiX19fZ2V0VHlwZU5hbWUiXT1hc21bIkYiXTt2YXIgX19fZW1iaW5kX3JlZ2lzdGVyX25hdGl2ZV9hbmRfYnVpbHRpbl90eXBlcz1Nb2R1bGVbIl9fX2VtYmluZF9yZWdpc3Rlcl9uYXRpdmVfYW5kX2J1aWx0aW5fdHlwZXMiXT1hc21bIkciXTt2YXIgX19fZXJybm9fbG9jYXRpb249TW9kdWxlWyJfX19lcnJub19sb2NhdGlvbiJdPWFzbVsiSCJdO3ZhciBfZnJlZT1Nb2R1bGVbIl9mcmVlIl09YXNtWyJJIl07dmFyIGR5bkNhbGxfamlqaT1Nb2R1bGVbImR5bkNhbGxfamlqaSJdPWFzbVsiSiJdO3ZhciBjYWxsZWRSdW47ZGVwZW5kZW5jaWVzRnVsZmlsbGVkPWZ1bmN0aW9uIHJ1bkNhbGxlcigpe2lmKCFjYWxsZWRSdW4pcnVuKCk7aWYoIWNhbGxlZFJ1bilkZXBlbmRlbmNpZXNGdWxmaWxsZWQ9cnVuQ2FsbGVyfTtmdW5jdGlvbiBydW4oYXJncyl7YXJncz1hcmdzfHxhcmd1bWVudHNfO2lmKHJ1bkRlcGVuZGVuY2llcz4wKXtyZXR1cm59cHJlUnVuKCk7aWYocnVuRGVwZW5kZW5jaWVzPjApe3JldHVybn1mdW5jdGlvbiBkb1J1bigpe2lmKGNhbGxlZFJ1bilyZXR1cm47Y2FsbGVkUnVuPXRydWU7TW9kdWxlWyJjYWxsZWRSdW4iXT10cnVlO2lmKEFCT1JUKXJldHVybjtpbml0UnVudGltZSgpO3ByZU1haW4oKTtyZWFkeVByb21pc2VSZXNvbHZlKE1vZHVsZSk7aWYoTW9kdWxlWyJvblJ1bnRpbWVJbml0aWFsaXplZCJdKU1vZHVsZVsib25SdW50aW1lSW5pdGlhbGl6ZWQiXSgpO3Bvc3RSdW4oKX1pZihNb2R1bGVbInNldFN0YXR1cyJdKXtNb2R1bGVbInNldFN0YXR1cyJdKCJSdW5uaW5nLi4uIik7c2V0VGltZW91dChmdW5jdGlvbigpe3NldFRpbWVvdXQoZnVuY3Rpb24oKXtNb2R1bGVbInNldFN0YXR1cyJdKCIiKX0sMSk7ZG9SdW4oKX0sMSl9ZWxzZXtkb1J1bigpfX1Nb2R1bGVbInJ1biJdPXJ1bjtpZihNb2R1bGVbInByZUluaXQiXSl7aWYodHlwZW9mIE1vZHVsZVsicHJlSW5pdCJdPT0iZnVuY3Rpb24iKU1vZHVsZVsicHJlSW5pdCJdPVtNb2R1bGVbInByZUluaXQiXV07d2hpbGUoTW9kdWxlWyJwcmVJbml0Il0ubGVuZ3RoPjApe01vZHVsZVsicHJlSW5pdCJdLnBvcCgpKCl9fXJ1bigpOwoKCiAgcmV0dXJuIE1vZHVsZQp9Cik7Cn0pKCk7Ci8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8gY29uc3QgUnVudGltZSA9IChNb2R1bGUpOwo7Ly8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvd29ya2VyL1V0aWxzLmpzCi8qKgogKiBBdXhpbGlhciBtZXRob2QgdG8gZGVsZXRlIGEgV2ViQXNzZW1ibHkgU2lkZSBWYXJpYWJsZXMKICoKICogQHBhcmFtIHthcnJheX0gYXJyYXkgVGhlIGFycmF5IHdpdGggbiBlbGVtZW50cwogKi8KY29uc3QgZGVsZXRlV2FzbVZhciA9ICguLi5hcnJheSkgPT4gewogICAgYXJyYXkuZm9yRWFjaCgob2JqKSA9PiB7CiAgICAgICAgaWYgKG9iaiAhPT0gbnVsbCAmJiB0eXBlb2Ygb2JqLmRlbGV0ZSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgb2JqLmRlbGV0ZSgpOwogICAgICAgIH0KICAgIH0pOwp9OwoKCjsvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuLi9sb2dnZXJfbW9kdWxlL3NyYy9NYWluLmpzCmNvbnN0IExvZ2dlckxldmVsID0gewogICAgREVCVUc6IDAsCiAgICBJTkZPOiAxLAogICAgV0FSTklORzogMiwKICAgIEVSUk9SOiAzCn07CgpsZXQgX19sb2dnZXJUYWcgPSAiIjsKbGV0IF9fY3VycmVudExvZ2dpbmdMZXZlbCA9IExvZ2dlckxldmVsLldBUk5JTkc7CgoKY2xhc3MgTG9nZ2VyIHsKCiAgICBzdGF0aWMgcHJpbnREZWJ1ZyguLi52YWx1ZXMpIHsKICAgICAgICBpZiAoTG9nZ2VyTGV2ZWwuREVCVUcgPj0gX19jdXJyZW50TG9nZ2luZ0xldmVsKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoYDxEPiBbJHtfX2xvZ2dlclRhZ31dICR7dmFsdWVzfWApOwogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMgcHJpbnRJbmZvKC4uLnZhbHVlcykgewogICAgICAgIGlmIChMb2dnZXJMZXZlbC5JTkZPID49IF9fY3VycmVudExvZ2dpbmdMZXZlbCkgewogICAgICAgICAgICBjb25zb2xlLmRlYnVnKGA8ST4gWyR7X19sb2dnZXJUYWd9XSAke3ZhbHVlc31gKTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIHByaW50V2FybmluZyguLi52YWx1ZXMpIHsKICAgICAgICBpZiAoTG9nZ2VyTGV2ZWwuV0FSTklORyA+PSBfX2N1cnJlbnRMb2dnaW5nTGV2ZWwpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKGA8Vz4gWyR7X19sb2dnZXJUYWd9XSAke3ZhbHVlc31gKTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIHByaW50RXJyb3IoLi4udmFsdWVzKSB7CiAgICAgICAgaWYgKExvZ2dlckxldmVsLkVSUk9SID49IF9fY3VycmVudExvZ2dpbmdMZXZlbCkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGA8RT4gWyR7X19sb2dnZXJUYWd9XSAke3ZhbHVlc31gKTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIHNldExvZ2dlckxldmVsKGxvZ2dlckx2bCkgewogICAgICAgIF9fY3VycmVudExvZ2dpbmdMZXZlbCA9IGxvZ2dlckx2bDsKICAgIH0KCiAgICBzdGF0aWMgc2V0TG9nZ2VyVGFnKGxvZ2dlclRhZykgewogICAgICAgIF9fbG9nZ2VyVGFnID0gbG9nZ2VyVGFnOwogICAgfQp9CgoKOy8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3dvcmtlci9FdmVudHMuanMKCgoKCmxldCBpbnN0YW5jZSA9IG51bGw7CmxldCBidW5kbGVQYXRoID0gIiI7CmxldCB0b2tlbml6ZXIgPSBudWxsOwoKY29uc3QgcHJlaW5pdGlhbGl6ZVdvcmtlciA9IGFzeW5jIChtZXNzYWdlKSA9PiB7CiAgICBMb2dnZXIucHJpbnREZWJ1ZygiUmVjZWl2ZWQgbWVzc2FnZSBpbiAiICsgInByZUluaXQiICsgIiBldmVudCIpOwoKICAgIC8vIFByb2Nlc3MgaW5wdXQgdmFyaWFibGVzCiAgICBidW5kbGVQYXRoID0gbWVzc2FnZS5idW5kbGVQYXRoOwoKICAgIHRyeSB7CiAgICAgICAgLyoKICAgICAgICAgKiBBc3luYyBmZXRjaCBiZWZvcmUgZ2V0IHRoZSBpbnN0YW5jZQogICAgICAgICAqIAogICAgICAgICAqIEltcG9ydGFudDogRHVlIHRvIHRoZSBuZWVkIG9mIHBhY2thZ2luZyB0aGUgV29ya2VyIGluc2lkZSB0aGUgc2VscGhpLXdpZGdldC13ZWIubWluLmpzIHVzaW5nCiAgICAgICAgICogICAgICAgICAgICBXZWJQYWNrLCBpcyBuZWVkZWQgdG8gYnVpbGQgdGhlIGV4dHJhY3RvciB1c2luZyB0aGlzIHBhcmFtZXRlcnM6CiAgICAgICAgICoKICAgICAgICAgKiAtcyBFWFBPUlRfRVM2PTEgLXMgVVNFX0VTNl9JTVBPUlRfTUVUQT0wIC1zIFdBU01fQVNZTkNfQ09NUElMQVRJT049MCAtcyBFTlZJUk9OTUVOVD0id2ViIgogICAgICAgICAqLwogICAgICAgIGxldCB3YXNtTW9kdWxlID0gYXdhaXQgKGF3YWl0IGZldGNoKGJ1bmRsZVBhdGggKyAiL0ZCVG9rZW5pemVyLndhc20iKSkuYXJyYXlCdWZmZXIoKTsKCiAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgbW9kdWxlIGluIGdsb2JhbHMgbW9kdWxlCiAgICAgICAgaW5zdGFuY2UgPSBhd2FpdCBSdW50aW1lKHsKICAgICAgICAgICAgd2FzbUJpbmFyeSA6IHdhc21Nb2R1bGUsCiAgICAgICAgICAgIG9uUnVudGltZUluaXRpYWxpemVkIDogKCkgPT4gc2VsZi5wb3N0TWVzc2FnZSh7IGNtZDogInByZUluaXQiIH0pCiAgICAgICAgfSk7CgogICAgICAgIC8vIFJlcG9ydCB0aGUgc3VjY2Vzc2Z1bCBsb2FkIG9mIG1vZHVsZSB0byBkZWJ1ZyBtZXNzYWdlCiAgICAgICAgTG9nZ2VyLnByaW50RGVidWcoIlByZWxvYWRpbmcgd2FzbSBtb2R1bGUgZnJvbSBwYXRoOiAiICsgYnVuZGxlUGF0aCArICIvRkJUb2tlbml6ZXIud2FzbSIpOwogICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8vIENyaXRpY2FsIGVycm9yIGhhcyBvY2N1cnJlZCBpbiB0aGUgV29ya2VyIFNpZGUsIHNlbmRpbmcgdG8gbWFpbiB0aHJlYWQKICAgICAgICBMb2dnZXIucHJpbnRFcnJvcigiW1dvcmtlcl06ICIgKyBlKTsKICAgIH0KfTsKCgpjb25zdCBpbml0aWFsaXplQXNzZW1ibHkgPSAoXykgPT4gewogICAgdG9rZW5pemVyID0gbmV3IGluc3RhbmNlLlRva2VuaXplcigpOwoKICAgIHNlbGYucG9zdE1lc3NhZ2UoeyBjbWQ6ICJpbml0aWFsaXplQXNzZW1ibHkiIH0pOwp9OwoKCmNvbnN0IGNsZWFyID0gYXN5bmMgKF8pID0+IHsKICAgIHRyeSB7CiAgICAgICAgaWYodG9rZW5pemVyICE9PSBudWxsKXsKICAgICAgICAgICAgdG9rZW5pemVyLmNsZWFyKCk7CiAgICAgICAgfQoKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgIGNtZDogImNsZWFyIgogICAgICAgIH0pOwogICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgIGNtZDogImNsZWFyIiwgZXhjZXB0aW9uOiAiQSBleGNlcHRpb24gaGFzIG9jdXJyZWQgY2xlYXJpbmcgdGhlIHRva2VuaXplciEiIAogICAgICAgIH0pOwogICAgfQp9OwoKY29uc3QgZ2V0RG9jdW1lbnREYXRhID0gYXN5bmMgKF8pID0+IHsKICAgIHRyeSB7CiAgICAgICAgaWYodG9rZW5pemVyICE9PSBudWxsKXsKICAgICAgICAgICAgbGV0IGtleXMgPSB0b2tlbml6ZXIuZ2V0RG9jdW1lbnREYXRhKCkua2V5cygpOwogICAgICAgICAgICBsZXQgb2JqUmVzdWx0PXt9OwogICAgICAgICAgICBmb3IobGV0IGlkeCA9IDA7IGlkeCA8IGtleXMuc2l6ZSgpOyBpZHgrKyl7CiAgICAgICAgICAgICAgICBsZXQga2V5ID0ga2V5cy5nZXQoaWR4KTsKICAgICAgICAgICAgICAgIG9ialJlc3VsdFtrZXldID0gdG9rZW5pemVyLmdldERvY3VtZW50RGF0YSgpLmdldChrZXkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vTm8gZGViZXLDrWEgZGUgaGFiZXIgbmluZ8O6biBwcm9ibGVtYSBkZSBtZW1vcmlhIHlhIHF1ZSBrZXlzIHkgc3VzIHZhbG9yZXMgbm8gc29uIG9iamV0b3Mgd2FzbQogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgICAgICBjbWQ6ICJnZXREb2N1bWVudERhdGEiLCBwYXlsb2FkOiBvYmpSZXN1bHQKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRva2VuaXplciBpcyBub3QgaW5pdGlhbGl6ZWQhIik7CiAgICAgICAgfQogICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgIGNtZDogImdldERvY3VtZW50RGF0YSIsIGV4Y2VwdGlvbjogIkEgZXhjZXB0aW9uIGhhcyBvY3VycmVkIGdldHRpbmcgdGhlIGRvY3VtZW50IGRhdGEhIiAKICAgICAgICB9KTsKICAgIH0KfTsKCmNvbnN0IGFkZERvY3VtZW50RGF0YSA9IGFzeW5jIChtZXNzYWdlKSA9PiB7CiAgICB0cnkgewogICAgICAgIGNvbnN0IG1hcERvY3VtZW50RGF0YSA9IG1lc3NhZ2UucGF5bG9hZDsKICAgICAgICBsZXQgZG9jdW1lbnREYXRhID0gbmV3IGluc3RhbmNlLk1hcFN0clN0cigpOwogICAgICAgIGZvciAoY29uc3Qga2V5IGluIG1hcERvY3VtZW50RGF0YSl7CiAgICAgICAgICAgIGRvY3VtZW50RGF0YS5zZXQoa2V5LG1hcERvY3VtZW50RGF0YVtrZXldKTsKICAgICAgICB9CgogICAgICAgIGlmKHRva2VuaXplciAhPT0gbnVsbCl7CiAgICAgICAgICAgIHRva2VuaXplci5hZGREb2N1bWVudERhdGEoZG9jdW1lbnREYXRhKTsKICAgICAgICAgICAgLy8gZG9jdW1lbnREYXRhLmRlbGV0ZSgpOwogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgICAgICBjbWQ6ICJhZGREb2N1bWVudERhdGEiCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRva2VuaXplciBpcyBub3QgaW5pdGlhbGl6ZWQhIik7CiAgICAgICAgfQogICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgIGNtZDogImFkZERvY3VtZW50RGF0YSIsIGV4Y2VwdGlvbjogIkEgZXhjZXB0aW9uIGhhcyBvY3VycmVkIGFkZGluZyB0aGUgZG9jdW1lbnQgZGF0YSEiIAogICAgICAgIH0pOwogICAgfQp9OwoKY29uc3QgcmVtb3ZlRG9jdW1lbnREYXRhV2l0aEtleVN0YXJ0ZWRCeUtleSA9IGFzeW5jIChtZXNzYWdlKSA9PiB7CiAgICB0cnkgewogICAgICAgIGNvbnN0IHN0YXJ0aW5nS2V5ID0gbWVzc2FnZS5rZXk7CgogICAgICAgIGlmKHRva2VuaXplciAhPT0gbnVsbCl7CiAgICAgICAgICAgIGxldCByZXN1bHQgPSB0b2tlbml6ZXIucmVtb3ZlRG9jdW1lbnREYXRhV2l0aEtleVN0YXJ0ZWRCeUtleShzdGFydGluZ0tleSk7CgogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgICAgICBjbWQ6ICJyZW1vdmVEb2N1bWVudERhdGFXaXRoS2V5U3RhcnRlZEJ5S2V5IiwgcGF5bG9hZDogcmVzdWx0CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRva2VuaXplciBpcyBub3QgaW5pdGlhbGl6ZWQhIik7CiAgICAgICAgfQogICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgIGNtZDogInJlbW92ZURvY3VtZW50RGF0YVdpdGhLZXlTdGFydGVkQnlLZXkiLCBleGNlcHRpb246ICJBIGV4Y2VwdGlvbiBoYXMgb2N1cnJlZCByZW1vdmluZyB0aGUga2V5IGRhdGEhIiAKICAgICAgICB9KTsKICAgIH0KfTsKCmNvbnN0IGdldEV4dHJhRGF0YSA9IGFzeW5jIChfKSA9PiB7CiAgICB0cnkgewogICAgICAgIGlmKHRva2VuaXplciAhPT0gbnVsbCl7CiAgICAgICAgICAgIGxldCBrZXlzID0gdG9rZW5pemVyLmdldEV4dHJhRGF0YSgpLmtleXMoKTsKICAgICAgICAgICAgbGV0IG9ialJlc3VsdD17fTsKICAgICAgICAgICAgZm9yKGxldCBpZHggPSAwOyBpZHggPCBrZXlzLnNpemUoKTsgaWR4KyspewogICAgICAgICAgICAgICAgbGV0IGtleSA9IGtleXMuZ2V0KGlkeCk7CiAgICAgICAgICAgICAgICBvYmpSZXN1bHRba2V5XSA9IHRva2VuaXplci5nZXRFeHRyYURhdGEoKS5nZXQoa2V5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL05vIGRlYmVyw61hIGRlIGhhYmVyIG5pbmfDum4gcHJvYmxlbWEgZGUgbWVtb3JpYSB5YSBxdWUga2V5cyB5IHN1cyB2YWxvcmVzIG5vIHNvbiBvYmpldG9zIHdhc20KICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IAogICAgICAgICAgICAgICAgY21kOiAiZ2V0RXh0cmFEYXRhIiwgcGF5bG9hZDogb2JqUmVzdWx0CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRva2VuaXplciBpcyBub3QgaW5pdGlhbGl6ZWQhIik7CiAgICAgICAgfQogICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgIGNtZDogImdldEV4dHJhRGF0YSIsIGV4Y2VwdGlvbjogIkEgZXhjZXB0aW9uIGhhcyBvY3VycmVkIGdldHRpbmcgdGhlIGV4dHJhIGRhdGEhIiAKICAgICAgICB9KTsKICAgIH0KfTsKCmNvbnN0IGFkZEV4dHJhRGF0YSA9IGFzeW5jIChtZXNzYWdlKSA9PiB7CiAgICB0cnkgewogICAgICAgIGNvbnN0IHBheWxvYWQgPSBtZXNzYWdlLnBheWxvYWQ7CiAgICAgICAgbGV0IGV4dHJhRGF0YSA9IG5ldyBpbnN0YW5jZS5NYXBTdHJTdHIoKTsKICAgICAgICBleHRyYURhdGEuc2V0KCJFeHRyYURhdGEiLHBheWxvYWQpOwoKICAgICAgICBpZih0b2tlbml6ZXIgIT09IG51bGwpewogICAgICAgICAgICBsZXQgbWFwUmVzdWx0ID0gdG9rZW5pemVyLmFkZEV4dHJhRGF0YShleHRyYURhdGEpOwogICAgICAgICAgICAvL2V4dHJhRGF0YS5kZWxldGUoKTsKICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IAogICAgICAgICAgICAgICAgY21kOiAiYWRkRXh0cmFEYXRhIiwgcGF5bG9hZDogbWFwUmVzdWx0CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRva2VuaXplciBpcyBub3QgaW5pdGlhbGl6ZWQhIik7CiAgICAgICAgfQogICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgIGNtZDogImFkZEV4dHJhRGF0YSIsIGV4Y2VwdGlvbjogIkEgZXhjZXB0aW9uIGhhcyBvY3VycmVkIGFkZGluZyB0aGUgZXh0cmEgZGF0YSEiIAogICAgICAgIH0pOwogICAgfQp9OwoKY29uc3QgZ2V0RG9jdW1lbnRNb2RlbCA9IGFzeW5jIChfKSA9PiB7CiAgICB0cnkgewogICAgICAgIGlmKHRva2VuaXplciAhPT0gbnVsbCl7CiAgICAgICAgICAgIGxldCB2ZWN0b3JSZXN1bHQgPSB0b2tlbml6ZXIuZ2V0RG9jdW1lbnRNb2RlbCgpOwoKICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IAogICAgICAgICAgICAgICAgY21kOiAiZ2V0RG9jdW1lbnRNb2RlbCIsIHBheWxvYWQ6IHZlY3RvclJlc3VsdAogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUb2tlbml6ZXIgaXMgbm90IGluaXRpYWxpemVkISIpOwogICAgICAgIH0KICAgIH0gY2F0Y2goZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IAogICAgICAgICAgICBjbWQ6ICJnZXREb2N1bWVudE1vZGVsIiwgZXhjZXB0aW9uOiAiQSBleGNlcHRpb24gaGFzIG9jdXJyZWQgZ2V0dGluZyB0aGUgZG9jdW1lbnQgbW9kZWwhIiAKICAgICAgICB9KTsKICAgIH0KfTsKCmNvbnN0IGFkZERvY3VtZW50TW9kZWwgPSBhc3luYyAobWVzc2FnZSkgPT4gewogICAgdHJ5IHsKICAgICAgICBjb25zdCB2ZWN0b3JTdHJpbmcgPSBtZXNzYWdlLmtleTsKCiAgICAgICAgaWYodG9rZW5pemVyICE9PSBudWxsKXsKICAgICAgICAgICAgbGV0IG1hcFJlc3VsdCA9IHRva2VuaXplci5hZGREb2N1bWVudE1vZGVsKHZlY3RvclN0cmluZyk7CgogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgICAgICBjbWQ6ICJhZGREb2N1bWVudE1vZGVsIiwgcGF5bG9hZDogbWFwUmVzdWx0CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRva2VuaXplciBpcyBub3QgaW5pdGlhbGl6ZWQhIik7CiAgICAgICAgfQogICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgIGNtZDogImFkZERvY3VtZW50TW9kZWwiLCBleGNlcHRpb246ICJBIGV4Y2VwdGlvbiBoYXMgb2N1cnJlZCBhZGRpbmcgdGhlIGV4dHJhIGRhdGEhIiAKICAgICAgICB9KTsKICAgIH0KfTsKCmNvbnN0IGdldEltYWdlRGF0YSA9IGFzeW5jIChfKSA9PiB7CiAgICB0cnkgewogICAgICAgIGlmKHRva2VuaXplciAhPT0gbnVsbCl7CiAgICAgICAgICAgIGxldCByZXN1bHQgPSB0b2tlbml6ZXIuZ2V0SW1hZ2VEYXRhKCk7CiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyAKICAgICAgICAgICAgICAgIGNtZDogImdldEltYWdlRGF0YSIsIHBheWxvYWQ6IHJlc3VsdAogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUb2tlbml6ZXIgaXMgbm90IGluaXRpYWxpemVkISIpOwogICAgICAgIH0KICAgIH0gY2F0Y2goZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IAogICAgICAgICAgICBjbWQ6ICJnZXRJbWFnZURhdGEiLCBleGNlcHRpb246ICJBIGV4Y2VwdGlvbiBoYXMgb2N1cnJlZCBnZXR0aW5nIHRoZSBpbWFnZSBkYXRhISIgCiAgICAgICAgfSk7CiAgICB9Cn07Cgpjb25zdCBhZGRJbWFnZURhdGEgPSBhc3luYyAobWVzc2FnZSkgPT4gewogICAgdHJ5IHsKICAgICAgICBjb25zdCBtYXBLZXkgPSBtZXNzYWdlLnBheWxvYWQ7CgogICAgICAgIGlmKHRva2VuaXplciAhPT0gbnVsbCl7CiAgICAgICAgICAgIHRva2VuaXplci5hZGRJbWFnZURhdGEobWFwS2V5KTsKCiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyAKICAgICAgICAgICAgICAgIGNtZDogImFkZEltYWdlRGF0YSIKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVG9rZW5pemVyIGlzIG5vdCBpbml0aWFsaXplZCEiKTsKICAgICAgICB9CiAgICB9IGNhdGNoKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyAKICAgICAgICAgICAgY21kOiAiYWRkSW1hZ2VEYXRhIiwgZXhjZXB0aW9uOiAiQSBleGNlcHRpb24gaGFzIG9jdXJyZWQgYWRkaW5nIHRoZSBpbWFnZSBkYXRhISIgCiAgICAgICAgfSk7CiAgICB9Cn07Cgpjb25zdCBnZXRJbnRlcm5hbERhdGEgPSBhc3luYyAoXykgPT4gewogICAgdHJ5IHsKICAgICAgICBpZih0b2tlbml6ZXIgIT09IG51bGwpewogICAgICAgICAgICBsZXQgbWFwUmVzdWx0ID0gdG9rZW5pemVyLmdldEludGVybmFsRGF0YSgpOwogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgICAgICBjbWQ6ICJnZXRJbnRlcm5hbERhdGEiLCBwYXlsb2FkOiBtYXBSZXN1bHQKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVG9rZW5pemVyIGlzIG5vdCBpbml0aWFsaXplZCEiKTsKICAgICAgICB9CiAgICB9IGNhdGNoKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyAKICAgICAgICAgICAgY21kOiAiZ2V0SW50ZXJuYWxEYXRhIiwgZXhjZXB0aW9uOiAiQSBleGNlcHRpb24gaGFzIG9jdXJyZWQgZ2V0dGluZyB0aGUgaW50ZXJuYWwgZGF0YSEiIAogICAgICAgIH0pOwogICAgfQp9OwoKY29uc3QgYWRkSW50ZXJuYWxEYXRhID0gYXN5bmMgKG1lc3NhZ2UpID0+IHsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgbWFwRGF0YSA9IG1lc3NhZ2UucGF5bG9hZDsKCiAgICAgICAgaWYodG9rZW5pemVyICE9PSBudWxsKXsKICAgICAgICAgICAgdG9rZW5pemVyLmFkZEludGVybmFsRGF0YShtYXBEYXRhKTsKCiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyAKICAgICAgICAgICAgICAgIGNtZDogImFkZEludGVybmFsRGF0YSIKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVG9rZW5pemVyIGlzIG5vdCBpbml0aWFsaXplZCEiKTsKICAgICAgICB9CiAgICB9IGNhdGNoKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyAKICAgICAgICAgICAgY21kOiAiYWRkSW50ZXJuYWxEYXRhIiwgZXhjZXB0aW9uOiAiQSBleGNlcHRpb24gaGFzIG9jdXJyZWQgYWRkaW5nIHRoZSBpbnRlcm5hbCBkYXRhISIgCiAgICAgICAgfSk7CiAgICB9Cn07Cgpjb25zdCBnZXRFbmNyeXB0b3JUeXBlID0gYXN5bmMgKF8pID0+IHsKICAgIHRyeSB7CiAgICAgICAgaWYodG9rZW5pemVyICE9PSBudWxsKXsKICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHRva2VuaXplci5nZXRFbmNyeXB0b3JUeXBlKCk7CiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyAKICAgICAgICAgICAgICAgIGNtZDogImdldEVuY3J5cHRvclR5cGUiLCBwYXlsb2FkOiByZXN1bHQKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVG9rZW5pemVyIGlzIG5vdCBpbml0aWFsaXplZCEiKTsKICAgICAgICB9CiAgICB9IGNhdGNoKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyAKICAgICAgICAgICAgY21kOiAiZ2V0RW5jcnlwdG9yVHlwZSIsIGV4Y2VwdGlvbjogIkEgZXhjZXB0aW9uIGhhcyBvY3VycmVkIGdldHRpbmcgdGhlIGVuY3J5dG9yIHR5cGUhIiAKICAgICAgICB9KTsKICAgIH0KfTsKCmNvbnN0IHNldEVuY3J5cHRvclR5cGUgPSBhc3luYyAobWVzc2FnZSkgPT4gewogICAgdHJ5IHsKICAgICAgICBjb25zdCB0eXBlID0gbWVzc2FnZS50eXBlOwoKICAgICAgICBpZih0b2tlbml6ZXIgIT09IG51bGwpewogICAgICAgICAgICB0b2tlbml6ZXIuc2V0RW5jcnlwdG9yVHlwZSh0eXBlKTsKCiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyAKICAgICAgICAgICAgICAgIGNtZDogInNldEVuY3J5cHRvclR5cGUiCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRva2VuaXplciBpcyBub3QgaW5pdGlhbGl6ZWQhIik7CiAgICAgICAgfQogICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgIGNtZDogInNldEVuY3J5cHRvclR5cGUiLCBleGNlcHRpb246ICJBIGV4Y2VwdGlvbiBoYXMgb2N1cnJlZCBzZXR0aW5nIHRoZSBlbmNyeXB0b3IgdHlwZSEiIAogICAgICAgIH0pOwogICAgfQp9OwoKY29uc3QgZW5jcnlwdERpY3Rpb25hcnkgPSBhc3luYyAoXykgPT4gewogICAgdHJ5IHsKICAgICAgICBpZih0b2tlbml6ZXIgIT09IG51bGwpewogICAgICAgICAgICBsZXQgcmVzdWx0ID0gdG9rZW5pemVyLmVuY3J5cHREaWN0aW9uYXJ5KCk7CgogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgICAgICBjbWQ6ICJlbmNyeXB0RGljdGlvbmFyeSIsIHBheWxvYWQ6IHJlc3VsdAogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUb2tlbml6ZXIgaXMgbm90IGluaXRpYWxpemVkISIpOwogICAgICAgIH0KICAgIH0gY2F0Y2goZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IAogICAgICAgICAgICBjbWQ6ICJlbmNyeXB0RGljdGlvbmFyeSIsIGV4Y2VwdGlvbjogIkEgZXhjZXB0aW9uIGhhcyBvY3VycmVkIGVuY3J5cHRpbmcgdGhlIGRpY3Rpb25hcnkhIiAKICAgICAgICB9KTsKICAgIH0KfTsKCmNvbnN0IGdldEVuY3J5cHRlZERpY3Rpb25hcnlCaW5hcnkgPSBhc3luYyAoXykgPT4gewogICAgdHJ5IHsKICAgICAgICBpZih0b2tlbml6ZXIgIT09IG51bGwpewogICAgICAgICAgICBsZXQgcmVzdWx0ID0gdG9rZW5pemVyLmdldEVuY3J5cHRlZERpY3Rpb25hcnlCaW5hcnkoKTsKICAgICAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IAogICAgICAgICAgICAgICAgY21kOiAiZ2V0RW5jcnlwdGVkRGljdGlvbmFyeUJpbmFyeSIsIHBheWxvYWQ6IHJlc3VsdAogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUb2tlbml6ZXIgaXMgbm90IGluaXRpYWxpemVkISIpOwogICAgICAgIH0KICAgIH0gY2F0Y2goZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IAogICAgICAgICAgICBjbWQ6ICJnZXRFbmNyeXB0ZWREaWN0aW9uYXJ5QmluYXJ5IiwgZXhjZXB0aW9uOiAiQSBleGNlcHRpb24gaGFzIG9jdXJyZWQgZ2V0dGluZyB0aGUgZW5jcnl0dGVkIGRpY3Rpb25hcnkgYmluYXJ5ISIgCiAgICAgICAgfSk7CiAgICB9Cn07Cgpjb25zdCBnZXRFbmNyeXB0ZWREaWN0aW9uYXJ5QmFzZTY0ID0gYXN5bmMgKF8pID0+IHsKICAgIHRyeSB7CiAgICAgICAgaWYodG9rZW5pemVyICE9PSBudWxsKXsKICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHRva2VuaXplci5nZXRFbmNyeXB0ZWREaWN0aW9uYXJ5QmFzZTY0KCk7CiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyAKICAgICAgICAgICAgICAgIGNtZDogImdldEVuY3J5cHRlZERpY3Rpb25hcnlCYXNlNjQiLCBwYXlsb2FkOiByZXN1bHQKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGVsc2V7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVG9rZW5pemVyIGlzIG5vdCBpbml0aWFsaXplZCEiKTsKICAgICAgICB9CiAgICB9IGNhdGNoKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyAKICAgICAgICAgICAgY21kOiAiZ2V0RW5jcnlwdGVkRGljdGlvbmFyeUJhc2U2NCIsIGV4Y2VwdGlvbjogIkEgZXhjZXB0aW9uIGhhcyBvY3VycmVkIGdldHRpbmcgdGhlIGVuY3J5cHRlZCBkaWN0aW9uYXJ5IGluIGJhc2U2NCEiIAogICAgICAgIH0pOwogICAgfQp9OwoKY29uc3QgZGVjcnlwdERpY3Rpb25hcnlCaW5hcnkgPSBhc3luYyAobWVzc2FnZSkgPT4gewogICAgdHJ5IHsKICAgICAgICBjb25zdCBkYXRhID0gbWVzc2FnZS5wYXlsb2FkOwoKICAgICAgICBpZih0b2tlbml6ZXIgIT09IG51bGwpewogICAgICAgICAgICBsZXQgcmVzdWx0ID0gdG9rZW5pemVyLmRlY3J5cHREaWN0aW9uYXJ5QmluYXJ5KGRhdGEpOwogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgICAgICBjbWQ6ICJkZWNyeXB0RGljdGlvbmFyeUJpbmFyeSIsIHBheWxvYWQ6IHJlc3VsdC52YWx1ZQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZWxzZXsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUb2tlbml6ZXIgaXMgbm90IGluaXRpYWxpemVkISIpOwogICAgICAgIH0KICAgIH0gY2F0Y2goZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IAogICAgICAgICAgICBjbWQ6ICJkZWNyeXB0RGljdGlvbmFyeUJpbmFyeSIsIGV4Y2VwdGlvbjogIkEgZXhjZXB0aW9uIGhhcyBvY3VycmVkIGRlY3J5cHRpbmcgdGhlIGRpY3Rpb25hcnkgaW4gYmluYXJ5ISIgCiAgICAgICAgfSk7CiAgICB9Cn07Cgpjb25zdCBkZWNyeXB0RGljdGlvbmFyeUJhc2U2NCA9IGFzeW5jIChtZXNzYWdlKSA9PiB7CiAgICB0cnkgewogICAgICAgIGNvbnN0IGRhdGEgPSBtZXNzYWdlLnBheWxvYWQ7CgogICAgICAgIGlmKHRva2VuaXplciAhPT0gbnVsbCl7CiAgICAgICAgICAgIGxldCByZXN1bHQgPSB0b2tlbml6ZXIuZGVjcnlwdERpY3Rpb25hcnlCYXNlNjQoZGF0YSk7CiAgICAgICAgICAgIHNlbGYucG9zdE1lc3NhZ2UoeyAKICAgICAgICAgICAgICAgIGNtZDogImRlY3J5cHREaWN0aW9uYXJ5QmFzZTY0IiwgcGF5bG9hZDogcmVzdWx0LnZhbHVlCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRva2VuaXplciBpcyBub3QgaW5pdGlhbGl6ZWQhIik7CiAgICAgICAgfQogICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgIGNtZDogImRlY3J5cHREaWN0aW9uYXJ5QmFzZTY0IiwgZXhjZXB0aW9uOiAiQSBleGNlcHRpb24gaGFzIG9jdXJyZWQgZGVjcnlwdGluZyB0aGUgZGljdGlvbmFyeSBpbiBiYXNlNjQhIiAKICAgICAgICB9KTsKICAgIH0KfTsKCmNvbnN0IGVuY3J5cHRCdWZmZXIgPSBhc3luYyAobWVzc2FnZSkgPT4gewogICAgdHJ5IHsKICAgICAgICBjb25zdCBidWZmZXIgPSBtZXNzYWdlLnBheWxvYWQ7CgogICAgICAgIGlmKHRva2VuaXplciAhPT0gbnVsbCl7CiAgICAgICAgICAgIGxldCByZXN1bHQgPSB0b2tlbml6ZXIuZW5jcnlwdEJ1ZmZlcihidWZmZXIpOwogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgICAgICBjbWQ6ICJlbmNyeXB0QnVmZmVyIiwgcGF5bG9hZDogcmVzdWx0CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRva2VuaXplciBpcyBub3QgaW5pdGlhbGl6ZWQhIik7CiAgICAgICAgfQogICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgIGNtZDogImVuY3J5cHRCdWZmZXIiLCBleGNlcHRpb246ICJBIGV4Y2VwdGlvbiBoYXMgb2N1cnJlZCBlbmNyeXB0aW5nIHRoZSBidWZmZXIhIiAKICAgICAgICB9KTsKICAgIH0KfTsKCmNvbnN0IGRlY3J5cHRCdWZmZXIgPSBhc3luYyAobWVzc2FnZSkgPT4gewogICAgdHJ5IHsKICAgICAgICBjb25zdCBidWZmZXIgPSBtZXNzYWdlLnBheWxvYWQ7CgogICAgICAgIGlmKHRva2VuaXplciAhPT0gbnVsbCl7CiAgICAgICAgICAgIGxldCByZXN1bHQgPSB0b2tlbml6ZXIuZGVjcnlwdEJ1ZmZlcihidWZmZXIpOwogICAgICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgICAgICBjbWQ6ICJkZWNyeXB0QnVmZmVyIiwgcGF5bG9hZDogcmVzdWx0CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRva2VuaXplciBpcyBub3QgaW5pdGlhbGl6ZWQhIik7CiAgICAgICAgfQogICAgfSBjYXRjaChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgCiAgICAgICAgICAgIGNtZDogImRlY3J5cHRCdWZmZXIiLCBleGNlcHRpb246ICJBIGV4Y2VwdGlvbiBoYXMgb2N1cnJlZCBkZWNyeXB0aW5nIHRoZSBidWZmZXIhIiAKICAgICAgICB9KTsKICAgIH0KfTsKCi8qKgogKiBEZXN0cm95IGNyZWF0ZWQgb2JqZWN0cyBpbiBXZWJBc3NlbWJseSBzaWRlCiAqLwpjb25zdCBkZXN0cm95ID0gYXN5bmMgKF8pID0+IHsKICAgIC8vIERlc3Ryb3kgV2ViQXNzZW1ibHkgR2xvYmFscwogICAgZGVsZXRlV2FzbVZhcigKICAgICAgICBpbnN0YW5jZQogICAgKTsKCiAgICAvLyBDbG9zZSBXb3JrZXIgVGhyZWFkCiAgICBjbG9zZSgpOwp9OwoKCjsvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy93b3JrZXIvTWFpbi5qcwovKiBlc2xpbnQtZGlzYWJsZSBjb21wbGV4aXR5ICovCgoKc2VsZi5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkgewogICAgc3dpdGNoKG1lc3NhZ2UuZGF0YS5jbWQpIHsKICAgIGNhc2UgInByZUluaXQiOgogICAgICAgIHByZWluaXRpYWxpemVXb3JrZXIobWVzc2FnZS5kYXRhKTsKICAgICAgICBicmVhazsKICAgIGNhc2UgImluaXRpYWxpemVBc3NlbWJseSI6CiAgICAgICAgaW5pdGlhbGl6ZUFzc2VtYmx5KG1lc3NhZ2UuZGF0YSk7CiAgICAgICAgYnJlYWs7CiAgICBjYXNlICJjbGVhciI6CiAgICAgICAgY2xlYXIobWVzc2FnZS5kYXRhKTsKICAgICAgICBicmVhazsKICAgIGNhc2UgImdldERvY3VtZW50RGF0YSI6CiAgICAgICAgZ2V0RG9jdW1lbnREYXRhKG1lc3NhZ2UuZGF0YSk7CiAgICAgICAgYnJlYWs7ICAgIAogICAgY2FzZSAiYWRkRG9jdW1lbnREYXRhIjoKICAgICAgICBhZGREb2N1bWVudERhdGEobWVzc2FnZS5kYXRhKTsKICAgICAgICBicmVhazsKICAgIGNhc2UgInJlbW92ZURvY3VtZW50RGF0YVdpdGhLZXlTdGFydGVkQnlLZXkiOgogICAgICAgIHJlbW92ZURvY3VtZW50RGF0YVdpdGhLZXlTdGFydGVkQnlLZXkobWVzc2FnZS5kYXRhKTsKICAgICAgICBicmVhazsKICAgIGNhc2UgImdldEV4dHJhRGF0YSI6CiAgICAgICAgY2xlYXIobWVzc2FnZS5kYXRhKTsKICAgICAgICBicmVhazsgICAgCiAgICBjYXNlICJhZGRFeHRyYURhdGEiOgogICAgICAgIGFkZEV4dHJhRGF0YShtZXNzYWdlLmRhdGEpOwogICAgICAgIGJyZWFrOwogICAgY2FzZSAiZ2V0RG9jdW1lbnRNb2RlbCI6CiAgICAgICAgZ2V0RG9jdW1lbnRNb2RlbChtZXNzYWdlLmRhdGEpOwogICAgICAgIGJyZWFrOwogICAgY2FzZSAiYWRkRG9jdW1lbnRNb2RlbCI6CiAgICAgICAgYWRkRG9jdW1lbnRNb2RlbChtZXNzYWdlLmRhdGEpOwogICAgICAgIGJyZWFrOyAgICAKICAgIGNhc2UgImdldEltYWdlRGF0YSI6CiAgICAgICAgZ2V0SW1hZ2VEYXRhKG1lc3NhZ2UuZGF0YSk7CiAgICAgICAgYnJlYWs7CiAgICBjYXNlICJhZGRJbWFnZURhdGEiOgogICAgICAgIGFkZEltYWdlRGF0YShtZXNzYWdlLmRhdGEpOwogICAgICAgIGJyZWFrOwogICAgY2FzZSAiZ2V0SW50ZXJuYWxEYXRhIjoKICAgICAgICBnZXRJbnRlcm5hbERhdGEobWVzc2FnZS5kYXRhKTsKICAgICAgICBicmVhazsgICAgCiAgICBjYXNlICJhZGRJbnRlcm5hbERhdGEiOgogICAgICAgIGFkZEludGVybmFsRGF0YShtZXNzYWdlLmRhdGEpOwogICAgICAgIGJyZWFrOwogICAgY2FzZSAiZ2V0RW5jcnlwdG9yVHlwZSI6CiAgICAgICAgZ2V0RW5jcnlwdG9yVHlwZShtZXNzYWdlLmRhdGEpOwogICAgICAgIGJyZWFrOwogICAgY2FzZSAic2V0RW5jcnlwdG9yVHlwZSI6CiAgICAgICAgc2V0RW5jcnlwdG9yVHlwZShtZXNzYWdlLmRhdGEpOwogICAgICAgIGJyZWFrOwogICAgY2FzZSAiZW5jcnlwdERpY3Rpb25hcnkiOgogICAgICAgIGVuY3J5cHREaWN0aW9uYXJ5KG1lc3NhZ2UuZGF0YSk7CiAgICAgICAgYnJlYWs7CiAgICBjYXNlICJnZXRFbmNyeXB0ZWREaWN0aW9uYXJ5QmluYXJ5IjoKICAgICAgICBnZXRFbmNyeXB0ZWREaWN0aW9uYXJ5QmluYXJ5KG1lc3NhZ2UuZGF0YSk7CiAgICAgICAgYnJlYWs7CiAgICBjYXNlICJnZXRFbmNyeXB0ZWREaWN0aW9uYXJ5QmFzZTY0IjoKICAgICAgICBnZXRFbmNyeXB0ZWREaWN0aW9uYXJ5QmFzZTY0KG1lc3NhZ2UuZGF0YSk7CiAgICAgICAgYnJlYWs7CiAgICBjYXNlICJkZWNyeXB0RGljdGlvbmFyeUJpbmFyeSI6CiAgICAgICAgZGVjcnlwdERpY3Rpb25hcnlCaW5hcnkobWVzc2FnZS5kYXRhKTsKICAgICAgICBicmVhazsKICAgIGNhc2UgImRlY3J5cHREaWN0aW9uYXJ5QmFzZTY0IjoKICAgICAgICBkZWNyeXB0RGljdGlvbmFyeUJhc2U2NChtZXNzYWdlLmRhdGEpOwogICAgICAgIGJyZWFrOwogICAgY2FzZSAiZW5jcnlwdEJ1ZmZlciI6CiAgICAgICAgZW5jcnlwdEJ1ZmZlcihtZXNzYWdlLmRhdGEpOwogICAgICAgIGJyZWFrOwogICAgY2FzZSAiZGVjcnlwdEJ1ZmZlciI6CiAgICAgICAgZGVjcnlwdEJ1ZmZlcihtZXNzYWdlLmRhdGEpOwogICAgICAgIGJyZWFrOwogICAgY2FzZSAiZGVzdHJveSI6CiAgICAgICAgZGVzdHJveShtZXNzYWdlLmRhdGEpOwogICAgICAgIGJyZWFrOwogICAgfQp9Owo='
                    ),
                  ],
                  { type: 'text/javascript' }
                )
              )),
            Z)
          );
        return (
          i.postMessage({ cmd: 'preInit', bundlePath: e }),
          new Promise((e) => {
            i.onmessage = (l) => {
              'preInit' === l.data.cmd
                ? i.postMessage({ cmd: 'initializeAssembly' })
                : 'initializeAssembly' === l.data.cmd && ((t.worker = i), e());
            };
          })
        );
      }
    }
    static async clear(e) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'clear' }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'clear' === i.data.cmd &&
              (i.data.exception ? t(new Error(i.data.exception)) : e());
          };
        })
      );
    }
    static async getDocumentData(e) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'getDocumentData' }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'getDocumentData' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async addDocumentData(e, t) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'addDocumentData', payload: t }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'addDocumentData' === i.data.cmd &&
              (i.data.exception ? t(new Error(i.data.exception)) : e());
          };
        })
      );
    }
    static async removeDocumentDataWithKeyStartedByKey(e, t) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({
          cmd: 'removeDocumentDataWithKeyStartedByKey',
          key: t,
        }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'removeDocumentDataWithKeyStartedByKey' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async getExtraData(e) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'getExtraData' }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'getExtraData' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async addExtraData(e, t) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'addExtraData', payload: t }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'addExtraData' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async getDocumentModel(e) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'getDocumentModel' }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'getDocumentModel' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async addDocumentModel(e, t) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'addDocumentModel', key: t }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'addDocumentModel' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async getImageData(e) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'getImageData' }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'getImageData' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async addImageData(e, t) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'addImageData', payload: t }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'addImageData' === i.data.cmd &&
              (i.data.exception ? t(new Error(i.data.exception)) : e());
          };
        })
      );
    }
    static async getInternalData(e) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'getInternalData' }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'getInternalData' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async addInternalData(e, t) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'addInternalData', payload: t }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'addInternalData' === i.data.cmd &&
              (i.data.exception ? t(new Error(i.data.exception)) : e());
          };
        })
      );
    }
    static async getEncryptorType(e) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'getEncryptorType' }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'getEncryptorType' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async setEncryptorType(e, t) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'setEncryptorType', type: t }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'setEncryptorType' === i.data.cmd &&
              (i.data.exception ? t(new Error(i.data.exception)) : e());
          };
        })
      );
    }
    static async encryptDictionary(e) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'encryptDictionary' }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'encryptDictionary' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async getEncryptedDictionaryBinary(e) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'getEncryptedDictionaryBinary' }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'getEncryptedDictionaryBinary' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async getEncryptedDictionaryBase64(e) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'getEncryptedDictionaryBase64' }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'getEncryptedDictionaryBase64' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async decryptDictionaryBinary(e, t) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'decryptDictionaryBinary', payload: t }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'decryptDictionaryBinary' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async decryptDictionaryBase64(e, t) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'decryptDictionaryBase64', payload: t }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'decryptDictionaryBase64' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async encryptBuffer(e, t) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'encryptBuffer', payload: t }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'encryptBuffer' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static async decryptBuffer(e, t) {
      return (
        await r.__checkWorker(e),
        r.worker.postMessage({ cmd: 'decryptBuffer', payload: t }),
        new Promise((e, t) => {
          r.worker.onmessage = (i) => {
            'decryptBuffer' === i.data.cmd &&
              (i.data.exception
                ? t(new Error(i.data.exception))
                : e(i.data.payload));
          };
        })
      );
    }
    static destroyWorker() {
      r.worker && (r.worker.postMessage({ cmd: 'destroy' }), (r.worker = null));
    }
  }
  let u = null;
  class g {
    constructor(e) {
      (this.__licenseKey = ''),
        (this.__engineLocation = ''),
        (this.__minIOD = 40),
        this.__mapperToRealConfig(e),
        (this.__worker = new Worker(
          (null === u &&
            (u = URL.createObjectURL(
              new Blob(
                [
                  window.atob(
                    'Y29uc3QgZT0oLi4uZSk9PntlLmZvckVhY2goKGU9PntudWxsIT09ZSYmdm9pZCAwIT09ZS5kZWxldGUmJmUuZGVsZXRlKCl9KSl9LHQ9KGUsdCxyKT0+e2xldCBuPXQ7aWYobi5zYW1wbGVEaWFnbm9zdGljPXIuZ2V0U2FtcGxlRGlhZ25vc3RpYygpLnZhbHVlLHIuZ2V0U2FtcGxlRGlhZ25vc3RpYygpPT09ZS5TYW1wbGVEaWFnbm9zdGljLk9rKXtsZXQgdCxvLGEsaSxzO251bGwhPT0obz1yLmdldFRlbXBsYXRlKCkpJiZudWxsIT09KGk9bmV3IFVpbnQ4QXJyYXkoZS5nZXRCeXRlcyhvKSkpJiYobi50ZW1wbGF0ZT1pLG8uZGVsZXRlKCkpLG51bGwhPT0oYT1yLmdldFRlbXBsYXRlUmF3KCkpJiZudWxsIT09KHM9bmV3IFVpbnQ4QXJyYXkoZS5nZXRCeXRlcyhhKSkpJiYobi50ZW1wbGF0ZVJhdz1zLGEuZGVsZXRlKCkpLG51bGwhPT0odD1yLmdldFRlbXBsYXRlSW5mbygpKSYmKG4udGVtcGxhdGVTY29yZT10LmdldFRlbXBsYXRlU2NvcmUoKSxuLmZhY2lhbFNjb3JlPXIuZ2V0RmFjaWFsU2NvcmUoKSxuLnN1bkdsYXNzZXNTY29yZT10LmdldFN1bkdsYXNzZXNTY29yZSgpLHQuZGVsZXRlKCkpfXJldHVybiBudWxsIT09KGZhY2U9ci5nZXRGYWNlKCkpJiYobi5mYWNlPXt4OmZhY2UuWCx5OmZhY2UuWSx3aWR0aDpmYWNlLldpZHRoLGhlaWdodDpmYWNlLkhlaWdodH0pLG51bGwhPT0obGVmdEV5ZT1yLmdldExlZnRFeWUoKSkmJihuLmxlZnRFeWU9e3g6bGVmdEV5ZS5YLHk6bGVmdEV5ZS5ZfSksbnVsbCE9PShyaWdodEV5ZT1yLmdldFJpZ2h0RXllKCkpJiYobi5yaWdodEV5ZT17eDpyaWdodEV5ZS5YLHk6cmlnaHRFeWUuWX0pLG59O2xldCByPSIiLG49MjtjbGFzcyBve3N0YXRpYyBwcmludERlYnVnKC4uLmUpezA+PW4mJmNvbnNvbGUuZGVidWcoYDxEPiBbJHtyfV0gJHtlfWApfXN0YXRpYyBwcmludEluZm8oLi4uZSl7MT49biYmY29uc29sZS5kZWJ1ZyhgPEk+IFske3J9XSAke2V9YCl9c3RhdGljIHByaW50V2FybmluZyguLi5lKXsyPj1uJiZjb25zb2xlLndhcm4oYDxXPiBbJHtyfV0gJHtlfWApfXN0YXRpYyBwcmludEVycm9yKC4uLmUpezM+PW4mJmNvbnNvbGUuZXJyb3IoYDxFPiBbJHtyfV0gJHtlfWApfXN0YXRpYyBzZXRMb2dnZXJMZXZlbChlKXtuPWV9c3RhdGljIHNldExvZ2dlclRhZyhlKXtyPWV9fXZhciBhLGk9KGE9InVuZGVmaW5lZCIhPXR5cGVvZiBkb2N1bWVudCYmZG9jdW1lbnQuY3VycmVudFNjcmlwdD9kb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYzp2b2lkIDAsZnVuY3Rpb24oZSl7dmFyIHQscjsoZT12b2lkIDAhPT0oZT1lfHx7fSk/ZTp7fSkucmVhZHk9bmV3IFByb21pc2UoKGZ1bmN0aW9uKGUsbil7dD1lLHI9bn0pKTt2YXIgbixvLGk9T2JqZWN0LmFzc2lnbih7fSxlKSxzPVtdLHU9Ii4vdGhpcy5wcm9ncmFtIixjPSIiOyJ1bmRlZmluZWQiIT10eXBlb2YgZG9jdW1lbnQmJmRvY3VtZW50LmN1cnJlbnRTY3JpcHQmJihjPWRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjKSxhJiYoYz1hKSxjPTAhPT1jLmluZGV4T2YoImJsb2I6Iik/Yy5zdWJzdHIoMCxjLnJlcGxhY2UoL1s/I10uKi8sIiIpLmxhc3RJbmRleE9mKCIvIikrMSk6IiIsbj1lPT57dmFyIHQ9bmV3IFhNTEh0dHBSZXF1ZXN0O3JldHVybiB0Lm9wZW4oIkdFVCIsZSwhMSksdC5zZW5kKG51bGwpLHQucmVzcG9uc2VUZXh0fSxvPShlLHQscik9Pnt2YXIgbj1uZXcgWE1MSHR0cFJlcXVlc3Q7bi5vcGVuKCJHRVQiLGUsITApLG4ucmVzcG9uc2VUeXBlPSJhcnJheWJ1ZmZlciIsbi5vbmxvYWQ9KCk9PnsyMDA9PW4uc3RhdHVzfHwwPT1uLnN0YXR1cyYmbi5yZXNwb25zZT90KG4ucmVzcG9uc2UpOnIoKX0sbi5vbmVycm9yPXIsbi5zZW5kKG51bGwpfTt2YXIgbD1lLnByaW50fHxjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUpLGQ9ZS5wcmludEVycnx8Y29uc29sZS53YXJuLmJpbmQoY29uc29sZSk7T2JqZWN0LmFzc2lnbihlLGkpLGk9bnVsbCxlLmFyZ3VtZW50cyYmKHM9ZS5hcmd1bWVudHMpLGUudGhpc1Byb2dyYW0mJih1PWUudGhpc1Byb2dyYW0pLGUucXVpdCYmZS5xdWl0O3ZhciBmO2Uud2FzbUJpbmFyeSYmKGY9ZS53YXNtQmluYXJ5KSxlLm5vRXhpdFJ1bnRpbWUsIm9iamVjdCIhPXR5cGVvZiBXZWJBc3NlbWJseSYmTCgibm8gbmF0aXZlIHdhc20gc3VwcG9ydCBkZXRlY3RlZCIpO3ZhciBwPSExO2Z1bmN0aW9uIGgoZSx0KXtlfHxMKHQpfXZhciBtLHYseSxnLHcsRSxfLGIsayxQPSJ1bmRlZmluZWQiIT10eXBlb2YgVGV4dERlY29kZXI/bmV3IFRleHREZWNvZGVyKCJ1dGY4Iik6dm9pZCAwO2Z1bmN0aW9uIFQoZSx0LHIpe2Zvcih2YXIgbj10K3Isbz10O2Vbb10mJiEobz49bik7KSsrbztpZihvLXQ+MTYmJmUuYnVmZmVyJiZQKXJldHVybiBQLmRlY29kZShlLnN1YmFycmF5KHQsbykpO2Zvcih2YXIgYT0iIjt0PG87KXt2YXIgaT1lW3QrK107aWYoMTI4Jmkpe3ZhciBzPTYzJmVbdCsrXTtpZigxOTIhPSgyMjQmaSkpe3ZhciB1PTYzJmVbdCsrXTtpZigoaT0yMjQ9PSgyNDAmaSk/KDE1JmkpPDwxMnxzPDw2fHU6KDcmaSk8PDE4fHM8PDEyfHU8PDZ8NjMmZVt0KytdKTw2NTUzNilhKz1TdHJpbmcuZnJvbUNoYXJDb2RlKGkpO2Vsc2V7dmFyIGM9aS02NTUzNjthKz1TdHJpbmcuZnJvbUNoYXJDb2RlKDU1Mjk2fGM+PjEwLDU2MzIwfDEwMjMmYyl9fWVsc2UgYSs9U3RyaW5nLmZyb21DaGFyQ29kZSgoMzEmaSk8PDZ8cyl9ZWxzZSBhKz1TdHJpbmcuZnJvbUNoYXJDb2RlKGkpfXJldHVybiBhfWZ1bmN0aW9uIFMoZSx0KXtyZXR1cm4gZT9UKHksZSx0KToiIn1mdW5jdGlvbiBEKGUsdCxyLG4pe2lmKCEobj4wKSlyZXR1cm4gMDtmb3IodmFyIG89cixhPXIrbi0xLGk9MDtpPGUubGVuZ3RoOysraSl7dmFyIHM9ZS5jaGFyQ29kZUF0KGkpO2lmKHM+PTU1Mjk2JiZzPD01NzM0MyYmKHM9NjU1MzYrKCgxMDIzJnMpPDwxMCl8MTAyMyZlLmNoYXJDb2RlQXQoKytpKSksczw9MTI3KXtpZihyPj1hKWJyZWFrO3RbcisrXT1zfWVsc2UgaWYoczw9MjA0Nyl7aWYocisxPj1hKWJyZWFrO3RbcisrXT0xOTJ8cz4+Nix0W3IrK109MTI4fDYzJnN9ZWxzZSBpZihzPD02NTUzNSl7aWYocisyPj1hKWJyZWFrO3RbcisrXT0yMjR8cz4+MTIsdFtyKytdPTEyOHxzPj42JjYzLHRbcisrXT0xMjh8NjMmc31lbHNle2lmKHIrMz49YSlicmVhazt0W3IrK109MjQwfHM+PjE4LHRbcisrXT0xMjh8cz4+MTImNjMsdFtyKytdPTEyOHxzPj42JjYzLHRbcisrXT0xMjh8NjMmc319cmV0dXJuIHRbcl09MCxyLW99ZnVuY3Rpb24gQyhlKXtmb3IodmFyIHQ9MCxyPTA7cjxlLmxlbmd0aDsrK3Ipe3ZhciBuPWUuY2hhckNvZGVBdChyKTtuPD0xMjc/dCsrOm48PTIwNDc/dCs9MjpuPj01NTI5NiYmbjw9NTczNDM/KHQrPTQsKytyKTp0Kz0zfXJldHVybiB0fWUuSU5JVElBTF9NRU1PUlk7dmFyIEYsTSxBLCQseCxSPVtdLE89W10saj1bXSxJPTAsej1udWxsLE49bnVsbDtmdW5jdGlvbiBCKHQpe0krKyxlLm1vbml0b3JSdW5EZXBlbmRlbmNpZXMmJmUubW9uaXRvclJ1bkRlcGVuZGVuY2llcyhJKX1mdW5jdGlvbiBXKHQpe2lmKEktLSxlLm1vbml0b3JSdW5EZXBlbmRlbmNpZXMmJmUubW9uaXRvclJ1bkRlcGVuZGVuY2llcyhJKSwwPT1JJiYobnVsbCE9PXomJihjbGVhckludGVydmFsKHopLHo9bnVsbCksTikpe3ZhciByPU47Tj1udWxsLHIoKX19ZnVuY3Rpb24gTCh0KXtlLm9uQWJvcnQmJmUub25BYm9ydCh0KSxkKHQ9IkFib3J0ZWQoIit0KyIpIikscD0hMCx0Kz0iLiBCdWlsZCB3aXRoIC1zQVNTRVJUSU9OUyBmb3IgbW9yZSBpbmZvLiI7dmFyIG49bmV3IFdlYkFzc2VtYmx5LlJ1bnRpbWVFcnJvcih0KTt0aHJvdyByKG4pLG59ZnVuY3Rpb24gVSh0KXtmb3IoO3QubGVuZ3RoPjA7KXQuc2hpZnQoKShlKX0oTT0iRlBoaUV4dHJhY3Rvci53YXNtIikuc3RhcnRzV2l0aCgiZGF0YTphcHBsaWNhdGlvbi9vY3RldC1zdHJlYW07YmFzZTY0LCIpfHwoQT1NLE09ZS5sb2NhdGVGaWxlP2UubG9jYXRlRmlsZShBLGMpOmMrQSk7dmFyIEg9W10sVj0wLFk9MCxxPVtdO2Z1bmN0aW9uIEcoZSl7dmFyIHQ9cVtlXTtyZXR1cm4gdHx8KGU+PXEubGVuZ3RoJiYocS5sZW5ndGg9ZSsxKSxxW2VdPXQ9Ri5nZXQoZSkpLHR9ZnVuY3Rpb24gWChlKXt0aGlzLmV4Y1B0cj1lLHRoaXMucHRyPWUtMjQsdGhpcy5zZXRfdHlwZT1mdW5jdGlvbihlKXtfW3RoaXMucHRyKzQ+PjJdPWV9LHRoaXMuZ2V0X3R5cGU9ZnVuY3Rpb24oKXtyZXR1cm4gX1t0aGlzLnB0cis0Pj4yXX0sdGhpcy5zZXRfZGVzdHJ1Y3Rvcj1mdW5jdGlvbihlKXtfW3RoaXMucHRyKzg+PjJdPWV9LHRoaXMuZ2V0X2Rlc3RydWN0b3I9ZnVuY3Rpb24oKXtyZXR1cm4gX1t0aGlzLnB0cis4Pj4yXX0sdGhpcy5zZXRfcmVmY291bnQ9ZnVuY3Rpb24oZSl7RVt0aGlzLnB0cj4+Ml09ZX0sdGhpcy5zZXRfY2F1Z2h0PWZ1bmN0aW9uKGUpe2U9ZT8xOjAsdlt0aGlzLnB0cisxMj4+MF09ZX0sdGhpcy5nZXRfY2F1Z2h0PWZ1bmN0aW9uKCl7cmV0dXJuIDAhPXZbdGhpcy5wdHIrMTI+PjBdfSx0aGlzLnNldF9yZXRocm93bj1mdW5jdGlvbihlKXtlPWU/MTowLHZbdGhpcy5wdHIrMTM+PjBdPWV9LHRoaXMuZ2V0X3JldGhyb3duPWZ1bmN0aW9uKCl7cmV0dXJuIDAhPXZbdGhpcy5wdHIrMTM+PjBdfSx0aGlzLmluaXQ9ZnVuY3Rpb24oZSx0KXt0aGlzLnNldF9hZGp1c3RlZF9wdHIoMCksdGhpcy5zZXRfdHlwZShlKSx0aGlzLnNldF9kZXN0cnVjdG9yKHQpLHRoaXMuc2V0X3JlZmNvdW50KDApLHRoaXMuc2V0X2NhdWdodCghMSksdGhpcy5zZXRfcmV0aHJvd24oITEpfSx0aGlzLmFkZF9yZWY9ZnVuY3Rpb24oKXt2YXIgZT1FW3RoaXMucHRyPj4yXTtFW3RoaXMucHRyPj4yXT1lKzF9LHRoaXMucmVsZWFzZV9yZWY9ZnVuY3Rpb24oKXt2YXIgZT1FW3RoaXMucHRyPj4yXTtyZXR1cm4gRVt0aGlzLnB0cj4+Ml09ZS0xLDE9PT1lfSx0aGlzLnNldF9hZGp1c3RlZF9wdHI9ZnVuY3Rpb24oZSl7X1t0aGlzLnB0cisxNj4+Ml09ZX0sdGhpcy5nZXRfYWRqdXN0ZWRfcHRyPWZ1bmN0aW9uKCl7cmV0dXJuIF9bdGhpcy5wdHIrMTY+PjJdfSx0aGlzLmdldF9leGNlcHRpb25fcHRyPWZ1bmN0aW9uKCl7aWYoQnQodGhpcy5nZXRfdHlwZSgpKSlyZXR1cm4gX1t0aGlzLmV4Y1B0cj4+Ml07dmFyIGU9dGhpcy5nZXRfYWRqdXN0ZWRfcHRyKCk7cmV0dXJuIDAhPT1lP2U6dGhpcy5leGNQdHJ9fXZhciBKPSJUbyB1c2UgZGxvcGVuLCB5b3UgbmVlZCBlbmFibGUgZHluYW1pYyBsaW5raW5nLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2Vtc2NyaXB0ZW4tY29yZS9lbXNjcmlwdGVuL3dpa2kvTGlua2luZyIsSz17fTtmdW5jdGlvbiBRKGUpe2Zvcig7ZS5sZW5ndGg7KXt2YXIgdD1lLnBvcCgpO2UucG9wKCkodCl9fWZ1bmN0aW9uIFooZSl7cmV0dXJuIHRoaXMuZnJvbVdpcmVUeXBlKEVbZT4+Ml0pfXZhciBlZT17fSx0ZT17fSxyZT17fSxuZT00OCxvZT01NztmdW5jdGlvbiBhZShlKXtpZih2b2lkIDA9PT1lKXJldHVybiJfdW5rbm93biI7dmFyIHQ9KGU9ZS5yZXBsYWNlKC9bXmEtekEtWjAtOV9dL2csIiQiKSkuY2hhckNvZGVBdCgwKTtyZXR1cm4gdD49bmUmJnQ8PW9lPyJfIitlOmV9ZnVuY3Rpb24gaWUoZSx0KXtyZXR1cm4gZT1hZShlKSxuZXcgRnVuY3Rpb24oImJvZHkiLCJyZXR1cm4gZnVuY3Rpb24gIitlKycoKSB7XG4gICAgInVzZSBzdHJpY3QiOyAgICByZXR1cm4gYm9keS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xufTtcbicpKHQpfWZ1bmN0aW9uIHNlKGUsdCl7dmFyIHI9aWUodCwoZnVuY3Rpb24oZSl7dGhpcy5uYW1lPXQsdGhpcy5tZXNzYWdlPWU7dmFyIHI9bmV3IEVycm9yKGUpLnN0YWNrO3ZvaWQgMCE9PXImJih0aGlzLnN0YWNrPXRoaXMudG9TdHJpbmcoKSsiXG4iK3IucmVwbGFjZSgvXkVycm9yKDpbXlxuXSopP1xuLywiIikpfSkpO3JldHVybiByLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGUucHJvdG90eXBlKSxyLnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj1yLHIucHJvdG90eXBlLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIHZvaWQgMD09PXRoaXMubWVzc2FnZT90aGlzLm5hbWU6dGhpcy5uYW1lKyI6ICIrdGhpcy5tZXNzYWdlfSxyfXZhciB1ZT12b2lkIDA7ZnVuY3Rpb24gY2UoZSl7dGhyb3cgbmV3IHVlKGUpfWZ1bmN0aW9uIGxlKGUsdCxyKXtmdW5jdGlvbiBuKHQpe3ZhciBuPXIodCk7bi5sZW5ndGghPT1lLmxlbmd0aCYmY2UoIk1pc21hdGNoZWQgdHlwZSBjb252ZXJ0ZXIgY291bnQiKTtmb3IodmFyIG89MDtvPGUubGVuZ3RoOysrbyl2ZShlW29dLG5bb10pfWUuZm9yRWFjaCgoZnVuY3Rpb24oZSl7cmVbZV09dH0pKTt2YXIgbz1uZXcgQXJyYXkodC5sZW5ndGgpLGE9W10saT0wO3QuZm9yRWFjaCgoKGUsdCk9Pnt0ZS5oYXNPd25Qcm9wZXJ0eShlKT9vW3RdPXRlW2VdOihhLnB1c2goZSksZWUuaGFzT3duUHJvcGVydHkoZSl8fChlZVtlXT1bXSksZWVbZV0ucHVzaCgoKCk9PntvW3RdPXRlW2VdLCsraT09PWEubGVuZ3RoJiZuKG8pfSkpKX0pKSwwPT09YS5sZW5ndGgmJm4obyl9ZnVuY3Rpb24gZGUoZSl7c3dpdGNoKGUpe2Nhc2UgMTpyZXR1cm4gMDtjYXNlIDI6cmV0dXJuIDE7Y2FzZSA0OnJldHVybiAyO2Nhc2UgODpyZXR1cm4gMztkZWZhdWx0OnRocm93IG5ldyBUeXBlRXJyb3IoIlVua25vd24gdHlwZSBzaXplOiAiK2UpfX12YXIgZmU9dm9pZCAwO2Z1bmN0aW9uIHBlKGUpe2Zvcih2YXIgdD0iIixyPWU7eVtyXTspdCs9ZmVbeVtyKytdXTtyZXR1cm4gdH12YXIgaGU9dm9pZCAwO2Z1bmN0aW9uIG1lKGUpe3Rocm93IG5ldyBoZShlKX1mdW5jdGlvbiB2ZShlLHQscj17fSl7aWYoISgiYXJnUGFja0FkdmFuY2UiaW4gdCkpdGhyb3cgbmV3IFR5cGVFcnJvcigicmVnaXN0ZXJUeXBlIHJlZ2lzdGVyZWRJbnN0YW5jZSByZXF1aXJlcyBhcmdQYWNrQWR2YW5jZSIpO3ZhciBuPXQubmFtZTtpZihlfHxtZSgndHlwZSAiJytuKyciIG11c3QgaGF2ZSBhIHBvc2l0aXZlIGludGVnZXIgdHlwZWlkIHBvaW50ZXInKSx0ZS5oYXNPd25Qcm9wZXJ0eShlKSl7aWYoci5pZ25vcmVEdXBsaWNhdGVSZWdpc3RyYXRpb25zKXJldHVybjttZSgiQ2Fubm90IHJlZ2lzdGVyIHR5cGUgJyIrbisiJyB0d2ljZSIpfWlmKHRlW2VdPXQsZGVsZXRlIHJlW2VdLGVlLmhhc093blByb3BlcnR5KGUpKXt2YXIgbz1lZVtlXTtkZWxldGUgZWVbZV0sby5mb3JFYWNoKChlPT5lKCkpKX19ZnVuY3Rpb24geWUoZSl7bWUoZS4kJC5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcy5uYW1lKyIgaW5zdGFuY2UgYWxyZWFkeSBkZWxldGVkIil9dmFyIGdlPSExO2Z1bmN0aW9uIHdlKGUpe31mdW5jdGlvbiBFZShlKXtlLmNvdW50LnZhbHVlLT0xLDA9PT1lLmNvdW50LnZhbHVlJiZmdW5jdGlvbihlKXtlLnNtYXJ0UHRyP2Uuc21hcnRQdHJUeXBlLnJhd0Rlc3RydWN0b3IoZS5zbWFydFB0cik6ZS5wdHJUeXBlLnJlZ2lzdGVyZWRDbGFzcy5yYXdEZXN0cnVjdG9yKGUucHRyKX0oZSl9ZnVuY3Rpb24gX2UoZSx0LHIpe2lmKHQ9PT1yKXJldHVybiBlO2lmKHZvaWQgMD09PXIuYmFzZUNsYXNzKXJldHVybiBudWxsO3ZhciBuPV9lKGUsdCxyLmJhc2VDbGFzcyk7cmV0dXJuIG51bGw9PT1uP251bGw6ci5kb3duY2FzdChuKX12YXIgYmU9e307dmFyIGtlPVtdO2Z1bmN0aW9uIFBlKCl7Zm9yKDtrZS5sZW5ndGg7KXt2YXIgZT1rZS5wb3AoKTtlLiQkLmRlbGV0ZVNjaGVkdWxlZD0hMSxlLmRlbGV0ZSgpfX12YXIgVGU9dm9pZCAwO3ZhciBTZT17fTtmdW5jdGlvbiBEZShlLHQpe3JldHVybiB0LnB0clR5cGUmJnQucHRyfHxjZSgibWFrZUNsYXNzSGFuZGxlIHJlcXVpcmVzIHB0ciBhbmQgcHRyVHlwZSIpLCEhdC5zbWFydFB0clR5cGUhPSEhdC5zbWFydFB0ciYmY2UoIkJvdGggc21hcnRQdHJUeXBlIGFuZCBzbWFydFB0ciBtdXN0IGJlIHNwZWNpZmllZCIpLHQuY291bnQ9e3ZhbHVlOjF9LENlKE9iamVjdC5jcmVhdGUoZSx7JCQ6e3ZhbHVlOnR9fSkpfWZ1bmN0aW9uIENlKGUpe3JldHVybiJ1bmRlZmluZWQiPT10eXBlb2YgRmluYWxpemF0aW9uUmVnaXN0cnk/KENlPWU9PmUsZSk6KGdlPW5ldyBGaW5hbGl6YXRpb25SZWdpc3RyeSgoZT0+e0VlKGUuJCQpfSkpLENlPWU9Pnt2YXIgdD1lLiQkO2lmKHQuc21hcnRQdHIpe3ZhciByPXskJDp0fTtnZS5yZWdpc3RlcihlLHIsZSl9cmV0dXJuIGV9LHdlPWU9PmdlLnVucmVnaXN0ZXIoZSksQ2UoZSkpfWZ1bmN0aW9uIEZlKCl7fWZ1bmN0aW9uIE1lKGUsdCxyKXtpZih2b2lkIDA9PT1lW3RdLm92ZXJsb2FkVGFibGUpe3ZhciBuPWVbdF07ZVt0XT1mdW5jdGlvbigpe3JldHVybiBlW3RdLm92ZXJsb2FkVGFibGUuaGFzT3duUHJvcGVydHkoYXJndW1lbnRzLmxlbmd0aCl8fG1lKCJGdW5jdGlvbiAnIityKyInIGNhbGxlZCB3aXRoIGFuIGludmFsaWQgbnVtYmVyIG9mIGFyZ3VtZW50cyAoIithcmd1bWVudHMubGVuZ3RoKyIpIC0gZXhwZWN0cyBvbmUgb2YgKCIrZVt0XS5vdmVybG9hZFRhYmxlKyIpISIpLGVbdF0ub3ZlcmxvYWRUYWJsZVthcmd1bWVudHMubGVuZ3RoXS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LGVbdF0ub3ZlcmxvYWRUYWJsZT1bXSxlW3RdLm92ZXJsb2FkVGFibGVbbi5hcmdDb3VudF09bn19ZnVuY3Rpb24gQWUodCxyLG4pe2UuaGFzT3duUHJvcGVydHkodCk/KCh2b2lkIDA9PT1ufHx2b2lkIDAhPT1lW3RdLm92ZXJsb2FkVGFibGUmJnZvaWQgMCE9PWVbdF0ub3ZlcmxvYWRUYWJsZVtuXSkmJm1lKCJDYW5ub3QgcmVnaXN0ZXIgcHVibGljIG5hbWUgJyIrdCsiJyB0d2ljZSIpLE1lKGUsdCx0KSxlLmhhc093blByb3BlcnR5KG4pJiZtZSgiQ2Fubm90IHJlZ2lzdGVyIG11bHRpcGxlIG92ZXJsb2FkcyBvZiBhIGZ1bmN0aW9uIHdpdGggdGhlIHNhbWUgbnVtYmVyIG9mIGFyZ3VtZW50cyAoIituKyIpISIpLGVbdF0ub3ZlcmxvYWRUYWJsZVtuXT1yKTooZVt0XT1yLHZvaWQgMCE9PW4mJihlW3RdLm51bUFyZ3VtZW50cz1uKSl9ZnVuY3Rpb24gJGUoZSx0LHIsbixvLGEsaSxzKXt0aGlzLm5hbWU9ZSx0aGlzLmNvbnN0cnVjdG9yPXQsdGhpcy5pbnN0YW5jZVByb3RvdHlwZT1yLHRoaXMucmF3RGVzdHJ1Y3Rvcj1uLHRoaXMuYmFzZUNsYXNzPW8sdGhpcy5nZXRBY3R1YWxUeXBlPWEsdGhpcy51cGNhc3Q9aSx0aGlzLmRvd25jYXN0PXMsdGhpcy5wdXJlVmlydHVhbEZ1bmN0aW9ucz1bXX1mdW5jdGlvbiB4ZShlLHQscil7Zm9yKDt0IT09cjspdC51cGNhc3R8fG1lKCJFeHBlY3RlZCBudWxsIG9yIGluc3RhbmNlIG9mICIrci5uYW1lKyIsIGdvdCBhbiBpbnN0YW5jZSBvZiAiK3QubmFtZSksZT10LnVwY2FzdChlKSx0PXQuYmFzZUNsYXNzO3JldHVybiBlfWZ1bmN0aW9uIFJlKGUsdCl7aWYobnVsbD09PXQpcmV0dXJuIHRoaXMuaXNSZWZlcmVuY2UmJm1lKCJudWxsIGlzIG5vdCBhIHZhbGlkICIrdGhpcy5uYW1lKSwwO3QuJCR8fG1lKCdDYW5ub3QgcGFzcyAiJytRZSh0KSsnIiBhcyBhICcrdGhpcy5uYW1lKSx0LiQkLnB0cnx8bWUoIkNhbm5vdCBwYXNzIGRlbGV0ZWQgb2JqZWN0IGFzIGEgcG9pbnRlciBvZiB0eXBlICIrdGhpcy5uYW1lKTt2YXIgcj10LiQkLnB0clR5cGUucmVnaXN0ZXJlZENsYXNzO3JldHVybiB4ZSh0LiQkLnB0cixyLHRoaXMucmVnaXN0ZXJlZENsYXNzKX1mdW5jdGlvbiBPZShlLHQpe3ZhciByO2lmKG51bGw9PT10KXJldHVybiB0aGlzLmlzUmVmZXJlbmNlJiZtZSgibnVsbCBpcyBub3QgYSB2YWxpZCAiK3RoaXMubmFtZSksdGhpcy5pc1NtYXJ0UG9pbnRlcj8ocj10aGlzLnJhd0NvbnN0cnVjdG9yKCksbnVsbCE9PWUmJmUucHVzaCh0aGlzLnJhd0Rlc3RydWN0b3Iscikscik6MDt0LiQkfHxtZSgnQ2Fubm90IHBhc3MgIicrUWUodCkrJyIgYXMgYSAnK3RoaXMubmFtZSksdC4kJC5wdHJ8fG1lKCJDYW5ub3QgcGFzcyBkZWxldGVkIG9iamVjdCBhcyBhIHBvaW50ZXIgb2YgdHlwZSAiK3RoaXMubmFtZSksIXRoaXMuaXNDb25zdCYmdC4kJC5wdHJUeXBlLmlzQ29uc3QmJm1lKCJDYW5ub3QgY29udmVydCBhcmd1bWVudCBvZiB0eXBlICIrKHQuJCQuc21hcnRQdHJUeXBlP3QuJCQuc21hcnRQdHJUeXBlLm5hbWU6dC4kJC5wdHJUeXBlLm5hbWUpKyIgdG8gcGFyYW1ldGVyIHR5cGUgIit0aGlzLm5hbWUpO3ZhciBuPXQuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3M7aWYocj14ZSh0LiQkLnB0cixuLHRoaXMucmVnaXN0ZXJlZENsYXNzKSx0aGlzLmlzU21hcnRQb2ludGVyKXN3aXRjaCh2b2lkIDA9PT10LiQkLnNtYXJ0UHRyJiZtZSgiUGFzc2luZyByYXcgcG9pbnRlciB0byBzbWFydCBwb2ludGVyIGlzIGlsbGVnYWwiKSx0aGlzLnNoYXJpbmdQb2xpY3kpe2Nhc2UgMDp0LiQkLnNtYXJ0UHRyVHlwZT09PXRoaXM/cj10LiQkLnNtYXJ0UHRyOm1lKCJDYW5ub3QgY29udmVydCBhcmd1bWVudCBvZiB0eXBlICIrKHQuJCQuc21hcnRQdHJUeXBlP3QuJCQuc21hcnRQdHJUeXBlLm5hbWU6dC4kJC5wdHJUeXBlLm5hbWUpKyIgdG8gcGFyYW1ldGVyIHR5cGUgIit0aGlzLm5hbWUpO2JyZWFrO2Nhc2UgMTpyPXQuJCQuc21hcnRQdHI7YnJlYWs7Y2FzZSAyOmlmKHQuJCQuc21hcnRQdHJUeXBlPT09dGhpcylyPXQuJCQuc21hcnRQdHI7ZWxzZXt2YXIgbz10LmNsb25lKCk7cj10aGlzLnJhd1NoYXJlKHIsWGUudG9IYW5kbGUoKGZ1bmN0aW9uKCl7by5kZWxldGUoKX0pKSksbnVsbCE9PWUmJmUucHVzaCh0aGlzLnJhd0Rlc3RydWN0b3Iscil9YnJlYWs7ZGVmYXVsdDptZSgiVW5zdXBwb3J0aW5nIHNoYXJpbmcgcG9saWN5Iil9cmV0dXJuIHJ9ZnVuY3Rpb24gamUoZSx0KXtpZihudWxsPT09dClyZXR1cm4gdGhpcy5pc1JlZmVyZW5jZSYmbWUoIm51bGwgaXMgbm90IGEgdmFsaWQgIit0aGlzLm5hbWUpLDA7dC4kJHx8bWUoJ0Nhbm5vdCBwYXNzICInK1FlKHQpKyciIGFzIGEgJyt0aGlzLm5hbWUpLHQuJCQucHRyfHxtZSgiQ2Fubm90IHBhc3MgZGVsZXRlZCBvYmplY3QgYXMgYSBwb2ludGVyIG9mIHR5cGUgIit0aGlzLm5hbWUpLHQuJCQucHRyVHlwZS5pc0NvbnN0JiZtZSgiQ2Fubm90IGNvbnZlcnQgYXJndW1lbnQgb2YgdHlwZSAiK3QuJCQucHRyVHlwZS5uYW1lKyIgdG8gcGFyYW1ldGVyIHR5cGUgIit0aGlzLm5hbWUpO3ZhciByPXQuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3M7cmV0dXJuIHhlKHQuJCQucHRyLHIsdGhpcy5yZWdpc3RlcmVkQ2xhc3MpfWZ1bmN0aW9uIEllKGUsdCxyLG4sbyxhLGkscyx1LGMsbCl7dGhpcy5uYW1lPWUsdGhpcy5yZWdpc3RlcmVkQ2xhc3M9dCx0aGlzLmlzUmVmZXJlbmNlPXIsdGhpcy5pc0NvbnN0PW4sdGhpcy5pc1NtYXJ0UG9pbnRlcj1vLHRoaXMucG9pbnRlZVR5cGU9YSx0aGlzLnNoYXJpbmdQb2xpY3k9aSx0aGlzLnJhd0dldFBvaW50ZWU9cyx0aGlzLnJhd0NvbnN0cnVjdG9yPXUsdGhpcy5yYXdTaGFyZT1jLHRoaXMucmF3RGVzdHJ1Y3Rvcj1sLG98fHZvaWQgMCE9PXQuYmFzZUNsYXNzP3RoaXMudG9XaXJlVHlwZT1PZTpuPyh0aGlzLnRvV2lyZVR5cGU9UmUsdGhpcy5kZXN0cnVjdG9yRnVuY3Rpb249bnVsbCk6KHRoaXMudG9XaXJlVHlwZT1qZSx0aGlzLmRlc3RydWN0b3JGdW5jdGlvbj1udWxsKX1mdW5jdGlvbiB6ZSh0LHIsbil7ZS5oYXNPd25Qcm9wZXJ0eSh0KXx8Y2UoIlJlcGxhY2luZyBub25leGlzdGFudCBwdWJsaWMgc3ltYm9sIiksdm9pZCAwIT09ZVt0XS5vdmVybG9hZFRhYmxlJiZ2b2lkIDAhPT1uP2VbdF0ub3ZlcmxvYWRUYWJsZVtuXT1yOihlW3RdPXIsZVt0XS5hcmdDb3VudD1uKX1mdW5jdGlvbiBOZSh0LHIpe3ZhciBuLG8sYSxpPSh0PXBlKHQpKS5pbmNsdWRlcygiaiIpPyhuPXQsbz1yLGE9W10sZnVuY3Rpb24oKXtyZXR1cm4gYS5sZW5ndGg9MCxPYmplY3QuYXNzaWduKGEsYXJndW1lbnRzKSxmdW5jdGlvbih0LHIsbil7cmV0dXJuIHQuaW5jbHVkZXMoImoiKT9mdW5jdGlvbih0LHIsbil7dmFyIG89ZVsiZHluQ2FsbF8iK3RdO3JldHVybiBuJiZuLmxlbmd0aD9vLmFwcGx5KG51bGwsW3JdLmNvbmNhdChuKSk6by5jYWxsKG51bGwscil9KHQscixuKTpHKHIpLmFwcGx5KG51bGwsbil9KG4sbyxhKX0pOkcocik7cmV0dXJuImZ1bmN0aW9uIiE9dHlwZW9mIGkmJm1lKCJ1bmtub3duIGZ1bmN0aW9uIHBvaW50ZXIgd2l0aCBzaWduYXR1cmUgIit0KyI6ICIrciksaX12YXIgQmU9dm9pZCAwO2Z1bmN0aW9uIFdlKGUpe3ZhciB0PSR0KGUpLHI9cGUodCk7cmV0dXJuIE10KHQpLHJ9ZnVuY3Rpb24gTGUoZSx0KXt2YXIgcj1bXSxuPXt9O3Rocm93IHQuZm9yRWFjaCgoZnVuY3Rpb24gZSh0KXtuW3RdfHx0ZVt0XXx8KHJlW3RdP3JlW3RdLmZvckVhY2goZSk6KHIucHVzaCh0KSxuW3RdPSEwKSl9KSksbmV3IEJlKGUrIjogIityLm1hcChXZSkuam9pbihbIiwgIl0pKX1mdW5jdGlvbiBVZShlLHQpe2lmKCEoZSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJuZXdfIGNhbGxlZCB3aXRoIGNvbnN0cnVjdG9yIHR5cGUgIit0eXBlb2YgZSsiIHdoaWNoIGlzIG5vdCBhIGZ1bmN0aW9uIik7dmFyIHI9aWUoZS5uYW1lfHwidW5rbm93bkZ1bmN0aW9uTmFtZSIsKGZ1bmN0aW9uKCl7fSkpO3IucHJvdG90eXBlPWUucHJvdG90eXBlO3ZhciBuPW5ldyByLG89ZS5hcHBseShuLHQpO3JldHVybiBvIGluc3RhbmNlb2YgT2JqZWN0P286bn1mdW5jdGlvbiBIZShlLHQscixuLG8pe3ZhciBhPXQubGVuZ3RoO2E8MiYmbWUoImFyZ1R5cGVzIGFycmF5IHNpemUgbWlzbWF0Y2ghIE11c3QgYXQgbGVhc3QgZ2V0IHJldHVybiB2YWx1ZSBhbmQgJ3RoaXMnIHR5cGVzISIpO2Zvcih2YXIgaT1udWxsIT09dFsxXSYmbnVsbCE9PXIscz0hMSx1PTE7dTx0Lmxlbmd0aDsrK3UpaWYobnVsbCE9PXRbdV0mJnZvaWQgMD09PXRbdV0uZGVzdHJ1Y3RvckZ1bmN0aW9uKXtzPSEwO2JyZWFrfXZhciBjPSJ2b2lkIiE9PXRbMF0ubmFtZSxsPSIiLGQ9IiI7Zm9yKHU9MDt1PGEtMjsrK3UpbCs9KDAhPT11PyIsICI6IiIpKyJhcmciK3UsZCs9KDAhPT11PyIsICI6IiIpKyJhcmciK3UrIldpcmVkIjt2YXIgZj0icmV0dXJuIGZ1bmN0aW9uICIrYWUoZSkrIigiK2wrIikge1xuaWYgKGFyZ3VtZW50cy5sZW5ndGggIT09ICIrKGEtMikrIikge1xudGhyb3dCaW5kaW5nRXJyb3IoJ2Z1bmN0aW9uICIrZSsiIGNhbGxlZCB3aXRoICcgKyBhcmd1bWVudHMubGVuZ3RoICsgJyBhcmd1bWVudHMsIGV4cGVjdGVkICIrKGEtMikrIiBhcmdzIScpO1xufVxuIjtzJiYoZis9InZhciBkZXN0cnVjdG9ycyA9IFtdO1xuIik7dmFyIHA9cz8iZGVzdHJ1Y3RvcnMiOiJudWxsIixoPVsidGhyb3dCaW5kaW5nRXJyb3IiLCJpbnZva2VyIiwiZm4iLCJydW5EZXN0cnVjdG9ycyIsInJldFR5cGUiLCJjbGFzc1BhcmFtIl0sbT1bbWUsbixvLFEsdFswXSx0WzFdXTtmb3IoaSYmKGYrPSJ2YXIgdGhpc1dpcmVkID0gY2xhc3NQYXJhbS50b1dpcmVUeXBlKCIrcCsiLCB0aGlzKTtcbiIpLHU9MDt1PGEtMjsrK3UpZis9InZhciBhcmciK3UrIldpcmVkID0gYXJnVHlwZSIrdSsiLnRvV2lyZVR5cGUoIitwKyIsIGFyZyIrdSsiKTsgLy8gIit0W3UrMl0ubmFtZSsiXG4iLGgucHVzaCgiYXJnVHlwZSIrdSksbS5wdXNoKHRbdSsyXSk7aWYoaSYmKGQ9InRoaXNXaXJlZCIrKGQubGVuZ3RoPjA/IiwgIjoiIikrZCksZis9KGM/InZhciBydiA9ICI6IiIpKyJpbnZva2VyKGZuIisoZC5sZW5ndGg+MD8iLCAiOiIiKStkKyIpO1xuIixzKWYrPSJydW5EZXN0cnVjdG9ycyhkZXN0cnVjdG9ycyk7XG4iO2Vsc2UgZm9yKHU9aT8xOjI7dTx0Lmxlbmd0aDsrK3Upe3ZhciB2PTE9PT11PyJ0aGlzV2lyZWQiOiJhcmciKyh1LTIpKyJXaXJlZCI7bnVsbCE9PXRbdV0uZGVzdHJ1Y3RvckZ1bmN0aW9uJiYoZis9disiX2R0b3IoIit2KyIpOyAvLyAiK3RbdV0ubmFtZSsiXG4iLGgucHVzaCh2KyJfZHRvciIpLG0ucHVzaCh0W3VdLmRlc3RydWN0b3JGdW5jdGlvbikpfXJldHVybiBjJiYoZis9InZhciByZXQgPSByZXRUeXBlLmZyb21XaXJlVHlwZShydik7XG5yZXR1cm4gcmV0O1xuIiksZis9In1cbiIsaC5wdXNoKGYpLFVlKEZ1bmN0aW9uLGgpLmFwcGx5KG51bGwsbSl9ZnVuY3Rpb24gVmUoZSx0KXtmb3IodmFyIHI9W10sbj0wO248ZTtuKyspci5wdXNoKF9bdCs0Km4+PjJdKTtyZXR1cm4gcn12YXIgWWU9W10scWU9W3t9LHt2YWx1ZTp2b2lkIDB9LHt2YWx1ZTpudWxsfSx7dmFsdWU6ITB9LHt2YWx1ZTohMX1dO2Z1bmN0aW9uIEdlKGUpe2U+NCYmMD09LS1xZVtlXS5yZWZjb3VudCYmKHFlW2VdPXZvaWQgMCxZZS5wdXNoKGUpKX12YXIgWGU9e3RvVmFsdWU6ZT0+KGV8fG1lKCJDYW5ub3QgdXNlIGRlbGV0ZWQgdmFsLiBoYW5kbGUgPSAiK2UpLHFlW2VdLnZhbHVlKSx0b0hhbmRsZTplPT57c3dpdGNoKGUpe2Nhc2Ugdm9pZCAwOnJldHVybiAxO2Nhc2UgbnVsbDpyZXR1cm4gMjtjYXNlITA6cmV0dXJuIDM7Y2FzZSExOnJldHVybiA0O2RlZmF1bHQ6dmFyIHQ9WWUubGVuZ3RoP1llLnBvcCgpOnFlLmxlbmd0aDtyZXR1cm4gcWVbdF09e3JlZmNvdW50OjEsdmFsdWU6ZX0sdH19fTtmdW5jdGlvbiBKZShlLHQscil7c3dpdGNoKHQpe2Nhc2UgMDpyZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHQ9cj92Onk7cmV0dXJuIHRoaXMuZnJvbVdpcmVUeXBlKHRbZV0pfTtjYXNlIDE6cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciB0PXI/Zzp3O3JldHVybiB0aGlzLmZyb21XaXJlVHlwZSh0W2U+PjFdKX07Y2FzZSAyOnJldHVybiBmdW5jdGlvbihlKXt2YXIgdD1yP0U6XztyZXR1cm4gdGhpcy5mcm9tV2lyZVR5cGUodFtlPj4yXSl9O2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBpbnRlZ2VyIHR5cGU6ICIrZSl9fWZ1bmN0aW9uIEtlKGUsdCl7dmFyIHI9dGVbZV07cmV0dXJuIHZvaWQgMD09PXImJm1lKHQrIiBoYXMgdW5rbm93biB0eXBlICIrV2UoZSkpLHJ9ZnVuY3Rpb24gUWUoZSl7aWYobnVsbD09PWUpcmV0dXJuIm51bGwiO3ZhciB0PXR5cGVvZiBlO3JldHVybiJvYmplY3QiPT09dHx8ImFycmF5Ij09PXR8fCJmdW5jdGlvbiI9PT10P2UudG9TdHJpbmcoKToiIitlfWZ1bmN0aW9uIFplKGUsdCl7c3dpdGNoKHQpe2Nhc2UgMjpyZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZnJvbVdpcmVUeXBlKGJbZT4+Ml0pfTtjYXNlIDM6cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmZyb21XaXJlVHlwZShrW2U+PjNdKX07ZGVmYXVsdDp0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGZsb2F0IHR5cGU6ICIrZSl9fWZ1bmN0aW9uIGV0KGUsdCxyKXtzd2l0Y2godCl7Y2FzZSAwOnJldHVybiByP2Z1bmN0aW9uKGUpe3JldHVybiB2W2VdfTpmdW5jdGlvbihlKXtyZXR1cm4geVtlXX07Y2FzZSAxOnJldHVybiByP2Z1bmN0aW9uKGUpe3JldHVybiBnW2U+PjFdfTpmdW5jdGlvbihlKXtyZXR1cm4gd1tlPj4xXX07Y2FzZSAyOnJldHVybiByP2Z1bmN0aW9uKGUpe3JldHVybiBFW2U+PjJdfTpmdW5jdGlvbihlKXtyZXR1cm4gX1tlPj4yXX07ZGVmYXVsdDp0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIGludGVnZXIgdHlwZTogIitlKX19dmFyIHR0PSJ1bmRlZmluZWQiIT10eXBlb2YgVGV4dERlY29kZXI/bmV3IFRleHREZWNvZGVyKCJ1dGYtMTZsZSIpOnZvaWQgMDtmdW5jdGlvbiBydChlLHQpe2Zvcih2YXIgcj1lLG49cj4+MSxvPW4rdC8yOyEobj49bykmJndbbl07KSsrbjtpZigocj1uPDwxKS1lPjMyJiZ0dClyZXR1cm4gdHQuZGVjb2RlKHkuc3ViYXJyYXkoZSxyKSk7Zm9yKHZhciBhPSIiLGk9MDshKGk+PXQvMik7KytpKXt2YXIgcz1nW2UrMippPj4xXTtpZigwPT1zKWJyZWFrO2ErPVN0cmluZy5mcm9tQ2hhckNvZGUocyl9cmV0dXJuIGF9ZnVuY3Rpb24gbnQoZSx0LHIpe2lmKHZvaWQgMD09PXImJihyPTIxNDc0ODM2NDcpLHI8MilyZXR1cm4gMDtmb3IodmFyIG49dCxvPShyLT0yKTwyKmUubGVuZ3RoP3IvMjplLmxlbmd0aCxhPTA7YTxvOysrYSl7dmFyIGk9ZS5jaGFyQ29kZUF0KGEpO2dbdD4+MV09aSx0Kz0yfXJldHVybiBnW3Q+PjFdPTAsdC1ufWZ1bmN0aW9uIG90KGUpe3JldHVybiAyKmUubGVuZ3RofWZ1bmN0aW9uIGF0KGUsdCl7Zm9yKHZhciByPTAsbj0iIjshKHI+PXQvNCk7KXt2YXIgbz1FW2UrNCpyPj4yXTtpZigwPT1vKWJyZWFrO2lmKCsrcixvPj02NTUzNil7dmFyIGE9by02NTUzNjtuKz1TdHJpbmcuZnJvbUNoYXJDb2RlKDU1Mjk2fGE+PjEwLDU2MzIwfDEwMjMmYSl9ZWxzZSBuKz1TdHJpbmcuZnJvbUNoYXJDb2RlKG8pfXJldHVybiBufWZ1bmN0aW9uIGl0KGUsdCxyKXtpZih2b2lkIDA9PT1yJiYocj0yMTQ3NDgzNjQ3KSxyPDQpcmV0dXJuIDA7Zm9yKHZhciBuPXQsbz1uK3ItNCxhPTA7YTxlLmxlbmd0aDsrK2Epe3ZhciBpPWUuY2hhckNvZGVBdChhKTtpZihpPj01NTI5NiYmaTw9NTczNDMmJihpPTY1NTM2KygoMTAyMyZpKTw8MTApfDEwMjMmZS5jaGFyQ29kZUF0KCsrYSkpLEVbdD4+Ml09aSwodCs9NCkrND5vKWJyZWFrfXJldHVybiBFW3Q+PjJdPTAsdC1ufWZ1bmN0aW9uIHN0KGUpe2Zvcih2YXIgdD0wLHI9MDtyPGUubGVuZ3RoOysrcil7dmFyIG49ZS5jaGFyQ29kZUF0KHIpO24+PTU1Mjk2JiZuPD01NzM0MyYmKytyLHQrPTR9cmV0dXJuIHR9dmFyIHV0PXt9O2Z1bmN0aW9uIGN0KGUpe3ZhciB0PXV0W2VdO3JldHVybiB2b2lkIDA9PT10P3BlKGUpOnR9dmFyIGx0LGR0PVtdLGZ0PVtdO2x0PSgpPT5wZXJmb3JtYW5jZS5ub3coKTt2YXIgcHQ9e307ZnVuY3Rpb24gaHQoKXtpZighaHQuc3RyaW5ncyl7dmFyIGU9e1VTRVI6IndlYl91c2VyIixMT0dOQU1FOiJ3ZWJfdXNlciIsUEFUSDoiLyIsUFdEOiIvIixIT01FOiIvaG9tZS93ZWJfdXNlciIsTEFORzooIm9iamVjdCI9PXR5cGVvZiBuYXZpZ2F0b3ImJm5hdmlnYXRvci5sYW5ndWFnZXMmJm5hdmlnYXRvci5sYW5ndWFnZXNbMF18fCJDIikucmVwbGFjZSgiLSIsIl8iKSsiLlVURi04IixfOnV8fCIuL3RoaXMucHJvZ3JhbSJ9O2Zvcih2YXIgdCBpbiBwdCl2b2lkIDA9PT1wdFt0XT9kZWxldGUgZVt0XTplW3RdPXB0W3RdO3ZhciByPVtdO2Zvcih2YXIgdCBpbiBlKXIucHVzaCh0KyI9IitlW3RdKTtodC5zdHJpbmdzPXJ9cmV0dXJuIGh0LnN0cmluZ3N9dmFyIG10PXtpc0FiczplPT4iLyI9PT1lLmNoYXJBdCgwKSxzcGxpdFBhdGg6ZT0+L14oXC8/fCkoW1xzXFNdKj8pKCg/OlwuezEsMn18W15cL10rP3wpKFwuW14uXC9dKnwpKSg/OltcL10qKSQvLmV4ZWMoZSkuc2xpY2UoMSksbm9ybWFsaXplQXJyYXk6KGUsdCk9Pntmb3IodmFyIHI9MCxuPWUubGVuZ3RoLTE7bj49MDtuLS0pe3ZhciBvPWVbbl07Ii4iPT09bz9lLnNwbGljZShuLDEpOiIuLiI9PT1vPyhlLnNwbGljZShuLDEpLHIrKyk6ciYmKGUuc3BsaWNlKG4sMSksci0tKX1pZih0KWZvcig7cjtyLS0pZS51bnNoaWZ0KCIuLiIpO3JldHVybiBlfSxub3JtYWxpemU6ZT0+e3ZhciB0PW10LmlzQWJzKGUpLHI9Ii8iPT09ZS5zdWJzdHIoLTEpO3JldHVybihlPW10Lm5vcm1hbGl6ZUFycmF5KGUuc3BsaXQoIi8iKS5maWx0ZXIoKGU9PiEhZSkpLCF0KS5qb2luKCIvIikpfHx0fHwoZT0iLiIpLGUmJnImJihlKz0iLyIpLCh0PyIvIjoiIikrZX0sZGlybmFtZTplPT57dmFyIHQ9bXQuc3BsaXRQYXRoKGUpLHI9dFswXSxuPXRbMV07cmV0dXJuIHJ8fG4/KG4mJihuPW4uc3Vic3RyKDAsbi5sZW5ndGgtMSkpLHIrbik6Ii4ifSxiYXNlbmFtZTplPT57aWYoIi8iPT09ZSlyZXR1cm4iLyI7dmFyIHQ9KGU9KGU9bXQubm9ybWFsaXplKGUpKS5yZXBsYWNlKC9cLyQvLCIiKSkubGFzdEluZGV4T2YoIi8iKTtyZXR1cm4tMT09PXQ/ZTplLnN1YnN0cih0KzEpfSxqb2luOmZ1bmN0aW9uKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtyZXR1cm4gbXQubm9ybWFsaXplKGUuam9pbigiLyIpKX0sam9pbjI6KGUsdCk9Pm10Lm5vcm1hbGl6ZShlKyIvIit0KX0sdnQ9e3Jlc29sdmU6ZnVuY3Rpb24oKXtmb3IodmFyIGU9IiIsdD0hMSxyPWFyZ3VtZW50cy5sZW5ndGgtMTtyPj0tMSYmIXQ7ci0tKXt2YXIgbj1yPj0wP2FyZ3VtZW50c1tyXTpfdC5jd2QoKTtpZigic3RyaW5nIiE9dHlwZW9mIG4pdGhyb3cgbmV3IFR5cGVFcnJvcigiQXJndW1lbnRzIHRvIHBhdGgucmVzb2x2ZSBtdXN0IGJlIHN0cmluZ3MiKTtpZighbilyZXR1cm4iIjtlPW4rIi8iK2UsdD1tdC5pc0FicyhuKX1yZXR1cm4odD8iLyI6IiIpKyhlPW10Lm5vcm1hbGl6ZUFycmF5KGUuc3BsaXQoIi8iKS5maWx0ZXIoKGU9PiEhZSkpLCF0KS5qb2luKCIvIikpfHwiLiJ9LHJlbGF0aXZlOihlLHQpPT57ZnVuY3Rpb24gcihlKXtmb3IodmFyIHQ9MDt0PGUubGVuZ3RoJiYiIj09PWVbdF07dCsrKTtmb3IodmFyIHI9ZS5sZW5ndGgtMTtyPj0wJiYiIj09PWVbcl07ci0tKTtyZXR1cm4gdD5yP1tdOmUuc2xpY2UodCxyLXQrMSl9ZT12dC5yZXNvbHZlKGUpLnN1YnN0cigxKSx0PXZ0LnJlc29sdmUodCkuc3Vic3RyKDEpO2Zvcih2YXIgbj1yKGUuc3BsaXQoIi8iKSksbz1yKHQuc3BsaXQoIi8iKSksYT1NYXRoLm1pbihuLmxlbmd0aCxvLmxlbmd0aCksaT1hLHM9MDtzPGE7cysrKWlmKG5bc10hPT1vW3NdKXtpPXM7YnJlYWt9dmFyIHU9W107Zm9yKHM9aTtzPG4ubGVuZ3RoO3MrKyl1LnB1c2goIi4uIik7cmV0dXJuKHU9dS5jb25jYXQoby5zbGljZShpKSkpLmpvaW4oIi8iKX19O2Z1bmN0aW9uIHl0KGUsdCxyKXt2YXIgbj1yPjA/cjpDKGUpKzEsbz1uZXcgQXJyYXkobiksYT1EKGUsbywwLG8ubGVuZ3RoKTtyZXR1cm4gdCYmKG8ubGVuZ3RoPWEpLG99dmFyIGd0PXt0dHlzOltdLGluaXQ6ZnVuY3Rpb24oKXt9LHNodXRkb3duOmZ1bmN0aW9uKCl7fSxyZWdpc3RlcjpmdW5jdGlvbihlLHQpe2d0LnR0eXNbZV09e2lucHV0OltdLG91dHB1dDpbXSxvcHM6dH0sX3QucmVnaXN0ZXJEZXZpY2UoZSxndC5zdHJlYW1fb3BzKX0sc3RyZWFtX29wczp7b3BlbjpmdW5jdGlvbihlKXt2YXIgdD1ndC50dHlzW2Uubm9kZS5yZGV2XTtpZighdCl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig0Myk7ZS50dHk9dCxlLnNlZWthYmxlPSExfSxjbG9zZTpmdW5jdGlvbihlKXtlLnR0eS5vcHMuZnN5bmMoZS50dHkpfSxmc3luYzpmdW5jdGlvbihlKXtlLnR0eS5vcHMuZnN5bmMoZS50dHkpfSxyZWFkOmZ1bmN0aW9uKGUsdCxyLG4sbyl7aWYoIWUudHR5fHwhZS50dHkub3BzLmdldF9jaGFyKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDYwKTtmb3IodmFyIGE9MCxpPTA7aTxuO2krKyl7dmFyIHM7dHJ5e3M9ZS50dHkub3BzLmdldF9jaGFyKGUudHR5KX1jYXRjaChlKXt0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigyOSl9aWYodm9pZCAwPT09cyYmMD09PWEpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoNik7aWYobnVsbD09cylicmVhazthKyssdFtyK2ldPXN9cmV0dXJuIGEmJihlLm5vZGUudGltZXN0YW1wPURhdGUubm93KCkpLGF9LHdyaXRlOmZ1bmN0aW9uKGUsdCxyLG4sbyl7aWYoIWUudHR5fHwhZS50dHkub3BzLnB1dF9jaGFyKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDYwKTt0cnl7Zm9yKHZhciBhPTA7YTxuO2ErKyllLnR0eS5vcHMucHV0X2NoYXIoZS50dHksdFtyK2FdKX1jYXRjaChlKXt0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigyOSl9cmV0dXJuIG4mJihlLm5vZGUudGltZXN0YW1wPURhdGUubm93KCkpLGF9fSxkZWZhdWx0X3R0eV9vcHM6e2dldF9jaGFyOmZ1bmN0aW9uKGUpe2lmKCFlLmlucHV0Lmxlbmd0aCl7dmFyIHQ9bnVsbDtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmImZ1bmN0aW9uIj09dHlwZW9mIHdpbmRvdy5wcm9tcHQ/bnVsbCE9PSh0PXdpbmRvdy5wcm9tcHQoIklucHV0OiAiKSkmJih0Kz0iXG4iKToiZnVuY3Rpb24iPT10eXBlb2YgcmVhZGxpbmUmJm51bGwhPT0odD1yZWFkbGluZSgpKSYmKHQrPSJcbiIpLCF0KXJldHVybiBudWxsO2UuaW5wdXQ9eXQodCwhMCl9cmV0dXJuIGUuaW5wdXQuc2hpZnQoKX0scHV0X2NoYXI6ZnVuY3Rpb24oZSx0KXtudWxsPT09dHx8MTA9PT10PyhsKFQoZS5vdXRwdXQsMCkpLGUub3V0cHV0PVtdKTowIT10JiZlLm91dHB1dC5wdXNoKHQpfSxmc3luYzpmdW5jdGlvbihlKXtlLm91dHB1dCYmZS5vdXRwdXQubGVuZ3RoPjAmJihsKFQoZS5vdXRwdXQsMCkpLGUub3V0cHV0PVtdKX19LGRlZmF1bHRfdHR5MV9vcHM6e3B1dF9jaGFyOmZ1bmN0aW9uKGUsdCl7bnVsbD09PXR8fDEwPT09dD8oZChUKGUub3V0cHV0LDApKSxlLm91dHB1dD1bXSk6MCE9dCYmZS5vdXRwdXQucHVzaCh0KX0sZnN5bmM6ZnVuY3Rpb24oZSl7ZS5vdXRwdXQmJmUub3V0cHV0Lmxlbmd0aD4wJiYoZChUKGUub3V0cHV0LDApKSxlLm91dHB1dD1bXSl9fX07ZnVuY3Rpb24gd3QoZSl7ZT1mdW5jdGlvbihlLHQpe3JldHVybiA2NTUzNipNYXRoLmNlaWwoZS82NTUzNil9KGUpO3ZhciB0PXh0KDY1NTM2LGUpO3JldHVybiB0P2Z1bmN0aW9uKGUsdCl7cmV0dXJuIHkuZmlsbCgwLGUsZSt0KSxlfSh0LGUpOjB9dmFyIEV0PXtvcHNfdGFibGU6bnVsbCxtb3VudDpmdW5jdGlvbihlKXtyZXR1cm4gRXQuY3JlYXRlTm9kZShudWxsLCIvIiwxNjg5NSwwKX0sY3JlYXRlTm9kZTpmdW5jdGlvbihlLHQscixuKXtpZihfdC5pc0Jsa2RldihyKXx8X3QuaXNGSUZPKHIpKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDYzKTtFdC5vcHNfdGFibGV8fChFdC5vcHNfdGFibGU9e2Rpcjp7bm9kZTp7Z2V0YXR0cjpFdC5ub2RlX29wcy5nZXRhdHRyLHNldGF0dHI6RXQubm9kZV9vcHMuc2V0YXR0cixsb29rdXA6RXQubm9kZV9vcHMubG9va3VwLG1rbm9kOkV0Lm5vZGVfb3BzLm1rbm9kLHJlbmFtZTpFdC5ub2RlX29wcy5yZW5hbWUsdW5saW5rOkV0Lm5vZGVfb3BzLnVubGluayxybWRpcjpFdC5ub2RlX29wcy5ybWRpcixyZWFkZGlyOkV0Lm5vZGVfb3BzLnJlYWRkaXIsc3ltbGluazpFdC5ub2RlX29wcy5zeW1saW5rfSxzdHJlYW06e2xsc2VlazpFdC5zdHJlYW1fb3BzLmxsc2Vla319LGZpbGU6e25vZGU6e2dldGF0dHI6RXQubm9kZV9vcHMuZ2V0YXR0cixzZXRhdHRyOkV0Lm5vZGVfb3BzLnNldGF0dHJ9LHN0cmVhbTp7bGxzZWVrOkV0LnN0cmVhbV9vcHMubGxzZWVrLHJlYWQ6RXQuc3RyZWFtX29wcy5yZWFkLHdyaXRlOkV0LnN0cmVhbV9vcHMud3JpdGUsYWxsb2NhdGU6RXQuc3RyZWFtX29wcy5hbGxvY2F0ZSxtbWFwOkV0LnN0cmVhbV9vcHMubW1hcCxtc3luYzpFdC5zdHJlYW1fb3BzLm1zeW5jfX0sbGluazp7bm9kZTp7Z2V0YXR0cjpFdC5ub2RlX29wcy5nZXRhdHRyLHNldGF0dHI6RXQubm9kZV9vcHMuc2V0YXR0cixyZWFkbGluazpFdC5ub2RlX29wcy5yZWFkbGlua30sc3RyZWFtOnt9fSxjaHJkZXY6e25vZGU6e2dldGF0dHI6RXQubm9kZV9vcHMuZ2V0YXR0cixzZXRhdHRyOkV0Lm5vZGVfb3BzLnNldGF0dHJ9LHN0cmVhbTpfdC5jaHJkZXZfc3RyZWFtX29wc319KTt2YXIgbz1fdC5jcmVhdGVOb2RlKGUsdCxyLG4pO3JldHVybiBfdC5pc0RpcihvLm1vZGUpPyhvLm5vZGVfb3BzPUV0Lm9wc190YWJsZS5kaXIubm9kZSxvLnN0cmVhbV9vcHM9RXQub3BzX3RhYmxlLmRpci5zdHJlYW0sby5jb250ZW50cz17fSk6X3QuaXNGaWxlKG8ubW9kZSk/KG8ubm9kZV9vcHM9RXQub3BzX3RhYmxlLmZpbGUubm9kZSxvLnN0cmVhbV9vcHM9RXQub3BzX3RhYmxlLmZpbGUuc3RyZWFtLG8udXNlZEJ5dGVzPTAsby5jb250ZW50cz1udWxsKTpfdC5pc0xpbmsoby5tb2RlKT8oby5ub2RlX29wcz1FdC5vcHNfdGFibGUubGluay5ub2RlLG8uc3RyZWFtX29wcz1FdC5vcHNfdGFibGUubGluay5zdHJlYW0pOl90LmlzQ2hyZGV2KG8ubW9kZSkmJihvLm5vZGVfb3BzPUV0Lm9wc190YWJsZS5jaHJkZXYubm9kZSxvLnN0cmVhbV9vcHM9RXQub3BzX3RhYmxlLmNocmRldi5zdHJlYW0pLG8udGltZXN0YW1wPURhdGUubm93KCksZSYmKGUuY29udGVudHNbdF09byxlLnRpbWVzdGFtcD1vLnRpbWVzdGFtcCksb30sZ2V0RmlsZURhdGFBc1R5cGVkQXJyYXk6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuY29udGVudHM/ZS5jb250ZW50cy5zdWJhcnJheT9lLmNvbnRlbnRzLnN1YmFycmF5KDAsZS51c2VkQnl0ZXMpOm5ldyBVaW50OEFycmF5KGUuY29udGVudHMpOm5ldyBVaW50OEFycmF5KDApfSxleHBhbmRGaWxlU3RvcmFnZTpmdW5jdGlvbihlLHQpe3ZhciByPWUuY29udGVudHM/ZS5jb250ZW50cy5sZW5ndGg6MDtpZighKHI+PXQpKXt0PU1hdGgubWF4KHQscioocjwxMDQ4NTc2PzI6MS4xMjUpPj4+MCksMCE9ciYmKHQ9TWF0aC5tYXgodCwyNTYpKTt2YXIgbj1lLmNvbnRlbnRzO2UuY29udGVudHM9bmV3IFVpbnQ4QXJyYXkodCksZS51c2VkQnl0ZXM+MCYmZS5jb250ZW50cy5zZXQobi5zdWJhcnJheSgwLGUudXNlZEJ5dGVzKSwwKX19LHJlc2l6ZUZpbGVTdG9yYWdlOmZ1bmN0aW9uKGUsdCl7aWYoZS51c2VkQnl0ZXMhPXQpaWYoMD09dCllLmNvbnRlbnRzPW51bGwsZS51c2VkQnl0ZXM9MDtlbHNle3ZhciByPWUuY29udGVudHM7ZS5jb250ZW50cz1uZXcgVWludDhBcnJheSh0KSxyJiZlLmNvbnRlbnRzLnNldChyLnN1YmFycmF5KDAsTWF0aC5taW4odCxlLnVzZWRCeXRlcykpKSxlLnVzZWRCeXRlcz10fX0sbm9kZV9vcHM6e2dldGF0dHI6ZnVuY3Rpb24oZSl7dmFyIHQ9e307cmV0dXJuIHQuZGV2PV90LmlzQ2hyZGV2KGUubW9kZSk/ZS5pZDoxLHQuaW5vPWUuaWQsdC5tb2RlPWUubW9kZSx0Lm5saW5rPTEsdC51aWQ9MCx0LmdpZD0wLHQucmRldj1lLnJkZXYsX3QuaXNEaXIoZS5tb2RlKT90LnNpemU9NDA5NjpfdC5pc0ZpbGUoZS5tb2RlKT90LnNpemU9ZS51c2VkQnl0ZXM6X3QuaXNMaW5rKGUubW9kZSk/dC5zaXplPWUubGluay5sZW5ndGg6dC5zaXplPTAsdC5hdGltZT1uZXcgRGF0ZShlLnRpbWVzdGFtcCksdC5tdGltZT1uZXcgRGF0ZShlLnRpbWVzdGFtcCksdC5jdGltZT1uZXcgRGF0ZShlLnRpbWVzdGFtcCksdC5ibGtzaXplPTQwOTYsdC5ibG9ja3M9TWF0aC5jZWlsKHQuc2l6ZS90LmJsa3NpemUpLHR9LHNldGF0dHI6ZnVuY3Rpb24oZSx0KXt2b2lkIDAhPT10Lm1vZGUmJihlLm1vZGU9dC5tb2RlKSx2b2lkIDAhPT10LnRpbWVzdGFtcCYmKGUudGltZXN0YW1wPXQudGltZXN0YW1wKSx2b2lkIDAhPT10LnNpemUmJkV0LnJlc2l6ZUZpbGVTdG9yYWdlKGUsdC5zaXplKX0sbG9va3VwOmZ1bmN0aW9uKGUsdCl7dGhyb3cgX3QuZ2VuZXJpY0Vycm9yc1s0NF19LG1rbm9kOmZ1bmN0aW9uKGUsdCxyLG4pe3JldHVybiBFdC5jcmVhdGVOb2RlKGUsdCxyLG4pfSxyZW5hbWU6ZnVuY3Rpb24oZSx0LHIpe2lmKF90LmlzRGlyKGUubW9kZSkpe3ZhciBuO3RyeXtuPV90Lmxvb2t1cE5vZGUodCxyKX1jYXRjaChlKXt9aWYobilmb3IodmFyIG8gaW4gbi5jb250ZW50cyl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig1NSl9ZGVsZXRlIGUucGFyZW50LmNvbnRlbnRzW2UubmFtZV0sZS5wYXJlbnQudGltZXN0YW1wPURhdGUubm93KCksZS5uYW1lPXIsdC5jb250ZW50c1tyXT1lLHQudGltZXN0YW1wPWUucGFyZW50LnRpbWVzdGFtcCxlLnBhcmVudD10fSx1bmxpbms6ZnVuY3Rpb24oZSx0KXtkZWxldGUgZS5jb250ZW50c1t0XSxlLnRpbWVzdGFtcD1EYXRlLm5vdygpfSxybWRpcjpmdW5jdGlvbihlLHQpe3ZhciByPV90Lmxvb2t1cE5vZGUoZSx0KTtmb3IodmFyIG4gaW4gci5jb250ZW50cyl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig1NSk7ZGVsZXRlIGUuY29udGVudHNbdF0sZS50aW1lc3RhbXA9RGF0ZS5ub3coKX0scmVhZGRpcjpmdW5jdGlvbihlKXt2YXIgdD1bIi4iLCIuLiJdO2Zvcih2YXIgciBpbiBlLmNvbnRlbnRzKWUuY29udGVudHMuaGFzT3duUHJvcGVydHkocikmJnQucHVzaChyKTtyZXR1cm4gdH0sc3ltbGluazpmdW5jdGlvbihlLHQscil7dmFyIG49RXQuY3JlYXRlTm9kZShlLHQsNDE0NzEsMCk7cmV0dXJuIG4ubGluaz1yLG59LHJlYWRsaW5rOmZ1bmN0aW9uKGUpe2lmKCFfdC5pc0xpbmsoZS5tb2RlKSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigyOCk7cmV0dXJuIGUubGlua319LHN0cmVhbV9vcHM6e3JlYWQ6ZnVuY3Rpb24oZSx0LHIsbixvKXt2YXIgYT1lLm5vZGUuY29udGVudHM7aWYobz49ZS5ub2RlLnVzZWRCeXRlcylyZXR1cm4gMDt2YXIgaT1NYXRoLm1pbihlLm5vZGUudXNlZEJ5dGVzLW8sbik7aWYoaT44JiZhLnN1YmFycmF5KXQuc2V0KGEuc3ViYXJyYXkobyxvK2kpLHIpO2Vsc2UgZm9yKHZhciBzPTA7czxpO3MrKyl0W3Irc109YVtvK3NdO3JldHVybiBpfSx3cml0ZTpmdW5jdGlvbihlLHQscixuLG8sYSl7aWYoIW4pcmV0dXJuIDA7dmFyIGk9ZS5ub2RlO2lmKGkudGltZXN0YW1wPURhdGUubm93KCksdC5zdWJhcnJheSYmKCFpLmNvbnRlbnRzfHxpLmNvbnRlbnRzLnN1YmFycmF5KSl7aWYoYSlyZXR1cm4gaS5jb250ZW50cz10LnN1YmFycmF5KHIscituKSxpLnVzZWRCeXRlcz1uLG47aWYoMD09PWkudXNlZEJ5dGVzJiYwPT09bylyZXR1cm4gaS5jb250ZW50cz10LnNsaWNlKHIscituKSxpLnVzZWRCeXRlcz1uLG47aWYobytuPD1pLnVzZWRCeXRlcylyZXR1cm4gaS5jb250ZW50cy5zZXQodC5zdWJhcnJheShyLHIrbiksbyksbn1pZihFdC5leHBhbmRGaWxlU3RvcmFnZShpLG8rbiksaS5jb250ZW50cy5zdWJhcnJheSYmdC5zdWJhcnJheSlpLmNvbnRlbnRzLnNldCh0LnN1YmFycmF5KHIscituKSxvKTtlbHNlIGZvcih2YXIgcz0wO3M8bjtzKyspaS5jb250ZW50c1tvK3NdPXRbcitzXTtyZXR1cm4gaS51c2VkQnl0ZXM9TWF0aC5tYXgoaS51c2VkQnl0ZXMsbytuKSxufSxsbHNlZWs6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPXQ7aWYoMT09PXI/bis9ZS5wb3NpdGlvbjoyPT09ciYmX3QuaXNGaWxlKGUubm9kZS5tb2RlKSYmKG4rPWUubm9kZS51c2VkQnl0ZXMpLG48MCl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigyOCk7cmV0dXJuIG59LGFsbG9jYXRlOmZ1bmN0aW9uKGUsdCxyKXtFdC5leHBhbmRGaWxlU3RvcmFnZShlLm5vZGUsdCtyKSxlLm5vZGUudXNlZEJ5dGVzPU1hdGgubWF4KGUubm9kZS51c2VkQnl0ZXMsdCtyKX0sbW1hcDpmdW5jdGlvbihlLHQscixuLG8pe2lmKCFfdC5pc0ZpbGUoZS5ub2RlLm1vZGUpKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDQzKTt2YXIgYSxpLHM9ZS5ub2RlLmNvbnRlbnRzO2lmKDImb3x8cy5idWZmZXIhPT1tKXtpZigocj4wfHxyK3Q8cy5sZW5ndGgpJiYocz1zLnN1YmFycmF5P3Muc3ViYXJyYXkocixyK3QpOkFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHMscixyK3QpKSxpPSEwLCEoYT13dCh0KSkpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoNDgpO3Yuc2V0KHMsYSl9ZWxzZSBpPSExLGE9cy5ieXRlT2Zmc2V0O3JldHVybntwdHI6YSxhbGxvY2F0ZWQ6aX19LG1zeW5jOmZ1bmN0aW9uKGUsdCxyLG4sbyl7cmV0dXJuIEV0LnN0cmVhbV9vcHMud3JpdGUoZSx0LDAsbixyLCExKSwwfX19LF90PXtyb290Om51bGwsbW91bnRzOltdLGRldmljZXM6e30sc3RyZWFtczpbXSxuZXh0SW5vZGU6MSxuYW1lVGFibGU6bnVsbCxjdXJyZW50UGF0aDoiLyIsaW5pdGlhbGl6ZWQ6ITEsaWdub3JlUGVybWlzc2lvbnM6ITAsRXJybm9FcnJvcjpudWxsLGdlbmVyaWNFcnJvcnM6e30sZmlsZXN5c3RlbXM6bnVsbCxzeW5jRlNSZXF1ZXN0czowLGxvb2t1cFBhdGg6KGUsdD17fSk9PntpZighKGU9dnQucmVzb2x2ZShlKSkpcmV0dXJue3BhdGg6IiIsbm9kZTpudWxsfTtpZigodD1PYmplY3QuYXNzaWduKHtmb2xsb3dfbW91bnQ6ITAscmVjdXJzZV9jb3VudDowfSx0KSkucmVjdXJzZV9jb3VudD44KXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDMyKTtmb3IodmFyIHI9ZS5zcGxpdCgiLyIpLmZpbHRlcigoZT0+ISFlKSksbj1fdC5yb290LG89Ii8iLGE9MDthPHIubGVuZ3RoO2ErKyl7dmFyIGk9YT09PXIubGVuZ3RoLTE7aWYoaSYmdC5wYXJlbnQpYnJlYWs7aWYobj1fdC5sb29rdXBOb2RlKG4sclthXSksbz1tdC5qb2luMihvLHJbYV0pLF90LmlzTW91bnRwb2ludChuKSYmKCFpfHxpJiZ0LmZvbGxvd19tb3VudCkmJihuPW4ubW91bnRlZC5yb290KSwhaXx8dC5mb2xsb3cpZm9yKHZhciBzPTA7X3QuaXNMaW5rKG4ubW9kZSk7KXt2YXIgdT1fdC5yZWFkbGluayhvKTtpZihvPXZ0LnJlc29sdmUobXQuZGlybmFtZShvKSx1KSxuPV90Lmxvb2t1cFBhdGgobyx7cmVjdXJzZV9jb3VudDp0LnJlY3Vyc2VfY291bnQrMX0pLm5vZGUscysrPjQwKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDMyKX19cmV0dXJue3BhdGg6byxub2RlOm59fSxnZXRQYXRoOmU9Pntmb3IodmFyIHQ7Oyl7aWYoX3QuaXNSb290KGUpKXt2YXIgcj1lLm1vdW50Lm1vdW50cG9pbnQ7cmV0dXJuIHQ/Ii8iIT09cltyLmxlbmd0aC0xXT9yKyIvIit0OnIrdDpyfXQ9dD9lLm5hbWUrIi8iK3Q6ZS5uYW1lLGU9ZS5wYXJlbnR9fSxoYXNoTmFtZTooZSx0KT0+e2Zvcih2YXIgcj0wLG49MDtuPHQubGVuZ3RoO24rKylyPShyPDw1KS1yK3QuY2hhckNvZGVBdChuKXwwO3JldHVybihlK3I+Pj4wKSVfdC5uYW1lVGFibGUubGVuZ3RofSxoYXNoQWRkTm9kZTplPT57dmFyIHQ9X3QuaGFzaE5hbWUoZS5wYXJlbnQuaWQsZS5uYW1lKTtlLm5hbWVfbmV4dD1fdC5uYW1lVGFibGVbdF0sX3QubmFtZVRhYmxlW3RdPWV9LGhhc2hSZW1vdmVOb2RlOmU9Pnt2YXIgdD1fdC5oYXNoTmFtZShlLnBhcmVudC5pZCxlLm5hbWUpO2lmKF90Lm5hbWVUYWJsZVt0XT09PWUpX3QubmFtZVRhYmxlW3RdPWUubmFtZV9uZXh0O2Vsc2UgZm9yKHZhciByPV90Lm5hbWVUYWJsZVt0XTtyOyl7aWYoci5uYW1lX25leHQ9PT1lKXtyLm5hbWVfbmV4dD1lLm5hbWVfbmV4dDticmVha31yPXIubmFtZV9uZXh0fX0sbG9va3VwTm9kZTooZSx0KT0+e3ZhciByPV90Lm1heUxvb2t1cChlKTtpZihyKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKHIsZSk7Zm9yKHZhciBuPV90Lmhhc2hOYW1lKGUuaWQsdCksbz1fdC5uYW1lVGFibGVbbl07bztvPW8ubmFtZV9uZXh0KXt2YXIgYT1vLm5hbWU7aWYoby5wYXJlbnQuaWQ9PT1lLmlkJiZhPT09dClyZXR1cm4gb31yZXR1cm4gX3QubG9va3VwKGUsdCl9LGNyZWF0ZU5vZGU6KGUsdCxyLG4pPT57dmFyIG89bmV3IF90LkZTTm9kZShlLHQscixuKTtyZXR1cm4gX3QuaGFzaEFkZE5vZGUobyksb30sZGVzdHJveU5vZGU6ZT0+e190Lmhhc2hSZW1vdmVOb2RlKGUpfSxpc1Jvb3Q6ZT0+ZT09PWUucGFyZW50LGlzTW91bnRwb2ludDplPT4hIWUubW91bnRlZCxpc0ZpbGU6ZT0+MzI3Njg9PSg2MTQ0MCZlKSxpc0RpcjplPT4xNjM4ND09KDYxNDQwJmUpLGlzTGluazplPT40MDk2MD09KDYxNDQwJmUpLGlzQ2hyZGV2OmU9PjgxOTI9PSg2MTQ0MCZlKSxpc0Jsa2RldjplPT4yNDU3Nj09KDYxNDQwJmUpLGlzRklGTzplPT40MDk2PT0oNjE0NDAmZSksaXNTb2NrZXQ6ZT0+NDkxNTI9PSg0OTE1MiZlKSxmbGFnTW9kZXM6e3I6MCwicisiOjIsdzo1NzcsIncrIjo1NzgsYToxMDg5LCJhKyI6MTA5MH0sbW9kZVN0cmluZ1RvRmxhZ3M6ZT0+e3ZhciB0PV90LmZsYWdNb2Rlc1tlXTtpZih2b2lkIDA9PT10KXRocm93IG5ldyBFcnJvcigiVW5rbm93biBmaWxlIG9wZW4gbW9kZTogIitlKTtyZXR1cm4gdH0sZmxhZ3NUb1Blcm1pc3Npb25TdHJpbmc6ZT0+e3ZhciB0PVsiciIsInciLCJydyJdWzMmZV07cmV0dXJuIDUxMiZlJiYodCs9InciKSx0fSxub2RlUGVybWlzc2lvbnM6KGUsdCk9Pl90Lmlnbm9yZVBlcm1pc3Npb25zfHwoIXQuaW5jbHVkZXMoInIiKXx8MjkyJmUubW9kZSkmJighdC5pbmNsdWRlcygidyIpfHwxNDYmZS5tb2RlKSYmKCF0LmluY2x1ZGVzKCJ4Iil8fDczJmUubW9kZSk/MDoyLG1heUxvb2t1cDplPT5fdC5ub2RlUGVybWlzc2lvbnMoZSwieCIpfHwoZS5ub2RlX29wcy5sb29rdXA/MDoyKSxtYXlDcmVhdGU6KGUsdCk9Pnt0cnl7cmV0dXJuIF90Lmxvb2t1cE5vZGUoZSx0KSwyMH1jYXRjaChlKXt9cmV0dXJuIF90Lm5vZGVQZXJtaXNzaW9ucyhlLCJ3eCIpfSxtYXlEZWxldGU6KGUsdCxyKT0+e3ZhciBuO3RyeXtuPV90Lmxvb2t1cE5vZGUoZSx0KX1jYXRjaChlKXtyZXR1cm4gZS5lcnJub312YXIgbz1fdC5ub2RlUGVybWlzc2lvbnMoZSwid3giKTtpZihvKXJldHVybiBvO2lmKHIpe2lmKCFfdC5pc0RpcihuLm1vZGUpKXJldHVybiA1NDtpZihfdC5pc1Jvb3Qobil8fF90LmdldFBhdGgobik9PT1fdC5jd2QoKSlyZXR1cm4gMTB9ZWxzZSBpZihfdC5pc0RpcihuLm1vZGUpKXJldHVybiAzMTtyZXR1cm4gMH0sbWF5T3BlbjooZSx0KT0+ZT9fdC5pc0xpbmsoZS5tb2RlKT8zMjpfdC5pc0RpcihlLm1vZGUpJiYoInIiIT09X3QuZmxhZ3NUb1Blcm1pc3Npb25TdHJpbmcodCl8fDUxMiZ0KT8zMTpfdC5ub2RlUGVybWlzc2lvbnMoZSxfdC5mbGFnc1RvUGVybWlzc2lvblN0cmluZyh0KSk6NDQsTUFYX09QRU5fRkRTOjQwOTYsbmV4dGZkOihlPTAsdD1fdC5NQVhfT1BFTl9GRFMpPT57Zm9yKHZhciByPWU7cjw9dDtyKyspaWYoIV90LnN0cmVhbXNbcl0pcmV0dXJuIHI7dGhyb3cgbmV3IF90LkVycm5vRXJyb3IoMzMpfSxnZXRTdHJlYW06ZT0+X3Quc3RyZWFtc1tlXSxjcmVhdGVTdHJlYW06KGUsdCxyKT0+e190LkZTU3RyZWFtfHwoX3QuRlNTdHJlYW09ZnVuY3Rpb24oKXt0aGlzLnNoYXJlZD17fX0sX3QuRlNTdHJlYW0ucHJvdG90eXBlPXt9LE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKF90LkZTU3RyZWFtLnByb3RvdHlwZSx7b2JqZWN0OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5ub2RlfSxzZXQ6ZnVuY3Rpb24oZSl7dGhpcy5ub2RlPWV9fSxpc1JlYWQ6e2dldDpmdW5jdGlvbigpe3JldHVybiAxIT0oMjA5NzE1NSZ0aGlzLmZsYWdzKX19LGlzV3JpdGU6e2dldDpmdW5jdGlvbigpe3JldHVybiAwIT0oMjA5NzE1NSZ0aGlzLmZsYWdzKX19LGlzQXBwZW5kOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMTAyNCZ0aGlzLmZsYWdzfX0sZmxhZ3M6e2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnNoYXJlZC5mbGFnc30sc2V0OmZ1bmN0aW9uKGUpe3RoaXMuc2hhcmVkLmZsYWdzPWV9fSxwb3NpdGlvbjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2hhcmVkLnBvc2l0aW9ufSxzZXQ6ZnVuY3Rpb24oZSl7dGhpcy5zaGFyZWQucG9zaXRpb249ZX19fSkpLGU9T2JqZWN0LmFzc2lnbihuZXcgX3QuRlNTdHJlYW0sZSk7dmFyIG49X3QubmV4dGZkKHQscik7cmV0dXJuIGUuZmQ9bixfdC5zdHJlYW1zW25dPWUsZX0sY2xvc2VTdHJlYW06ZT0+e190LnN0cmVhbXNbZV09bnVsbH0sY2hyZGV2X3N0cmVhbV9vcHM6e29wZW46ZT0+e3ZhciB0PV90LmdldERldmljZShlLm5vZGUucmRldik7ZS5zdHJlYW1fb3BzPXQuc3RyZWFtX29wcyxlLnN0cmVhbV9vcHMub3BlbiYmZS5zdHJlYW1fb3BzLm9wZW4oZSl9LGxsc2VlazooKT0+e3Rocm93IG5ldyBfdC5FcnJub0Vycm9yKDcwKX19LG1ham9yOmU9PmU+PjgsbWlub3I6ZT0+MjU1JmUsbWFrZWRldjooZSx0KT0+ZTw8OHx0LHJlZ2lzdGVyRGV2aWNlOihlLHQpPT57X3QuZGV2aWNlc1tlXT17c3RyZWFtX29wczp0fX0sZ2V0RGV2aWNlOmU9Pl90LmRldmljZXNbZV0sZ2V0TW91bnRzOmU9Pntmb3IodmFyIHQ9W10scj1bZV07ci5sZW5ndGg7KXt2YXIgbj1yLnBvcCgpO3QucHVzaChuKSxyLnB1c2guYXBwbHkocixuLm1vdW50cyl9cmV0dXJuIHR9LHN5bmNmczooZSx0KT0+eyJmdW5jdGlvbiI9PXR5cGVvZiBlJiYodD1lLGU9ITEpLF90LnN5bmNGU1JlcXVlc3RzKyssX3Quc3luY0ZTUmVxdWVzdHM+MSYmZCgid2FybmluZzogIitfdC5zeW5jRlNSZXF1ZXN0cysiIEZTLnN5bmNmcyBvcGVyYXRpb25zIGluIGZsaWdodCBhdCBvbmNlLCBwcm9iYWJseSBqdXN0IGRvaW5nIGV4dHJhIHdvcmsiKTt2YXIgcj1fdC5nZXRNb3VudHMoX3Qucm9vdC5tb3VudCksbj0wO2Z1bmN0aW9uIG8oZSl7cmV0dXJuIF90LnN5bmNGU1JlcXVlc3RzLS0sdChlKX1mdW5jdGlvbiBhKGUpe2lmKGUpcmV0dXJuIGEuZXJyb3JlZD92b2lkIDA6KGEuZXJyb3JlZD0hMCxvKGUpKTsrK24+PXIubGVuZ3RoJiZvKG51bGwpfXIuZm9yRWFjaCgodD0+e2lmKCF0LnR5cGUuc3luY2ZzKXJldHVybiBhKG51bGwpO3QudHlwZS5zeW5jZnModCxlLGEpfSkpfSxtb3VudDooZSx0LHIpPT57dmFyIG4sbz0iLyI9PT1yLGE9IXI7aWYobyYmX3Qucm9vdCl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigxMCk7aWYoIW8mJiFhKXt2YXIgaT1fdC5sb29rdXBQYXRoKHIse2ZvbGxvd19tb3VudDohMX0pO2lmKHI9aS5wYXRoLG49aS5ub2RlLF90LmlzTW91bnRwb2ludChuKSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigxMCk7aWYoIV90LmlzRGlyKG4ubW9kZSkpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoNTQpfXZhciBzPXt0eXBlOmUsb3B0czp0LG1vdW50cG9pbnQ6cixtb3VudHM6W119LHU9ZS5tb3VudChzKTtyZXR1cm4gdS5tb3VudD1zLHMucm9vdD11LG8/X3Qucm9vdD11Om4mJihuLm1vdW50ZWQ9cyxuLm1vdW50JiZuLm1vdW50Lm1vdW50cy5wdXNoKHMpKSx1fSx1bm1vdW50OmU9Pnt2YXIgdD1fdC5sb29rdXBQYXRoKGUse2ZvbGxvd19tb3VudDohMX0pO2lmKCFfdC5pc01vdW50cG9pbnQodC5ub2RlKSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigyOCk7dmFyIHI9dC5ub2RlLG49ci5tb3VudGVkLG89X3QuZ2V0TW91bnRzKG4pO09iamVjdC5rZXlzKF90Lm5hbWVUYWJsZSkuZm9yRWFjaCgoZT0+e2Zvcih2YXIgdD1fdC5uYW1lVGFibGVbZV07dDspe3ZhciByPXQubmFtZV9uZXh0O28uaW5jbHVkZXModC5tb3VudCkmJl90LmRlc3Ryb3lOb2RlKHQpLHQ9cn19KSksci5tb3VudGVkPW51bGw7dmFyIGE9ci5tb3VudC5tb3VudHMuaW5kZXhPZihuKTtyLm1vdW50Lm1vdW50cy5zcGxpY2UoYSwxKX0sbG9va3VwOihlLHQpPT5lLm5vZGVfb3BzLmxvb2t1cChlLHQpLG1rbm9kOihlLHQscik9Pnt2YXIgbj1fdC5sb29rdXBQYXRoKGUse3BhcmVudDohMH0pLm5vZGUsbz1tdC5iYXNlbmFtZShlKTtpZighb3x8Ii4iPT09b3x8Ii4uIj09PW8pdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoMjgpO3ZhciBhPV90Lm1heUNyZWF0ZShuLG8pO2lmKGEpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoYSk7aWYoIW4ubm9kZV9vcHMubWtub2QpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoNjMpO3JldHVybiBuLm5vZGVfb3BzLm1rbm9kKG4sbyx0LHIpfSxjcmVhdGU6KGUsdCk9Pih0PXZvaWQgMCE9PXQ/dDo0MzgsdCY9NDA5NSx0fD0zMjc2OCxfdC5ta25vZChlLHQsMCkpLG1rZGlyOihlLHQpPT4odD12b2lkIDAhPT10P3Q6NTExLHQmPTEwMjMsdHw9MTYzODQsX3QubWtub2QoZSx0LDApKSxta2RpclRyZWU6KGUsdCk9Pntmb3IodmFyIHI9ZS5zcGxpdCgiLyIpLG49IiIsbz0wO288ci5sZW5ndGg7KytvKWlmKHJbb10pe24rPSIvIityW29dO3RyeXtfdC5ta2RpcihuLHQpfWNhdGNoKGUpe2lmKDIwIT1lLmVycm5vKXRocm93IGV9fX0sbWtkZXY6KGUsdCxyKT0+KHZvaWQgMD09PXImJihyPXQsdD00MzgpLHR8PTgxOTIsX3QubWtub2QoZSx0LHIpKSxzeW1saW5rOihlLHQpPT57aWYoIXZ0LnJlc29sdmUoZSkpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoNDQpO3ZhciByPV90Lmxvb2t1cFBhdGgodCx7cGFyZW50OiEwfSkubm9kZTtpZighcil0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig0NCk7dmFyIG49bXQuYmFzZW5hbWUodCksbz1fdC5tYXlDcmVhdGUocixuKTtpZihvKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKG8pO2lmKCFyLm5vZGVfb3BzLnN5bWxpbmspdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoNjMpO3JldHVybiByLm5vZGVfb3BzLnN5bWxpbmsocixuLGUpfSxyZW5hbWU6KGUsdCk9Pnt2YXIgcixuLG89bXQuZGlybmFtZShlKSxhPW10LmRpcm5hbWUodCksaT1tdC5iYXNlbmFtZShlKSxzPW10LmJhc2VuYW1lKHQpO2lmKHI9X3QubG9va3VwUGF0aChlLHtwYXJlbnQ6ITB9KS5ub2RlLG49X3QubG9va3VwUGF0aCh0LHtwYXJlbnQ6ITB9KS5ub2RlLCFyfHwhbil0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig0NCk7aWYoci5tb3VudCE9PW4ubW91bnQpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoNzUpO3ZhciB1LGM9X3QubG9va3VwTm9kZShyLGkpLGw9dnQucmVsYXRpdmUoZSxhKTtpZigiLiIhPT1sLmNoYXJBdCgwKSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigyOCk7aWYoIi4iIT09KGw9dnQucmVsYXRpdmUodCxvKSkuY2hhckF0KDApKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDU1KTt0cnl7dT1fdC5sb29rdXBOb2RlKG4scyl9Y2F0Y2goZSl7fWlmKGMhPT11KXt2YXIgZD1fdC5pc0RpcihjLm1vZGUpLGY9X3QubWF5RGVsZXRlKHIsaSxkKTtpZihmKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKGYpO2lmKGY9dT9fdC5tYXlEZWxldGUobixzLGQpOl90Lm1heUNyZWF0ZShuLHMpKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKGYpO2lmKCFyLm5vZGVfb3BzLnJlbmFtZSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig2Myk7aWYoX3QuaXNNb3VudHBvaW50KGMpfHx1JiZfdC5pc01vdW50cG9pbnQodSkpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoMTApO2lmKG4hPT1yJiYoZj1fdC5ub2RlUGVybWlzc2lvbnMociwidyIpKSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcihmKTtfdC5oYXNoUmVtb3ZlTm9kZShjKTt0cnl7ci5ub2RlX29wcy5yZW5hbWUoYyxuLHMpfWNhdGNoKGUpe3Rocm93IGV9ZmluYWxseXtfdC5oYXNoQWRkTm9kZShjKX19fSxybWRpcjplPT57dmFyIHQ9X3QubG9va3VwUGF0aChlLHtwYXJlbnQ6ITB9KS5ub2RlLHI9bXQuYmFzZW5hbWUoZSksbj1fdC5sb29rdXBOb2RlKHQsciksbz1fdC5tYXlEZWxldGUodCxyLCEwKTtpZihvKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKG8pO2lmKCF0Lm5vZGVfb3BzLnJtZGlyKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDYzKTtpZihfdC5pc01vdW50cG9pbnQobikpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoMTApO3Qubm9kZV9vcHMucm1kaXIodCxyKSxfdC5kZXN0cm95Tm9kZShuKX0scmVhZGRpcjplPT57dmFyIHQ9X3QubG9va3VwUGF0aChlLHtmb2xsb3c6ITB9KS5ub2RlO2lmKCF0Lm5vZGVfb3BzLnJlYWRkaXIpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoNTQpO3JldHVybiB0Lm5vZGVfb3BzLnJlYWRkaXIodCl9LHVubGluazplPT57dmFyIHQ9X3QubG9va3VwUGF0aChlLHtwYXJlbnQ6ITB9KS5ub2RlO2lmKCF0KXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDQ0KTt2YXIgcj1tdC5iYXNlbmFtZShlKSxuPV90Lmxvb2t1cE5vZGUodCxyKSxvPV90Lm1heURlbGV0ZSh0LHIsITEpO2lmKG8pdGhyb3cgbmV3IF90LkVycm5vRXJyb3Iobyk7aWYoIXQubm9kZV9vcHMudW5saW5rKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDYzKTtpZihfdC5pc01vdW50cG9pbnQobikpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoMTApO3Qubm9kZV9vcHMudW5saW5rKHQsciksX3QuZGVzdHJveU5vZGUobil9LHJlYWRsaW5rOmU9Pnt2YXIgdD1fdC5sb29rdXBQYXRoKGUpLm5vZGU7aWYoIXQpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoNDQpO2lmKCF0Lm5vZGVfb3BzLnJlYWRsaW5rKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDI4KTtyZXR1cm4gdnQucmVzb2x2ZShfdC5nZXRQYXRoKHQucGFyZW50KSx0Lm5vZGVfb3BzLnJlYWRsaW5rKHQpKX0sc3RhdDooZSx0KT0+e3ZhciByPV90Lmxvb2t1cFBhdGgoZSx7Zm9sbG93OiF0fSkubm9kZTtpZighcil0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig0NCk7aWYoIXIubm9kZV9vcHMuZ2V0YXR0cil0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig2Myk7cmV0dXJuIHIubm9kZV9vcHMuZ2V0YXR0cihyKX0sbHN0YXQ6ZT0+X3Quc3RhdChlLCEwKSxjaG1vZDooZSx0LHIpPT57dmFyIG47aWYoIShuPSJzdHJpbmciPT10eXBlb2YgZT9fdC5sb29rdXBQYXRoKGUse2ZvbGxvdzohcn0pLm5vZGU6ZSkubm9kZV9vcHMuc2V0YXR0cil0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig2Myk7bi5ub2RlX29wcy5zZXRhdHRyKG4se21vZGU6NDA5NSZ0fC00MDk2Jm4ubW9kZSx0aW1lc3RhbXA6RGF0ZS5ub3coKX0pfSxsY2htb2Q6KGUsdCk9PntfdC5jaG1vZChlLHQsITApfSxmY2htb2Q6KGUsdCk9Pnt2YXIgcj1fdC5nZXRTdHJlYW0oZSk7aWYoIXIpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoOCk7X3QuY2htb2Qoci5ub2RlLHQpfSxjaG93bjooZSx0LHIsbik9Pnt2YXIgbztpZighKG89InN0cmluZyI9PXR5cGVvZiBlP190Lmxvb2t1cFBhdGgoZSx7Zm9sbG93OiFufSkubm9kZTplKS5ub2RlX29wcy5zZXRhdHRyKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDYzKTtvLm5vZGVfb3BzLnNldGF0dHIobyx7dGltZXN0YW1wOkRhdGUubm93KCl9KX0sbGNob3duOihlLHQscik9PntfdC5jaG93bihlLHQsciwhMCl9LGZjaG93bjooZSx0LHIpPT57dmFyIG49X3QuZ2V0U3RyZWFtKGUpO2lmKCFuKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDgpO190LmNob3duKG4ubm9kZSx0LHIpfSx0cnVuY2F0ZTooZSx0KT0+e2lmKHQ8MCl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigyOCk7dmFyIHI7aWYoIShyPSJzdHJpbmciPT10eXBlb2YgZT9fdC5sb29rdXBQYXRoKGUse2ZvbGxvdzohMH0pLm5vZGU6ZSkubm9kZV9vcHMuc2V0YXR0cil0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig2Myk7aWYoX3QuaXNEaXIoci5tb2RlKSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigzMSk7aWYoIV90LmlzRmlsZShyLm1vZGUpKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDI4KTt2YXIgbj1fdC5ub2RlUGVybWlzc2lvbnMociwidyIpO2lmKG4pdGhyb3cgbmV3IF90LkVycm5vRXJyb3Iobik7ci5ub2RlX29wcy5zZXRhdHRyKHIse3NpemU6dCx0aW1lc3RhbXA6RGF0ZS5ub3coKX0pfSxmdHJ1bmNhdGU6KGUsdCk9Pnt2YXIgcj1fdC5nZXRTdHJlYW0oZSk7aWYoIXIpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoOCk7aWYoMD09KDIwOTcxNTUmci5mbGFncykpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoMjgpO190LnRydW5jYXRlKHIubm9kZSx0KX0sdXRpbWU6KGUsdCxyKT0+e3ZhciBuPV90Lmxvb2t1cFBhdGgoZSx7Zm9sbG93OiEwfSkubm9kZTtuLm5vZGVfb3BzLnNldGF0dHIobix7dGltZXN0YW1wOk1hdGgubWF4KHQscil9KX0sb3BlbjoodCxyLG4pPT57aWYoIiI9PT10KXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDQ0KTt2YXIgbztpZihuPXZvaWQgMD09PW4/NDM4Om4sbj02NCYocj0ic3RyaW5nIj09dHlwZW9mIHI/X3QubW9kZVN0cmluZ1RvRmxhZ3Mocik6cik/NDA5NSZufDMyNzY4OjAsIm9iamVjdCI9PXR5cGVvZiB0KW89dDtlbHNle3Q9bXQubm9ybWFsaXplKHQpO3RyeXtvPV90Lmxvb2t1cFBhdGgodCx7Zm9sbG93OiEoMTMxMDcyJnIpfSkubm9kZX1jYXRjaChlKXt9fXZhciBhPSExO2lmKDY0JnIpaWYobyl7aWYoMTI4JnIpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoMjApfWVsc2Ugbz1fdC5ta25vZCh0LG4sMCksYT0hMDtpZighbyl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig0NCk7aWYoX3QuaXNDaHJkZXYoby5tb2RlKSYmKHImPS01MTMpLDY1NTM2JnImJiFfdC5pc0RpcihvLm1vZGUpKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDU0KTtpZighYSl7dmFyIGk9X3QubWF5T3BlbihvLHIpO2lmKGkpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoaSl9NTEyJnImJiFhJiZfdC50cnVuY2F0ZShvLDApLHImPS0xMzE3MTM7dmFyIHM9X3QuY3JlYXRlU3RyZWFtKHtub2RlOm8scGF0aDpfdC5nZXRQYXRoKG8pLGZsYWdzOnIsc2Vla2FibGU6ITAscG9zaXRpb246MCxzdHJlYW1fb3BzOm8uc3RyZWFtX29wcyx1bmdvdHRlbjpbXSxlcnJvcjohMX0pO3JldHVybiBzLnN0cmVhbV9vcHMub3BlbiYmcy5zdHJlYW1fb3BzLm9wZW4ocyksIWUubG9nUmVhZEZpbGVzfHwxJnJ8fChfdC5yZWFkRmlsZXN8fChfdC5yZWFkRmlsZXM9e30pLHQgaW4gX3QucmVhZEZpbGVzfHwoX3QucmVhZEZpbGVzW3RdPTEpKSxzfSxjbG9zZTplPT57aWYoX3QuaXNDbG9zZWQoZSkpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoOCk7ZS5nZXRkZW50cyYmKGUuZ2V0ZGVudHM9bnVsbCk7dHJ5e2Uuc3RyZWFtX29wcy5jbG9zZSYmZS5zdHJlYW1fb3BzLmNsb3NlKGUpfWNhdGNoKGUpe3Rocm93IGV9ZmluYWxseXtfdC5jbG9zZVN0cmVhbShlLmZkKX1lLmZkPW51bGx9LGlzQ2xvc2VkOmU9Pm51bGw9PT1lLmZkLGxsc2VlazooZSx0LHIpPT57aWYoX3QuaXNDbG9zZWQoZSkpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoOCk7aWYoIWUuc2Vla2FibGV8fCFlLnN0cmVhbV9vcHMubGxzZWVrKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDcwKTtpZigwIT1yJiYxIT1yJiYyIT1yKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDI4KTtyZXR1cm4gZS5wb3NpdGlvbj1lLnN0cmVhbV9vcHMubGxzZWVrKGUsdCxyKSxlLnVuZ290dGVuPVtdLGUucG9zaXRpb259LHJlYWQ6KGUsdCxyLG4sbyk9PntpZihuPDB8fG88MCl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigyOCk7aWYoX3QuaXNDbG9zZWQoZSkpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoOCk7aWYoMT09KDIwOTcxNTUmZS5mbGFncykpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoOCk7aWYoX3QuaXNEaXIoZS5ub2RlLm1vZGUpKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDMxKTtpZighZS5zdHJlYW1fb3BzLnJlYWQpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoMjgpO3ZhciBhPXZvaWQgMCE9PW87aWYoYSl7aWYoIWUuc2Vla2FibGUpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoNzApfWVsc2Ugbz1lLnBvc2l0aW9uO3ZhciBpPWUuc3RyZWFtX29wcy5yZWFkKGUsdCxyLG4sbyk7cmV0dXJuIGF8fChlLnBvc2l0aW9uKz1pKSxpfSx3cml0ZTooZSx0LHIsbixvLGEpPT57aWYobjwwfHxvPDApdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoMjgpO2lmKF90LmlzQ2xvc2VkKGUpKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDgpO2lmKDA9PSgyMDk3MTU1JmUuZmxhZ3MpKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDgpO2lmKF90LmlzRGlyKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigzMSk7aWYoIWUuc3RyZWFtX29wcy53cml0ZSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigyOCk7ZS5zZWVrYWJsZSYmMTAyNCZlLmZsYWdzJiZfdC5sbHNlZWsoZSwwLDIpO3ZhciBpPXZvaWQgMCE9PW87aWYoaSl7aWYoIWUuc2Vla2FibGUpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoNzApfWVsc2Ugbz1lLnBvc2l0aW9uO3ZhciBzPWUuc3RyZWFtX29wcy53cml0ZShlLHQscixuLG8sYSk7cmV0dXJuIGl8fChlLnBvc2l0aW9uKz1zKSxzfSxhbGxvY2F0ZTooZSx0LHIpPT57aWYoX3QuaXNDbG9zZWQoZSkpdGhyb3cgbmV3IF90LkVycm5vRXJyb3IoOCk7aWYodDwwfHxyPD0wKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDI4KTtpZigwPT0oMjA5NzE1NSZlLmZsYWdzKSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig4KTtpZighX3QuaXNGaWxlKGUubm9kZS5tb2RlKSYmIV90LmlzRGlyKGUubm9kZS5tb2RlKSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig0Myk7aWYoIWUuc3RyZWFtX29wcy5hbGxvY2F0ZSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigxMzgpO2Uuc3RyZWFtX29wcy5hbGxvY2F0ZShlLHQscil9LG1tYXA6KGUsdCxyLG4sbyk9PntpZigwIT0oMiZuKSYmMD09KDImbykmJjIhPSgyMDk3MTU1JmUuZmxhZ3MpKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDIpO2lmKDE9PSgyMDk3MTU1JmUuZmxhZ3MpKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDIpO2lmKCFlLnN0cmVhbV9vcHMubW1hcCl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig0Myk7cmV0dXJuIGUuc3RyZWFtX29wcy5tbWFwKGUsdCxyLG4sbyl9LG1zeW5jOihlLHQscixuLG8pPT5lLnN0cmVhbV9vcHMubXN5bmM/ZS5zdHJlYW1fb3BzLm1zeW5jKGUsdCxyLG4sbyk6MCxtdW5tYXA6ZT0+MCxpb2N0bDooZSx0LHIpPT57aWYoIWUuc3RyZWFtX29wcy5pb2N0bCl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig1OSk7cmV0dXJuIGUuc3RyZWFtX29wcy5pb2N0bChlLHQscil9LHJlYWRGaWxlOihlLHQ9e30pPT57aWYodC5mbGFncz10LmZsYWdzfHwwLHQuZW5jb2Rpbmc9dC5lbmNvZGluZ3x8ImJpbmFyeSIsInV0ZjgiIT09dC5lbmNvZGluZyYmImJpbmFyeSIhPT10LmVuY29kaW5nKXRocm93IG5ldyBFcnJvcignSW52YWxpZCBlbmNvZGluZyB0eXBlICInK3QuZW5jb2RpbmcrJyInKTt2YXIgcixuPV90Lm9wZW4oZSx0LmZsYWdzKSxvPV90LnN0YXQoZSkuc2l6ZSxhPW5ldyBVaW50OEFycmF5KG8pO3JldHVybiBfdC5yZWFkKG4sYSwwLG8sMCksInV0ZjgiPT09dC5lbmNvZGluZz9yPVQoYSwwKToiYmluYXJ5Ij09PXQuZW5jb2RpbmcmJihyPWEpLF90LmNsb3NlKG4pLHJ9LHdyaXRlRmlsZTooZSx0LHI9e30pPT57ci5mbGFncz1yLmZsYWdzfHw1Nzc7dmFyIG49X3Qub3BlbihlLHIuZmxhZ3Msci5tb2RlKTtpZigic3RyaW5nIj09dHlwZW9mIHQpe3ZhciBvPW5ldyBVaW50OEFycmF5KEModCkrMSksYT1EKHQsbywwLG8ubGVuZ3RoKTtfdC53cml0ZShuLG8sMCxhLHZvaWQgMCxyLmNhbk93bil9ZWxzZXtpZighQXJyYXlCdWZmZXIuaXNWaWV3KHQpKXRocm93IG5ldyBFcnJvcigiVW5zdXBwb3J0ZWQgZGF0YSB0eXBlIik7X3Qud3JpdGUobix0LDAsdC5ieXRlTGVuZ3RoLHZvaWQgMCxyLmNhbk93bil9X3QuY2xvc2Uobil9LGN3ZDooKT0+X3QuY3VycmVudFBhdGgsY2hkaXI6ZT0+e3ZhciB0PV90Lmxvb2t1cFBhdGgoZSx7Zm9sbG93OiEwfSk7aWYobnVsbD09PXQubm9kZSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig0NCk7aWYoIV90LmlzRGlyKHQubm9kZS5tb2RlKSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig1NCk7dmFyIHI9X3Qubm9kZVBlcm1pc3Npb25zKHQubm9kZSwieCIpO2lmKHIpdGhyb3cgbmV3IF90LkVycm5vRXJyb3Iocik7X3QuY3VycmVudFBhdGg9dC5wYXRofSxjcmVhdGVEZWZhdWx0RGlyZWN0b3JpZXM6KCk9PntfdC5ta2RpcigiL3RtcCIpLF90Lm1rZGlyKCIvaG9tZSIpLF90Lm1rZGlyKCIvaG9tZS93ZWJfdXNlciIpfSxjcmVhdGVEZWZhdWx0RGV2aWNlczooKT0+e190Lm1rZGlyKCIvZGV2IiksX3QucmVnaXN0ZXJEZXZpY2UoX3QubWFrZWRldigxLDMpLHtyZWFkOigpPT4wLHdyaXRlOihlLHQscixuLG8pPT5ufSksX3QubWtkZXYoIi9kZXYvbnVsbCIsX3QubWFrZWRldigxLDMpKSxndC5yZWdpc3RlcihfdC5tYWtlZGV2KDUsMCksZ3QuZGVmYXVsdF90dHlfb3BzKSxndC5yZWdpc3RlcihfdC5tYWtlZGV2KDYsMCksZ3QuZGVmYXVsdF90dHkxX29wcyksX3QubWtkZXYoIi9kZXYvdHR5IixfdC5tYWtlZGV2KDUsMCkpLF90Lm1rZGV2KCIvZGV2L3R0eTEiLF90Lm1ha2VkZXYoNiwwKSk7dmFyIGU9ZnVuY3Rpb24oKXtpZigib2JqZWN0Ij09dHlwZW9mIGNyeXB0byYmImZ1bmN0aW9uIj09dHlwZW9mIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMpe3ZhciBlPW5ldyBVaW50OEFycmF5KDEpO3JldHVybigpPT4oY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhlKSxlWzBdKX1yZXR1cm4oKT0+TCgicmFuZG9tRGV2aWNlIil9KCk7X3QuY3JlYXRlRGV2aWNlKCIvZGV2IiwicmFuZG9tIixlKSxfdC5jcmVhdGVEZXZpY2UoIi9kZXYiLCJ1cmFuZG9tIixlKSxfdC5ta2RpcigiL2Rldi9zaG0iKSxfdC5ta2RpcigiL2Rldi9zaG0vdG1wIil9LGNyZWF0ZVNwZWNpYWxEaXJlY3RvcmllczooKT0+e190Lm1rZGlyKCIvcHJvYyIpO3ZhciBlPV90Lm1rZGlyKCIvcHJvYy9zZWxmIik7X3QubWtkaXIoIi9wcm9jL3NlbGYvZmQiKSxfdC5tb3VudCh7bW91bnQ6KCk9Pnt2YXIgdD1fdC5jcmVhdGVOb2RlKGUsImZkIiwxNjg5NSw3Myk7cmV0dXJuIHQubm9kZV9vcHM9e2xvb2t1cDooZSx0KT0+e3ZhciByPSt0LG49X3QuZ2V0U3RyZWFtKHIpO2lmKCFuKXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDgpO3ZhciBvPXtwYXJlbnQ6bnVsbCxtb3VudDp7bW91bnRwb2ludDoiZmFrZSJ9LG5vZGVfb3BzOntyZWFkbGluazooKT0+bi5wYXRofX07cmV0dXJuIG8ucGFyZW50PW8sb319LHR9fSx7fSwiL3Byb2Mvc2VsZi9mZCIpfSxjcmVhdGVTdGFuZGFyZFN0cmVhbXM6KCk9PntlLnN0ZGluP190LmNyZWF0ZURldmljZSgiL2RldiIsInN0ZGluIixlLnN0ZGluKTpfdC5zeW1saW5rKCIvZGV2L3R0eSIsIi9kZXYvc3RkaW4iKSxlLnN0ZG91dD9fdC5jcmVhdGVEZXZpY2UoIi9kZXYiLCJzdGRvdXQiLG51bGwsZS5zdGRvdXQpOl90LnN5bWxpbmsoIi9kZXYvdHR5IiwiL2Rldi9zdGRvdXQiKSxlLnN0ZGVycj9fdC5jcmVhdGVEZXZpY2UoIi9kZXYiLCJzdGRlcnIiLG51bGwsZS5zdGRlcnIpOl90LnN5bWxpbmsoIi9kZXYvdHR5MSIsIi9kZXYvc3RkZXJyIiksX3Qub3BlbigiL2Rldi9zdGRpbiIsMCksX3Qub3BlbigiL2Rldi9zdGRvdXQiLDEpLF90Lm9wZW4oIi9kZXYvc3RkZXJyIiwxKX0sZW5zdXJlRXJybm9FcnJvcjooKT0+e190LkVycm5vRXJyb3J8fChfdC5FcnJub0Vycm9yPWZ1bmN0aW9uKGUsdCl7dGhpcy5ub2RlPXQsdGhpcy5zZXRFcnJubz1mdW5jdGlvbihlKXt0aGlzLmVycm5vPWV9LHRoaXMuc2V0RXJybm8oZSksdGhpcy5tZXNzYWdlPSJGUyBlcnJvciJ9LF90LkVycm5vRXJyb3IucHJvdG90eXBlPW5ldyBFcnJvcixfdC5FcnJub0Vycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj1fdC5FcnJub0Vycm9yLFs0NF0uZm9yRWFjaCgoZT0+e190LmdlbmVyaWNFcnJvcnNbZV09bmV3IF90LkVycm5vRXJyb3IoZSksX3QuZ2VuZXJpY0Vycm9yc1tlXS5zdGFjaz0iPGdlbmVyaWMgZXJyb3IsIG5vIHN0YWNrPiJ9KSkpfSxzdGF0aWNJbml0OigpPT57X3QuZW5zdXJlRXJybm9FcnJvcigpLF90Lm5hbWVUYWJsZT1uZXcgQXJyYXkoNDA5NiksX3QubW91bnQoRXQse30sIi8iKSxfdC5jcmVhdGVEZWZhdWx0RGlyZWN0b3JpZXMoKSxfdC5jcmVhdGVEZWZhdWx0RGV2aWNlcygpLF90LmNyZWF0ZVNwZWNpYWxEaXJlY3RvcmllcygpLF90LmZpbGVzeXN0ZW1zPXtNRU1GUzpFdH19LGluaXQ6KHQscixuKT0+e190LmluaXQuaW5pdGlhbGl6ZWQ9ITAsX3QuZW5zdXJlRXJybm9FcnJvcigpLGUuc3RkaW49dHx8ZS5zdGRpbixlLnN0ZG91dD1yfHxlLnN0ZG91dCxlLnN0ZGVycj1ufHxlLnN0ZGVycixfdC5jcmVhdGVTdGFuZGFyZFN0cmVhbXMoKX0scXVpdDooKT0+e190LmluaXQuaW5pdGlhbGl6ZWQ9ITE7Zm9yKHZhciBlPTA7ZTxfdC5zdHJlYW1zLmxlbmd0aDtlKyspe3ZhciB0PV90LnN0cmVhbXNbZV07dCYmX3QuY2xvc2UodCl9fSxnZXRNb2RlOihlLHQpPT57dmFyIHI9MDtyZXR1cm4gZSYmKHJ8PTM2NSksdCYmKHJ8PTE0Nikscn0sZmluZE9iamVjdDooZSx0KT0+e3ZhciByPV90LmFuYWx5emVQYXRoKGUsdCk7cmV0dXJuIHIuZXhpc3RzP3Iub2JqZWN0Om51bGx9LGFuYWx5emVQYXRoOihlLHQpPT57dHJ5e2U9KG49X3QubG9va3VwUGF0aChlLHtmb2xsb3c6IXR9KSkucGF0aH1jYXRjaChlKXt9dmFyIHI9e2lzUm9vdDohMSxleGlzdHM6ITEsZXJyb3I6MCxuYW1lOm51bGwscGF0aDpudWxsLG9iamVjdDpudWxsLHBhcmVudEV4aXN0czohMSxwYXJlbnRQYXRoOm51bGwscGFyZW50T2JqZWN0Om51bGx9O3RyeXt2YXIgbj1fdC5sb29rdXBQYXRoKGUse3BhcmVudDohMH0pO3IucGFyZW50RXhpc3RzPSEwLHIucGFyZW50UGF0aD1uLnBhdGgsci5wYXJlbnRPYmplY3Q9bi5ub2RlLHIubmFtZT1tdC5iYXNlbmFtZShlKSxuPV90Lmxvb2t1cFBhdGgoZSx7Zm9sbG93OiF0fSksci5leGlzdHM9ITAsci5wYXRoPW4ucGF0aCxyLm9iamVjdD1uLm5vZGUsci5uYW1lPW4ubm9kZS5uYW1lLHIuaXNSb290PSIvIj09PW4ucGF0aH1jYXRjaChlKXtyLmVycm9yPWUuZXJybm99cmV0dXJuIHJ9LGNyZWF0ZVBhdGg6KGUsdCxyLG4pPT57ZT0ic3RyaW5nIj09dHlwZW9mIGU/ZTpfdC5nZXRQYXRoKGUpO2Zvcih2YXIgbz10LnNwbGl0KCIvIikucmV2ZXJzZSgpO28ubGVuZ3RoOyl7dmFyIGE9by5wb3AoKTtpZihhKXt2YXIgaT1tdC5qb2luMihlLGEpO3RyeXtfdC5ta2RpcihpKX1jYXRjaChlKXt9ZT1pfX1yZXR1cm4gaX0sY3JlYXRlRmlsZTooZSx0LHIsbixvKT0+e3ZhciBhPW10LmpvaW4yKCJzdHJpbmciPT10eXBlb2YgZT9lOl90LmdldFBhdGgoZSksdCksaT1fdC5nZXRNb2RlKG4sbyk7cmV0dXJuIF90LmNyZWF0ZShhLGkpfSxjcmVhdGVEYXRhRmlsZTooZSx0LHIsbixvLGEpPT57dmFyIGk9dDtlJiYoZT0ic3RyaW5nIj09dHlwZW9mIGU/ZTpfdC5nZXRQYXRoKGUpLGk9dD9tdC5qb2luMihlLHQpOmUpO3ZhciBzPV90LmdldE1vZGUobixvKSx1PV90LmNyZWF0ZShpLHMpO2lmKHIpe2lmKCJzdHJpbmciPT10eXBlb2Ygcil7Zm9yKHZhciBjPW5ldyBBcnJheShyLmxlbmd0aCksbD0wLGQ9ci5sZW5ndGg7bDxkOysrbCljW2xdPXIuY2hhckNvZGVBdChsKTtyPWN9X3QuY2htb2QodSwxNDZ8cyk7dmFyIGY9X3Qub3Blbih1LDU3Nyk7X3Qud3JpdGUoZixyLDAsci5sZW5ndGgsMCxhKSxfdC5jbG9zZShmKSxfdC5jaG1vZCh1LHMpfXJldHVybiB1fSxjcmVhdGVEZXZpY2U6KGUsdCxyLG4pPT57dmFyIG89bXQuam9pbjIoInN0cmluZyI9PXR5cGVvZiBlP2U6X3QuZ2V0UGF0aChlKSx0KSxhPV90LmdldE1vZGUoISFyLCEhbik7X3QuY3JlYXRlRGV2aWNlLm1ham9yfHwoX3QuY3JlYXRlRGV2aWNlLm1ham9yPTY0KTt2YXIgaT1fdC5tYWtlZGV2KF90LmNyZWF0ZURldmljZS5tYWpvcisrLDApO3JldHVybiBfdC5yZWdpc3RlckRldmljZShpLHtvcGVuOmU9PntlLnNlZWthYmxlPSExfSxjbG9zZTplPT57biYmbi5idWZmZXImJm4uYnVmZmVyLmxlbmd0aCYmbigxMCl9LHJlYWQ6KGUsdCxuLG8sYSk9Pntmb3IodmFyIGk9MCxzPTA7czxvO3MrKyl7dmFyIHU7dHJ5e3U9cigpfWNhdGNoKGUpe3Rocm93IG5ldyBfdC5FcnJub0Vycm9yKDI5KX1pZih2b2lkIDA9PT11JiYwPT09aSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig2KTtpZihudWxsPT11KWJyZWFrO2krKyx0W24rc109dX1yZXR1cm4gaSYmKGUubm9kZS50aW1lc3RhbXA9RGF0ZS5ub3coKSksaX0sd3JpdGU6KGUsdCxyLG8sYSk9Pntmb3IodmFyIGk9MDtpPG87aSsrKXRyeXtuKHRbcitpXSl9Y2F0Y2goZSl7dGhyb3cgbmV3IF90LkVycm5vRXJyb3IoMjkpfXJldHVybiBvJiYoZS5ub2RlLnRpbWVzdGFtcD1EYXRlLm5vdygpKSxpfX0pLF90Lm1rZGV2KG8sYSxpKX0sZm9yY2VMb2FkRmlsZTplPT57aWYoZS5pc0RldmljZXx8ZS5pc0ZvbGRlcnx8ZS5saW5rfHxlLmNvbnRlbnRzKXJldHVybiEwO2lmKCJ1bmRlZmluZWQiIT10eXBlb2YgWE1MSHR0cFJlcXVlc3QpdGhyb3cgbmV3IEVycm9yKCJMYXp5IGxvYWRpbmcgc2hvdWxkIGhhdmUgYmVlbiBwZXJmb3JtZWQgKGNvbnRlbnRzIHNldCkgaW4gY3JlYXRlTGF6eUZpbGUsIGJ1dCBpdCB3YXMgbm90LiBMYXp5IGxvYWRpbmcgb25seSB3b3JrcyBpbiB3ZWIgd29ya2Vycy4gVXNlIC0tZW1iZWQtZmlsZSBvciAtLXByZWxvYWQtZmlsZSBpbiBlbWNjIG9uIHRoZSBtYWluIHRocmVhZC4iKTtpZighbil0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBsb2FkIHdpdGhvdXQgcmVhZCgpIG9yIFhNTEh0dHBSZXF1ZXN0LiIpO3RyeXtlLmNvbnRlbnRzPXl0KG4oZS51cmwpLCEwKSxlLnVzZWRCeXRlcz1lLmNvbnRlbnRzLmxlbmd0aH1jYXRjaChlKXt0aHJvdyBuZXcgX3QuRXJybm9FcnJvcigyOSl9fSxjcmVhdGVMYXp5RmlsZTooZSx0LHIsbixvKT0+e2Z1bmN0aW9uIGEoKXt0aGlzLmxlbmd0aEtub3duPSExLHRoaXMuY2h1bmtzPVtdfWlmKGEucHJvdG90eXBlLmdldD1mdW5jdGlvbihlKXtpZighKGU+dGhpcy5sZW5ndGgtMXx8ZTwwKSl7dmFyIHQ9ZSV0aGlzLmNodW5rU2l6ZSxyPWUvdGhpcy5jaHVua1NpemV8MDtyZXR1cm4gdGhpcy5nZXR0ZXIocilbdF19fSxhLnByb3RvdHlwZS5zZXREYXRhR2V0dGVyPWZ1bmN0aW9uKGUpe3RoaXMuZ2V0dGVyPWV9LGEucHJvdG90eXBlLmNhY2hlTGVuZ3RoPWZ1bmN0aW9uKCl7dmFyIGU9bmV3IFhNTEh0dHBSZXF1ZXN0O2lmKGUub3BlbigiSEVBRCIsciwhMSksZS5zZW5kKG51bGwpLCEoZS5zdGF0dXM+PTIwMCYmZS5zdGF0dXM8MzAwfHwzMDQ9PT1lLnN0YXR1cykpdGhyb3cgbmV3IEVycm9yKCJDb3VsZG4ndCBsb2FkICIrcisiLiBTdGF0dXM6ICIrZS5zdGF0dXMpO3ZhciB0LG49TnVtYmVyKGUuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtbGVuZ3RoIikpLG89KHQ9ZS5nZXRSZXNwb25zZUhlYWRlcigiQWNjZXB0LVJhbmdlcyIpKSYmImJ5dGVzIj09PXQsYT0odD1lLmdldFJlc3BvbnNlSGVhZGVyKCJDb250ZW50LUVuY29kaW5nIikpJiYiZ3ppcCI9PT10LGk9MTA0ODU3NjtvfHwoaT1uKTt2YXIgcz10aGlzO3Muc2V0RGF0YUdldHRlcigoZT0+e3ZhciB0PWUqaSxvPShlKzEpKmktMTtpZihvPU1hdGgubWluKG8sbi0xKSx2b2lkIDA9PT1zLmNodW5rc1tlXSYmKHMuY2h1bmtzW2VdPSgoZSx0KT0+e2lmKGU+dCl0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgcmFuZ2UgKCIrZSsiLCAiK3QrIikgb3Igbm8gYnl0ZXMgcmVxdWVzdGVkISIpO2lmKHQ+bi0xKXRocm93IG5ldyBFcnJvcigib25seSAiK24rIiBieXRlcyBhdmFpbGFibGUhIHByb2dyYW1tZXIgZXJyb3IhIik7dmFyIG89bmV3IFhNTEh0dHBSZXF1ZXN0O2lmKG8ub3BlbigiR0VUIixyLCExKSxuIT09aSYmby5zZXRSZXF1ZXN0SGVhZGVyKCJSYW5nZSIsImJ5dGVzPSIrZSsiLSIrdCksby5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIixvLm92ZXJyaWRlTWltZVR5cGUmJm8ub3ZlcnJpZGVNaW1lVHlwZSgidGV4dC9wbGFpbjsgY2hhcnNldD14LXVzZXItZGVmaW5lZCIpLG8uc2VuZChudWxsKSwhKG8uc3RhdHVzPj0yMDAmJm8uc3RhdHVzPDMwMHx8MzA0PT09by5zdGF0dXMpKXRocm93IG5ldyBFcnJvcigiQ291bGRuJ3QgbG9hZCAiK3IrIi4gU3RhdHVzOiAiK28uc3RhdHVzKTtyZXR1cm4gdm9pZCAwIT09by5yZXNwb25zZT9uZXcgVWludDhBcnJheShvLnJlc3BvbnNlfHxbXSk6eXQoby5yZXNwb25zZVRleHR8fCIiLCEwKX0pKHQsbykpLHZvaWQgMD09PXMuY2h1bmtzW2VdKXRocm93IG5ldyBFcnJvcigiZG9YSFIgZmFpbGVkISIpO3JldHVybiBzLmNodW5rc1tlXX0pKSwhYSYmbnx8KGk9bj0xLG49dGhpcy5nZXR0ZXIoMCkubGVuZ3RoLGk9bixsKCJMYXp5RmlsZXMgb24gZ3ppcCBmb3JjZXMgZG93bmxvYWQgb2YgdGhlIHdob2xlIGZpbGUgd2hlbiBsZW5ndGggaXMgYWNjZXNzZWQiKSksdGhpcy5fbGVuZ3RoPW4sdGhpcy5fY2h1bmtTaXplPWksdGhpcy5sZW5ndGhLbm93bj0hMH0sInVuZGVmaW5lZCIhPXR5cGVvZiBYTUxIdHRwUmVxdWVzdCl0aHJvdyJDYW5ub3QgZG8gc3luY2hyb25vdXMgYmluYXJ5IFhIUnMgb3V0c2lkZSB3ZWJ3b3JrZXJzIGluIG1vZGVybiBicm93c2Vycy4gVXNlIC0tZW1iZWQtZmlsZSBvciAtLXByZWxvYWQtZmlsZSBpbiBlbWNjIjt2YXIgaT17aXNEZXZpY2U6ITEsdXJsOnJ9LHM9X3QuY3JlYXRlRmlsZShlLHQsaSxuLG8pO2kuY29udGVudHM/cy5jb250ZW50cz1pLmNvbnRlbnRzOmkudXJsJiYocy5jb250ZW50cz1udWxsLHMudXJsPWkudXJsKSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyhzLHt1c2VkQnl0ZXM6e2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbnRlbnRzLmxlbmd0aH19fSk7dmFyIHU9e307ZnVuY3Rpb24gYyhlLHQscixuLG8pe3ZhciBhPWUubm9kZS5jb250ZW50cztpZihvPj1hLmxlbmd0aClyZXR1cm4gMDt2YXIgaT1NYXRoLm1pbihhLmxlbmd0aC1vLG4pO2lmKGEuc2xpY2UpZm9yKHZhciBzPTA7czxpO3MrKyl0W3Irc109YVtvK3NdO2Vsc2UgZm9yKHM9MDtzPGk7cysrKXRbcitzXT1hLmdldChvK3MpO3JldHVybiBpfXJldHVybiBPYmplY3Qua2V5cyhzLnN0cmVhbV9vcHMpLmZvckVhY2goKGU9Pnt2YXIgdD1zLnN0cmVhbV9vcHNbZV07dVtlXT1mdW5jdGlvbigpe3JldHVybiBfdC5mb3JjZUxvYWRGaWxlKHMpLHQuYXBwbHkobnVsbCxhcmd1bWVudHMpfX0pKSx1LnJlYWQ9KGUsdCxyLG4sbyk9PihfdC5mb3JjZUxvYWRGaWxlKHMpLGMoZSx0LHIsbixvKSksdS5tbWFwPShlLHQscixuLG8pPT57X3QuZm9yY2VMb2FkRmlsZShzKTt2YXIgYT13dCh0KTtpZighYSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig0OCk7cmV0dXJuIGMoZSx2LGEsdCxyKSx7cHRyOmEsYWxsb2NhdGVkOiEwfX0scy5zdHJlYW1fb3BzPXUsc30sY3JlYXRlUHJlbG9hZGVkRmlsZTooZSx0LHIsbixhLGkscyx1LGMsbCk9Pnt2YXIgZD10P3Z0LnJlc29sdmUobXQuam9pbjIoZSx0KSk6ZTtmdW5jdGlvbiBmKHIpe2Z1bmN0aW9uIG8ocil7bCYmbCgpLHV8fF90LmNyZWF0ZURhdGFGaWxlKGUsdCxyLG4sYSxjKSxpJiZpKCksVygpfUJyb3dzZXIuaGFuZGxlZEJ5UHJlbG9hZFBsdWdpbihyLGQsbywoKCk9PntzJiZzKCksVygpfSkpfHxvKHIpfUIoKSwic3RyaW5nIj09dHlwZW9mIHI/ZnVuY3Rpb24oZSx0LHIsbil7dmFyIGE9ImFsICIrZTtvKGUsKHQ9PntoKHQsJ0xvYWRpbmcgZGF0YSBmaWxlICInK2UrJyIgZmFpbGVkIChubyBhcnJheUJ1ZmZlcikuJyksZihuZXcgVWludDhBcnJheSh0KSksYSYmVygpfSksKHQ9PntpZighcil0aHJvdydMb2FkaW5nIGRhdGEgZmlsZSAiJytlKyciIGZhaWxlZC4nO3IoKX0pKSxhJiZCKCl9KHIsMCxzKTpmKHIpfSxpbmRleGVkREI6KCk9PndpbmRvdy5pbmRleGVkREJ8fHdpbmRvdy5tb3pJbmRleGVkREJ8fHdpbmRvdy53ZWJraXRJbmRleGVkREJ8fHdpbmRvdy5tc0luZGV4ZWREQixEQl9OQU1FOigpPT4iRU1fRlNfIit3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUsREJfVkVSU0lPTjoyMCxEQl9TVE9SRV9OQU1FOiJGSUxFX0RBVEEiLHNhdmVGaWxlc1RvREI6KGUsdCxyKT0+e3Q9dHx8KCgpPT57fSkscj1yfHwoKCk9Pnt9KTt2YXIgbj1fdC5pbmRleGVkREIoKTt0cnl7dmFyIG89bi5vcGVuKF90LkRCX05BTUUoKSxfdC5EQl9WRVJTSU9OKX1jYXRjaChlKXtyZXR1cm4gcihlKX1vLm9udXBncmFkZW5lZWRlZD0oKT0+e2woImNyZWF0aW5nIGRiIiksby5yZXN1bHQuY3JlYXRlT2JqZWN0U3RvcmUoX3QuREJfU1RPUkVfTkFNRSl9LG8ub25zdWNjZXNzPSgpPT57dmFyIG49by5yZXN1bHQudHJhbnNhY3Rpb24oW190LkRCX1NUT1JFX05BTUVdLCJyZWFkd3JpdGUiKSxhPW4ub2JqZWN0U3RvcmUoX3QuREJfU1RPUkVfTkFNRSksaT0wLHM9MCx1PWUubGVuZ3RoO2Z1bmN0aW9uIGMoKXswPT1zP3QoKTpyKCl9ZS5mb3JFYWNoKChlPT57dmFyIHQ9YS5wdXQoX3QuYW5hbHl6ZVBhdGgoZSkub2JqZWN0LmNvbnRlbnRzLGUpO3Qub25zdWNjZXNzPSgpPT57KytpK3M9PXUmJmMoKX0sdC5vbmVycm9yPSgpPT57cysrLGkrcz09dSYmYygpfX0pKSxuLm9uZXJyb3I9cn0sby5vbmVycm9yPXJ9LGxvYWRGaWxlc0Zyb21EQjooZSx0LHIpPT57dD10fHwoKCk9Pnt9KSxyPXJ8fCgoKT0+e30pO3ZhciBuPV90LmluZGV4ZWREQigpO3RyeXt2YXIgbz1uLm9wZW4oX3QuREJfTkFNRSgpLF90LkRCX1ZFUlNJT04pfWNhdGNoKGUpe3JldHVybiByKGUpfW8ub251cGdyYWRlbmVlZGVkPXIsby5vbnN1Y2Nlc3M9KCk9Pnt2YXIgbj1vLnJlc3VsdDt0cnl7dmFyIGE9bi50cmFuc2FjdGlvbihbX3QuREJfU1RPUkVfTkFNRV0sInJlYWRvbmx5Iil9Y2F0Y2goZSl7cmV0dXJuIHZvaWQgcihlKX12YXIgaT1hLm9iamVjdFN0b3JlKF90LkRCX1NUT1JFX05BTUUpLHM9MCx1PTAsYz1lLmxlbmd0aDtmdW5jdGlvbiBsKCl7MD09dT90KCk6cigpfWUuZm9yRWFjaCgoZT0+e3ZhciB0PWkuZ2V0KGUpO3Qub25zdWNjZXNzPSgpPT57X3QuYW5hbHl6ZVBhdGgoZSkuZXhpc3RzJiZfdC51bmxpbmsoZSksX3QuY3JlYXRlRGF0YUZpbGUobXQuZGlybmFtZShlKSxtdC5iYXNlbmFtZShlKSx0LnJlc3VsdCwhMCwhMCwhMCksKytzK3U9PWMmJmwoKX0sdC5vbmVycm9yPSgpPT57dSsrLHMrdT09YyYmbCgpfX0pKSxhLm9uZXJyb3I9cn0sby5vbmVycm9yPXJ9fSxidD17REVGQVVMVF9QT0xMTUFTSzo1LGNhbGN1bGF0ZUF0OmZ1bmN0aW9uKGUsdCxyKXtpZihtdC5pc0Ficyh0KSlyZXR1cm4gdDt2YXIgbjtpZihuPS0xMDA9PT1lP190LmN3ZCgpOmJ0LmdldFN0cmVhbUZyb21GRChlKS5wYXRoLDA9PXQubGVuZ3RoKXtpZighcil0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig0NCk7cmV0dXJuIG59cmV0dXJuIG10LmpvaW4yKG4sdCl9LGRvU3RhdDpmdW5jdGlvbihlLHQscil7dHJ5e3ZhciBuPWUodCl9Y2F0Y2goZSl7aWYoZSYmZS5ub2RlJiZtdC5ub3JtYWxpemUodCkhPT1tdC5ub3JtYWxpemUoX3QuZ2V0UGF0aChlLm5vZGUpKSlyZXR1cm4tNTQ7dGhyb3cgZX1FW3I+PjJdPW4uZGV2LEVbcis4Pj4yXT1uLmlubyxFW3IrMTI+PjJdPW4ubW9kZSxfW3IrMTY+PjJdPW4ubmxpbmssRVtyKzIwPj4yXT1uLnVpZCxFW3IrMjQ+PjJdPW4uZ2lkLEVbcisyOD4+Ml09bi5yZGV2LHg9W24uc2l6ZT4+PjAsKCQ9bi5zaXplLCtNYXRoLmFicygkKT49MT8kPjA/KDB8TWF0aC5taW4oK01hdGguZmxvb3IoJC80Mjk0OTY3Mjk2KSw0Mjk0OTY3Mjk1KSk+Pj4wOn5+K01hdGguY2VpbCgoJC0rKH5+JD4+PjApKS80Mjk0OTY3Mjk2KT4+PjA6MCldLEVbcis0MD4+Ml09eFswXSxFW3IrNDQ+PjJdPXhbMV0sRVtyKzQ4Pj4yXT00MDk2LEVbcis1Mj4+Ml09bi5ibG9ja3M7dmFyIG89bi5hdGltZS5nZXRUaW1lKCksYT1uLm10aW1lLmdldFRpbWUoKSxpPW4uY3RpbWUuZ2V0VGltZSgpO3JldHVybiB4PVtNYXRoLmZsb29yKG8vMWUzKT4+PjAsKCQ9TWF0aC5mbG9vcihvLzFlMyksK01hdGguYWJzKCQpPj0xPyQ+MD8oMHxNYXRoLm1pbigrTWF0aC5mbG9vcigkLzQyOTQ5NjcyOTYpLDQyOTQ5NjcyOTUpKT4+PjA6fn4rTWF0aC5jZWlsKCgkLSsofn4kPj4+MCkpLzQyOTQ5NjcyOTYpPj4+MDowKV0sRVtyKzU2Pj4yXT14WzBdLEVbcis2MD4+Ml09eFsxXSxfW3IrNjQ+PjJdPW8lMWUzKjFlMyx4PVtNYXRoLmZsb29yKGEvMWUzKT4+PjAsKCQ9TWF0aC5mbG9vcihhLzFlMyksK01hdGguYWJzKCQpPj0xPyQ+MD8oMHxNYXRoLm1pbigrTWF0aC5mbG9vcigkLzQyOTQ5NjcyOTYpLDQyOTQ5NjcyOTUpKT4+PjA6fn4rTWF0aC5jZWlsKCgkLSsofn4kPj4+MCkpLzQyOTQ5NjcyOTYpPj4+MDowKV0sRVtyKzcyPj4yXT14WzBdLEVbcis3Nj4+Ml09eFsxXSxfW3IrODA+PjJdPWElMWUzKjFlMyx4PVtNYXRoLmZsb29yKGkvMWUzKT4+PjAsKCQ9TWF0aC5mbG9vcihpLzFlMyksK01hdGguYWJzKCQpPj0xPyQ+MD8oMHxNYXRoLm1pbigrTWF0aC5mbG9vcigkLzQyOTQ5NjcyOTYpLDQyOTQ5NjcyOTUpKT4+PjA6fn4rTWF0aC5jZWlsKCgkLSsofn4kPj4+MCkpLzQyOTQ5NjcyOTYpPj4+MDowKV0sRVtyKzg4Pj4yXT14WzBdLEVbcis5Mj4+Ml09eFsxXSxfW3IrOTY+PjJdPWklMWUzKjFlMyx4PVtuLmlubz4+PjAsKCQ9bi5pbm8sK01hdGguYWJzKCQpPj0xPyQ+MD8oMHxNYXRoLm1pbigrTWF0aC5mbG9vcigkLzQyOTQ5NjcyOTYpLDQyOTQ5NjcyOTUpKT4+PjA6fn4rTWF0aC5jZWlsKCgkLSsofn4kPj4+MCkpLzQyOTQ5NjcyOTYpPj4+MDowKV0sRVtyKzEwND4+Ml09eFswXSxFW3IrMTA4Pj4yXT14WzFdLDB9LGRvTXN5bmM6ZnVuY3Rpb24oZSx0LHIsbixvKXtpZighX3QuaXNGaWxlKHQubm9kZS5tb2RlKSl0aHJvdyBuZXcgX3QuRXJybm9FcnJvcig0Myk7aWYoMiZuKXJldHVybiAwO3ZhciBhPXkuc2xpY2UoZSxlK3IpO190Lm1zeW5jKHQsYSxvLHIsbil9LHZhcmFyZ3M6dm9pZCAwLGdldDpmdW5jdGlvbigpe3JldHVybiBidC52YXJhcmdzKz00LEVbYnQudmFyYXJncy00Pj4yXX0sZ2V0U3RyOmZ1bmN0aW9uKGUpe3JldHVybiBTKGUpfSxnZXRTdHJlYW1Gcm9tRkQ6ZnVuY3Rpb24oZSl7dmFyIHQ9X3QuZ2V0U3RyZWFtKGUpO2lmKCF0KXRocm93IG5ldyBfdC5FcnJub0Vycm9yKDgpO3JldHVybiB0fX07ZnVuY3Rpb24ga3QoZSl7cmV0dXJuIGUlND09MCYmKGUlMTAwIT0wfHxlJTQwMD09MCl9dmFyIFB0PVszMSwyOSwzMSwzMCwzMSwzMCwzMSwzMSwzMCwzMSwzMCwzMV0sVHQ9WzMxLDI4LDMxLDMwLDMxLDMwLDMxLDMxLDMwLDMxLDMwLDMxXTt1ZT1lLkludGVybmFsRXJyb3I9c2UoRXJyb3IsIkludGVybmFsRXJyb3IiKSxmdW5jdGlvbigpe2Zvcih2YXIgZT1uZXcgQXJyYXkoMjU2KSx0PTA7dDwyNTY7Kyt0KWVbdF09U3RyaW5nLmZyb21DaGFyQ29kZSh0KTtmZT1lfSgpLGhlPWUuQmluZGluZ0Vycm9yPXNlKEVycm9yLCJCaW5kaW5nRXJyb3IiKSxGZS5wcm90b3R5cGUuaXNBbGlhc09mPWZ1bmN0aW9uKGUpe2lmKCEodGhpcyBpbnN0YW5jZW9mIEZlKSlyZXR1cm4hMTtpZighKGUgaW5zdGFuY2VvZiBGZSkpcmV0dXJuITE7Zm9yKHZhciB0PXRoaXMuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3Mscj10aGlzLiQkLnB0cixuPWUuJCQucHRyVHlwZS5yZWdpc3RlcmVkQ2xhc3Msbz1lLiQkLnB0cjt0LmJhc2VDbGFzczspcj10LnVwY2FzdChyKSx0PXQuYmFzZUNsYXNzO2Zvcig7bi5iYXNlQ2xhc3M7KW89bi51cGNhc3Qobyksbj1uLmJhc2VDbGFzcztyZXR1cm4gdD09PW4mJnI9PT1vfSxGZS5wcm90b3R5cGUuY2xvbmU9ZnVuY3Rpb24oKXtpZih0aGlzLiQkLnB0cnx8eWUodGhpcyksdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSlyZXR1cm4gdGhpcy4kJC5jb3VudC52YWx1ZSs9MSx0aGlzO3ZhciBlLHQ9Q2UoT2JqZWN0LmNyZWF0ZShPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcykseyQkOnt2YWx1ZTooZT10aGlzLiQkLHtjb3VudDplLmNvdW50LGRlbGV0ZVNjaGVkdWxlZDplLmRlbGV0ZVNjaGVkdWxlZCxwcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZTplLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlLHB0cjplLnB0cixwdHJUeXBlOmUucHRyVHlwZSxzbWFydFB0cjplLnNtYXJ0UHRyLHNtYXJ0UHRyVHlwZTplLnNtYXJ0UHRyVHlwZX0pfX0pKTtyZXR1cm4gdC4kJC5jb3VudC52YWx1ZSs9MSx0LiQkLmRlbGV0ZVNjaGVkdWxlZD0hMSx0fSxGZS5wcm90b3R5cGUuZGVsZXRlPWZ1bmN0aW9uKCl7dGhpcy4kJC5wdHJ8fHllKHRoaXMpLHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkJiYhdGhpcy4kJC5wcmVzZXJ2ZVBvaW50ZXJPbkRlbGV0ZSYmbWUoIk9iamVjdCBhbHJlYWR5IHNjaGVkdWxlZCBmb3IgZGVsZXRpb24iKSx3ZSh0aGlzKSxFZSh0aGlzLiQkKSx0aGlzLiQkLnByZXNlcnZlUG9pbnRlck9uRGVsZXRlfHwodGhpcy4kJC5zbWFydFB0cj12b2lkIDAsdGhpcy4kJC5wdHI9dm9pZCAwKX0sRmUucHJvdG90eXBlLmlzRGVsZXRlZD1mdW5jdGlvbigpe3JldHVybiF0aGlzLiQkLnB0cn0sRmUucHJvdG90eXBlLmRlbGV0ZUxhdGVyPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuJCQucHRyfHx5ZSh0aGlzKSx0aGlzLiQkLmRlbGV0ZVNjaGVkdWxlZCYmIXRoaXMuJCQucHJlc2VydmVQb2ludGVyT25EZWxldGUmJm1lKCJPYmplY3QgYWxyZWFkeSBzY2hlZHVsZWQgZm9yIGRlbGV0aW9uIiksa2UucHVzaCh0aGlzKSwxPT09a2UubGVuZ3RoJiZUZSYmVGUoUGUpLHRoaXMuJCQuZGVsZXRlU2NoZWR1bGVkPSEwLHRoaXN9LGUuZ2V0SW5oZXJpdGVkSW5zdGFuY2VDb3VudD1mdW5jdGlvbigpe3JldHVybiBPYmplY3Qua2V5cyhTZSkubGVuZ3RofSxlLmdldExpdmVJbmhlcml0ZWRJbnN0YW5jZXM9ZnVuY3Rpb24oKXt2YXIgZT1bXTtmb3IodmFyIHQgaW4gU2UpU2UuaGFzT3duUHJvcGVydHkodCkmJmUucHVzaChTZVt0XSk7cmV0dXJuIGV9LGUuZmx1c2hQZW5kaW5nRGVsZXRlcz1QZSxlLnNldERlbGF5RnVuY3Rpb249ZnVuY3Rpb24oZSl7VGU9ZSxrZS5sZW5ndGgmJlRlJiZUZShQZSl9LEllLnByb3RvdHlwZS5nZXRQb2ludGVlPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJhd0dldFBvaW50ZWUmJihlPXRoaXMucmF3R2V0UG9pbnRlZShlKSksZX0sSWUucHJvdG90eXBlLmRlc3RydWN0b3I9ZnVuY3Rpb24oZSl7dGhpcy5yYXdEZXN0cnVjdG9yJiZ0aGlzLnJhd0Rlc3RydWN0b3IoZSl9LEllLnByb3RvdHlwZS5hcmdQYWNrQWR2YW5jZT04LEllLnByb3RvdHlwZS5yZWFkVmFsdWVGcm9tUG9pbnRlcj1aLEllLnByb3RvdHlwZS5kZWxldGVPYmplY3Q9ZnVuY3Rpb24oZSl7bnVsbCE9PWUmJmUuZGVsZXRlKCl9LEllLnByb3RvdHlwZS5mcm9tV2lyZVR5cGU9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5nZXRQb2ludGVlKGUpO2lmKCF0KXJldHVybiB0aGlzLmRlc3RydWN0b3IoZSksbnVsbDt2YXIgcj1mdW5jdGlvbihlLHQpe3JldHVybiB0PWZ1bmN0aW9uKGUsdCl7Zm9yKHZvaWQgMD09PXQmJm1lKCJwdHIgc2hvdWxkIG5vdCBiZSB1bmRlZmluZWQiKTtlLmJhc2VDbGFzczspdD1lLnVwY2FzdCh0KSxlPWUuYmFzZUNsYXNzO3JldHVybiB0fShlLHQpLFNlW3RdfSh0aGlzLnJlZ2lzdGVyZWRDbGFzcyx0KTtpZih2b2lkIDAhPT1yKXtpZigwPT09ci4kJC5jb3VudC52YWx1ZSlyZXR1cm4gci4kJC5wdHI9dCxyLiQkLnNtYXJ0UHRyPWUsci5jbG9uZSgpO3ZhciBuPXIuY2xvbmUoKTtyZXR1cm4gdGhpcy5kZXN0cnVjdG9yKGUpLG59ZnVuY3Rpb24gbygpe3JldHVybiB0aGlzLmlzU21hcnRQb2ludGVyP0RlKHRoaXMucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLHtwdHJUeXBlOnRoaXMucG9pbnRlZVR5cGUscHRyOnQsc21hcnRQdHJUeXBlOnRoaXMsc21hcnRQdHI6ZX0pOkRlKHRoaXMucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLHtwdHJUeXBlOnRoaXMscHRyOmV9KX12YXIgYSxpPXRoaXMucmVnaXN0ZXJlZENsYXNzLmdldEFjdHVhbFR5cGUodCkscz1iZVtpXTtpZighcylyZXR1cm4gby5jYWxsKHRoaXMpO2E9dGhpcy5pc0NvbnN0P3MuY29uc3RQb2ludGVyVHlwZTpzLnBvaW50ZXJUeXBlO3ZhciB1PV9lKHQsdGhpcy5yZWdpc3RlcmVkQ2xhc3MsYS5yZWdpc3RlcmVkQ2xhc3MpO3JldHVybiBudWxsPT09dT9vLmNhbGwodGhpcyk6dGhpcy5pc1NtYXJ0UG9pbnRlcj9EZShhLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTphLHB0cjp1LHNtYXJ0UHRyVHlwZTp0aGlzLHNtYXJ0UHRyOmV9KTpEZShhLnJlZ2lzdGVyZWRDbGFzcy5pbnN0YW5jZVByb3RvdHlwZSx7cHRyVHlwZTphLHB0cjp1fSl9LEJlPWUuVW5ib3VuZFR5cGVFcnJvcj1zZShFcnJvciwiVW5ib3VuZFR5cGVFcnJvciIpLGUuY291bnRfZW12YWxfaGFuZGxlcz1mdW5jdGlvbigpe2Zvcih2YXIgZT0wLHQ9NTt0PHFlLmxlbmd0aDsrK3Qpdm9pZCAwIT09cWVbdF0mJisrZTtyZXR1cm4gZX0sZS5nZXRfZmlyc3RfZW12YWw9ZnVuY3Rpb24oKXtmb3IodmFyIGU9NTtlPHFlLmxlbmd0aDsrK2UpaWYodm9pZCAwIT09cWVbZV0pcmV0dXJuIHFlW2VdO3JldHVybiBudWxsfTt2YXIgU3Q9ZnVuY3Rpb24oZSx0LHIsbil7ZXx8KGU9dGhpcyksdGhpcy5wYXJlbnQ9ZSx0aGlzLm1vdW50PWUubW91bnQsdGhpcy5tb3VudGVkPW51bGwsdGhpcy5pZD1fdC5uZXh0SW5vZGUrKyx0aGlzLm5hbWU9dCx0aGlzLm1vZGU9cix0aGlzLm5vZGVfb3BzPXt9LHRoaXMuc3RyZWFtX29wcz17fSx0aGlzLnJkZXY9bn07T2JqZWN0LmRlZmluZVByb3BlcnRpZXMoU3QucHJvdG90eXBlLHtyZWFkOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMzY1PT0oMzY1JnRoaXMubW9kZSl9LHNldDpmdW5jdGlvbihlKXtlP3RoaXMubW9kZXw9MzY1OnRoaXMubW9kZSY9LTM2Nn19LHdyaXRlOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMTQ2PT0oMTQ2JnRoaXMubW9kZSl9LHNldDpmdW5jdGlvbihlKXtlP3RoaXMubW9kZXw9MTQ2OnRoaXMubW9kZSY9LTE0N319LGlzRm9sZGVyOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gX3QuaXNEaXIodGhpcy5tb2RlKX19LGlzRGV2aWNlOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gX3QuaXNDaHJkZXYodGhpcy5tb2RlKX19fSksX3QuRlNOb2RlPVN0LF90LnN0YXRpY0luaXQoKTt2YXIgRHQsQ3Q9e2E6ZnVuY3Rpb24oZSx0LHIsbil7TCgiQXNzZXJ0aW9uIGZhaWxlZDogIitTKGUpKyIsIGF0OiAiK1t0P1ModCk6InVua25vd24gZmlsZW5hbWUiLHIsbj9TKG4pOiJ1bmtub3duIGZ1bmN0aW9uIl0pfSx0OmZ1bmN0aW9uKGUpe3ZhciB0PW5ldyBYKGUpO3JldHVybiB0LmdldF9jYXVnaHQoKXx8KHQuc2V0X2NhdWdodCghMCksVi0tKSx0LnNldF9yZXRocm93bighMSksSC5wdXNoKHQpLGZ1bmN0aW9uKGUpe2UuYWRkX3JlZigpfSh0KSx0LmdldF9leGNlcHRpb25fcHRyKCl9LHk6ZnVuY3Rpb24oKXtSdCgwKSxmdW5jdGlvbihlKXtpZihlLnJlbGVhc2VfcmVmKCkmJiFlLmdldF9yZXRocm93bigpKXt2YXIgdD1lLmdldF9kZXN0cnVjdG9yKCk7dCYmRyh0KShlLmV4Y1B0ciksenQoZS5leGNQdHIpfX0oSC5wb3AoKSksWT0wfSxkOmZ1bmN0aW9uKCl7dmFyIGU9WTtpZighZSlyZXR1cm4gT3QoMCksMDt2YXIgdD1uZXcgWChlKTt0LnNldF9hZGp1c3RlZF9wdHIoZSk7dmFyIHI9dC5nZXRfdHlwZSgpO2lmKCFyKXJldHVybiBPdCgwKSxlO2Zvcih2YXIgbj0wO248YXJndW1lbnRzLmxlbmd0aDtuKyspe3ZhciBvPWFyZ3VtZW50c1tuXTtpZigwPT09b3x8bz09PXIpYnJlYWs7dmFyIGE9dC5wdHIrMTY7aWYoTnQobyxyLGEpKXJldHVybiBPdChvKSxlfXJldHVybiBPdChyKSxlfSxtOmZ1bmN0aW9uKCl7dmFyIGU9WTtpZighZSlyZXR1cm4gT3QoMCksMDt2YXIgdD1uZXcgWChlKTt0LnNldF9hZGp1c3RlZF9wdHIoZSk7dmFyIHI9dC5nZXRfdHlwZSgpO2lmKCFyKXJldHVybiBPdCgwKSxlO2Zvcih2YXIgbj0wO248YXJndW1lbnRzLmxlbmd0aDtuKyspe3ZhciBvPWFyZ3VtZW50c1tuXTtpZigwPT09b3x8bz09PXIpYnJlYWs7dmFyIGE9dC5wdHIrMTY7aWYoTnQobyxyLGEpKXJldHVybiBPdChvKSxlfXJldHVybiBPdChyKSxlfSxOOmZ1bmN0aW9uKCl7dmFyIGU9SC5wb3AoKTtlfHxMKCJubyBleGNlcHRpb24gdG8gdGhyb3ciKTt2YXIgdD1lLmV4Y1B0cjt0aHJvdyBlLmdldF9yZXRocm93bigpfHwoSC5wdXNoKGUpLGUuc2V0X3JldGhyb3duKCEwKSxlLnNldF9jYXVnaHQoITEpLFYrKyksWT10LHR9LGM6ZnVuY3Rpb24oZSx0LHIpe3Rocm93IG5ldyBYKGUpLmluaXQodCxyKSxZPWUsVisrLGV9LFk6ZnVuY3Rpb24oKXtyZXR1cm4gVn0saDpmdW5jdGlvbihlKXt0aHJvdyBZfHwoWT1lKSxlfSxmYTpmdW5jdGlvbihlKXt9LGhhOmZ1bmN0aW9uKGUsdCl7TChKKX0sZ2E6ZnVuY3Rpb24oZSx0KXtMKEopfSxPOmZ1bmN0aW9uKGUpe3ZhciB0PUtbZV07ZGVsZXRlIEtbZV07dmFyIHI9dC5yYXdDb25zdHJ1Y3RvcixuPXQucmF3RGVzdHJ1Y3RvcixvPXQuZmllbGRzO2xlKFtlXSxvLm1hcCgoZT0+ZS5nZXR0ZXJSZXR1cm5UeXBlKSkuY29uY2F0KG8ubWFwKChlPT5lLnNldHRlckFyZ3VtZW50VHlwZSkpKSwoZT0+e3ZhciBhPXt9O3JldHVybiBvLmZvckVhY2goKCh0LHIpPT57dmFyIG49dC5maWVsZE5hbWUsaT1lW3JdLHM9dC5nZXR0ZXIsdT10LmdldHRlckNvbnRleHQsYz1lW3Irby5sZW5ndGhdLGw9dC5zZXR0ZXIsZD10LnNldHRlckNvbnRleHQ7YVtuXT17cmVhZDplPT5pLmZyb21XaXJlVHlwZShzKHUsZSkpLHdyaXRlOihlLHQpPT57dmFyIHI9W107bChkLGUsYy50b1dpcmVUeXBlKHIsdCkpLFEocil9fX0pKSxbe25hbWU6dC5uYW1lLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXt2YXIgdD17fTtmb3IodmFyIHIgaW4gYSl0W3JdPWFbcl0ucmVhZChlKTtyZXR1cm4gbihlKSx0fSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBvIGluIGEpaWYoIShvIGluIHQpKXRocm93IG5ldyBUeXBlRXJyb3IoJ01pc3NpbmcgZmllbGQ6ICAiJytvKyciJyk7dmFyIGk9cigpO2ZvcihvIGluIGEpYVtvXS53cml0ZShpLHRbb10pO3JldHVybiBudWxsIT09ZSYmZS5wdXNoKG4saSksaX0sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpaLGRlc3RydWN0b3JGdW5jdGlvbjpufV19KSl9LFU6ZnVuY3Rpb24oZSx0LHIsbixvKXt9LGthOmZ1bmN0aW9uKGUsdCxyLG4sbyl7dmFyIGE9ZGUocik7dmUoZSx7bmFtZTp0PXBlKHQpLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXtyZXR1cm4hIWV9LHRvV2lyZVR5cGU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdD9uOm99LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6ZnVuY3Rpb24oZSl7dmFyIG47aWYoMT09PXIpbj12O2Vsc2UgaWYoMj09PXIpbj1nO2Vsc2V7aWYoNCE9PXIpdGhyb3cgbmV3IFR5cGVFcnJvcigiVW5rbm93biBib29sZWFuIHR5cGUgc2l6ZTogIit0KTtuPUV9cmV0dXJuIHRoaXMuZnJvbVdpcmVUeXBlKG5bZT4+YV0pfSxkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSxzOmZ1bmN0aW9uKGUsdCxyLG4sbyxhLGkscyx1LGMsbCxkLGYpe2w9cGUobCksYT1OZShvLGEpLHMmJihzPU5lKGkscykpLGMmJihjPU5lKHUsYykpLGY9TmUoZCxmKTt2YXIgcD1hZShsKTtBZShwLChmdW5jdGlvbigpe0xlKCJDYW5ub3QgY29uc3RydWN0ICIrbCsiIGR1ZSB0byB1bmJvdW5kIHR5cGVzIixbbl0pfSkpLGxlKFtlLHQscl0sbj9bbl06W10sKGZ1bmN0aW9uKHQpe3ZhciByLG87dD10WzBdLG89bj8ocj10LnJlZ2lzdGVyZWRDbGFzcykuaW5zdGFuY2VQcm90b3R5cGU6RmUucHJvdG90eXBlO3ZhciBpPWllKHAsKGZ1bmN0aW9uKCl7aWYoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpIT09dSl0aHJvdyBuZXcgaGUoIlVzZSAnbmV3JyB0byBjb25zdHJ1Y3QgIitsKTtpZih2b2lkIDA9PT1kLmNvbnN0cnVjdG9yX2JvZHkpdGhyb3cgbmV3IGhlKGwrIiBoYXMgbm8gYWNjZXNzaWJsZSBjb25zdHJ1Y3RvciIpO3ZhciBlPWQuY29uc3RydWN0b3JfYm9keVthcmd1bWVudHMubGVuZ3RoXTtpZih2b2lkIDA9PT1lKXRocm93IG5ldyBoZSgiVHJpZWQgdG8gaW52b2tlIGN0b3Igb2YgIitsKyIgd2l0aCBpbnZhbGlkIG51bWJlciBvZiBwYXJhbWV0ZXJzICgiK2FyZ3VtZW50cy5sZW5ndGgrIikgLSBleHBlY3RlZCAoIitPYmplY3Qua2V5cyhkLmNvbnN0cnVjdG9yX2JvZHkpLnRvU3RyaW5nKCkrIikgcGFyYW1ldGVycyBpbnN0ZWFkISIpO3JldHVybiBlLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pKSx1PU9iamVjdC5jcmVhdGUobyx7Y29uc3RydWN0b3I6e3ZhbHVlOml9fSk7aS5wcm90b3R5cGU9dTt2YXIgZD1uZXcgJGUobCxpLHUsZixyLGEscyxjKSxoPW5ldyBJZShsLGQsITAsITEsITEpLG09bmV3IEllKGwrIioiLGQsITEsITEsITEpLHY9bmV3IEllKGwrIiBjb25zdCoiLGQsITEsITAsITEpO3JldHVybiBiZVtlXT17cG9pbnRlclR5cGU6bSxjb25zdFBvaW50ZXJUeXBlOnZ9LHplKHAsaSksW2gsbSx2XX0pKX0sSTpmdW5jdGlvbihlLHQscixuLG8sYSxpKXt2YXIgcz1WZShyLG4pO3Q9cGUodCksYT1OZShvLGEpLGxlKFtdLFtlXSwoZnVuY3Rpb24oZSl7dmFyIG49KGU9ZVswXSkubmFtZSsiLiIrdDtmdW5jdGlvbiBvKCl7TGUoIkNhbm5vdCBjYWxsICIrbisiIGR1ZSB0byB1bmJvdW5kIHR5cGVzIixzKX10LnN0YXJ0c1dpdGgoIkBAIikmJih0PVN5bWJvbFt0LnN1YnN0cmluZygyKV0pO3ZhciB1PWUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yO3JldHVybiB2b2lkIDA9PT11W3RdPyhvLmFyZ0NvdW50PXItMSx1W3RdPW8pOihNZSh1LHQsbiksdVt0XS5vdmVybG9hZFRhYmxlW3ItMV09byksbGUoW10scywoZnVuY3Rpb24oZSl7dmFyIG89W2VbMF0sbnVsbF0uY29uY2F0KGUuc2xpY2UoMSkpLHM9SGUobixvLG51bGwsYSxpKTtyZXR1cm4gdm9pZCAwPT09dVt0XS5vdmVybG9hZFRhYmxlPyhzLmFyZ0NvdW50PXItMSx1W3RdPXMpOnVbdF0ub3ZlcmxvYWRUYWJsZVtyLTFdPXMsW119KSksW119KSl9LHA6ZnVuY3Rpb24oZSx0LHIsbixvLGEpe2godD4wKTt2YXIgaT1WZSh0LHIpO289TmUobixvKSxsZShbXSxbZV0sKGZ1bmN0aW9uKGUpe3ZhciByPSJjb25zdHJ1Y3RvciAiKyhlPWVbMF0pLm5hbWU7aWYodm9pZCAwPT09ZS5yZWdpc3RlcmVkQ2xhc3MuY29uc3RydWN0b3JfYm9keSYmKGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHk9W10pLHZvaWQgMCE9PWUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbdC0xXSl0aHJvdyBuZXcgaGUoIkNhbm5vdCByZWdpc3RlciBtdWx0aXBsZSBjb25zdHJ1Y3RvcnMgd2l0aCBpZGVudGljYWwgbnVtYmVyIG9mIHBhcmFtZXRlcnMgKCIrKHQtMSkrIikgZm9yIGNsYXNzICciK2UubmFtZSsiJyEgT3ZlcmxvYWQgcmVzb2x1dGlvbiBpcyBjdXJyZW50bHkgb25seSBwZXJmb3JtZWQgdXNpbmcgdGhlIHBhcmFtZXRlciBjb3VudCwgbm90IGFjdHVhbCB0eXBlIGluZm8hIik7cmV0dXJuIGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbdC0xXT0oKT0+e0xlKCJDYW5ub3QgY29uc3RydWN0ICIrZS5uYW1lKyIgZHVlIHRvIHVuYm91bmQgdHlwZXMiLGkpfSxsZShbXSxpLChmdW5jdGlvbihuKXtyZXR1cm4gbi5zcGxpY2UoMSwwLG51bGwpLGUucmVnaXN0ZXJlZENsYXNzLmNvbnN0cnVjdG9yX2JvZHlbdC0xXT1IZShyLG4sbnVsbCxvLGEpLFtdfSkpLFtdfSkpfSxmOmZ1bmN0aW9uKGUsdCxyLG4sbyxhLGkscyl7dmFyIHU9VmUocixuKTt0PXBlKHQpLGE9TmUobyxhKSxsZShbXSxbZV0sKGZ1bmN0aW9uKGUpe3ZhciBuPShlPWVbMF0pLm5hbWUrIi4iK3Q7ZnVuY3Rpb24gbygpe0xlKCJDYW5ub3QgY2FsbCAiK24rIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIsdSl9dC5zdGFydHNXaXRoKCJAQCIpJiYodD1TeW1ib2xbdC5zdWJzdHJpbmcoMildKSxzJiZlLnJlZ2lzdGVyZWRDbGFzcy5wdXJlVmlydHVhbEZ1bmN0aW9ucy5wdXNoKHQpO3ZhciBjPWUucmVnaXN0ZXJlZENsYXNzLmluc3RhbmNlUHJvdG90eXBlLGw9Y1t0XTtyZXR1cm4gdm9pZCAwPT09bHx8dm9pZCAwPT09bC5vdmVybG9hZFRhYmxlJiZsLmNsYXNzTmFtZSE9PWUubmFtZSYmbC5hcmdDb3VudD09PXItMj8oby5hcmdDb3VudD1yLTIsby5jbGFzc05hbWU9ZS5uYW1lLGNbdF09byk6KE1lKGMsdCxuKSxjW3RdLm92ZXJsb2FkVGFibGVbci0yXT1vKSxsZShbXSx1LChmdW5jdGlvbihvKXt2YXIgcz1IZShuLG8sZSxhLGkpO3JldHVybiB2b2lkIDA9PT1jW3RdLm92ZXJsb2FkVGFibGU/KHMuYXJnQ291bnQ9ci0yLGNbdF09cyk6Y1t0XS5vdmVybG9hZFRhYmxlW3ItMl09cyxbXX0pKSxbXX0pKX0samE6ZnVuY3Rpb24oZSx0KXt2ZShlLHtuYW1lOnQ9cGUodCksZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKGUpe3ZhciB0PVhlLnRvVmFsdWUoZSk7cmV0dXJuIEdlKGUpLHR9LHRvV2lyZVR5cGU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gWGUudG9IYW5kbGUodCl9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6WixkZXN0cnVjdG9yRnVuY3Rpb246bnVsbH0pfSx1OmZ1bmN0aW9uKGUsdCxyLG4pe3ZhciBvPWRlKHIpO2Z1bmN0aW9uIGEoKXt9dD1wZSh0KSxhLnZhbHVlcz17fSx2ZShlLHtuYW1lOnQsY29uc3RydWN0b3I6YSxmcm9tV2lyZVR5cGU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudmFsdWVzW2VdfSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQudmFsdWV9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6SmUodCxvLG4pLGRlc3RydWN0b3JGdW5jdGlvbjpudWxsfSksQWUodCxhKX0sajpmdW5jdGlvbihlLHQscil7dmFyIG49S2UoZSwiZW51bSIpO3Q9cGUodCk7dmFyIG89bi5jb25zdHJ1Y3RvcixhPU9iamVjdC5jcmVhdGUobi5jb25zdHJ1Y3Rvci5wcm90b3R5cGUse3ZhbHVlOnt2YWx1ZTpyfSxjb25zdHJ1Y3Rvcjp7dmFsdWU6aWUobi5uYW1lKyJfIit0LChmdW5jdGlvbigpe30pKX19KTtvLnZhbHVlc1tyXT1hLG9bdF09YX0sTDpmdW5jdGlvbihlLHQscil7dmFyIG49ZGUocik7dmUoZSx7bmFtZTp0PXBlKHQpLGZyb21XaXJlVHlwZTpmdW5jdGlvbihlKXtyZXR1cm4gZX0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLHQpe3JldHVybiB0fSxhcmdQYWNrQWR2YW5jZTo4LHJlYWRWYWx1ZUZyb21Qb2ludGVyOlplKHQsbiksZGVzdHJ1Y3RvckZ1bmN0aW9uOm51bGx9KX0sUTpmdW5jdGlvbihlLHQscixuLG8sYSl7dmFyIGk9VmUodCxyKTtlPXBlKGUpLG89TmUobixvKSxBZShlLChmdW5jdGlvbigpe0xlKCJDYW5ub3QgY2FsbCAiK2UrIiBkdWUgdG8gdW5ib3VuZCB0eXBlcyIsaSl9KSx0LTEpLGxlKFtdLGksKGZ1bmN0aW9uKHIpe3ZhciBuPVtyWzBdLG51bGxdLmNvbmNhdChyLnNsaWNlKDEpKTtyZXR1cm4gemUoZSxIZShlLG4sbnVsbCxvLGEpLHQtMSksW119KSl9LHc6ZnVuY3Rpb24oZSx0LHIsbixvKXt0PXBlKHQpLC0xPT09byYmKG89NDI5NDk2NzI5NSk7dmFyIGE9ZGUociksaT1lPT5lO2lmKDA9PT1uKXt2YXIgcz0zMi04KnI7aT1lPT5lPDxzPj4+c312YXIgdT10LmluY2x1ZGVzKCJ1bnNpZ25lZCIpO3ZlKGUse25hbWU6dCxmcm9tV2lyZVR5cGU6aSx0b1dpcmVUeXBlOnU/ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5uYW1lLHQ+Pj4wfTpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLm5hbWUsdH0sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpldCh0LGEsMCE9PW4pLGRlc3RydWN0b3JGdW5jdGlvbjpudWxsfSl9LG46ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPVtJbnQ4QXJyYXksVWludDhBcnJheSxJbnQxNkFycmF5LFVpbnQxNkFycmF5LEludDMyQXJyYXksVWludDMyQXJyYXksRmxvYXQzMkFycmF5LEZsb2F0NjRBcnJheV1bdF07ZnVuY3Rpb24gbyhlKXt2YXIgdD1fLHI9dFtlPj49Ml0sbz10W2UrMV07cmV0dXJuIG5ldyBuKG0sbyxyKX12ZShlLHtuYW1lOnI9cGUociksZnJvbVdpcmVUeXBlOm8sYXJnUGFja0FkdmFuY2U6OCxyZWFkVmFsdWVGcm9tUG9pbnRlcjpvfSx7aWdub3JlRHVwbGljYXRlUmVnaXN0cmF0aW9uczohMH0pfSxNOmZ1bmN0aW9uKGUsdCl7dmFyIHI9InN0ZDo6c3RyaW5nIj09PSh0PXBlKHQpKTt2ZShlLHtuYW1lOnQsZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKGUpe3ZhciB0LG49X1tlPj4yXSxvPWUrNDtpZihyKWZvcih2YXIgYT1vLGk9MDtpPD1uOysraSl7dmFyIHM9bytpO2lmKGk9PW58fDA9PXlbc10pe3ZhciB1PVMoYSxzLWEpO3ZvaWQgMD09PXQ/dD11Oih0Kz1TdHJpbmcuZnJvbUNoYXJDb2RlKDApLHQrPXUpLGE9cysxfX1lbHNle3ZhciBjPW5ldyBBcnJheShuKTtmb3IoaT0wO2k8bjsrK2kpY1tpXT1TdHJpbmcuZnJvbUNoYXJDb2RlKHlbbytpXSk7dD1jLmpvaW4oIiIpfXJldHVybiBNdChlKSx0fSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7dmFyIG47dCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyJiYodD1uZXcgVWludDhBcnJheSh0KSk7dmFyIG89InN0cmluZyI9PXR5cGVvZiB0O298fHQgaW5zdGFuY2VvZiBVaW50OEFycmF5fHx0IGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQ4QXJyYXl8fG1lKCJDYW5ub3QgcGFzcyBub24tc3RyaW5nIHRvIHN0ZDo6c3RyaW5nIiksbj1yJiZvP0ModCk6dC5sZW5ndGg7dmFyIGE9QXQoNCtuKzEpLGk9YSs0O2lmKF9bYT4+Ml09bixyJiZvKUQodCx5LGksbisxKTtlbHNlIGlmKG8pZm9yKHZhciBzPTA7czxuOysrcyl7dmFyIHU9dC5jaGFyQ29kZUF0KHMpO3U+MjU1JiYoTXQoaSksbWUoIlN0cmluZyBoYXMgVVRGLTE2IGNvZGUgdW5pdHMgdGhhdCBkbyBub3QgZml0IGluIDggYml0cyIpKSx5W2krc109dX1lbHNlIGZvcihzPTA7czxuOysrcyl5W2krc109dFtzXTtyZXR1cm4gbnVsbCE9PWUmJmUucHVzaChNdCxhKSxhfSxhcmdQYWNrQWR2YW5jZTo4LHJlYWRWYWx1ZUZyb21Qb2ludGVyOlosZGVzdHJ1Y3RvckZ1bmN0aW9uOmZ1bmN0aW9uKGUpe010KGUpfX0pfSxIOmZ1bmN0aW9uKGUsdCxyKXt2YXIgbixvLGEsaSxzO3I9cGUociksMj09PXQ/KG49cnQsbz1udCxpPW90LGE9KCk9Pncscz0xKTo0PT09dCYmKG49YXQsbz1pdCxpPXN0LGE9KCk9Pl8scz0yKSx2ZShlLHtuYW1lOnIsZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKGUpe2Zvcih2YXIgcixvPV9bZT4+Ml0saT1hKCksdT1lKzQsYz0wO2M8PW87KytjKXt2YXIgbD1lKzQrYyp0O2lmKGM9PW98fDA9PWlbbD4+c10pe3ZhciBkPW4odSxsLXUpO3ZvaWQgMD09PXI/cj1kOihyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKDApLHIrPWQpLHU9bCt0fX1yZXR1cm4gTXQoZSkscn0sdG9XaXJlVHlwZTpmdW5jdGlvbihlLG4peyJzdHJpbmciIT10eXBlb2YgbiYmbWUoIkNhbm5vdCBwYXNzIG5vbi1zdHJpbmcgdG8gQysrIHN0cmluZyB0eXBlICIrcik7dmFyIGE9aShuKSx1PUF0KDQrYSt0KTtyZXR1cm4gX1t1Pj4yXT1hPj5zLG8obix1KzQsYSt0KSxudWxsIT09ZSYmZS5wdXNoKE10LHUpLHV9LGFyZ1BhY2tBZHZhbmNlOjgscmVhZFZhbHVlRnJvbVBvaW50ZXI6WixkZXN0cnVjdG9yRnVuY3Rpb246ZnVuY3Rpb24oZSl7TXQoZSl9fSl9LFA6ZnVuY3Rpb24oZSx0LHIsbixvLGEpe0tbZV09e25hbWU6cGUodCkscmF3Q29uc3RydWN0b3I6TmUocixuKSxyYXdEZXN0cnVjdG9yOk5lKG8sYSksZmllbGRzOltdfX0sQzpmdW5jdGlvbihlLHQscixuLG8sYSxpLHMsdSxjKXtLW2VdLmZpZWxkcy5wdXNoKHtmaWVsZE5hbWU6cGUodCksZ2V0dGVyUmV0dXJuVHlwZTpyLGdldHRlcjpOZShuLG8pLGdldHRlckNvbnRleHQ6YSxzZXR0ZXJBcmd1bWVudFR5cGU6aSxzZXR0ZXI6TmUocyx1KSxzZXR0ZXJDb250ZXh0OmN9KX0sbGE6ZnVuY3Rpb24oZSx0KXt2ZShlLHtpc1ZvaWQ6ITAsbmFtZTp0PXBlKHQpLGFyZ1BhY2tBZHZhbmNlOjAsZnJvbVdpcmVUeXBlOmZ1bmN0aW9uKCl7fSx0b1dpcmVUeXBlOmZ1bmN0aW9uKGUsdCl7fX0pfSxlYTpmdW5jdGlvbigpe3JldHVybiEwfSxwYTpmdW5jdGlvbihlLHQscil7ZT1YZS50b1ZhbHVlKGUpLHQ9S2UodCwiZW12YWw6OmFzIik7dmFyIG49W10sbz1YZS50b0hhbmRsZShuKTtyZXR1cm4gX1tyPj4yXT1vLHQudG9XaXJlVHlwZShuLGUpfSxuYTpmdW5jdGlvbihlLHQscixuKXsoZT1kdFtlXSkodD1YZS50b1ZhbHVlKHQpLHI9Y3QociksbnVsbCxuKX0sQjpHZSxtYTpmdW5jdGlvbihlLHQpe3ZhciByPWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPW5ldyBBcnJheShlKSxuPTA7bjxlOysrbilyW25dPUtlKF9bdCs0Km4+PjJdLCJwYXJhbWV0ZXIgIituKTtyZXR1cm4gcn0oZSx0KSxuPXJbMF0sbz1uLm5hbWUrIl8kIityLnNsaWNlKDEpLm1hcCgoZnVuY3Rpb24oZSl7cmV0dXJuIGUubmFtZX0pKS5qb2luKCJfIikrIiQiLGE9ZnRbb107aWYodm9pZCAwIT09YSlyZXR1cm4gYTtmb3IodmFyIGk9WyJyZXRUeXBlIl0scz1bbl0sdT0iIixjPTA7YzxlLTE7KytjKXUrPSgwIT09Yz8iLCAiOiIiKSsiYXJnIitjLGkucHVzaCgiYXJnVHlwZSIrYykscy5wdXNoKHJbMStjXSk7dmFyIGwsZCxmPSJyZXR1cm4gZnVuY3Rpb24gIithZSgibWV0aG9kQ2FsbGVyXyIrbykrIihoYW5kbGUsIG5hbWUsIGRlc3RydWN0b3JzLCBhcmdzKSB7XG4iLHA9MDtmb3IoYz0wO2M8ZS0xOysrYylmKz0iICAgIHZhciBhcmciK2MrIiA9IGFyZ1R5cGUiK2MrIi5yZWFkVmFsdWVGcm9tUG9pbnRlcihhcmdzIisocD8iKyIrcDoiIikrIik7XG4iLHArPXJbYysxXS5hcmdQYWNrQWR2YW5jZTtmb3IoZis9IiAgICB2YXIgcnYgPSBoYW5kbGVbbmFtZV0oIit1KyIpO1xuIixjPTA7YzxlLTE7KytjKXJbYysxXS5kZWxldGVPYmplY3QmJihmKz0iICAgIGFyZ1R5cGUiK2MrIi5kZWxldGVPYmplY3QoYXJnIitjKyIpO1xuIik7cmV0dXJuIG4uaXNWb2lkfHwoZis9IiAgICByZXR1cm4gcmV0VHlwZS50b1dpcmVUeXBlKGRlc3RydWN0b3JzLCBydik7XG4iKSxmKz0ifTtcbiIsaS5wdXNoKGYpLGw9VWUoRnVuY3Rpb24saSkuYXBwbHkobnVsbCxzKSxkPWR0Lmxlbmd0aCxkdC5wdXNoKGwpLGE9ZCxmdFtvXT1hLGF9LHJhOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGU9WGUudG9WYWx1ZShlKSx0PVhlLnRvVmFsdWUodCksWGUudG9IYW5kbGUoZVt0XSl9LEY6ZnVuY3Rpb24oZSl7ZT40JiYocWVbZV0ucmVmY291bnQrPTEpfSxxYTpmdW5jdGlvbihlKXtyZXR1cm4gWGUudG9IYW5kbGUoY3QoZSkpfSxvYTpmdW5jdGlvbihlKXtRKFhlLnRvVmFsdWUoZSkpLEdlKGUpfSx6OmZ1bmN0aW9uKGUsdCl7dmFyIHI9KGU9S2UoZSwiX2VtdmFsX3Rha2VfdmFsdWUiKSkucmVhZFZhbHVlRnJvbVBvaW50ZXIodCk7cmV0dXJuIFhlLnRvSGFuZGxlKHIpfSxiOmZ1bmN0aW9uKCl7TCgiIil9LEs6ZnVuY3Rpb24oKXtyZXR1cm4gRGF0ZS5ub3coKX0sXzpmdW5jdGlvbigpe3JldHVybiB5Lmxlbmd0aH0sRzpsdCxkYTpmdW5jdGlvbihlLHQscil7eS5jb3B5V2l0aGluKGUsdCx0K3IpfSxaOmZ1bmN0aW9uKGUpe3kubGVuZ3RoLEwoIk9PTSIpfSwkOmZ1bmN0aW9uKGUsdCl7dmFyIHI9MDtyZXR1cm4gaHQoKS5mb3JFYWNoKChmdW5jdGlvbihuLG8pe3ZhciBhPXQrcjtfW2UrNCpvPj4yXT1hLGZ1bmN0aW9uKGUsdCxyKXtmb3IodmFyIG49MDtuPGUubGVuZ3RoOysrbil2W3QrKz4+MF09ZS5jaGFyQ29kZUF0KG4pO3ZbdD4+MF09MH0obixhKSxyKz1uLmxlbmd0aCsxfSkpLDB9LGFhOmZ1bmN0aW9uKGUsdCl7dmFyIHI9aHQoKTtfW2U+PjJdPXIubGVuZ3RoO3ZhciBuPTA7cmV0dXJuIHIuZm9yRWFjaCgoZnVuY3Rpb24oZSl7bis9ZS5sZW5ndGgrMX0pKSxfW3Q+PjJdPW4sMH0saWE6ZnVuY3Rpb24oZSl7dHJ5e3ZhciB0PWJ0LmdldFN0cmVhbUZyb21GRChlKTtyZXR1cm4gX3QuY2xvc2UodCksMH1jYXRjaChlKXtpZih2b2lkIDA9PT1fdHx8IShlIGluc3RhbmNlb2YgX3QuRXJybm9FcnJvcikpdGhyb3cgZTtyZXR1cm4gZS5lcnJub319LGNhOmZ1bmN0aW9uKGUsdCxyLG4pe3RyeXt2YXIgbz1mdW5jdGlvbihlLHQscixuKXtmb3IodmFyIG89MCxhPTA7YTxyO2ErKyl7dmFyIGk9X1t0Pj4yXSxzPV9bdCs0Pj4yXTt0Kz04O3ZhciB1PV90LnJlYWQoZSx2LGkscyx1bmRlZmluZWQpO2lmKHU8MClyZXR1cm4tMTtpZihvKz11LHU8cylicmVha31yZXR1cm4gb30oYnQuZ2V0U3RyZWFtRnJvbUZEKGUpLHQscik7cmV0dXJuIF9bbj4+Ml09bywwfWNhdGNoKGUpe2lmKHZvaWQgMD09PV90fHwhKGUgaW5zdGFuY2VvZiBfdC5FcnJub0Vycm9yKSl0aHJvdyBlO3JldHVybiBlLmVycm5vfX0sVDpmdW5jdGlvbihlLHQscixuLG8pe3RyeXt2YXIgYT0odT1yKSsyMDk3MTUyPj4+MDw0MTk0MzA1LSEhKHM9dCk/KHM+Pj4wKSs0Mjk0OTY3Mjk2KnU6TmFOO2lmKGlzTmFOKGEpKXJldHVybiA2MTt2YXIgaT1idC5nZXRTdHJlYW1Gcm9tRkQoZSk7cmV0dXJuIF90Lmxsc2VlayhpLGEsbikseD1baS5wb3NpdGlvbj4+PjAsKCQ9aS5wb3NpdGlvbiwrTWF0aC5hYnMoJCk+PTE/JD4wPygwfE1hdGgubWluKCtNYXRoLmZsb29yKCQvNDI5NDk2NzI5NiksNDI5NDk2NzI5NSkpPj4+MDp+fitNYXRoLmNlaWwoKCQtKyh+fiQ+Pj4wKSkvNDI5NDk2NzI5Nik+Pj4wOjApXSxFW28+PjJdPXhbMF0sRVtvKzQ+PjJdPXhbMV0saS5nZXRkZW50cyYmMD09PWEmJjA9PT1uJiYoaS5nZXRkZW50cz1udWxsKSwwfWNhdGNoKGUpe2lmKHZvaWQgMD09PV90fHwhKGUgaW5zdGFuY2VvZiBfdC5FcnJub0Vycm9yKSl0aHJvdyBlO3JldHVybiBlLmVycm5vfXZhciBzLHV9LGJhOmZ1bmN0aW9uKGUsdCxyLG4pe3RyeXt2YXIgbz1mdW5jdGlvbihlLHQscixuKXtmb3IodmFyIG89MCxhPTA7YTxyO2ErKyl7dmFyIGk9X1t0Pj4yXSxzPV9bdCs0Pj4yXTt0Kz04O3ZhciB1PV90LndyaXRlKGUsdixpLHMsdW5kZWZpbmVkKTtpZih1PDApcmV0dXJuLTE7bys9dX1yZXR1cm4gb30oYnQuZ2V0U3RyZWFtRnJvbUZEKGUpLHQscik7cmV0dXJuIF9bbj4+Ml09bywwfWNhdGNoKGUpe2lmKHZvaWQgMD09PV90fHwhKGUgaW5zdGFuY2VvZiBfdC5FcnJub0Vycm9yKSl0aHJvdyBlO3JldHVybiBlLmVycm5vfX0sVjpmdW5jdGlvbihlKXt2YXIgdD1qdCgpO3RyeXtyZXR1cm4gRyhlKSgpfWNhdGNoKGUpe2lmKEl0KHQpLGUhPT1lKzApdGhyb3cgZTtSdCgxLDApfX0sZTpmdW5jdGlvbihlLHQpe3ZhciByPWp0KCk7dHJ5e3JldHVybiBHKGUpKHQpfWNhdGNoKGUpe2lmKEl0KHIpLGUhPT1lKzApdGhyb3cgZTtSdCgxLDApfX0sZzpmdW5jdGlvbihlLHQscil7dmFyIG49anQoKTt0cnl7cmV0dXJuIEcoZSkodCxyKX1jYXRjaChlKXtpZihJdChuKSxlIT09ZSswKXRocm93IGU7UnQoMSwwKX19LHI6ZnVuY3Rpb24oZSx0LHIsbil7dmFyIG89anQoKTt0cnl7cmV0dXJuIEcoZSkodCxyLG4pfWNhdGNoKGUpe2lmKEl0KG8pLGUhPT1lKzApdGhyb3cgZTtSdCgxLDApfX0sVzpmdW5jdGlvbihlLHQscixuLG8sYSl7dmFyIGk9anQoKTt0cnl7cmV0dXJuIEcoZSkodCxyLG4sbyxhKX1jYXRjaChlKXtpZihJdChpKSxlIT09ZSswKXRocm93IGU7UnQoMSwwKX19LHg6ZnVuY3Rpb24oZSx0LHIsbixvLGEsaSl7dmFyIHM9anQoKTt0cnl7cmV0dXJuIEcoZSkodCxyLG4sbyxhLGkpfWNhdGNoKGUpe2lmKEl0KHMpLGUhPT1lKzApdGhyb3cgZTtSdCgxLDApfX0sSjpmdW5jdGlvbihlLHQscixuLG8sYSxpLHMpe3ZhciB1PWp0KCk7dHJ5e3JldHVybiBHKGUpKHQscixuLG8sYSxpLHMpfWNhdGNoKGUpe2lmKEl0KHUpLGUhPT1lKzApdGhyb3cgZTtSdCgxLDApfX0sRTpmdW5jdGlvbihlLHQscixuLG8sYSxpLHMsdSxjLGwsZCl7dmFyIGY9anQoKTt0cnl7cmV0dXJuIEcoZSkodCxyLG4sbyxhLGkscyx1LGMsbCxkKX1jYXRjaChlKXtpZihJdChmKSxlIT09ZSswKXRocm93IGU7UnQoMSwwKX19LFI6ZnVuY3Rpb24oZSx0LHIsbixvKXt2YXIgYT1qdCgpO3RyeXtyZXR1cm4gTHQoZSx0LHIsbixvKX1jYXRjaChlKXtpZihJdChhKSxlIT09ZSswKXRocm93IGU7UnQoMSwwKX19LFM6ZnVuY3Rpb24oZSl7dmFyIHQ9anQoKTt0cnl7cmV0dXJuIFd0KGUpfWNhdGNoKGUpe2lmKEl0KHQpLGUhPT1lKzApdGhyb3cgZTtSdCgxLDApfX0sbDpmdW5jdGlvbihlKXt2YXIgdD1qdCgpO3RyeXtHKGUpKCl9Y2F0Y2goZSl7aWYoSXQodCksZSE9PWUrMCl0aHJvdyBlO1J0KDEsMCl9fSxrOmZ1bmN0aW9uKGUsdCl7dmFyIHI9anQoKTt0cnl7RyhlKSh0KX1jYXRjaChlKXtpZihJdChyKSxlIT09ZSswKXRocm93IGU7UnQoMSwwKX19LGk6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWp0KCk7dHJ5e0coZSkodCxyKX1jYXRjaChlKXtpZihJdChuKSxlIT09ZSswKXRocm93IGU7UnQoMSwwKX19LHY6ZnVuY3Rpb24oZSx0LHIsbil7dmFyIG89anQoKTt0cnl7RyhlKSh0LHIsbil9Y2F0Y2goZSl7aWYoSXQobyksZSE9PWUrMCl0aHJvdyBlO1J0KDEsMCl9fSxvOmZ1bmN0aW9uKGUsdCxyLG4sbyl7dmFyIGE9anQoKTt0cnl7RyhlKSh0LHIsbixvKX1jYXRjaChlKXtpZihJdChhKSxlIT09ZSswKXRocm93IGU7UnQoMSwwKX19LHE6ZnVuY3Rpb24oZSx0LHIsbixvLGEsaSxzKXt2YXIgdT1qdCgpO3RyeXtHKGUpKHQscixuLG8sYSxpLHMpfWNhdGNoKGUpe2lmKEl0KHUpLGUhPT1lKzApdGhyb3cgZTtSdCgxLDApfX0sQTpmdW5jdGlvbihlLHQscixuLG8sYSxpLHMsdSxjLGwpe3ZhciBkPWp0KCk7dHJ5e0coZSkodCxyLG4sbyxhLGkscyx1LGMsbCl9Y2F0Y2goZSl7aWYoSXQoZCksZSE9PWUrMCl0aHJvdyBlO1J0KDEsMCl9fSxEOmZ1bmN0aW9uKGUsdCxyLG4sbyxhLGkscyx1LGMsbCxkLGYscCxoLG0pe3ZhciB2PWp0KCk7dHJ5e0coZSkodCxyLG4sbyxhLGkscyx1LGMsbCxkLGYscCxoLG0pfWNhdGNoKGUpe2lmKEl0KHYpLGUhPT1lKzApdGhyb3cgZTtSdCgxLDApfX0sWDpmdW5jdGlvbihlLHQscixuLG8pe3JldHVybiBmdW5jdGlvbihlLHQscixuKXt2YXIgbz1FW24rNDA+PjJdLGE9e3RtX3NlYzpFW24+PjJdLHRtX21pbjpFW24rND4+Ml0sdG1faG91cjpFW24rOD4+Ml0sdG1fbWRheTpFW24rMTI+PjJdLHRtX21vbjpFW24rMTY+PjJdLHRtX3llYXI6RVtuKzIwPj4yXSx0bV93ZGF5OkVbbisyND4+Ml0sdG1feWRheTpFW24rMjg+PjJdLHRtX2lzZHN0OkVbbiszMj4+Ml0sdG1fZ210b2ZmOkVbbiszNj4+Ml0sdG1fem9uZTpvP1Mobyk6IiJ9LGk9UyhyKSxzPXsiJWMiOiIlYSAlYiAlZCAlSDolTTolUyAlWSIsIiVEIjoiJW0vJWQvJXkiLCIlRiI6IiVZLSVtLSVkIiwiJWgiOiIlYiIsIiVyIjoiJUk6JU06JVMgJXAiLCIlUiI6IiVIOiVNIiwiJVQiOiIlSDolTTolUyIsIiV4IjoiJW0vJWQvJXkiLCIlWCI6IiVIOiVNOiVTIiwiJUVjIjoiJWMiLCIlRUMiOiIlQyIsIiVFeCI6IiVtLyVkLyV5IiwiJUVYIjoiJUg6JU06JVMiLCIlRXkiOiIleSIsIiVFWSI6IiVZIiwiJU9kIjoiJWQiLCIlT2UiOiIlZSIsIiVPSCI6IiVIIiwiJU9JIjoiJUkiLCIlT20iOiIlbSIsIiVPTSI6IiVNIiwiJU9TIjoiJVMiLCIlT3UiOiIldSIsIiVPVSI6IiVVIiwiJU9WIjoiJVYiLCIlT3ciOiIldyIsIiVPVyI6IiVXIiwiJU95IjoiJXkifTtmb3IodmFyIHUgaW4gcylpPWkucmVwbGFjZShuZXcgUmVnRXhwKHUsImciKSxzW3VdKTt2YXIgYz1bIlN1bmRheSIsIk1vbmRheSIsIlR1ZXNkYXkiLCJXZWRuZXNkYXkiLCJUaHVyc2RheSIsIkZyaWRheSIsIlNhdHVyZGF5Il0sbD1bIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl07ZnVuY3Rpb24gZChlLHQscil7Zm9yKHZhciBuPSJudW1iZXIiPT10eXBlb2YgZT9lLnRvU3RyaW5nKCk6ZXx8IiI7bi5sZW5ndGg8dDspbj1yWzBdK247cmV0dXJuIG59ZnVuY3Rpb24gZihlLHQpe3JldHVybiBkKGUsdCwiMCIpfWZ1bmN0aW9uIHAoZSx0KXtmdW5jdGlvbiByKGUpe3JldHVybiBlPDA/LTE6ZT4wPzE6MH12YXIgbjtyZXR1cm4gMD09PShuPXIoZS5nZXRGdWxsWWVhcigpLXQuZ2V0RnVsbFllYXIoKSkpJiYwPT09KG49cihlLmdldE1vbnRoKCktdC5nZXRNb250aCgpKSkmJihuPXIoZS5nZXREYXRlKCktdC5nZXREYXRlKCkpKSxufWZ1bmN0aW9uIGgoZSl7c3dpdGNoKGUuZ2V0RGF5KCkpe2Nhc2UgMDpyZXR1cm4gbmV3IERhdGUoZS5nZXRGdWxsWWVhcigpLTEsMTEsMjkpO2Nhc2UgMTpyZXR1cm4gZTtjYXNlIDI6cmV0dXJuIG5ldyBEYXRlKGUuZ2V0RnVsbFllYXIoKSwwLDMpO2Nhc2UgMzpyZXR1cm4gbmV3IERhdGUoZS5nZXRGdWxsWWVhcigpLDAsMik7Y2FzZSA0OnJldHVybiBuZXcgRGF0ZShlLmdldEZ1bGxZZWFyKCksMCwxKTtjYXNlIDU6cmV0dXJuIG5ldyBEYXRlKGUuZ2V0RnVsbFllYXIoKS0xLDExLDMxKTtjYXNlIDY6cmV0dXJuIG5ldyBEYXRlKGUuZ2V0RnVsbFllYXIoKS0xLDExLDMwKX19ZnVuY3Rpb24gbShlKXt2YXIgdD1mdW5jdGlvbihlLHQpe2Zvcih2YXIgcj1uZXcgRGF0ZShlLmdldFRpbWUoKSk7dD4wOyl7dmFyIG49a3Qoci5nZXRGdWxsWWVhcigpKSxvPXIuZ2V0TW9udGgoKSxhPShuP1B0OlR0KVtvXTtpZighKHQ+YS1yLmdldERhdGUoKSkpcmV0dXJuIHIuc2V0RGF0ZShyLmdldERhdGUoKSt0KSxyO3QtPWEtci5nZXREYXRlKCkrMSxyLnNldERhdGUoMSksbzwxMT9yLnNldE1vbnRoKG8rMSk6KHIuc2V0TW9udGgoMCksci5zZXRGdWxsWWVhcihyLmdldEZ1bGxZZWFyKCkrMSkpfXJldHVybiByfShuZXcgRGF0ZShlLnRtX3llYXIrMTkwMCwwLDEpLGUudG1feWRheSkscj1uZXcgRGF0ZSh0LmdldEZ1bGxZZWFyKCksMCw0KSxuPW5ldyBEYXRlKHQuZ2V0RnVsbFllYXIoKSsxLDAsNCksbz1oKHIpLGE9aChuKTtyZXR1cm4gcChvLHQpPD0wP3AoYSx0KTw9MD90LmdldEZ1bGxZZWFyKCkrMTp0LmdldEZ1bGxZZWFyKCk6dC5nZXRGdWxsWWVhcigpLTF9dmFyIHk9eyIlYSI6ZnVuY3Rpb24oZSl7cmV0dXJuIGNbZS50bV93ZGF5XS5zdWJzdHJpbmcoMCwzKX0sIiVBIjpmdW5jdGlvbihlKXtyZXR1cm4gY1tlLnRtX3dkYXldfSwiJWIiOmZ1bmN0aW9uKGUpe3JldHVybiBsW2UudG1fbW9uXS5zdWJzdHJpbmcoMCwzKX0sIiVCIjpmdW5jdGlvbihlKXtyZXR1cm4gbFtlLnRtX21vbl19LCIlQyI6ZnVuY3Rpb24oZSl7cmV0dXJuIGYoKGUudG1feWVhcisxOTAwKS8xMDB8MCwyKX0sIiVkIjpmdW5jdGlvbihlKXtyZXR1cm4gZihlLnRtX21kYXksMil9LCIlZSI6ZnVuY3Rpb24oZSl7cmV0dXJuIGQoZS50bV9tZGF5LDIsIiAiKX0sIiVnIjpmdW5jdGlvbihlKXtyZXR1cm4gbShlKS50b1N0cmluZygpLnN1YnN0cmluZygyKX0sIiVHIjpmdW5jdGlvbihlKXtyZXR1cm4gbShlKX0sIiVIIjpmdW5jdGlvbihlKXtyZXR1cm4gZihlLnRtX2hvdXIsMil9LCIlSSI6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS50bV9ob3VyO3JldHVybiAwPT10P3Q9MTI6dD4xMiYmKHQtPTEyKSxmKHQsMil9LCIlaiI6ZnVuY3Rpb24oZSl7cmV0dXJuIGYoZS50bV9tZGF5K2Z1bmN0aW9uKGUsdCl7Zm9yKHZhciByPTAsbj0wO248PXQ7cis9ZVtuKytdKTtyZXR1cm4gcn0oa3QoZS50bV95ZWFyKzE5MDApP1B0OlR0LGUudG1fbW9uLTEpLDMpfSwiJW0iOmZ1bmN0aW9uKGUpe3JldHVybiBmKGUudG1fbW9uKzEsMil9LCIlTSI6ZnVuY3Rpb24oZSl7cmV0dXJuIGYoZS50bV9taW4sMil9LCIlbiI6ZnVuY3Rpb24oKXtyZXR1cm4iXG4ifSwiJXAiOmZ1bmN0aW9uKGUpe3JldHVybiBlLnRtX2hvdXI+PTAmJmUudG1faG91cjwxMj8iQU0iOiJQTSJ9LCIlUyI6ZnVuY3Rpb24oZSl7cmV0dXJuIGYoZS50bV9zZWMsMil9LCIldCI6ZnVuY3Rpb24oKXtyZXR1cm4iXHQifSwiJXUiOmZ1bmN0aW9uKGUpe3JldHVybiBlLnRtX3dkYXl8fDd9LCIlVSI6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS50bV95ZGF5KzctZS50bV93ZGF5O3JldHVybiBmKE1hdGguZmxvb3IodC83KSwyKX0sIiVWIjpmdW5jdGlvbihlKXt2YXIgdD1NYXRoLmZsb29yKChlLnRtX3lkYXkrNy0oZS50bV93ZGF5KzYpJTcpLzcpO2lmKChlLnRtX3dkYXkrMzcxLWUudG1feWRheS0yKSU3PD0yJiZ0KyssdCl7aWYoNTM9PXQpe3ZhciByPShlLnRtX3dkYXkrMzcxLWUudG1feWRheSklNzs0PT1yfHwzPT1yJiZrdChlLnRtX3llYXIpfHwodD0xKX19ZWxzZXt0PTUyO3ZhciBuPShlLnRtX3dkYXkrNy1lLnRtX3lkYXktMSklNzsoND09bnx8NT09biYma3QoZS50bV95ZWFyJTQwMC0xKSkmJnQrK31yZXR1cm4gZih0LDIpfSwiJXciOmZ1bmN0aW9uKGUpe3JldHVybiBlLnRtX3dkYXl9LCIlVyI6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS50bV95ZGF5KzctKGUudG1fd2RheSs2KSU3O3JldHVybiBmKE1hdGguZmxvb3IodC83KSwyKX0sIiV5IjpmdW5jdGlvbihlKXtyZXR1cm4oZS50bV95ZWFyKzE5MDApLnRvU3RyaW5nKCkuc3Vic3RyaW5nKDIpfSwiJVkiOmZ1bmN0aW9uKGUpe3JldHVybiBlLnRtX3llYXIrMTkwMH0sIiV6IjpmdW5jdGlvbihlKXt2YXIgdD1lLnRtX2dtdG9mZixyPXQ+PTA7cmV0dXJuIHQ9KHQ9TWF0aC5hYnModCkvNjApLzYwKjEwMCt0JTYwLChyPyIrIjoiLSIpK1N0cmluZygiMDAwMCIrdCkuc2xpY2UoLTQpfSwiJVoiOmZ1bmN0aW9uKGUpe3JldHVybiBlLnRtX3pvbmV9LCIlJSI6ZnVuY3Rpb24oKXtyZXR1cm4iJSJ9fTtmb3IodmFyIHUgaW4gaT1pLnJlcGxhY2UoLyUlL2csIlwwXDAiKSx5KWkuaW5jbHVkZXModSkmJihpPWkucmVwbGFjZShuZXcgUmVnRXhwKHUsImciKSx5W3VdKGEpKSk7dmFyIGc9eXQoaT1pLnJlcGxhY2UoL1wwXDAvZywiJSIpLCExKTtyZXR1cm4gZy5sZW5ndGg+dD8wOihmdW5jdGlvbihlLHQpe3Yuc2V0KGUsdCl9KGcsZSksZy5sZW5ndGgtMSl9KGUsdCxyLG4pfX0sRnQ9ZnVuY3Rpb24oKXt2YXIgdD17YTpDdH07ZnVuY3Rpb24gbih0LHIpe3ZhciBuLG8sYT10LmV4cG9ydHM7ZS5hc209YSxuPWUuYXNtLnNhLmJ1ZmZlcixtPW4sZS5IRUFQOD12PW5ldyBJbnQ4QXJyYXkobiksZS5IRUFQMTY9Zz1uZXcgSW50MTZBcnJheShuKSxlLkhFQVAzMj1FPW5ldyBJbnQzMkFycmF5KG4pLGUuSEVBUFU4PXk9bmV3IFVpbnQ4QXJyYXkobiksZS5IRUFQVTE2PXc9bmV3IFVpbnQxNkFycmF5KG4pLGUuSEVBUFUzMj1fPW5ldyBVaW50MzJBcnJheShuKSxlLkhFQVBGMzI9Yj1uZXcgRmxvYXQzMkFycmF5KG4pLGUuSEVBUEY2ND1rPW5ldyBGbG9hdDY0QXJyYXkobiksRj1lLmFzbS55YSxvPWUuYXNtLnRhLE8udW5zaGlmdChvKSxXKCl9aWYoQigpLGUuaW5zdGFudGlhdGVXYXNtKXRyeXtyZXR1cm4gZS5pbnN0YW50aWF0ZVdhc20odCxuKX1jYXRjaChlKXtkKCJNb2R1bGUuaW5zdGFudGlhdGVXYXNtIGNhbGxiYWNrIGZhaWxlZCB3aXRoIGVycm9yOiAiK2UpLHIoZSl9cmV0dXJuIG4oZnVuY3Rpb24oZSx0KXt2YXIgcixuLG87dHJ5e289ZnVuY3Rpb24oZSl7dHJ5e2lmKGU9PU0mJmYpcmV0dXJuIG5ldyBVaW50OEFycmF5KGYpO3Rocm93InN5bmMgZmV0Y2hpbmcgb2YgdGhlIHdhc20gZmFpbGVkOiB5b3UgY2FuIHByZWxvYWQgaXQgdG8gTW9kdWxlWyd3YXNtQmluYXJ5J10gbWFudWFsbHksIG9yIGVtY2MucHkgd2lsbCBkbyB0aGF0IGZvciB5b3Ugd2hlbiBnZW5lcmF0aW5nIEhUTUwgKGJ1dCBub3QgSlMpIn1jYXRjaChlKXtMKGUpfX0oZSksbj1uZXcgV2ViQXNzZW1ibHkuTW9kdWxlKG8pLHI9bmV3IFdlYkFzc2VtYmx5Lkluc3RhbmNlKG4sdCl9Y2F0Y2goZSl7dmFyIGE9ZS50b1N0cmluZygpO3Rocm93IGQoImZhaWxlZCB0byBjb21waWxlIHdhc20gbW9kdWxlOiAiK2EpLChhLmluY2x1ZGVzKCJpbXBvcnRlZCBNZW1vcnkiKXx8YS5pbmNsdWRlcygibWVtb3J5IGltcG9ydCIpKSYmZCgiTWVtb3J5IHNpemUgaW5jb21wYXRpYmlsaXR5IGlzc3VlcyBtYXkgYmUgZHVlIHRvIGNoYW5naW5nIElOSVRJQUxfTUVNT1JZIGF0IHJ1bnRpbWUgdG8gc29tZXRoaW5nIHRvbyBsYXJnZS4gVXNlIEFMTE9XX01FTU9SWV9HUk9XVEggdG8gYWxsb3cgYW55IHNpemUgbWVtb3J5IChhbmQgYWxzbyBtYWtlIHN1cmUgbm90IHRvIHNldCBJTklUSUFMX01FTU9SWSBhdCBydW50aW1lIHRvIHNvbWV0aGluZyBzbWFsbGVyIHRoYW4gaXQgd2FzIGF0IGNvbXBpbGUgdGltZSkuIiksZX1yZXR1cm5bcixuXX0oTSx0KVswXSksZS5hc219KCksTXQ9KGUuX19fd2FzbV9jYWxsX2N0b3JzPUZ0LnRhLGUuX2ZyZWU9RnQudWEpLEF0PWUuX21hbGxvYz1GdC52YSwkdD1lLl9fX2dldFR5cGVOYW1lPUZ0LndhLHh0PShlLl9fZW1iaW5kX2luaXRpYWxpemVfYmluZGluZ3M9RnQueGEsZS5fZW1zY3JpcHRlbl9idWlsdGluX21lbWFsaWduPUZ0LnphKSxSdD1lLl9zZXRUaHJldz1GdC5BYSxPdD1lLnNldFRlbXBSZXQwPUZ0LkJhLGp0PWUuc3RhY2tTYXZlPUZ0LkNhLEl0PWUuc3RhY2tSZXN0b3JlPUZ0LkRhLHp0PWUuX19fY3hhX2ZyZWVfZXhjZXB0aW9uPUZ0LkVhLE50PWUuX19fY3hhX2Nhbl9jYXRjaD1GdC5GYSxCdD1lLl9fX2N4YV9pc19wb2ludGVyX3R5cGU9RnQuR2EsV3Q9ZS5keW5DYWxsX2o9RnQuSGEsTHQ9KGUuZHluQ2FsbF9qamo9RnQuSWEsZS5keW5DYWxsX2lpaWo9RnQuSmEpO2Z1bmN0aW9uIFV0KHIpe2Z1bmN0aW9uIG4oKXtEdHx8KER0PSEwLGUuY2FsbGVkUnVuPSEwLHB8fChlLm5vRlNJbml0fHxfdC5pbml0LmluaXRpYWxpemVkfHxfdC5pbml0KCksX3QuaWdub3JlUGVybWlzc2lvbnM9ITEsZ3QuaW5pdCgpLFUoTyksdChlKSxlLm9uUnVudGltZUluaXRpYWxpemVkJiZlLm9uUnVudGltZUluaXRpYWxpemVkKCksZnVuY3Rpb24oKXtpZihlLnBvc3RSdW4pZm9yKCJmdW5jdGlvbiI9PXR5cGVvZiBlLnBvc3RSdW4mJihlLnBvc3RSdW49W2UucG9zdFJ1bl0pO2UucG9zdFJ1bi5sZW5ndGg7KXQ9ZS5wb3N0UnVuLnNoaWZ0KCksai51bnNoaWZ0KHQpO3ZhciB0O1Uoail9KCkpKX1yPXJ8fHMsST4wfHwoZnVuY3Rpb24oKXtpZihlLnByZVJ1bilmb3IoImZ1bmN0aW9uIj09dHlwZW9mIGUucHJlUnVuJiYoZS5wcmVSdW49W2UucHJlUnVuXSk7ZS5wcmVSdW4ubGVuZ3RoOyl0PWUucHJlUnVuLnNoaWZ0KCksUi51bnNoaWZ0KHQpO3ZhciB0O1UoUil9KCksST4wfHwoZS5zZXRTdGF0dXM/KGUuc2V0U3RhdHVzKCJSdW5uaW5nLi4uIiksc2V0VGltZW91dCgoZnVuY3Rpb24oKXtzZXRUaW1lb3V0KChmdW5jdGlvbigpe2Uuc2V0U3RhdHVzKCIiKX0pLDEpLG4oKX0pLDEpKTpuKCkpKX1pZihlLmR5bkNhbGxfamlqaT1GdC5LYSxlLmR5bkNhbGxfdmlpamlpPUZ0LkxhLGUuZHluQ2FsbF9paWlpaWo9RnQuTWEsZS5keW5DYWxsX2lpaWlpamo9RnQuTmEsZS5keW5DYWxsX2lpaWlpaWpqPUZ0Lk9hLE49ZnVuY3Rpb24gZSgpe0R0fHxVdCgpLER0fHwoTj1lKX0sZS5wcmVJbml0KWZvcigiZnVuY3Rpb24iPT10eXBlb2YgZS5wcmVJbml0JiYoZS5wcmVJbml0PVtlLnByZUluaXRdKTtlLnByZUluaXQubGVuZ3RoPjA7KWUucHJlSW5pdC5wb3AoKSgpO3JldHVybiBVdCgpLGV9KTtjb25zdCBzPWk7dmFyIHU9bnVsbCxjPW51bGwsbD1udWxsLGQ9IiI7Y29uc3QgZj1hc3luYygpPT57ZShjLGwsbnVsbCx1KSxjbG9zZSgpfTtvLnNldExvZ2dlckxldmVsKDIpLG8uc2V0TG9nZ2VyVGFnKCJzZWxwaGktd29ya2VyLWVuZ2luZSIpLHNlbGYub25tZXNzYWdlPXI9Pntzd2l0Y2goci5kYXRhLmNtZCl7Y2FzZSJwcmVJbml0IjooYXN5bmMgZT0+e28ucHJpbnREZWJ1ZygiUmVjZWl2ZWQgbWVzc2FnZSBpbiBwcmVJbml0IGV2ZW50IiksZD1lLmJ1bmRsZVBhdGg7dHJ5e2xldCBlPWF3YWl0KGF3YWl0IGZldGNoKGQrIi9GUGhpRXh0cmFjdG9yLndhc20iKSkuYXJyYXlCdWZmZXIoKSx0PW5ldyBXZWJBc3NlbWJseS5NZW1vcnkoe2luaXRpYWw6MSxtYXhpbXVtOjQwOTZ9KTt1PWF3YWl0IHMoe3dhc21CaW5hcnk6ZSx3YXNtTWVtb3J5OnQsb25SdW50aW1lSW5pdGlhbGl6ZWQ6KCk9PnNlbGYucG9zdE1lc3NhZ2Uoe2NtZDoicmVhZHkifSl9KSxvLnByaW50RGVidWcoIlByZWxvYWRpbmcgd2FzbSBtb2R1bGUgZnJvbSBwYXRoOiAiK2QrIi9GUGhpRXh0cmFjdG9yLndhc20iKX1jYXRjaChlKXtlIGluc3RhbmNlb2YgUmFuZ2VFcnJvcj9vLnByaW50RXJyb3IoIkl0IGxvb2tzIGxpa2UgeW91IGhhdmUgdHJpZWQgdG8gaW5zdGFudGlhdGUgbW9yZSBtZW1vcnkgdGhhbiB0aGUgZGV2aWNlIGlzIGFsbG93aW5nLCB0aGlzIG1heSBtZWFuIHRoYXQgbm90IGVub3VnaCBtZW1vcnkgaGFzIGJlZW4gYWxsb2NhdGVkIHRvIHRoZSBicm93c2VyIHRhYiBvciB0aGF0IHRoZSB3ZWIgYXBwbGljYXRpb24gaXMgY29uc3VtaW5nIG1vcmUgcmVzb3VyY2VzIHRoYW4gZXhwZWN0ZWQuIik6ZSBpbnN0YW5jZW9mIFdlYkFzc2VtYmx5LkxpbmtFcnJvcj9vLnByaW50RXJyb3IoIkl0IGhhcyBiZWVuIGRldGVjdGVkIHRoYXQgdGhlIHJlc291cmNlIGJ1bmRsZSBkZWxpdmVyZWQgd2l0aCB0aGlzIHZlcnNpb24gaXMgbm90IGJlaW5nIHVzZWQuIFBsZWFzZSBjaGVjayB0aGUgeWFybi5sb2NrIG9yIHBhY2thZ2UtbG9jay5qc29uIGZpbGUgb2YgdGhlIHByb2plY3QgaW4gY2FzZSB5b3UgYXJlIHVzaW5nIHRoZSBXZWIgU0RLLCBvdGhlcndpc2UgbWFudWFsbHkgdXBkYXRlIHRoZSByZXNvdXJjZSBkaXJlY3RvcnkgYW5kIHRyeSBhZ2Fpbi4iKTpvLnByaW50RXJyb3IoIltXb3JrZXJdOiAiK2UpfX0pKHIuZGF0YSk7YnJlYWs7Y2FzZSJpbml0IjooYXN5bmMgdD0+e2xldCByPXQubWluSU9EO3RyeXtsZXQgdD1uZXcgdS5FeHRyYWN0b3JDb25maWd1cmF0aW9uTWFuYWdlcjt0LnNldE1pbmltdW1EaXN0YW5jZUJldHdlZW5FeWVzQWxsb3dlZChyKSx0LnNldEltYWdlUXVhbGl0eUZpbHRlcih1LkltYWdlUXVhbGl0eUZpbHRlci5NZWRpdW0pLHQuc2V0UGF0dGVyblF1YWxpdHlGaWx0ZXIodS5QYXR0ZXJuUXVhbGl0eUZpbHRlci5NZWRpdW0pLGM9bmV3IHUuRXh0cmFjdG9yKHQpLGUodCksby5wcmludERlYnVnKCJTZWxwaGkgRXh0cmFjdG9yIEluc3RhbmNlZCIpLHNlbGYucG9zdE1lc3NhZ2Uoe2NtZDoiaW5pdCJ9KX1jYXRjaChlKXtvLnByaW50RXJyb3IoZSl9fSkoci5kYXRhKTticmVhaztjYXNlInRva2VuaXplIjooYXN5bmMgdD0+e2xldCByPXtjbWQ6InRva2VuaXplIn07by5wcmludERlYnVnKCJSZWNlaXZlZCBtZXNzYWdlIGluIHRva2VuaXplIGV2ZW50Iik7bGV0IG49dC5kYXRhLGE9dC5kYXRhLmxlbmd0aCxpPW5ldyB1LkV4dHJhY3RvcixzPW5ldyB1LlZlY3RvclVjaGFyO2ZvcihsZXQgZT0wO2U8YTtlKyspcy5wdXNoX2JhY2sobi5jaGFyQ29kZUF0KGUpKTtsZXQgYz1pLnRva2VuaXplKHMpO3IuZGF0YT1idG9hKChlPT57bGV0IHQ9W107Zm9yKGxldCByPTA7cjxlLmxlbmd0aDtyKz0zMjc2OCl0LnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLGUuc3ViYXJyYXkocixyKzMyNzY4KSkpO3JldHVybiB0LmpvaW4oIiIpfSkodS5nZXRCeXRlcyhjKSkpLGUocyxjLGkpLG8ucHJpbnREZWJ1ZygiU2VudCBtZXNzYWdlIGZyb20gdG9rZW5pemUgZXZlbnQiKSxzZWxmLnBvc3RNZXNzYWdlKHIpLGF3YWl0IGYoKX0pKHIuZGF0YSk7YnJlYWs7Y2FzZSJkZXRlY3QiOihhc3luYyByPT57bGV0IG49e2NtZDoiZGV0ZWN0In07by5wcmludERlYnVnKCJSZWNlaXZlZCBtZXNzYWdlIGluIGRldGVjdCBldmVudCIpO2xldCBhPXUuSW1hZ2UuZ2V0RlBoaUltYWdlKHIuZGF0YSxyLmhlaWdodCxyLndpZHRoLHUuSW1hZ2VGb3JtYXQuUkdCQV8zMmJwcCksaT1jLmRldGVjdChhKSxzPW51bGw7aSYmKHM9aS5nZXQoMCksbj10KHUsbixzKSksZShzLGEsaSksby5wcmludERlYnVnKCJTZW50IG1lc3NhZ2UgZnJvbSBkZXRlY3QgZXZlbnQiKSxzZWxmLnBvc3RNZXNzYWdlKG4pfSkoci5kYXRhKTticmVhaztjYXNlImluaXRTdHJlYW1FeHRyYWN0aW9uIjooYXN5bmMgdD0+e2Muc3RvcFN0cmVhbUV4dHJhY3Rpb24oKSxvLnByaW50RGVidWcoIlJlY2VpdmVkIG1lc3NhZ2UgaW4gaW5pdFN0cmVhbUV4dHJhY3Rpb24gZXZlbnQiKTtsZXQgcj1udWxsLG49bmV3IHUuRXh0cmFjdGlvbk9wdGlvbnM7cj0xPT09dC5leHRyYWN0aW9uTW9kZT91LkV4dHJhY3Rpb25Nb2RlLlJlZ2lzdGVyOnUuRXh0cmFjdGlvbk1vZGUuQXV0aGVudGljYXRlLG4uc2V0RXh0cmFjdGlvbk1vZGUociksbi5zZXRSYXdUZW1wbGF0ZXMoMSksYy5pbml0U3RyZWFtRXh0cmFjdGlvblNtYXJ0V2l0aEV4dHJhY3Rpb25PcHRpb25zKG4pLGUobixyKSxvLnByaW50RGVidWcoIlNlbnQgbWVzc2FnZSBmcm9tIGluaXRTdHJlYW1FeHRyYWN0aW9uIGV2ZW50Iiksc2VsZi5wb3N0TWVzc2FnZSh7Y21kOiJpbml0U3RyZWFtRXh0cmFjdGlvbiJ9KX0pKHIuZGF0YSk7YnJlYWs7Y2FzZSJleHRyYWN0TmV4dFNtYXJ0IjooYXN5bmMgcj0+e2xldCBuPXtjbWQ6ImV4dHJhY3ROZXh0U21hcnQifTtvLnByaW50RGVidWcoIlJlY2VpdmVkIG1lc3NhZ2UgaW4gZXh0cmFjdE5leHRTbWFydCBldmVudCIpO2xldCBhPXUuSW1hZ2UuZ2V0RlBoaUltYWdlKHIuZGF0YSxyLmhlaWdodCxyLndpZHRoLHUuSW1hZ2VGb3JtYXQuUkdCQV8zMmJwcCksaT1jLmV4dHJhY3ROZXh0U21hcnQoYSk7bnVsbCE9PWwmJmwuZGVsZXRlKCksbD1pLG49dCh1LG4saSksZShhKSxvLnByaW50RGVidWcoIlNlbnQgbWVzc2FnZSBmcm9tIGV4dHJhY3ROZXh0U21hcnQgZXZlbnQiKSxzZWxmLnBvc3RNZXNzYWdlKG4pfSkoci5kYXRhKTticmVhaztjYXNlImluaXRMaXZlbmVzc01vdmVTdGFiaWxpemF0aW9uIjooYXN5bmMoKT0+e28ucHJpbnREZWJ1ZygiUmVjZWl2ZWQgbWVzc2FnZSBpbiBpbml0TGl2ZW5lc3NNb3ZlU3RhYmlsaXphdGlvbiBldmVudCIpLGMuaW5pdExpdmVuZXNzSE1DQ1N0YWJpbGl6YXRpb24oKSxvLnByaW50RGVidWcoIlNlbnQgbWVzc2FnZSBmcm9tIGluaXRMaXZlbmVzc01vdmVTdGFiaWxpemF0aW9uIGV2ZW50Iiksc2VsZi5wb3N0TWVzc2FnZSh7Y21kOiJpbml0TGl2ZW5lc3NNb3ZlU3RhYmlsaXphdGlvbiJ9KX0pKHIuZGF0YSk7YnJlYWs7Y2FzZSJuZXh0TGl2ZW5lc3NNb3ZlU3RhYmlsaXphdGlvbiI6KGFzeW5jIHI9PntsZXQgbj17Y21kOiJuZXh0TGl2ZW5lc3NNb3ZlU3RhYmlsaXphdGlvbiJ9O28ucHJpbnREZWJ1ZygiUmVjZWl2ZWQgbWVzc2FnZSBpbiBuZXh0TGl2ZW5lc3NNb3ZlU3RhYmlsaXphdGlvbiBldmVudCIpO2xldCBhPXUuSW1hZ2UuZ2V0RlBoaUltYWdlKHIuZGF0YSxyLmhlaWdodCxyLndpZHRoLHUuSW1hZ2VGb3JtYXQuUkdCQV8zMmJwcCksaT1jLm5leHRMaXZlbmVzc0hNQ0NTdGFiaWxpemF0aW9uKGEscGVyZm9ybWFuY2Uubm93KCkpO251bGwhPT1sJiZsLmRlbGV0ZSgpLGw9aSxuPXQodSxuLGkpLG4uZmFjZVN0YWJpbGl6ZWQ9aS5nZXRGYWNlU3RhYmlsaXplZFN0YXR1cygpLGUoYSksby5wcmludERlYnVnKCJTZW50IG1lc3NhZ2UgZnJvbSBuZXh0TGl2ZW5lc3NNb3ZlU3RhYmlsaXphdGlvbiBldmVudCIpLHNlbGYucG9zdE1lc3NhZ2Uobil9KShyLmRhdGEpO2JyZWFrO2Nhc2UidmVyc2lvbiI6KGFzeW5jKCk9PntsZXQgZT17Y21kOiJ2ZXJzaW9uIn07ZS52ZXJzaW9uPXUuRXh0cmFjdG9yLmdldFZlcnNpb24oKSxzZWxmLnBvc3RNZXNzYWdlKGUpfSkoci5kYXRhKTticmVhaztjYXNlImRlc3Ryb3kiOmYoci5kYXRhKTticmVhaztkZWZhdWx0Om8ucHJpbnREZWJ1ZygiVW5rbm93IE1lc3NhZ2UiKX19Ow=='
                  ),
                ],
                { type: 'text/javascript' }
              )
            )),
          u)
        ));
    }
    async initializeEngine() {
      try {
        this.__worker.postMessage({
          cmd: 'preInit',
          licenseKey: this.__licenseKey,
          bundlePath: this.__engineLocation + '/FPhi.Engine.Facephi',
        }),
          await new Promise((e) => {
            this.__worker.onmessage = (t) => {
              'ready' === t.data.cmd && e();
            };
          }),
          this.__worker.postMessage({ cmd: 'init', minIOD: this.__minIOD }),
          await new Promise((e) => {
            this.__worker.onmessage = (t) => {
              'init' === t.data.cmd
                ? this.__worker.postMessage({
                    cmd: 'initLivenessMoveStabilization',
                  })
                : 'initLivenessMoveStabilization' === t.data.cmd
                ? this.__worker.postMessage({
                    cmd: 'initStreamExtraction',
                    extractionMode: 0,
                  })
                : 'initStreamExtraction' === t.data.cmd && e();
            };
          });
      } catch (e) {
        throw new Error('Fail to initialize the engine!');
      }
    }
    detect(e) {
      return new Promise((t) => {
        (this.__worker.onmessage = (e) => {
          'detect' === e.data.cmd && t(this.__cleanOutputWorker(e.data));
        }),
          this.__worker.postMessage({
            cmd: 'detect',
            data: e.data,
            width: e.width,
            height: e.height,
            format: 8,
          });
      });
    }
    extractionNextSmart(e) {
      return new Promise((t) => {
        (this.__worker.onmessage = (e) => {
          'extractNextSmart' === e.data.cmd &&
            t(this.__cleanOutputWorker(e.data));
        }),
          this.__worker.postMessage({
            cmd: 'extractNextSmart',
            data: e.data,
            width: e.width,
            height: e.height,
            format: 8,
          });
      });
    }
    nextLivenessMoveStabilization(e) {
      return new Promise((t) => {
        (this.__worker.onmessage = (e) => {
          'nextLivenessMoveStabilization' === e.data.cmd &&
            t(this.__cleanOutputWorker(e.data));
        }),
          this.__worker.postMessage({
            cmd: 'nextLivenessMoveStabilization',
            data: e.data,
            width: e.width,
            height: e.height,
            format: 8,
          });
      });
    }
    tokenize(e) {
      return new Promise((t) => {
        (this.__worker.onmessage = (e) => {
          'tokenize' === e.data.cmd && t(e.data.data);
        }),
          this.__worker.postMessage({ cmd: 'tokenize', data: e });
      });
    }
    getVersion() {
      return new Promise((e) => {
        (this.__worker.onmessage = (t) => {
          'version' === t.data.cmd && e(t.data.version);
        }),
          this.__worker.postMessage({ cmd: 'version' });
      });
    }
    async finalizeEngine() {
      this.__worker.postMessage({ cmd: 'destroy' });
    }
    get __attributes() {
      return {
        minIOD: { type: 'string', property: '__minIOD' },
        licenseKey: { type: 'string', property: '__licenseKey' },
        bundlePath: { type: 'string', property: '__engineLocation' },
      };
    }
    __mapperToRealConfig(e) {
      for (const [t, i] of Object.entries(e))
        void 0 !== this.__attributes[t] &&
          (this[this.__attributes[t].property] = i);
    }
    __cleanOutputWorker(e) {
      return {
        sampleDiagnostic: e.sampleDiagnostic,
        template: e.template,
        templateRaw: e.templateRaw,
        face: e.face,
        leftEye: e.leftEye,
        rightEye: e.rightEye,
        templateScore: e.templateScore,
        facialScore: e.facialScore,
        sunGlassesScore: e.sunGlassesScore,
        faceStabilized: e.faceStabilized,
      };
    }
  }
  class y {
    constructor(e, t, i) {
      (this.__width = e),
        (this.__height = t),
        (this.__rate = i > 30 ? 30 : i),
        (this.__rateInv = 1e3 / this.__rate),
        (this.__lastFrame = performance.now());
    }
    frameReady(e = !0) {
      let t = performance.now();
      return (
        t - this.__lastFrame >= this.__rateInv &&
        (e && (this.__lastFrame = t), !0)
      );
    }
    addFrame(e) {
      throw new Error('Method addFrame must be implemented.');
    }
    generateVideo() {
      throw new Error('Method generateVideo must be implemented.');
    }
  }
  var I = i(280);
  const G = {
    local: class extends y {
      constructor(e, t, i, l) {
        super(e, t, i, l),
          'VideoEncoder' in window
            ? ((this.__muxer = new I.Muxer({
                target: new I.ArrayBufferTarget(),
                video: {
                  codec: 'avc',
                  width: this.__width,
                  height: this.__height,
                },
                firstTimestampBehavior: 'offset',
              })),
              (this.__videoEncoder = new VideoEncoder({
                output: (e, t) => this.__muxer.addVideoChunk(e, t),
                error: console.error,
              })),
              this.__videoEncoder.configure({
                codec: 'avc1.42002A',
                height: this.__height,
                width: this.__width,
                hardwareAcceleration: 'prefer-hardware',
                bitrate: 1e6,
                framerate: this.__rate,
              }),
              (this.__stopVideo = !1),
              (this.__frameCount = 0),
              (this.__lastKeyFrame = 0))
            : (this.__stopVideo = !0);
      }
      initializeEngine() {
        return new Promise((e) => {
          e();
        });
      }
      addFrame(e) {
        return new Promise((t, i) => {
          try {
            this.__stopVideo ||
              ('VideoEncoder' in window &&
                (this.frameReady()
                  ? createImageBitmap(e).then((e) => {
                      this.__startTime ||
                        (this.__startTime = document.timeline.currentTime);
                      let i = document.timeline.currentTime - this.__startTime,
                        l = (1e6 * this.__frameCount) / this.__rate;
                      const a = new VideoFrame(e, { timestamp: l });
                      (this.__lastKeyFrame = i),
                        this.__videoEncoder.encode(a, { keyFrame: !0 }),
                        a.close(),
                        this.__frameCount++,
                        t();
                    })
                  : t()));
          } catch (e) {
            i(e);
          }
        });
      }
      async generateVideo() {
        return new Promise((e) => {
          (this.__stopVideo = !0),
            'VideoEncoder' in window
              ? this.__videoEncoder.flush().then(() => {
                  this.__muxer.finalize(),
                    e(
                      URL.createObjectURL(
                        new Blob([this.__muxer.target.buffer], {
                          type: 'video/mp4',
                        })
                      )
                    );
                })
              : e('');
        });
      }
      deinitializeEngine() {
        try {
          this.__videoEncoder.flush();
        } catch (e) {
          console.log(e);
        }
        this.__videoEncoder.reset();
      }
    },
    remote: class extends y {
      constructor(e, t, i) {
        super(e, t, i),
          (this.__opennedConnection = !1),
          (this.__socket = new WebSocket('wss://ws-dev.facephi.cloud')),
          (this.__socket.onopen = () => (this.__opennedConnection = !0)),
          (this.__canvas = document.createElement('canvas')),
          (this.__canvas.width = e),
          (this.__canvas.height = t),
          (this.__rate = i > 30 ? 30 : i),
          (this.__lastFrameSended = 0),
          (this.__startTime = 0),
          (this.__lastFrameRecordedTime = 0);
      }
      initializeEngine() {
        return Promise.resolve();
      }
      storeFrame(e) {
        return new Promise((t, i) => {
          if (this.frameReady()) {
            this.__startTime || (this.__startTime = performance.now()),
              this.__canvas.getContext('2d').putImageData(e, 0, 0);
            let t = this.__canvas.toDataURL('image/jpeg');
            (this.__lastFrameRecordedTime = performance.now()),
              this.sendFrame(t);
          } else t();
        });
      }
      addFrame(e) {
        return new Promise((t, i) => {
          this.storeFrame(e), t();
        });
      }
      sendFrame(e) {
        this.__opennedConnection &&
          (this.__socket.send(
            JSON.stringify({
              type: 'VIDEO_FRAME',
              id: this.__lastFrameSended,
              dataURL: e,
            })
          ),
          this.__lastFrameSended++);
      }
      generateVideo() {
        return new Promise((e, t) => {
          if (this.__opennedConnection) {
            (this.__socket.onerror = (e) => t(e)),
              (this.__socket.onmessage = (t) => {
                let i = JSON.parse(t.data);
                i.video && e(i.video);
              });
            let i = (this.__lastFrameRecordedTime - this.__startTime) / 1e3,
              l = parseInt(this.__lastFrameSended / i);
            this.__socket.send(JSON.stringify({ type: 'MAKE_VIDEO', FR: l })),
              (this.__lastFrameSended = 0);
          } else e();
        });
      }
      deinitializeEngine() {
        this.__socket.close();
      }
    },
  };
  class X {
    static getAvailableEngines() {
      return Object.keys(G);
    }
    static generateInstance(e, ...t) {
      return 'local' !== e || 'VideoEncoder' in window
        ? new G[e](...t)
        : (console.warn(
            'It seems that your browser does not support local recording of the extraction, the remote encoder will be used.'
          ),
          new G.remote(...t));
    }
  }
  const p = {};
  function W(e) {
    let t = '',
      i = new Uint8Array(e),
      l = i.byteLength;
    for (let e = 0; e < l; e++) t += String.fromCharCode(i[e]);
    return window.btoa(t);
  }
  (p.Selphi = e),
    (p.Selphi.RecorderType = { Local: 0, Remote: 1 }),
    (p.Selphi.RecorderStatus = { Ok: 0, Unknown: 1, SocketError: 2 }),
    (p.Selphi.ConfigurationManager = class {
      constructor() {
        (this.container = null),
          (this.language = 'es'),
          (this.dpiList = [163, 326, 489]),
          (this.cameraWidth = 1280),
          (this.cameraHeight = 720),
          (this.cameraId = null),
          (this.cameraType = e.CameraType.Front),
          (this.cameraSwitchButton = !1),
          (this.cameraRotation = 0),
          (this.bundlePath = ''),
          (this.resourcesPath = this.bundlePath + '/FPhi.Widget.Resources'),
          (this.faceTracking = !1),
          (this.accessibility = !1),
          (this.accessibleElements = ['button', 'buttonImage']),
          (this.externalCamera = !1),
          (this.showLog = !1),
          (this.epheremalKey = ''),
          (this.onExtractionFinish = null),
          (this.onUserCancel = null),
          (this.onExceptionCaptured = null),
          (this.onExtractionTimeout = null),
          (this.onModuleLoaded = null),
          (this.onLivenessError = null),
          (this.onLivenessErrorButtonClick = null),
          (this.onTimeoutErrorButtonClick = null),
          (this.onStabilizing = null),
          (this.onTrackStatus = null),
          (this.onAccessibilityStatus = null),
          (this.livenessMode = e.LivenessMode.None),
          (this.tutorial = !1),
          (this.stabilizationStage = !1),
          (this.livenessPrecision = 2),
          (this.livenessMoveInitialError = 0),
          (this.livenessMoveInfoTime = 4),
          (this.timeout = 3e4),
          (this.interactible = !0),
          (this.authenticateTime = 1),
          (this.graphPath = this.bundlePath + '/graph.xml'),
          (this.imageFormat = 'image/jpeg'),
          (this.imageQuality = 0.92),
          (this.logImages = !1),
          (this.cropFactor = 1),
          (this.cropImage = !0),
          (this.templateFormat = e.TemplateFormat.Base64),
          (this.videoRecord = !1),
          (this.videoRecordRate = 10),
          (this.videoRecordScale = 1),
          (this.videoRecordType = e.RecorderType.Remote);
      }
      setExternalCamera(e) {
        this.externalCamera = e;
      }
      getExternalCamera() {
        return this.externalCamera;
      }
      setContainer(e) {
        this.container = e;
      }
      getContainer() {
        return this.container;
      }
      setLanguage(e) {
        this.language = e;
      }
      getLanguage() {
        return this.language;
      }
      setDpiList(e) {
        this.dpiList = e;
      }
      getDpiList() {
        return this.dpiList;
      }
      setCameraSwitchButton(e) {
        this.cameraSwitchButton = e;
      }
      getCameraSwitchButton() {
        return this.cameraSwitchButton;
      }
      setCameraWidth(e) {
        this.cameraWidth = e;
      }
      getCameraWidth() {
        return this.cameraWidth;
      }
      setCameraHeight(e) {
        this.cameraHeight = e;
      }
      getCameraHeight() {
        return this.cameraHeight;
      }
      setCameraType(e) {
        this.cameraType = e;
      }
      getCameraType() {
        return this.cameraType;
      }
      setCameraRotation(e) {
        this.cameraRotation = e;
      }
      getCameraRotation() {
        return this.cameraRotation;
      }
      setResourcesPath(e) {
        this.resourcesPath = e;
      }
      getResourcesPath() {
        return this.resourcesPath;
      }
      setBundlePath(e) {
        (this.bundlePath = e),
          (this.graphPath = this.bundlePath + '/graph.xml'),
          (this.resourcesPath = this.bundlePath + '/FPhi.Widget.Resources');
      }
      getTimeout() {
        return this.timeout;
      }
      setTimeout(e) {
        this.timeout = e;
      }
      getBundlePath() {
        return this.bundlePath;
      }
      setOnExtractionFinish(e) {
        this.onExtractionFinish = e;
      }
      getOnExtractionFinish() {
        return this.onExtractionFinish;
      }
      setOnUserCancel(e) {
        this.onUserCancel = e;
      }
      getOnUserCancel() {
        return this.onUserCancel;
      }
      setOnExceptionCaptured(e) {
        this.onExceptionCaptured = e;
      }
      getOnExceptionCaptured() {
        return this.onExceptionCaptured;
      }
      setOnExtractionTimeout(e) {
        this.onExtractionTimeout = e;
      }
      getOnExtractionTimeout() {
        return this.onExtractionTimeout;
      }
      setOnModuleLoaded(e) {
        this.onModuleLoaded = e;
      }
      getOnModuleLoaded() {
        return this.onModuleLoaded;
      }
      setOnLivenessError(e) {
        this.onLivenessError = e;
      }
      getOnLivenessError() {
        return this.onLivenessError;
      }
      setOnLivenessErrorButtonClick(e) {
        this.onLivenessErrorButtonClick = e;
      }
      getOnLivenessErrorButtonClick() {
        return this.onLivenessErrorButtonClick;
      }
      setOnTimeoutErrorButtonClick(e) {
        this.onTimeoutErrorButtonClick = e;
      }
      getOnTimeoutErrorButtonClick() {
        return this.onTimeoutErrorButtonClick;
      }
      setOnStabilizing(e) {
        this.onStabilizing = e;
      }
      getOnStabilizing() {
        return this.onStabilizing;
      }
      setOnTrackStatus(e) {
        this.onTrackStatus = e;
      }
      getOnTrackStatus() {
        return this.onTrackStatus;
      }
      setOnAccessibilityStatus(e) {
        this.onAccessibilityStatus = e;
      }
      getOnAccessibilityStatus() {
        return this.onAccessibilityStatus;
      }
      setLivenessMode(e) {
        this.livenessMode = e;
      }
      getLivenessMode() {
        return this.livenessMode;
      }
      setTutorial(e) {
        this.tutorial = !1;
      }
      getTutorial() {
        return this.tutorial;
      }
      setStabilizationStage(e) {
        this.stabilizationStage = e;
      }
      getStabilizationStage() {
        return this.stabilizationStage;
      }
      setLivenessPrecision(e) {
        this.livenessPrecision = e;
      }
      getLivenessPrecision() {
        return this.livenessPrecision;
      }
      setLivenessMoveInitialError(e) {
        this.livenessMoveInitialError = e;
      }
      getLivenessMoveInitialError() {
        return this.livenessMoveInitialError;
      }
      setLivenessMoveInfoTime(e) {
        this.livenessMoveInfoTime = e;
      }
      getLivenessMoveInfoTime() {
        return this.livenessMoveInfoTime;
      }
      setInteractible(e) {
        this.interactible = e;
      }
      getInteractible() {
        return this.interactible;
      }
      setAuthenticateTime(e) {
        this.authenticateTime = e;
      }
      getAuthenticateTime() {
        return this.authenticateTime;
      }
      setGraphPath(e) {
        this.graphPath = e;
      }
      getGraphPath() {
        return this.graphPath;
      }
      setImageFormat(e) {
        this.imageFormat = e;
      }
      getImageFormat() {
        return this.imageFormat;
      }
      setImageQuality(e) {
        this.imageQuality = e;
      }
      getImageQuality() {
        return this.imageQuality;
      }
      setCameraId(e) {
        this.cameraId = e;
      }
      getCameraId() {
        return this.cameraId;
      }
      setLogImages(e) {
        this.logImages = e;
      }
      getLogImages() {
        return this.logImages;
      }
      setCropFactor(e) {
        this.cropFactor = e;
      }
      getCropFactor() {
        return this.cropFactor;
      }
      setCropImage(e) {
        this.cropImage = e;
      }
      getCropImage() {
        return this.cropImage;
      }
      setTemplateFormat(e) {
        this.templateFormat = e;
      }
      getTemplateFormat() {
        return this.templateFormat;
      }
      setVideoRecord(e) {
        this.videoRecord = e;
      }
      getVideoRecord() {
        return this.videoRecord;
      }
      setVideoRecordRate(e) {
        this.videoRecordRate = e;
      }
      getVideoRecordRate() {
        return this.videoRecordRate;
      }
      setVideoRecordScale(e) {
        this.videoRecordScale = e;
      }
      getVideoRecordScale() {
        return this.videoRecordScale;
      }
      setVideoRecordType(e) {
        this.videoRecordType = e;
      }
      getVideoRecordType() {
        return this.videoRecordType;
      }
      setShowLog(e) {
        this.showLog = e;
      }
      getShowLog() {
        return this.showLog;
      }
      setFaceTracking(e) {
        this.faceTracking = e;
      }
      getFaceTracking() {
        return this.faceTracking;
      }
      setAccessibility(e) {
        this.accessibility = e;
      }
      getAccessibility() {
        return this.accessibility;
      }
      setAccessibleElements(e) {
        this.accessibleElements = e;
      }
      getAccessibleElements() {
        return this.accessibleElements;
      }
      setEpheremalKey(e) {
        this.epheremalKey = e;
      }
      getEpheremalKey() {
        return this.epheremalKey;
      }
    }),
    (p.Selphi.TokenizerUtils = r),
    (p.Selphi.Widget = function (e) {
      m.setLoggerLevel(e.getShowLog() ? 0 : 2),
        m.setLoggerTag('selphi-widget-web'),
        (this.showLog = e.getShowLog()),
        m.printInfo('Selphi Widget Web Version: ' + p.Selphi.Version),
        (this.cm = e),
        (this.audioBuffer = []),
        (this.divContainer = this.cm.getContainer()),
        (this.livenessMode = this.cm.getLivenessMode()),
        (this.tutorial = !1),
        (this.stabilizationStage = this.cm.getStabilizationStage()),
        (this.onExtractionFinish = this.cm.getOnExtractionFinish()),
        (this.onUserCancel = this.cm.getOnUserCancel()),
        (this.onExceptionCaptured = this.cm.getOnExceptionCaptured()),
        (this.onExtractionTimeout = this.cm.getOnExtractionTimeout()),
        (this.onModuleLoaded = this.cm.getOnModuleLoaded()),
        (this.onLivenessError = this.cm.getOnLivenessError()),
        (this.onLivenessErrorButtonClick =
          this.cm.getOnLivenessErrorButtonClick()),
        (this.onTimeoutErrorButtonClick =
          this.cm.getOnTimeoutErrorButtonClick()),
        (this.onStabilizing = this.cm.getOnStabilizing()),
        (this.onTrackStatus = this.cm.getOnTrackStatus()),
        (this.onAccessibilityStatus = this.cm.getOnAccessibilityStatus()),
        (this.livenessPrecision = this.cm.getLivenessPrecision()),
        (this.livenessMoveInitialError = this.cm.getLivenessMoveInitialError()),
        (this.livenessMoveInfoTime = this.cm.getLivenessMoveInfoTime()),
        (this.interactible = this.cm.getInteractible()),
        (this.authenticateTime = this.cm.getAuthenticateTime()),
        (this.graphPath = this.isPathAbsolute(this.cm.getGraphPath())
          ? this.cm.getGraphPath()
          : this.getScriptPath() + this.cm.getGraphPath()),
        (this.imageFormat = this.cm.getImageFormat()),
        (this.imageQuality = this.cm.getImageQuality()),
        (this.logImages = this.cm.getLogImages()),
        (this.cropFactor = this.cm.getCropFactor()),
        (this.cropImage = this.cm.getCropImage()),
        (this.devicePixelRatio = window.devicePixelRatio),
        (this.recorderWorking = !1),
        (this.engineInstance = null),
        (this.epheremalKey = this.cm.getEpheremalKey()),
        (this.bundlePath = this.isPathAbsolute(this.cm.getBundlePath())
          ? this.cm.getBundlePath()
          : this.getScriptPath() + this.cm.getBundlePath()),
        m.printInfo('Serving from URL: ' + this.bundlePath),
        (this.wasmReady = !1),
        (this.wasmInitiated = !1),
        (this.resourceParent = null),
        (this.workerWorking = !1),
        (this.language = this.cm.getLanguage()),
        (this.cameraSwitchButton = this.cm.getCameraSwitchButton()),
        (this.cameraReady = !1),
        (this.cameraWidth = this.cm.getCameraWidth()),
        (this.cameraHeight = this.cm.getCameraHeight()),
        (this.cameraType = this.cm.getCameraType()),
        (this.cameraRotation = this.cm.getCameraRotation()),
        (this.cameraId = this.cm.getCameraId()),
        (this.canvasWidth = 500),
        (this.canvasHeight = 500),
        (this.faceTrackingOffset = { x: 0, y: 0 }),
        (this.expectedExternalCamera = this.cm.getExternalCamera()),
        (this.detectionTimeout = this.cm.getTimeout()),
        (this.extractionTimeout = this.cm.getTimeout()),
        (this.fontSizeFactor = this.canvasHeight / 500),
        (this.canvasSizeFactor = this.canvasHeight / 500),
        (this.baseURL = this.isPathAbsolute(this.cm.getResourcesPath())
          ? this.cm.getResourcesPath()
          : this.getScriptPath() + this.cm.getResourcesPath()),
        (this.dpiList = this.cm.getDpiList()),
        this.livenessMode === p.Selphi.LivenessMode.Passive &&
          ((this.livenessMode = p.Selphi.LivenessMode.None),
          (this.cameraWidth = 1280),
          (this.cameraHeight = 720),
          (this.cropImage = !1)),
        (this.rmReady = !1),
        (this.graphReady = !1),
        (this.rm = new a(
          this.baseURL,
          this.language,
          this,
          this.OnResourceManagerStatus,
          this.dpiList,
          window.devicePixelRatio,
          this.canvasSizeFactor
        )),
        (this.graph = new t(
          this.graphPath,
          this.OnGraphReady.bind(this),
          this.OnGraphNewState.bind(this)
        )),
        (this.drawer = new d({
          livenessMode: this.cm.getLivenessMode(),
          stabilizationStage: this.cm.getStabilizationStage(),
          canvasSizeFactor: this.canvasSizeFactor,
          fontSizeFactor: this.fontSizeFactor,
          enableButtonCamera: !this.expectedExternalCamera,
        })),
        this.divContainer.addEventListener(
          'FPhi.UserControl.Finish.event',
          this.onExtractionFinish,
          !0
        ),
        this.divContainer.addEventListener(
          'FPhi.UserControl.UserCancel.event',
          this.onUserCancel,
          !0
        ),
        this.divContainer.addEventListener(
          'FPhi.UserControl.ExtractionTimeout.event',
          this.onExtractionTimeout,
          !0
        ),
        this.divContainer.addEventListener(
          'FPhi.UserControl.LivenessError.event',
          this.onLivenessError,
          !0
        ),
        this.divContainer.addEventListener(
          'FPhi.UserControl.LivenessErrorButtonClick.event',
          this.onLivenessErrorButtonClick,
          !0
        ),
        this.divContainer.addEventListener(
          'FPhi.UserControl.TimeoutErrorButtonClick.event',
          this.onTimeoutErrorButtonClick,
          !0
        ),
        this.divContainer.addEventListener(
          'FPhi.UserControl.ModuleLoaded.event',
          this.onModuleLoaded,
          !0
        ),
        this.divContainer.addEventListener(
          'FPhi.UserControl.ExceptionCaptured.event',
          this.onExceptionCaptured,
          !0
        ),
        this.divContainer.addEventListener(
          'FPhi.UserControl.Stabilizing.event',
          this.onStabilizing,
          !0
        ),
        this.divContainer.addEventListener(
          'FPhi.UserControl.TrackStatus.event',
          this.onTrackStatus,
          !0
        ),
        this.divContainer.addEventListener(
          'FPhi.UserControl.AccessibilityStatus.event',
          this.onAccessibilityStatus,
          !0
        );
    }),
    (p.Selphi.Widget.prototype = {
      constructor: p.Selphi.Widget,
      language: 'es',
      userTags: null,
      privateCanvas: null,
      extractor: null,
      extractorLiveness: null,
      extractorVersion: '',
      lastDetectResult: null,
      lastExtractionResult: null,
      lastExtractionResultWizard: null,
      faceAvailable: !0,
      faceDataRect: null,
      faceAvailableDelayed: !1,
      faceTooFar: !1,
      tooManyFaces: !1,
      bestScore: 0,
      actualTime: 0,
      actualTimePrev: 0,
      epheremalKey: '',
      clockWaitingFace: null,
      clockWaitingStart: null,
      clockExtraction: null,
      clockExtractionPure: null,
      clockCycleTip: null,
      clockWizardCompleted: null,
      clockShowResults: null,
      clockImprove: null,
      clockLiveness1: null,
      clockLiveness2: null,
      clockLiveness3: null,
      clockLiveness3_finish: null,
      clockFinish: null,
      clockNewScenario: null,
      clockWarningIn: null,
      clockWarningOut: null,
      clockEyeDetection: null,
      clockEyeDetectionDetected: null,
      waitingTimeStart: 3,
      extractionTime: 5,
      extractionTimePartial: 0,
      extractionSmartMinScore: 0.5,
      engineInstance: null,
      face_mo: function () {
        return 'MO';
      },
      face_o: function () {
        return 'O';
      },
      face_sn: function () {
        return 'SN';
      },
      face_spl: function () {
        return 'SPL';
      },
      liveness1Time: 0.5,
      liveness3Time: 0.25,
      livenessActualRetrain: 0,
      livenessCalculating: !1,
      livenessErrorString: '',
      livenessErrorImage: null,
      livenessMoveDirection: -1,
      livenessMoveActualSuccessfulAttempts: 0,
      livenessMoveActualFailedAttempts: 0,
      livenessMoveNextIndex: 0,
      livenessMoveGlassesFail: 0,
      livenessMoveInit: !1,
      livenessMoveFailReason: 0,
      livenessMoveInfoTime: 3,
      livenessMoveLastStabilizedStatus: 0,
      livenessMoveStabilizedStatusHistory: [],
      livenessMoveHistory: [],
      livenessPrecision: 0,
      showImproveButton: !1,
      face_alpha: function () {
        return String.fromCharCode(89, 52, 77);
      },
      maxResults: 15,
      graphicalScoreMax: 0,
      privateLastImage: null,
      privateImages: [],
      logImages: !1,
      workerWorking: !1,
      privateLivenessImages: [],
      privateLivenessImageTemp: null,
      privateLivenessTimerDiagnostic: null,
      privateLivenessResults: [],
      privateEyesYLevel: 0,
      idContainer: null,
      divContainer: null,
      extractorContainer: null,
      videoSelectId: null,
      isMobileDevice: !1,
      cameraContainer: null,
      cameraWidth: null,
      cameraHeight: null,
      cameraRotation: 0,
      cameraId: null,
      canvasWidth: null,
      canvasHeight: null,
      cameraStream: null,
      stopCameraStream: !0,
      selectedSource: null,
      samplePeriod: 0,
      face_defa: function () {
        return 'DEFA';
      },
      face_ke: function () {
        return 'KE';
      },
      face_ck: function () {
        return 'CK';
      },
      face_ap: function () {
        return 'AP';
      },
      buttonHeight: 50,
      debug: !1,
      interactible: !0,
      recorderWorking: !1,
      imageFormat: 'image/png',
      forceMoveDirection: -1,
      authenticateTime: 1,
      globalTimeout: 30,
      fps: 0,
      fpse: 0,
      fpsframes: 0,
      fpseFrames: 0,
      fpsTime: null,
      fontSizeFactor: 1,
      canvasSizeFactor: 1,
      imageTips1: null,
      imageTips2: null,
      imageFaceMoving: [],
      imageCheck: null,
      imageError: null,
      imageArrow: null,
      face_cam: function () {
        return 'CAM';
      },
      face_t: function () {
        return 'TUAL';
      },
      face_ult: function () {
        return 'ULT';
      },
      face_b: function () {
        return 'B';
      },
      imageCamera: null,
      cropImage: !0,
      cropFactor: 1,
      warningInTime: 0.8,
      warningOutTime: 0,
      detectionTimeout: 0,
      extractionTimeout: 0,
      sceneTimeout: 0,
      secondsWidget: 0,
      secondsState: 0,
      sendingTimeout: 2,
      cameraList: [],
      graphPath: 'graph.xml',
      testedResolutions: [],
      facePositions: [],
      face_v: function () {
        return 'VIR';
      },
      face_it: function () {
        return 'IT';
      },
      face_s: function () {
        return 'S';
      },
      face_fa: function () {
        return 'FA';
      },
      GenerateTemplateRawFromByteArrayComplete: function (e, t, i) {
        let l = document.createElement('canvas');
        (l.width = t.naturalWidth),
          (l.height = t.naturalHeight),
          l.getContext('2d').drawImage(t, 0, 0);
        let a = l.toDataURL(this.imageFormat);
        a = a.split(',')[1];
        let c = window.atob(a);
        try {
          const t = new g({ bundlePath: e.bundlePath, minIOD: 128 });
          t.initializeEngine().then(() => t.tokenize(c).then(i));
        } catch (t) {
          return void e.divContainer.dispatchEvent(
            new CustomEvent('FPhi.UserControl.ExceptionCaptured.event', {
              detail: {
                exceptionType: 'engineError',
                message: 'FPhi.Selphi.Widget: ' + t.message,
              },
            })
          );
        }
      },
      GenerateTemplateRawFromByteArray: function (e, t) {
        e.complete
          ? this.GenerateTemplateRawFromByteArrayComplete(this, e, t)
          : (e.onload = () =>
              this.GenerateTemplateRawFromByteArrayComplete(this, e, t));
      },
      Start: function (e) {
        (this.qualityCheckFailed = !1), this.Start_(e);
      },
      Start_: async function (e) {
        try {
          if (
            ((this.fpsTime = performance.now()),
            (this.cameraContainer = document.createElement('div')),
            (this.cameraContainer.id = 'cameraContainer'),
            (this.cameraContainer.style.overflow = 'hidden'),
            (this.cameraContainer.style.position = 'relative'),
            (this.cameraContainer.style.width =
              this.divContainer.offsetWidth + 'px'),
            (this.cameraContainer.style.height =
              this.divContainer.offsetHeight + 'px'),
            this.divContainer.appendChild(this.cameraContainer),
            this.cropFactor <= 0)
          ) {
            let e = new CustomEvent(
              'FPhi.UserControl.ExceptionCaptured.event',
              {
                detail: {
                  message:
                    'Invalid value of CropFactor. Must be greather than 0.',
                  exceptionType: 3,
                },
              }
            );
            this.divContainer.dispatchEvent(e), (this.cropFactor = 1);
          }
          this.sceneTimeout <= 0 && (this.sceneTimeout = 0),
            (this.loadingMessage = document.createElement('div')),
            this.cameraContainer.appendChild(this.loadingMessage),
            (this.gifWait = document.createElement('img')),
            this.cameraContainer.appendChild(this.gifWait);
          let t = this;
          (this.gifWait.style.display = 'none'),
            this.gifWait.addEventListener('load', this.onWaitingLoaded),
            (this.gifWait.onload = () => {
              let e = t.canvas.height / 2 - t.gifWait.height / 2,
                i = t.canvas.width / 2 - t.gifWait.width / 2;
              t.gifWait.style =
                'position:absolute; top:' + e + 'px; left:' + i + 'px;';
            }),
            (this.gifWait.src = this.baseURL + '/resources/163dpi/loading.gif'),
            document.featurePolicy &&
              !1 === document.featurePolicy.allowsFeature('camera') &&
              (m.printWarning(
                'Feature Policy issue: Camera feature is restricted in the actual environment. Check your server HTTP Headers.'
              ),
              m.printWarning(
                'https://developers.google.com/web/updates/2018/06/feature-policy#js'
              )),
            window.location !== window.parent.location &&
              m.printDebug('Selphi: widget running inside iframe.'),
            (this.selectedSource = null);
          let i = document.createElement('canvas');
          (i.id = 'display'),
            (i.style = 'position:absolute; top:-1px; left:-1px; zIndex:1;'),
            this.cameraContainer.appendChild(i),
            (i.width = this.cameraContainer.offsetWidth + 2),
            (i.height = this.cameraContainer.offsetHeight + 2),
            (this.canvas = i),
            (this.onCanvasResizeContext = this.onCanvasResize.bind(this)),
            window.addEventListener('resize', this.onCanvasResizeContext, !1);
          const l = navigator.userAgent;
          if (
            ((/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(
              l
            ) ||
              /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(
                l.substring(0, 4)
              )) &&
              (this.isMobileDevice = !0),
            (this.engineInstance = new g({
              minIOD: 40,
              bundlePath: this.bundlePath,
            })),
            this.engineInstance
              .initializeEngine()
              .then(() => {
                (this.wasmReady = !0), this.CheckDependencies(this);
              })
              .catch((e) => {
                this.divContainer.dispatchEvent(
                  new CustomEvent('FPhi.UserControl.ExceptionCaptured.event', {
                    detail: { exceptionType: 5, message: `${e.message}` },
                  })
                );
              }),
            this.initCamera(
              this.cameraContainer,
              this.cameraWidth,
              this.cameraHeight
            ),
            null != e)
          ) {
            m.printInfo('Detected external camera stream, using this...'),
              (this.stopCameraStream = !1),
              (this.cameraStream = e),
              (this.video.srcObject = e);
            const t = e.getVideoTracks()[0],
              i = t.getSettings();
            try {
              this.cameraName = t.label;
            } catch (e) {
              this.cameraName = 'Dummy Camera';
            }
            m.printDebug(
              `Camera Width: ${i.width}; Camera Height: ${i.height}; Camera Framerate: ${i.frameRate}`
            ),
              (this.video.onloadedmetadata = this.videoLoaded.bind(this)),
              this.video.play();
            let l = this.canvas.getContext('2d', { alpha: !0 });
            this.setCameraPosition(l, this.video);
          } else if (
            ((this.stopCameraStream = !0), this.expectedExternalCamera)
          )
            m.printDebug(
              'Entering into loading state until waits the external camera...'
            );
          else {
            if (
              (m.printDebug(
                'No detected external camera stream, running own stream...'
              ),
              m.printDebug('Init process - Checked parameters are correctly'),
              document.featurePolicy &&
                !1 === document.featurePolicy.allowsFeature('camera') &&
                (m.printDebug(
                  'Feature Policy issue: Camera feature is restricted in the actual environment. Check your server HTTP Headers.'
                ),
                m.printDebug(
                  'https://developers.google.com/web/updates/2018/06/feature-policy#js'
                )),
              this.cameraSwitchButton)
            ) {
              (this.isBrowserFirefox = navigator.userAgent
                .toLowerCase()
                .includes('firefox')),
                (this.isWebView =
                  navigator.userAgent.includes('wv') ||
                  navigator.userAgent.includes('CriOS')),
                this.isBrowserFirefox ||
                  this.isWebView ||
                  (await this.grantVideoPermission(),
                  m.printDebug('Init process - Checked camera permissions')),
                (this.cameras = []);
              try {
                const e = await navigator.mediaDevices.enumerateDevices();
                this.cameras = e.filter((e) => 'videoinput' === e.kind);
              } catch (e) {
                m.printDebug(
                  'There was an error getting device media resources',
                  e
                );
              }
              if (this.isBrowserFirefox || this.isWebView) {
                if (
                  ((this.sortedDeviceCameras = this.cameras),
                  (this.cameraCount = this.cameras.length),
                  this.cameras.length > 1 &&
                    (this.drawer.cameraCount = this.cameraCount),
                  m.printDebug(this.cameraCount + ' cameras found.'),
                  this.cameraId &&
                    -1 ===
                      this.cameras.findIndex(
                        (e) => e.deviceId === this.cameraId
                      ))
                ) {
                  const e = new CustomEvent(
                    'FPhi.UserControl.ExceptionCaptured.event',
                    {
                      detail: {
                        message:
                          'Camera ID provided by implementator is not present on the device, or there might be some misspelling mistake',
                        exceptionType: 0,
                      },
                    }
                  );
                  this.divContainer && this.divContainer.dispatchEvent(e);
                }
              } else {
                m.printDebug('Camera enumeration: ', this.cameras.length);
                let e = [],
                  t = [],
                  i = [],
                  l = [];
                this.cameraCount = 0;
                for (let { deviceId: a } of this.cameras)
                  try {
                    let c = await navigator.mediaDevices.getUserMedia({
                      video: { deviceId: a },
                    });
                    if (
                      c.getVideoTracks().length > 0 &&
                      ('function' ==
                        typeof c.getVideoTracks()[0].getCapabilities ||
                        'object' == typeof c.getVideoTracks()[0].getSettings())
                    ) {
                      const a = c.getVideoTracks()[0],
                        s = a.getCapabilities
                          ? a.getCapabilities()
                          : a.getSettings();
                      s.focusMode
                        ? (m.printDebug(
                            `Reading camera with id: ${s.deviceId}; name: ${
                              a.label
                            }; focusDiscance: ${JSON.stringify(
                              s.focusDistance
                            )}; facingMode: ${JSON.stringify(s.facingMode)}`
                          ),
                          'user' === s.facingMode[0]
                            ? (e.push(s),
                              m.printDebug(
                                `Pushing front camera with id: ${s.deviceId}; name: ${a.label}`
                              ))
                            : s.focusMode.some((e) => 'continuous' === e)
                            ? (t.push(s),
                              m.printDebug(
                                `Pushing environment camera with id: ${s.deviceId}; name: ${a.label}`
                              ))
                            : (i.push(s),
                              m.printDebug(
                                `Ignoring camera with id: ${s.deviceId}; name: ${a.label}`
                              )))
                        : (l.push(s),
                          m.printDebug(
                            `Pushing camera with id: ${s.deviceId}; name: ${a.label}`
                          )),
                        a.stop();
                    }
                    this.cameraCount++;
                  } catch (e) {
                    m.printError(
                      `CameraSwitchButton: Error opening camera with id "${
                        a || null
                      }".`
                    ),
                      m.printError(`${e}`);
                    let t = new CustomEvent(
                      'FPhi.UserControl.ExceptionCaptured.event',
                      {
                        detail: {
                          message: `Error in CameraSwitchButton function. Error opening camera with id "${
                            a || null
                          }". ${e.message}`,
                          exceptionType: 0,
                        },
                      }
                    );
                    return (
                      this.divContainer && this.divContainer.dispatchEvent(t),
                      void this.Stop()
                    );
                  }
                if (
                  (e.sort((e, t) =>
                    e.focusMode.some((e) => 'continuous' === e) &&
                    t.focusMode.every((e) => 'continuous' !== e)
                      ? -1
                      : e.focusMode.every((e) => 'continuous' !== e) &&
                        t.focusMode.some((e) => 'continuous' === e)
                      ? 1
                      : 0
                  ),
                  t.sort((e, t) =>
                    e.width.max > t.width.max && t.width.max < 1080
                      ? -1
                      : e.width.max < t.width.max && e.width.max < 1080
                      ? 1
                      : e.iso.max > t.iso.max
                      ? -1
                      : e.iso.max < t.iso.max
                      ? 1
                      : e.torch && !t.torch
                      ? -1
                      : !e.torch && t.torch
                      ? 1
                      : void 0
                  ),
                  (this.sortedDeviceCameras = l.concat(e, t, i)),
                  this.sortedDeviceCameras.length > 0)
                ) {
                  if (this.cameraId) {
                    const e = this.sortedDeviceCameras.findIndex(
                      (e) => e.deviceId === this.cameraId
                    );
                    if (-1 !== e) {
                      const t = this.sortedDeviceCameras.splice(e, 1);
                      this.sortedDeviceCameras.unshift(t[0]),
                        m.printInfo(
                          `Modified sorted camera list. Camera with ID: ${t[0].deviceId} is going to be used initially`
                        );
                    } else {
                      const e = new CustomEvent(
                        'FPhi.UserControl.ExceptionCaptured.event',
                        {
                          detail: {
                            message:
                              'Camera ID provided by implementator is not present on the device, or there might be some misspelling mistake',
                            exceptionType: 0,
                          },
                        }
                      );
                      this.divContainer && this.divContainer.dispatchEvent(e);
                    }
                  } else if (this.cameraType === p.Selphi.CameraType.Back)
                    if (t.length > 0) {
                      const e = this.sortedDeviceCameras.findIndex(
                          (e) => e.deviceId === t[0].deviceId
                        ),
                        i = this.sortedDeviceCameras.splice(e, 1);
                      this.sortedDeviceCameras.unshift(i[0]),
                        m.printInfo(
                          `Modified sorted camera list. Camera with ID: ${i[0].deviceId} is going to be used initially`
                        );
                    } else {
                      const e = new CustomEvent(
                        'FPhi.UserControl.ExceptionCaptured.event',
                        {
                          detail: {
                            message:
                              'There are no rear cameras available within the used device',
                            exceptionType: 0,
                          },
                        }
                      );
                      this.divContainer && this.divContainer.dispatchEvent(e);
                    }
                  (this.forceCameraId = this.sortedDeviceCameras[0].deviceId),
                    m.printDebug(this.cameraCount + ' cameras found.');
                }
                this.sortedDeviceCameras.length > 1 &&
                  (this.drawer.cameraCount = this.cameraCount);
              }
            }
            m.printDebug('Init process - Checked available cameras'),
              (this.selectedSource = null),
              this.setVideoInput(this);
            let e = this.canvas.getContext('2d', { alpha: !0 });
            this.setCameraPosition(e, this.video);
          }
          (this.widgetTime = performance.now()),
            (this.stateTime = this.widgetTime),
            m.printDebug(
              'Hardware concurrency: ' + window.navigator.hardwareConcurrency
            );
        } catch (e) {
          return (
            this.divContainer.dispatchEvent(
              new CustomEvent('FPhi.UserControl.ExceptionCaptured.event', {
                detail: {
                  exceptionType: 'engineError',
                  message: 'FPhi.Selphi.Widget: ' + e.message,
                },
              })
            ),
            this.Stop(),
            void m.printError(e.message)
          );
        }
      },
      Finalize: function () {
        void 0 !== this.worker &&
          null !== this.worker &&
          (this.postMessage(this, { cmd: 'destroy' }), (this.worker = null)),
          void 0 !== this.engineInstance &&
            null !== this.engineInstance &&
            this.engineInstance.finalizeEngine();
      },
      Stop: function () {
        if (null !== this.divContainer) {
          this.onCanvasResizeContext &&
            (window.removeEventListener(
              'resize',
              this.onCanvasResizeContext,
              !1
            ),
            (this.onCanvasResizeContext = void 0)),
            this.onVideoResizeContext &&
              (this.video.removeEventListener(
                'resize',
                this.onVideoResizeContext,
                !1
              ),
              (this.onVideoResizeContext = void 0)),
            this.divContainer.removeEventListener(
              'FPhi.UserControl.Finish.event',
              this.onExtractionFinish,
              !0
            ),
            this.divContainer.removeEventListener(
              'FPhi.UserControl.UserCancel.event',
              this.onUserCancel,
              !0
            ),
            this.divContainer.removeEventListener(
              'FPhi.UserControl.ExtractionTimeout.event',
              this.onExtractionTimeout,
              !0
            ),
            this.divContainer.removeEventListener(
              'FPhi.UserControl.LivenessError.event',
              this.onLivenessError,
              !0
            ),
            this.divContainer.removeEventListener(
              'FPhi.UserControl.LivenessErrorButtonClick.event',
              this.onLivenessErrorButtonClick,
              !0
            ),
            this.divContainer.removeEventListener(
              'FPhi.UserControl.TimeoutErrorButtonClick.event',
              this.onTimeoutErrorButtonClick,
              !0
            ),
            this.divContainer.removeEventListener(
              'FPhi.UserControl.ModuleLoaded.event',
              this.onModuleLoaded,
              !0
            ),
            this.divContainer.removeEventListener(
              'FPhi.UserControl.ExceptionCaptured.event',
              this.onExceptionCaptured,
              !0
            ),
            this.divContainer.removeEventListener(
              'FPhi.UserControl.Stabilizing.event',
              this.onStabilizing,
              !0
            ),
            this.divContainer.removeEventListener(
              'FPhi.UserControl.TrackStatus.event',
              this.onTrackStatus,
              !0
            ),
            this.divContainer.removeEventListener(
              'FPhi.UserControl.AccessibilityStatus.event',
              this.onAccessibilityStatus,
              !0
            ),
            (this.video.onloadedmetadata = null);
          let e = this.canvas;
          (e.onmousemove = null),
            (e.onclick = null),
            (this.gifWait.onload = null),
            this.divContainer.removeChild(this.cameraContainer),
            (this.divContainer = null),
            (this.cameraContainer = null);
        }
        this.stopCameraStream &&
          null !== this.cameraStream &&
          this.cameraStream.getVideoTracks()[0].stop(),
          this.rm && ((this.rm.caller = null), (this.rm = null)),
          this.graph && (this.graph = null),
          this.drawer && (this.drawer = null),
          this.rmScript &&
            ((this.rmScript.onreadystatechange = null),
            (this.rmScript.onload = null),
            (this.rmScript = null)),
          this.graphScript &&
            ((this.graphScript.onreadystatechange = null),
            (this.graphScript.onload = null),
            (this.graphScript = null)),
          this.drawerScript &&
            ((this.drawerScript.onload = null), (this.drawerScript = null)),
          this.Finalize();
      },
      reconfigureWidget: function (e) {
        (this.imageFormat = e.getImageFormat()),
          (this.imageQuality = e.getImageQuality()),
          (this.cropFactor = e.getCropFactor()),
          (this.cropImage = e.getCropImage()),
          m.printDebug('FPhi.Selphi.Widget.reconfigureWidget fired'),
          m.printDebug('  imageFormat: ' + this.imageFormat),
          m.printDebug('  imageQuality: ' + this.imageQuality),
          m.printDebug('  cropFactor: ' + this.cropFactor),
          m.printDebug('  cropImage: ' + this.cropImage);
      },
      printLog: function (e) {
        this.showLog && console.log(e);
      },
      onVideoResize: function () {
        (this.cameraWidth = this.video.videoWidth),
          (this.cameraHeight = this.video.videoHeight);
        let e = this.canvas.getContext('2d', { alpha: !0 });
        this.setCameraPosition(e, this.video);
      },
      onCanvasResize: function () {
        if (!this.drawer || !this.rm) return;
        let e = this.canvas,
          t = e.getContext('2d', { alpha: !0 }),
          i = this.video;
        if (
          ((this.cameraWidth = i.videoWidth),
          (this.cameraHeight = i.videoHeight),
          0 === this.cameraRotation || 2 === this.cameraRotation
            ? ((this.privateCanvas.width = this.cameraWidth),
              (this.privateCanvas.height = this.cameraHeight))
            : ((this.privateCanvas.width = this.cameraHeight),
              (this.privateCanvas.height = this.cameraWidth)),
          (this.cameraContainer.style.width =
            this.divContainer.offsetWidth + 'px'),
          (this.cameraContainer.style.height =
            this.divContainer.offsetHeight + 'px'),
          (e.width = this.cameraContainer.offsetWidth + 2),
          (e.height = this.cameraContainer.offsetHeight + 2),
          this.drawer.setCanvasSize(e.clientWidth, e.clientHeight),
          this.elements)
        )
          for (let e = 0; e < this.elements.length; e++)
            null != this.elements[e].videoPlayer &&
              (this.elements[e].videoPlayer.pause(),
              this.elements[e].videoPlayer.removeAttribute('src'),
              this.elements[e].videoPlayer.removeEventListener(
                'ended',
                this.videoplayerEnded.bind(self),
                !1
              ),
              this.elements[e].videoPlayer.load(),
              (this.elements[e].videoPlayer = null));
        this.rm &&
          this.resourceParent &&
          ((this.elements = this.rm.getElements(
            this.resourceParent,
            this.drawer.landscape
          )),
          this.startVideos(this)),
          this.setCameraPosition(t, this.video),
          this.cm.getAccessibility() &&
            !0 === this.cm.getInteractible() &&
            this.elements &&
            this.getAccessibilityData();
      },
      GetAvailableCameras: function () {
        return navigator.mediaDevices
          ? navigator.mediaDevices
              .enumerateDevices()
              .then(this.gotDevices)
              .catch(this.handleCameraError)
          : null;
      },
      postMessage: function (e, t) {
        e.worker.postMessage(t);
      },
      setLastExtractionResult: function (e, t) {
        null !== e.lastExtractionResult && e.lastExtractionResult.delete(),
          (e.lastExtractionResult = t);
      },
      setCameraPosition: function (e, t) {
        this.cameraVisibleRegion = this.drawer.getCameraRect(
          e,
          this.cameraWidth,
          this.cameraHeight,
          this.resourceParent
        );
        let i = '';
        this.cameraType === p.Selphi.CameraType.Front
          ? (i = 'rotateY(180deg) ')
          : this.cameraType === p.Selphi.CameraType.Back &&
            (i = 'rotateY(0deg) '),
          1 === this.cameraRotation
            ? (i += 'rotateZ(90deg) ')
            : 2 === this.cameraRotation
            ? (i += 'rotateZ(180deg) ')
            : 3 === this.cameraRotation && (i += 'rotateZ(270deg) '),
          this.cameraVisibleRegion.visible
            ? ((t.style.position = 'absolute'),
              (t.style.top = this.cameraVisibleRegion.y + 'px'),
              (t.style.left = this.cameraVisibleRegion.x + 'px'),
              (t.style.width = this.cameraVisibleRegion.width + 'px'),
              (t.style.height = this.cameraVisibleRegion.height + 'px'),
              (t.style.transform = i),
              (t.style.zIndex = 0))
            : ((t.style.position = 'absolute'),
              (t.style.top = '-10000px'),
              (t.style.left = '0px'),
              (t.style.width = this.cameraVisibleRegion.width + 'px'),
              (t.style.height = this.cameraVisibleRegion.height + 'px'),
              (t.style.transform = i),
              (t.style.zIndex = 0)),
          (t.style.position = 'sticky'),
          (t.style.position = 'absolute');
      },
      OnGraphNewState: function (e) {
        this.stateTime = performance.now();
        let t = this.canvas;
        ('UCNothing' !== this.state && void 0 !== this.state) ||
          ((this.actualTime = this.stateTime),
          (this.widgetTime = this.stateTime)),
          (this.secondsWidget = (this.actualTime - this.widgetTime) / 1e3),
          (this.secondsState = (this.actualTime - this.stateTime) / 1e3),
          (this.state = e),
          (this.resourceParent = this.drawer.getResourceIdForState(e));
        let i = this.video;
        this.setCameraPosition(t.getContext('2d', { alpha: !0 }), i),
          m.printDebug('state: ' + e);
        for (let e = 0; e < this.audioBuffer.length; e++)
          this.audioBuffer[e].audio.pause();
        if (((this.audioBuffer = []), null != this.elements))
          for (let e = 0; e < this.elements.length; e++)
            null != this.elements[e].videoPlayer &&
              (this.elements[e].videoPlayer.pause(),
              this.elements[e].videoPlayer.removeAttribute('src'),
              this.elements[e].videoPlayer.removeEventListener(
                'ended',
                this.videoplayerEnded.bind(self),
                !1
              ),
              this.elements[e].videoPlayer.load(),
              (this.elements[e].videoPlayer = null));
        if (
          ((this.elements = null),
          this.resourceParent &&
            ((this.elements = this.rm.getElements(
              this.resourceParent,
              this.drawer.landscape
            )),
            this.startVideos(this)),
          'UCNothing' === e)
        )
          (this.clockNewScenario = performance.now()),
            (this.lastExtractionResult = null),
            (this.bestScore = 0),
            (this.faceAvailable = !1),
            (this.clockWaitingStart = null),
            (this.clockExtraction = null),
            (this.clockExtractionPure = null),
            (this.clockLiveness = null),
            (this.extractionTime = this.authenticateTime),
            (this.livenessCalculating = !1),
            (this.privateLastImage = null),
            (this.privateImages = []),
            (this.privateLivenessImages = []),
            (this.privateLivenessResults = []),
            (this.livenessActualRetrain = 0),
            (this.livenessErrorString = null),
            (this.faceDataRect = {
              x: this.drawer.circleX,
              y: this.drawer.circleY,
              width: 0,
              height: 0,
            }),
            (this.faceTrackingOffset = { x: 0, y: 0 });
        else if ('UCTutorialRegister2' === e)
          this.clockNewScenario = performance.now();
        else if ('UCWaitingFaceStart' === e)
          (this.clockNewScenario = performance.now()),
            !1 === this.interactible &&
              this.graph.sendMessage('Click//button_start');
        else if ('UCSelectTutorial' === e)
          this.graph.sendMessage(
            'SetMode//' + self.livenessMode + ',' + (self.tutorial ? 1 : 0)
          );
        else if ('UCExtracting' === e)
          (this.clockNewScenario = performance.now()),
            (this.clockExtraction = performance.now()),
            (this.clockExtractionPure = this.clockExtraction),
            (this.extractionTimePartial = 0);
        else if ('UCCameraSwitch' === e) {
          if (this.cameraStream) {
            let e = this.cameraStream.getVideoTracks(),
              t = this.cameraStream.getVideoTracks()[0].getSettings().deviceId,
              l = this.sortedDeviceCameras,
              a = -1,
              c = -1;
            l.forEach((e) => {
              e.deviceId === t && (a = l.indexOf(e));
            }),
              (c = a === l.length - 1 ? 0 : a + 1),
              m.printInfo('Camera rotation list');
            for (let e = 0; e < l.length; e++)
              e === c
                ? m.printDebug(
                    '  * Camera id: ' + l[e].deviceId + ' name: ' + l[e].label
                  )
                : m.printInfo(
                    '  Camera id: ' + l[e].deviceId + ' name: ' + l[e].label
                  );
            this.video.pause(),
              e.forEach(function (e) {
                e.stop();
              }),
              (this.cameraStream = null),
              (this.video.srcObject = null);
            let s,
              d,
              h,
              n = this.cm.getLivenessMode();
            n === p.Selphi.LivenessMode.None
              ? ((s = this.cm.getCameraWidth()),
                (d = this.cm.getCameraHeight()),
                (h = {
                  video: { deviceId: l[c].deviceId, width: s, height: d },
                  audio: !1,
                }))
              : n === p.Selphi.LivenessMode.Passive
              ? ((s = 1280),
                (d = 720),
                (h = {
                  video: { deviceId: l[c].deviceId, width: s, height: d },
                  audio: !1,
                }))
              : m.printError(
                  'The selected "livenessMode" does not exist, it can only be used in passive or none mode.'
                ),
              (self = this),
              navigator.mediaDevices
                .getUserMedia(h)
                .then(async function (e) {
                  self.cameraStream = e;
                  const t = self.cameraStream.getVideoTracks()[0];
                  if (h.video.width > 1280 || h.video.height > 720)
                    try {
                      await t.applyConstraints({
                        width: { max: 1280, min: 640, ideal: s },
                        height: { max: 720, min: 480, ideal: d },
                      });
                    } catch (e) {
                      m.printWarning(
                        'Error applying resolution contraints to the track: ' +
                          e.message
                      );
                    }
                  const a =
                    'function' === t.getCapabilities
                      ? t.getCapabilities()
                      : t.getSettings();
                  a.facingMode &&
                    ('user' === a.facingMode || 'user' === a.facingMode[0]
                      ? (m.printDebug(
                          `Selecting Front Camera for Play with id: ${a.deviceId}; name: ${t.name}`
                        ),
                        (self.cameraType = p.Selphi.CameraType.Front))
                      : ('environment' !== a.facingMode &&
                          'environment' !== a.facingMode[0]) ||
                        (m.printDebug(
                          `Selecting Rear Camera for Play with id: ${a.deviceId}; name: ${t.name}`
                        ),
                        (self.cameraType = p.Selphi.CameraType.Back))),
                    (self.cameraId = a.deviceId),
                    (i.srcObject = e),
                    (self.switchTimeoutHandler = setTimeout(() => {
                      self.video.pause(),
                        self.cameraStream
                          .getVideoTracks()
                          .forEach(function (e) {
                            e.stop();
                          }),
                        self.graph.sendMessage('retry');
                    }, 5e3)),
                    i
                      .play()
                      .then(() => {
                        m.printDebug(
                          'Camera switch success. New camera with id: ' +
                            l[c].deviceId
                        ),
                          clearTimeout(self.switchTimeoutHandler),
                          self.setCameraPosition(
                            self.canvas.getContext('2d', { alpha: !0 }),
                            self.video
                          ),
                          self.graph.sendMessage('cameraSwitched');
                      })
                      .catch((e) => {
                        m.printDebug('Camera switch unsuccess.'),
                          m.printDebug(e),
                          clearTimeout(self.switchTimeoutHandler),
                          self.graph.sendMessage('retry');
                      });
                })
                .catch(function (e) {
                  m.printDebug(`Fatal error camera switch. Error: ${e}`);
                });
          }
        } else if ('UCShowResults' === e)
          (this.clockNewScenario = performance.now()),
            (this.clockShowResults = performance.now()),
            null != this.lastExtractionResultWizard &&
              (this.setLastExtractionResult(this.lastExtractionResultWizard),
              (this.lastExtractionResultWizard = null));
        else if ('UCCancelByUser' === e) {
          this.clockNewScenario = performance.now();
          let e = new CustomEvent('FPhi.UserControl.UserCancel.event');
          this.divContainer.dispatchEvent(e), this.Stop();
        } else if ('UCLivenessDetectionStep1' === e)
          (this.clockNewScenario = performance.now()),
            (this.clockLiveness1 = performance.now());
        else if ('UCLivenessDetectionStep2' === e)
          (this.clockLiveness2 = performance.now()),
            (this.privateLivenessImages = []),
            (this.privateLivenessResults = []);
        else if ('UCLivenessDetectionStep3' === e)
          (this.clockLiveness3_finish = null),
            (this.clockLiveness3 = performance.now());
        else if ('UCWaitingEyeDetection' === e)
          (this.clockNewScenario = performance.now()),
            (this.clockEyeDetection = performance.now()),
            (this.clockEyeDetectionDetected = null);
        else if ('UCFinish' === e) {
          (this.clockNewScenario = performance.now()),
            (this.clockFinish = performance.now());
          let e = Array.from(this.privateImages);
          this.sortImagesByFacialScore(this, e);
          let t,
            i = this.getImgTag(
              e[0],
              !1,
              this.cropFactor,
              this.imageFormat,
              this.imageQuality
            ),
            l = this.getImgTag(
              e[0],
              !0,
              this.cropFactor,
              this.imageFormat,
              this.imageQuality
            ),
            a = [];
          if (this.logImages)
            for (let e = 0; e < this.privateImages.length; e++)
              void 0 !== this.privateImages[e] &&
                a.push(
                  this.getImgTag(
                    this.privateImages[e],
                    this.cropImage,
                    this.cropFactor,
                    this.imageFormat,
                    this.imageQuality
                  )
                );
          void 0 !== this.lastExtractionResult.templateRaw &&
            ((t = this.lastExtractionResult.templateRaw),
            this.cm.getTemplateFormat() === p.Selphi.TemplateFormat.Base64 &&
              (t = W(t)));
          let c = this.lastExtractionResult.template;
          this.cm.getTemplateFormat() === p.Selphi.TemplateFormat.Base64 &&
            (c = W(c));
          let s = {
            template: c,
            bestImage: i,
            bestImageCropped: l,
            images: a,
            timeStamp: this.privateLivenessResults,
            templateRaw: t,
            livenessMoveFails: this.livenessMoveActualFailedAttempts,
            livenessMoveHistory: this.livenessMoveHistory,
            livenessMoveStabilizedHistory:
              this.livenessMoveStabilizedStatusHistory,
            livenessMoveStabilizedStatus: this.livenessMoveLastStabilizedStatus,
          };
          this.cm.getVideoRecord() &&
            (this.recordedVideo
              ? ((s.video = this.recordedVideo),
                (s.videoStatus = p.Selphi.RecorderStatus.Ok))
              : (s.videoStatus = p.Selphi.RecorderStatus.SocketError)),
            this.GenerateTemplateRawFromByteArray(i, async (e) => {
              (i.onload = null), (s.bestImageTokenized = e);
              let t = new CustomEvent('FPhi.UserControl.Finish.event', {
                detail: s,
              });
              this.divContainer.dispatchEvent(t), this.Stop();
            });
        } else if ('UCErrors' === e) {
          let e = {
            livenessMoveFails: this.livenessMoveActualFailedAttempts,
            livenessMoveHistory: this.livenessMoveHistory,
            livenessMoveStabilizedHistory:
              this.livenessMoveStabilizedStatusHistory,
            livenessMoveStabilizedStatus: this.livenessMoveLastStabilizedStatus,
          };
          if (
            (this.lastExtractionResult &&
              this.lastExtractionResult.sunGlassesScore &&
              1 === this.lastExtractionResult.sunGlassesScore &&
              (e.sunGlassesDetected = !0),
            this.logImages)
          ) {
            let t = [];
            for (let e = 0; e < this.privateImages.length; e++)
              void 0 !== this.privateImages[e] &&
                t.push(
                  this.getImgTag(
                    this.privateImages[e],
                    this.cropImage,
                    this.cropFactor,
                    this.imageFormat,
                    this.imageQuality
                  )
                );
            (e.images = t), (e.timeStamp = this.privateLivenessResults);
          }
          if (
            ((this.clockNewScenario = performance.now()),
            this.livenessDiagnostic < 0)
          )
            this.divContainer.dispatchEvent(
              new CustomEvent('FPhi.UserControl.ExtractionTimeout.event', {
                detail: e,
              })
            );
          else {
            e.livenessErrorType = this.livenessDiagnostic;
            let t = new CustomEvent('FPhi.UserControl.LivenessError.event', {
              detail: e,
            });
            this.divContainer.dispatchEvent(t);
          }
        } else if ('UCErrorFinish' === e) {
          let e;
          -1 === this.livenessDiagnostic
            ? ((e = new CustomEvent(
                'FPhi.UserControl.TimeoutErrorButtonClick.event'
              )),
              this.divContainer.dispatchEvent(e))
            : ((e = new CustomEvent(
                'FPhi.UserControl.LivenessErrorButtonClick.event'
              )),
              this.divContainer.dispatchEvent(e)),
            this.Stop();
        } else if ('UCLivenessMoveStabilizing' === e);
        else if ('UCLivenessMoveStabilized' === e)
          this.livenessMode === p.Selphi.LivenessMode.Move
            ? (!1 === this.livenessMoveInit &&
                (this.postMessage(this, {
                  cmd: 'initLivenessMoveSequence',
                  livenessPrecision: this.livenessPrecision,
                }),
                (this.livenessMoveInit = !0)),
              this.postMessage(this, { cmd: 'nextLivenessMoveSequence' }),
              (this.livenessMoveNextIndex = 0),
              this.graph.sendMessage('Move'))
            : this.graph.sendMessage('NoMove');
        else if ('UCLivenessMoveDetecting' === e)
          this.privateLivenessImages = [];
        else if ('UCLivenessMoveProcessing' === e)
          this.processingIndexBase = this.livenessMoveNextIndex;
        else if ('UCWaitRecording' === e && this.cm.getVideoRecord()) {
          m.printDebug('generating movie'), (this.agProcessing = !0);
          let e = this;
          (this.agProcessingFirst = performance.now()),
            (e.recorderWorking = !0),
            this.recorder
              .generateVideo()
              .then(function (t) {
                (e.recorderWorking = !1),
                  (e.recorderFinish = !0),
                  (e.recordedVideo = t);
              })
              .catch(function (t) {
                console.error(t.message),
                  (e.recorderWorking = !1),
                  (e.recorderFinish = !0);
              });
        }
        if (this.divContainer) {
          let t = new CustomEvent('FPhi.UserControl.TrackStatus.event', {
            detail: {
              code: p.Selphi.TrackStatus.ChangeState,
              timeStamp: this.secondsWidget,
              data: e,
            },
          });
          this.divContainer.dispatchEvent(t),
            this.cm.getAccessibility() &&
              !0 === this.cm.getInteractible() &&
              this.elements &&
              this.getAccessibilityData();
        }
        null !== this.graph && this.graph.sendMessage('SetStatusFinished');
      },
      getAccessibilityData: function () {
        let e = this.canvas.getContext('2d', { alpha: !0 }),
          t = e.canvas.width,
          i = e.canvas.height,
          l = {};
        l.state = this.state;
        let a = [];
        null === this.elements && (this.elements = []);
        for (let e = 0; e < this.elements.length; e++)
          if (this.cm.getAccessibleElements().includes(this.elements[e].type)) {
            let c = this.drawer.getLayout(
              this.resourceParent,
              this.elements[e].id,
              this.elements[e].type,
              this.secondsWidget,
              this.secondsState,
              'Normal',
              l
            );
            c &&
              ((c = this.getLayoutFromXML(
                this.resourceParent,
                this.elements[e].id,
                c,
                t,
                i
              )),
              a.push({
                id: this.elements[e].id,
                type: this.elements[e].type,
                x: c.x,
                y: c.y,
                width: c.width,
                height: c.height,
              }));
          }
        if (a.length > 0) {
          let e = new CustomEvent(
            'FPhi.UserControl.AccessibilityStatus.event',
            {
              detail: {
                code: p.Selphi.TrackStatus.AccessibilityData,
                view: this.state,
                timeStamp: this.secondsWidget,
                data: a,
              },
            }
          );
          this.elements.length > 0 && this.divContainer.dispatchEvent(e);
        }
      },
      getImageData: function (e) {
        let t = e.getContext('2d'),
          i = e.height,
          l = e.width;
        return {
          width: l,
          height: i,
          pixels: t.getImageData(0, 0, l, i),
          time: performance.now(),
        };
      },
      resetInternalVars: function () {
        (this.privateCanvas = null),
          (this.lastDetectResult = null),
          (this.lastExtractionResult = null),
          (this.lastExtractionResultWizard = null),
          (this.clockWaitingFace = null),
          (this.clockWaitingStart = null),
          (this.clockExtraction = null),
          (this.clockExtractionPure = null),
          (this.clockCycleTip = null),
          (this.clockWizardCompleted = null),
          (this.clockShowResults = null),
          (this.clockImprove = null),
          (this.clockLiveness1 = null),
          (this.clockLiveness2 = null),
          (this.clockLiveness3 = null),
          (this.clockLiveness3_finish = null),
          (this.clockFinish = null),
          (this.clockNewScenario = null),
          (this.clockWarningIn = null),
          (this.clockWarningOut = null),
          (this.clockEyeDetection = null),
          (this.clockEyeDetectionDetected = null),
          (this.livenessErrorImage = null),
          (this.livenessMoveStabilizedStatusHistory = []),
          (this.livenessMoveHistory = []),
          (this.privateLastImage = null),
          (this.privateImages = []),
          (this.privateLivenessImages = []),
          (this.privateLivenessImageTemp = null),
          (this.privateLivenessTimerDiagnostic = null),
          (this.privateLivenessResults = []),
          (this.extractorContainer = null),
          (this.videoSelectId = null),
          (this.canvasWidth = null),
          (this.canvasHeight = null),
          (this.fpsTime = null),
          (this.imageTips2 = null),
          (this.imageFaceMoving = []),
          (this.imageCheck = null),
          (this.imageError = null),
          (this.imageArrow = null),
          (this.imageCamera = null),
          (this.facePositions = []),
          (this.imageTips1 = null);
      },
      getImgTag: function (e, t, i, l, a) {
        let c = document.createElement('canvas');
        (c.width = e.width),
          (c.height = e.height),
          c.getContext('2d').putImageData(e.pixels, 0, 0);
        let s = document.createElement('canvas');
        if (
          t &&
          void 0 !== e.extractionResult &&
          void 0 !== e.extractionResult.face
        ) {
          let t = e.extractionResult.face.width * i,
            l = e.extractionResult.face.height * i,
            a =
              e.extractionResult.face.x -
              ((i - 1) * e.extractionResult.face.width) / 2,
            d =
              e.extractionResult.face.y -
              ((i - 1) * e.extractionResult.face.height) / 2;
          a < 0 && ((t += a), (a = 0)),
            d < 0 && ((l += d), (d = 0)),
            a + t >= e.width && (t = e.width - a),
            d + l >= e.height && (l = e.height - d),
            (s.width = t),
            (s.height = l),
            s
              .getContext('2d')
              .drawImage(c, a, d, t, l, 0, 0, s.width, s.height);
        } else
          (s.width = e.width),
            (s.height = e.height),
            s.getContext('2d').drawImage(c, 0, 0, s.width, s.height);
        let d = document.createElement('img');
        return (d.src = s.toDataURL(l, a)), d;
      },
      faceTrack: function () {
        if (this.secondsWidget < 1) return;
        let e = 0,
          t = 0;
        0 != this.faceDataRect.width &&
          ((e = Math.round(
            this.drawer.circleX -
              (this.faceDataRect.x + this.faceDataRect.width / 2)
          )),
          (t = Math.round(
            this.drawer.circleY -
              (this.faceDataRect.y + this.faceDataRect.height / 2)
          ))),
          this.faceTrackingOffset || (this.faceTrackingOffset = { x: 0, y: 0 }),
          (this.faceTrackingOffset.x +=
            5 *
            (e - this.faceTrackingOffset.x) *
            ((this.actualTime - this.actualTimePrev) / 1e3)),
          (this.faceTrackingOffset.y +=
            5 *
            (t - this.faceTrackingOffset.y) *
            ((this.actualTime - this.actualTimePrev) / 1e3));
        let i = this.cameraVisibleRegion.x + this.faceTrackingOffset.x,
          l = this.cameraVisibleRegion.y + this.faceTrackingOffset.y;
        i > this.drawer.circleX - this.drawer.circleRadius &&
          (i = this.drawer.circleX - this.drawer.circleRadius),
          l > this.drawer.circleY - this.drawer.circleRadius &&
            (l = this.drawer.circleY - this.drawer.circleRadius),
          i + this.cameraVisibleRegion.width <
            this.drawer.circleX + this.drawer.circleRadius &&
            (i =
              this.drawer.circleX +
              this.drawer.circleRadius -
              this.cameraVisibleRegion.width),
          l + this.cameraVisibleRegion.height <
            this.drawer.circleY + this.drawer.circleRadius &&
            (l =
              this.drawer.circleY +
              this.drawer.circleRadius -
              this.cameraVisibleRegion.height),
          (this.video.style.left = i + 'px'),
          (this.video.style.top = l + 'px');
      },
      startVideos: function (e) {
        if (null != e.elements)
          for (let t = 0; t < e.elements.length; t++)
            if ('video' === e.elements[t].type) {
              let i = document.createElement('video');
              (i.hidden = !0),
                (i.playsinline = !0),
                (i.loop = !1),
                (i.autoplay = !0),
                (i.controls = !0),
                (i.muted = !0),
                (i.volume = 0),
                (i.src = e.rm.getResourceUrlBase(
                  e.rm.getSetupResourceId(
                    e.resourceParent,
                    e.elements[t].id,
                    e.drawer.landscape,
                    'value'
                  )
                )),
                i.addEventListener('ended', e.videoplayerEnded.bind(e), !1),
                i.setAttribute('playsinline', ''),
                i.setAttribute('webkit-playsinline', ''),
                i.setAttribute('muted', !0),
                i.setAttribute('volume', 0),
                i.addEventListener('play', () => {
                  (i.muted = !0), (i.volume = 0);
                }),
                i.play(),
                (e.elements[t].videoPlayer = i);
            }
      },
      canvasOnMove: function (e) {
        if (this.elements)
          for (let t = this.elements.length - 1; t >= 0; t--)
            if (
              void 0 !== this.elements[t].layout &&
              e.offsetX >= this.elements[t].layout.x &&
              e.offsetX <
                this.elements[t].layout.x + this.elements[t].layout.width &&
              e.offsetY >= this.elements[t].layout.y &&
              e.offsetY <
                this.elements[t].layout.y + this.elements[t].layout.height
            ) {
              if ('button_info' === this.elements[t].id) break;
              this.drawer.onMouseMove(
                e.target,
                this.elements[t].layout,
                this.resourceParent,
                this.elements[t].id,
                this.elements[t].type
              );
              break;
            }
      },
      routeClick: function (e, t) {
        this.canvasOnClick({ offsetX: e, offsetY: t });
      },
      canvasOnClick: function (e) {
        if ('UCErrors' === this.state) {
          e.offsetX;
          let t = e.offsetY,
            i = this.canvasHeight - this.buttonHeight;
          m.printDebug('canvasOnClick', this.canvasHeight, i, t),
            t > i && this.graph.sendMessage('Click//button_error');
        } else {
          if (void 0 === this.elements) return;
          let t = null;
          for (let i = this.elements.length - 1; i >= 0; i--)
            if (
              null != this.elements[i].layout &&
              e.offsetX >= this.elements[i].layout.x &&
              e.offsetX <
                this.elements[i].layout.x + this.elements[i].layout.width &&
              e.offsetY >= this.elements[i].layout.y &&
              e.offsetY <
                this.elements[i].layout.y + this.elements[i].layout.height
            ) {
              if (
                ((t = this.elements[i].id),
                this.rm.isAttributeAvailable(
                  this.resourceParent,
                  t,
                  !1,
                  'audio'
                ))
              ) {
                let e = this.rm.getSetupResourceId(
                    this.resourceParent,
                    t,
                    !1,
                    'audio'
                  ),
                  i = this.rm.getResourceUrlBase(e),
                  l = null,
                  a = !1;
                for (let e = 0; e < this.audioBuffer.length; e++)
                  if (this.audioBuffer[e].url == i) {
                    (a = !0), (l = this.audioBuffer[e].audio);
                    break;
                  }
                a
                  ? ((l.currentTime = 0), l.play())
                  : ((l = new Audio(i)),
                    this.audioBuffer.push({ url: i, audio: l }),
                    l.play());
              }
              let e = 'Click//' + this.elements[i].id;
              this.graph.sendMessage(e);
              break;
            }
          if (this.divContainer) {
            let e = new CustomEvent('FPhi.UserControl.TrackStatus.event', {
              detail: {
                code: p.Selphi.TrackStatus.Tap,
                timeStamp: this.secondsWidget,
                data: t,
              },
            });
            this.divContainer.dispatchEvent(e);
          }
        }
      },
      initCamera: function (e, t, i) {
        let l = this.canvas;
        if (!this.video) {
          let t = document.createElement('video');
          (t.id = 'live'),
            t.setAttribute('playsinline', ''),
            t.setAttribute('webkit-playsinline', ''),
            t.setAttribute('autoplay', ''),
            t.setAttribute('muted', !0),
            t.setAttribute('volume', 0),
            t.addEventListener('play', () => {
              (t.muted = !0), (t.volume = 0);
            }),
            (t.style.display = 'none'),
            e.insertBefore(t, e.firstChild),
            (this.video = t),
            (this.onVideoResizeContext = this.onVideoResize.bind(this)),
            t.addEventListener('resize', this.onVideoResizeContext, !1);
        }
        (l.imageSmoothingEnabled = !0),
          l.clientWidth,
          l.clientHeight,
          l &&
            ((l.style.display = 'none'),
            (l.onclick = this.canvasOnClick.bind(this)),
            (l.onmousemove = this.canvasOnMove.bind(this)),
            (this.privateCanvas = document.createElement('canvas')),
            0 === this.cameraRotation || 2 === this.cameraRotation
              ? ((this.privateCanvas.width = t),
                (this.privateCanvas.height = i))
              : ((this.privateCanvas.width = i),
                (this.privateCanvas.height = t)));
      },
      userMedia: function () {
        return (navigator.getUserMedia =
          navigator.getUserMedia ||
          navigator.webkitGetUserMedia ||
          navigator.mozGetUserMedia ||
          navigator.msGetUserMedia ||
          null);
      },
      grantVideoPermission: async function () {
        try {
          let e = { video: { width: 640, height: 480 }, audio: !1 };
          (await navigator.mediaDevices.getUserMedia(e))
            .getTracks()
            .forEach((e) => {
              e.stop();
            });
        } catch (e) {
          this.divContainer.dispatchEvent(
            new CustomEvent('FPhi.UserControl.ExceptionCaptured.event', {
              detail: { exceptionType: 0, message: '' + e.message },
            })
          );
        }
      },
      setVideoInput: function (e) {
        e.canvas && e.playDevice(e);
      },
      playDevice: function (e) {
        let t = e.video,
          i = e.canvas.getContext('2d', { alpha: !0 }),
          l = {};
        window.stream &&
          window.stream.getTracks().forEach((e) => {
            e.stop();
          }),
          (l = e.forceCameraId
            ? {
                video: {
                  deviceId: e.forceCameraId,
                  width: e.cameraWidth,
                  height: e.cameraHeight,
                },
                audio: !1,
              }
            : {
                video: {
                  deviceId: e.cameraId ? { exact: e.cameraId } : void 0,
                  width: e.cameraWidth,
                  height: e.cameraHeight,
                  facingMode:
                    e.cameraType === p.Selphi.CameraType.Front
                      ? 'user'
                      : 'environment',
                },
                audio: !1,
              }),
          navigator.mediaDevices
            .getUserMedia(l)
            .then(async function (i) {
              e.cameraStream = i;
              const a = e.cameraStream.getVideoTracks()[0];
              if (l.video.width > 1280 || l.video.height > 720)
                try {
                  await a.applyConstraints({
                    width: { max: 1280, min: 640, ideal: e.cameraWidth },
                    height: { max: 720, min: 480, ideal: e.cameraHeight },
                  });
                } catch (e) {
                  m.printWarning(
                    'Error applying resolution contraints to the track: ' +
                      e.message
                  );
                }
              const c =
                'function' === a.getCapabilities
                  ? a.getCapabilities()
                  : a.getSettings();
              c.facingMode &&
                ('user' === c.facingMode || 'user' === c.facingMode[0]
                  ? (m.printDebug(
                      `Selecting Camera for Play with id: ${
                        c.deviceId
                      }; name: ${a.name}; facingMode = ${JSON.stringify(
                        c.facingMode
                      )}`
                    ),
                    (e.cameraType = p.Selphi.CameraType.Front))
                  : ('environment' !== c.facingMode &&
                      'environment' !== c.facingMode[0]) ||
                    (m.printDebug(
                      `Selecting Camera for Play with id: ${
                        c.deviceId
                      }; name: ${a.name}; facingMode = ${JSON.stringify(
                        c.facingMode
                      )}`
                    ),
                    (e.cameraType = p.Selphi.CameraType.Back))),
                (e.cameraName = a.label),
                m.printDebug('Camera selected for widget: ' + a.label),
                (e.cameraId = c.deviceId),
                (t.onloadedmetadata = e.videoLoaded.bind(e)),
                (t.srcObject = i),
                t.play();
            })
            .catch(function (l) {
              const a = new CustomEvent(
                'FPhi.UserControl.ExceptionCaptured.event',
                {
                  detail: {
                    message: `Error opening camera with id: ${e.cameraId}`,
                    exceptionType: 0,
                  },
                }
              );
              e.divContainer && e.divContainer.dispatchEvent(a),
                m.printDebug(l);
              let c = {
                video: {
                  width: e.cm.getCameraWidth(),
                  height: e.cm.getCameraHeight(),
                  facingMode:
                    e.cameraType === p.Selphi.CameraType.Front
                      ? 'user'
                      : 'environment',
                },
                audio: !1,
              };
              navigator.mediaDevices
                .getUserMedia(c)
                .then(async function (i) {
                  e.cameraStream = i;
                  const l = i.getVideoTracks()[0];
                  if (c.video.width > 1280 || c.video.height > 720)
                    try {
                      await l.applyConstraints({
                        width: { max: 1280, min: 640, ideal: e.cameraWidth },
                        height: { max: 720, min: 480, ideal: e.cameraHeight },
                      });
                    } catch (e) {
                      m.printWarning(
                        'Error applying resolution contraints to the track: ' +
                          e.message
                      );
                    }
                  const a =
                    'function' === l.getCapabilities
                      ? l.getCapabilities()
                      : l.getSettings();
                  (e.cameraName = l.label),
                    m.printDebug('Camera selected for widget: ' + l.label),
                    (e.cameraId = a.deviceId),
                    (t.onloadedmetadata = e.videoLoaded.bind(e)),
                    (t.srcObject = i),
                    t.play();
                })
                .catch(function (t) {
                  e.draw(e, e.imageCamera, i);
                  let l = new CustomEvent(
                    'FPhi.UserControl.ExceptionCaptured.event',
                    { detail: { message: t.message, exceptionType: 0 } }
                  );
                  e.divContainer.dispatchEvent(l);
                });
            });
      },
      addCameraResolution: function (e, t, i) {
        for (let l = 0; l < e.length; l++)
          if (e[l].width === t && e[l].height === i) return;
        e.push({ width: t, height: i });
      },
      checkCameraResolutions: async function (e, t, i) {
        let l = document.createElement('video');
        const a = await navigator.mediaDevices.enumerateDevices();
        for (let e = 0; e < a.length; e++) m.printDebug(a[e]);
        let c = {
          video: {
            width: { ideal: i.cameraWidth },
            height: { ideal: i.cameraHeight },
            facingMode:
              i.cameraType === p.Selphi.CameraType.Front
                ? 'user'
                : 'environment',
          },
          audio: !1,
        };
        try {
          const t = await navigator.mediaDevices.getUserMedia(c);
          (l.srcObject = t),
            (l.onloadedmetadata = async function (l) {
              t.getVideoTracks()[0];
              for (let l = 0; l < e.length; l++) {
                let a = {
                  width: { exact: e[l].width },
                  height: { exact: e[l].height },
                };
                try {
                  const c = t.getVideoTracks()[0];
                  await c.applyConstraints(a);
                  let s = c.getSettings();
                  s.resizeMode
                    ? 'none' === s.resizeMode &&
                      i.addCameraResolution(
                        i.testedResolutions,
                        e[l].width,
                        e[l].height
                      )
                    : i.addCameraResolution(
                        i.testedResolutions,
                        e[l].width,
                        e[l].height
                      );
                } catch (e) {}
              }
              let a = 'Camera resolutions: ';
              for (let e = 0; e < i.testedResolutions.length; e++)
                a =
                  a +
                  '[' +
                  i.testedResolutions[e].width +
                  'x' +
                  i.testedResolutions[e].height +
                  ']';
              m.printDebug(a),
                t.getTracks().forEach(function (e) {
                  e.stop();
                }),
                i.Start_();
            }),
            l.play();
        } catch (e) {
          self_Start_();
        }
      },
      handleRecorderDataAvailable: function (e) {
        e.data && e.data.size > 0 && this.recordedBlobs.push(e.data);
      },
      handleRecorderOnStop: function (e) {
        this.recorderFinish = !0;
      },
      mobileCheck: function () {
        let e = !1;
        var t;
        return (
          (t = navigator.userAgent || navigator.vendor || window.opera),
          (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(
            t
          ) ||
            /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(
              t.substr(0, 4)
            )) &&
            (e = !0),
          e
        );
      },
      isIpadOS: function () {
        return (
          navigator.maxTouchPoints &&
          navigator.maxTouchPoints > 2 &&
          /MacIntel/.test(navigator.platform)
        );
      },
      gotDevices: function (e) {
        let t = 0;
        for (let i = 0; i !== e.length; ++i) 'videoinput' === e[i].kind && t++;
        this.cameraList = new Array(t);
        let i = 0;
        for (let t = 0; t !== e.length; ++t) {
          let l = e[t];
          if ('videoinput' === l.kind) {
            let e = document.createElement('option');
            (e.value = l.deviceId),
              (e.text = l.label),
              (this.cameraList[i] = e),
              i++;
          }
        }
        let l = new CustomEvent('FPhi.UserControl.Cameras.event', {
          detail: { cameras: this.cameraList },
        });
        this.divContainer.dispatchEvent(l);
      },
      handleCameraError: function (e) {},
      fromCameraToScreen: function (e, t) {
        let i = e.cameraWidth,
          l = e.cameraHeight;
        (1 !== e.cameraRotation && 3 !== e.cameraRotation) ||
          ((i = e.cameraHeight), (l = e.cameraWidth));
        let a = e.canvas.getContext('2d', { alpha: !0 }),
          c = e.drawer.getCameraRect(a, i, l),
          s = c.width / i,
          d = c.height / l,
          h = {
            x: t.x * s,
            y: t.y * d,
            width: t.width * s,
            height: t.height * d,
          },
          n = e.reflectedX(c.width, h.x + h.width);
        return (h.x = n), (h.x += c.x), (h.y += c.y), h;
      },
      fromCameraToScreenDetection: function (e, t) {
        let i = e.cameraWidth,
          l = e.cameraHeight;
        (1 !== e.cameraRotation && 3 !== e.cameraRotation) ||
          ((i = e.cameraHeight), (l = e.cameraWidth));
        let a = e.canvas.getContext('2d', { alpha: !0 });
        if (e.drawer) {
          let c = e.drawer.getCameraRect(a, i, l),
            s = c.width / i,
            d = c.height / l,
            h = {
              x: t.x * s,
              y: t.y * d,
              width: t.width * s,
              height: t.height * d,
            },
            n = e.reflectedX(c.width, h.x + h.width);
          return (h.x = n), (h.x += c.x), (h.y += c.y), h;
        }
        return { x: 0, y: 0, width: 0, height: 0 };
      },
      scaleRect: function (e, t, i) {
        let l = t.x + t.width / 2,
          a = t.y + t.height / 2,
          c = t.width / e.width,
          s = t.height / e.height,
          d = e.width * c,
          h = e.height * c;
        return (
          void 0 === i
            ? h < t.height && ((d = e.width * s), (h = e.height * s))
            : h >= t.height && ((d = e.width * s), (h = e.height * s)),
          { x: l - d / 2, y: a - h / 2, width: d, height: h }
        );
      },
      scaleRectByFactor(e, t, i) {
        let l = e.x + 0.5 * e.width,
          a = e.y + 0.5 * e.height,
          c = { x: 0, y: 0, width: 0, height: 0 };
        (c.width = e.width *= t),
          (c.height = e.height *= i),
          (c.x = e.x),
          (c.y = e.y);
        let s = e.x + 0.5 * e.width - l,
          d = e.y + 0.5 * e.height - a;
        return (c.x -= s), (c.y -= d), c;
      },
      getGraphicalScore: function (e) {
        let t = ((100 * e) / 90) * ((100 * e) / 90) * 0.9 + 0.1;
        return t > 1 && (t = 1), t;
      },
      saveImageToCanvas: function (e, t) {
        (e.privateCanvas.style.width = e.cameraWidth),
          (e.privateCanvas.style.height = e.cameraHeight);
        let i = e.privateCanvas.getContext('2d');
        switch (e.cameraRotation) {
          case 0:
            i.drawImage(t, 0, 0, e.cameraWidth, e.cameraHeight);
            break;
          case 1:
          case 3:
            i.save(),
              i.translate(e.cameraHeight / 2, e.cameraWidth / 2),
              i.rotate((Math.PI / 2) * e.cameraRotation),
              i.drawImage(t, -e.cameraWidth / 2, -e.cameraHeight / 2),
              i.restore();
            break;
          case 2:
            i.save(),
              i.translate(e.cameraWidth / 2, e.cameraHeight / 2),
              i.rotate((Math.PI / 2) * e.cameraRotation),
              i.drawImage(t, -e.cameraWidth / 2, -e.cameraHeight / 2),
              i.restore();
        }
      },
      getLayoutFromXML: function (e, t, i, l, a) {
        let c = 'LEFT',
          s = 'TOP',
          d = i,
          h = !1;
        if (
          this.rm.isAttributeAvailable(e, t, this.drawer.landscape, 'width')
        ) {
          null == d && (d = {});
          let i = this.rm.getSetupFloat(e, t, this.drawer.landscape, 'width');
          (d.width = i <= 1 ? i * l : i), (h = !0);
        }
        if (
          this.rm.isAttributeAvailable(e, t, this.drawer.landscape, 'height')
        ) {
          null == d && (d = {});
          let i = this.rm.getSetupFloat(e, t, this.drawer.landscape, 'height');
          (d.height = i <= 1 ? i * a : i), (h = !0);
        }
        if (
          (this.rm.isAttributeAvailable(
            e,
            t,
            this.drawer.landscape,
            'xAnchor'
          ) &&
            (c = this.rm.getSetupAlign(e, t, this.drawer.landscape, 'xAnchor')),
          this.rm.isAttributeAvailable(
            e,
            t,
            this.drawer.landscape,
            'yAnchor'
          ) &&
            (s = this.rm.getSetupAlign(e, t, this.drawer.landscape, 'yAnchor')),
          this.rm.isAttributeAvailable(e, t, this.drawer.landscape, 'x'))
        ) {
          null == d && (d = {});
          let i = this.rm.getSetupFloat(e, t, this.drawer.landscape, 'x');
          (d.x = i <= 1 && i >= -1 ? i * l : i),
            'CENTER' === c
              ? (d.x = l / 2 - d.width / 2 + d.x)
              : 'RIGHT' === c && (d.x = l - d.width + d.x),
            (h = !0);
        }
        if (this.rm.isAttributeAvailable(e, t, this.drawer.landscape, 'y')) {
          null == d && (d = {});
          let i = this.rm.getSetupFloat(e, t, this.drawer.landscape, 'y');
          (d.y = i <= 1 && i >= -1 ? i * a : i),
            'CENTER' === s
              ? (d.y = a / 2 - d.height / 2 + d.y)
              : 'BOTTOM' === s && (d.y = a - d.height + d.y),
            (h = !0);
        }
        return d;
      },
      draw: function (e) {
        if (!this.drawer) return;
        if (!this.divContainer) return;
        this.cm.getFaceTracking() && (this.isMobileDevice || this.faceTrack());
        let t = this,
          i = t.video,
          l = t.canvas.getContext('2d', { alpha: !0 }),
          a = l.canvas.clientWidth,
          c = l.canvas.clientHeight;
        (t.canvasWidth = a),
          (t.canvasHeight = c),
          l.clearRect(0, 0, a, c),
          t.fpsframes++,
          (t.actualTimePrev = t.actualTime),
          (t.actualTime = performance.now());
        let s = (t.actualTime - t.fpsTime) / 1e3;
        s > 1 &&
          ((t.fps = t.fpsframes / s),
          t.fpseframes > 0 ? (t.fpse = t.fpseframes / s) : (t.fpse = 0),
          (t.fpsTime = t.actualTime),
          (t.fpsframes = 0),
          (t.fpseframes = 0)),
          t.video &&
            ((t.videoWidthOld == t.video.videoWidth &&
              t.videoHeightOld == t.video.videoHeight) ||
              t.onCanvasResize(),
            (t.videoWidthOld = t.video.videoWidth),
            (t.videoHeightOld = t.video.videoHeight));
        let d = 'Normal';
        if (
          (t.actualTime - t.widgetTime > 500 &&
            (('UCWaitingFaceStart' !== t.state && 'UCExtracting' !== t.state) ||
              t.faceAvailableDelayed ||
              (d = 'Warning'),
            'UCLivenessMoveStabilizing' === t.state &&
              1 !== t.livenessMoveLastStabilizedStatus &&
              2 !== t.livenessMoveLastStabilizedStatus &&
              17 !== t.livenessMoveLastStabilizedStatus &&
              (d = 'Warning')),
          t.iterateAutomata(t, i, l),
          (t.secondsWidget = (t.actualTime - t.widgetTime) / 1e3),
          (t.secondsState = (t.actualTime - t.stateTime) / 1e3),
          void 0 !== t.elements && null !== t.elements)
        ) {
          let e = { progress: 0 };
          (e.faceDataRect = t.faceDataRect),
            (e.leftEyeData = t.leftEyeData),
            (e.rightEyeData = t.rightEyeData),
            (e.state = t.state),
            (e.livenessMoveLastStabilizedStatus =
              t.livenessMoveLastStabilizedStatus),
            (e.interactible = t.interactible),
            'UCExtracting' === t.state
              ? 0 !== t.extractionTime
                ? (e.progress =
                    t.extractionTimePartial / (1e3 * t.extractionTime))
                : (e.progress = 0)
              : 'UCShowResults' === t.state
              ? (e.progress = t.getGraphicalScore(
                  t.lastExtractionResult.templateScore
                ))
              : 'UCLivenessMoveDetecting' === t.state
              ? (e.livenessMoveDirection = t.livenessMoveDirection)
              : 'UCWaitingFaceStart' === t.state ||
                'UCWaitingFaceStartDecision' === t.state
              ? (e.progress = 1)
              : ('UCErrors' !== t.state && 'UCErrorFinish' !== t.state) ||
                (e.livenessDiagnostic = t.livenessDiagnostic),
            (e.livenessMoveFailReason = t.livenessMoveFailReason);
          for (let i = 0; i < t.elements.length; i++) {
            let s = null;
            if (
              (null !== t.rm &&
                (s = t.drawer.getLayout(
                  t.resourceParent,
                  t.elements[i].id,
                  t.elements[i].type,
                  t.secondsWidget,
                  t.secondsState,
                  d,
                  e
                )),
              null !== s &&
                (s = t.getLayoutFromXML(
                  t.resourceParent,
                  t.elements[i].id,
                  s,
                  a,
                  c
                )),
              null !== s)
            ) {
              t.elements[i].layout = s;
              let a = t.elements[i].mode,
                c = !1;
              if (a) {
                let e = a.split('|');
                for (let t = 0; t < e.length; t++)
                  if (e[t] === d) {
                    c = !0;
                    break;
                  }
              } else c = !0;
              if (!0 === c) {
                if ('video' === t.elements[i].type)
                  e.player = t.elements[i].videoPlayer;
                else if ('camera' === t.elements[i].type)
                  if (
                    ((e.eyesYLevel = t.privateEyesYLevel),
                    (e.blindText = ''),
                    'UCLivenessDetectionStep1' === t.state)
                  ) {
                    let i = t.actualTime - t.clockLiveness1;
                    (i /= 1e3 * t.liveness1Time),
                      i > 1 && (i = 1),
                      (i = (i - 1) * (i - 1) * (i - 1) + 1),
                      (e.blind = 0.8 * i);
                  } else if ('UCLivenessDetectionStep2' === t.state)
                    (e.blind = 0.8),
                      (e.blindText = t.rm.translate('message_blink'));
                  else if ('UCLivenessDetectionStep3' === t.state) {
                    let i = 0;
                    (i = t.actualTime - t.clockLiveness3),
                      (i = (i / (1e3 * t.liveness3Time)) * 0.2),
                      i > 0.2 && (i = 0.2),
                      (e.blind = 0.8 + i);
                  } else if ('UCWaitingEyeDetection' === t.state)
                    if (null == t.clockEyeDetectionDetected) {
                      let i = t.actualTime - t.clockEyeDetection,
                        l = 0;
                      i < 1e3
                        ? (l = 1)
                        : ((l = (i - 1e3) / (1e3 * t.liveness1Time)),
                          l < 0 ? (l = 0) : l > 1 && (l = 1),
                          (l = 1 - l)),
                        (e.blind = l);
                    } else {
                      let i =
                        ((t.actualTime - t.clockEyeDetectionDetected) /
                          (1e3 * t.liveness3Time)) *
                        0.2;
                      i < 0 ? (i = 0) : i > 0.2 && (i = 0.2), (e.blind = 1 - i);
                    }
                  else e.blind = 0;
                'button_info' !== t.elements[i].id &&
                  ((t.cm.getAccessibility() &&
                    t.cm
                      .getAccessibleElements()
                      .includes(t.elements[i].type)) ||
                    t.drawer.draw(
                      l,
                      s,
                      t.resourceParent,
                      t.elements[i].id,
                      t.elements[i].type,
                      t.secondsWidget,
                      t.secondsState,
                      d,
                      e
                    ));
              }
            }
          }
        } else if ('UCErrors' === t.state) {
          (l.fillStyle = 'white'), l.fillRect(0, 0, a, c);
          let e = t.livenessErrorString,
            i = 15 * t.fontSizeFactor,
            s = t.rm.getSetupResourceId(
              'facephi-widget-conf',
              '',
              t.drawer.landscape,
              'font_warning_message'
            );
          (l.font = i + "px '" + s + "'"), (l.fillStyle = 'black');
          let d = e.split('\n');
          for (let e = 0; e < d.length; e++) {
            let c = l.measureText(d[e]),
              s = 330 * t.canvasSizeFactor + i * e;
            l.fillText(d[e], a / 2 - c.width / 2, s);
          }
          let h = t.livenessErrorImage,
            n = t.scaleRect(
              { width: h.width, height: h.height },
              { x: 0.03 * a, y: 0.378 * c, width: 0.94 * a, height: 0.1 * c },
              !0
            );
          l.drawImage(h, n.x, n.y, n.width, n.height),
            t.drawButton(
              t,
              l,
              { x: 0, y: c - t.buttonHeight, width: a, height: t.buttonHeight },
              'Results',
              'button_finish'
            ),
            t.secondsState;
        }
        if (t.debug && (t.worker || t.engineInstance)) {
          let e = 1;
          (l.font = '12px Poppins-SemiBold'),
            (l.fillStyle = 'black'),
            l.fillText('State: ' + t.state, 0, 20 * e),
            e++,
            l.fillText('FPS: ' + t.fps.toFixed(2), 0, 20 * e),
            e++,
            l.fillText('FPS Extractor: ' + t.fpse.toFixed(2), 0, 20 * e),
            e++,
            l.fillText(
              'Camera size: ' + t.cameraWidth + 'x' + t.cameraHeight + 'px',
              0,
              20 * e
            ),
            e++,
            l.fillText('Canvas size: ' + a + 'x' + c + 'px', 0, 20 * e),
            e++,
            l.fillText('Camera rotation: ' + t.cameraRotation, 0, 20 * e),
            e++,
            l.fillText('WidgetTime: ' + t.secondsWidget, 0, 20 * e),
            e++,
            l.fillText('StateTime: ' + t.secondsState, 0, 20 * e),
            e++,
            l.fillText('Mode: ' + d, 0, 20 * e),
            e++,
            l.fillText('Images: ' + t.privateImages.length, 0, 20 * e),
            e++,
            l.fillText('Face available: ' + t.faceAvailable, 0, 20 * e),
            e++,
            l.fillText(
              'EyesYLevel: ' + Math.round(t.privateEyesYLevel),
              0,
              20 * e
            ),
            e++;
          let i = t.lastDetectResult;
          if (null != i) {
            if (void 0 !== i.face) {
              l.fillText(
                'Face: [' +
                  i.face.x +
                  ',' +
                  i.face.y +
                  ',' +
                  i.face.width +
                  ',' +
                  i.face.height +
                  ']',
                0,
                20 * e
              ),
                e++,
                l.beginPath(),
                (l.lineWidth = '3'),
                (l.strokeStyle = 'red');
              let a = t.fromCameraToScreen(t, {
                x: i.face.x,
                y: i.face.y,
                width: i.face.width,
                height: i.face.height,
              });
              l.rect(a.x, a.y, a.width, a.height), l.stroke();
            }
            if (void 0 !== i.leftEye) {
              l.beginPath(), (l.lineWidth = '6'), (l.strokeStyle = 'red');
              let e = t.fromCameraToScreen(t, {
                x: i.leftEye.x,
                y: i.leftEye.y,
                width: 1,
                height: 1,
              });
              l.rect(e.x, e.y, e.width, e.height), l.stroke();
            }
            if (void 0 !== i.rightEye) {
              l.beginPath(), (l.lineWidth = '6'), (l.strokeStyle = 'red');
              let e = t.fromCameraToScreen(t, {
                x: i.rightEye.x,
                y: i.rightEye.y,
                width: 1,
                height: 1,
              });
              l.rect(e.x, e.y, e.width, e.height), l.stroke();
            }
          }
        }
        (t.worker || t.engineInstance) &&
          setTimeout(t.draw.bind(this), t.samplePeriod);
      },
      reduceRect: function (e, t) {
        let i = e.width * (1 - t),
          l = e.height * (1 - t);
        return (
          (e.x = e.x + (e.width - i) / 2),
          (e.y = e.y + (e.height - l) / 2),
          (e.width = i),
          (e.height = l),
          e
        );
      },
      drawStringMultiline: function (e, t, i, l, a, c, s) {
        let d = i.split('\n');
        (t.imageSmoothingEnabled = !1),
          (s = Math.round(s * e.fontSizeFactor)),
          (t.font = 'normal ' + s + "px '" + c + "'"),
          (t.fillStyle = a);
        for (let i = 0; i < d.length; i++) {
          let a = t.measureText(d[i]);
          t.fillText(d[i], e.canvasWidth / 2 - a.width / 2, l + i * (s + 1));
        }
      },
      setOffInterface: function (e, t, i) {
        e.beginPath(),
          (e.lineWidth = '5'),
          (e.fillStyle = 'gray'),
          e.fillRect(0, 0, i, i),
          e.stroke();
      },
      adaptText: function (e, t, i, l) {
        if (((t.font = l), t.measureText(i).width > e)) {
          let a = l.indexOf('px'),
            c = l.substring(0, a);
          return (
            c--,
            (l = c + l.substring(a, l.length)),
            (t.font = l),
            this.adaptText(e, t, i, l)
          );
        }
        return !0;
      },
      reflectedX: function (e, t) {
        return e - t;
      },
      iterateAutomata: function (e, t, i) {
        if (!1 === e.cameraReady) return;
        let l = e.faceAvailable;
        switch (e.state) {
          case 'UCNothing':
            let i = e.canvas;
            null !== i && (i.style.display = 'inline-block');
            let l = 'SetMode//' + e.livenessMode + ',' + (e.tutorial ? 1 : 0);
            m.printDebug(l), e.graph.sendMessage(l), (e.workerWorking = !1);
            break;
          case 'UCErrors':
            !1 === e.interactible &&
              e.secondsState > 2 &&
              e.graph.sendMessage('Click//button_error');
            break;
          case 'UCTutorialRegister1':
          case 'UCTutorialRegister2':
          case 'UCShowResults':
            e.evaluateScenarioTimeout(e);
            break;
          case 'UCWaitingFaceStart':
            e.wasmReady &&
              !1 === e.workerWorking &&
              (e.saveImageToCanvas(e, t),
              (e.privateLastImage = e.getImageData(e.privateCanvas)),
              m.printDebug('Sending data to engine!'),
              (e.workerWorking = !0),
              e.engineInstance
                .detect(e.privateLastImage.pixels)
                .then((t) => {
                  if (
                    (m.printDebug('Received data from engine!'),
                    m.printDebug(JSON.stringify(t)),
                    (e.lastDetectResult = t),
                    (e.faceAvailable = !1),
                    (e.faceTooFar =
                      t.sampleDiagnostic ===
                      p.Selphi.SampleDiagnostic.FaceTooFar),
                    t.face)
                  ) {
                    let i = e.fromCameraToScreenDetection(e, t.face);
                    ((e.drawer && e.drawer.faceInsideCircle(i)) ||
                      e.cm.getFaceTracking()) &&
                      ((e.faceAvailable = !0), (e.faceDataRect = i));
                  }
                  let i =
                    t.sampleDiagnostic === p.Selphi.SampleDiagnostic.NotRated;
                  if (
                    (!1 === e.qualityCheckFailed &&
                      !0 === i &&
                      m.printDebug('timeout by phi_code_3'),
                    (e.qualityCheckFailed = e.qualityCheckFailed || i),
                    t.leftEye)
                  ) {
                    let i = e.fromCameraToScreenDetection(e, {
                      x: t.leftEye.x,
                      y: t.leftEye.y,
                      width: 1,
                      height: 1,
                    });
                    (e.privateEyesYLevel = i.y), (e.leftEyeData = i);
                  }
                  if (t.rightEye) {
                    let i = e.fromCameraToScreenDetection(e, {
                      x: t.rightEye.x,
                      y: t.rightEye.y,
                      width: 1,
                      height: 1,
                    });
                    (e.privateEyesYLevel = i.y), (e.rightEyeData = i);
                  }
                  e.lastExtractionResult && e.lastExtractionResult.face
                    ? e.facePositions.push(
                        e.lastExtractionResult.SampleDiagnostic ===
                          p.Selphi.SampleDiagnostic.NotRated
                      )
                    : e.facePositions.push(!0),
                    (e.workerWorking = !1);
                })
                .catch((t) => {
                  console.error(t), (e.workerWorking = !1);
                }),
              e.evaluateScenarioTimeout(e));
            break;
          case 'UCWaitingFaceStartDecision':
            !0 === e.stabilizationStage
              ? e.graph.sendMessage('Stabilize')
              : e.graph.sendMessage('Extract');
            break;
          case 'UCExtracting':
            let a = !1,
              c = !1;
            navigator.userAgent &&
              (navigator.userAgent.includes('Macintosh') && (a = !0),
              navigator.userAgent.includes('Chrome') && (c = !0)),
              e.cameraName.toUpperCase().includes(e.face_v() + e.face_t()) ||
              e.cameraName
                .toUpperCase()
                .includes(e.face_o() + e.face_b() + e.face_s()) ||
              e.cameraName
                .toUpperCase()
                .includes(e.face_spl() + e.face_it() + e.face_cam()) ||
              e.cameraName.toUpperCase().includes(e.face_fa() + e.face_ke()) ||
              e.cameraName.toUpperCase().includes(e.face_sn() + e.face_ap()) ||
              e.cameraName
                .toUpperCase()
                .includes(e.face_defa() + e.face_ult()) ||
              e.cameraName.toUpperCase().includes(e.face_mo() + e.face_ck()) ||
              e.cameraName.toUpperCase().includes(e.face_alpha())
                ? e.actualTime - e.clockExtractionPure > e.extractionTimeout &&
                  e.extractionTimeout > 0 &&
                  ((e.livenessDiagnostic = -1),
                  e.graph.sendMessage('Timeout'),
                  m.printDebug('timeout by phi_code_2'))
                : e.faceAvailableDelayed &&
                  (e.extractionTimePartial += e.actualTime - e.actualTimePrev),
              e.actualTime - e.clockExtractionPure > e.detectionTimeout &&
              e.detectionTimeout > 0 &&
              0 === e.privateImages.length
                ? ((e.livenessDiagnostic = -1), e.graph.sendMessage('Timeout'))
                : e.extractionTime > 0 &&
                  (e.extractionTimePartial < 1e3 * e.extractionTime ||
                    0 === e.privateImages.length)
                ? e.actualTime - e.clockExtractionPure > e.extractionTimeout &&
                  e.extractionTimeout > 0
                  ? ((e.livenessDiagnostic = -1),
                    e.graph.sendMessage('Timeout'))
                  : !1 === e.workerWorking &&
                    (e.saveImageToCanvas(e, t),
                    (e.privateLastImage = e.getImageData(e.privateCanvas)),
                    m.printDebug('Sending data to engine!'),
                    (e.workerWorking = !0),
                    e.engineInstance
                      .extractionNextSmart(e.privateLastImage.pixels)
                      .then((t) => {
                        if (
                          (m.printDebug('Received data from engine!'),
                          m.printDebug(JSON.stringify(t)),
                          (e.faceTooFar =
                            t.sampleDiagnostic ===
                            p.Selphi.SampleDiagnostic.FaceTooFar),
                          (e.tooManyFaces =
                            t.sampleDiagnostic ===
                            p.Selphi.SampleDiagnostic.TooManyFaces),
                          (e.faceAvailable = !1),
                          t.sampleDiagnostic === p.Selphi.SampleDiagnostic.Ok)
                        ) {
                          e.lastExtractionResult = t;
                          let i = e.fromCameraToScreenDetection(
                            e,
                            e.lastExtractionResult.face
                          );
                          e.drawer.faceInsideCircle(i) &&
                            ((e.faceAvailable = !0), (e.faceDataRect = i));
                        }
                        let i =
                          t.sampleDiagnostic ===
                          p.Selphi.SampleDiagnostic.NotRated;
                        if (
                          (!1 === e.qualityCheckFailed &&
                            !0 === i &&
                            m.printDebug('timeout by phi_code_3'),
                          (e.qualityCheckFailed = e.qualityCheckFailed || i),
                          t.leftEye)
                        ) {
                          let i = e.fromCameraToScreenDetection(e, {
                            x: t.leftEye.x,
                            y: t.leftEye.y,
                            width: 1,
                            height: 1,
                          });
                          (e.privateEyesYLevel = i.y), (e.leftEyeData = i);
                        }
                        if (t.rightEye) {
                          let i = e.fromCameraToScreenDetection(e, {
                            x: t.rightEye.x,
                            y: t.rightEye.y,
                            width: 1,
                            height: 1,
                          });
                          (e.privateEyesYLevel = i.y), (e.rightEyeData = i);
                        }
                        e.lastExtractionResult && e.lastExtractionResult.face
                          ? e.facePositions.push(
                              e.lastExtractionResult.SampleDiagnostic ===
                                p.Selphi.SampleDiagnostic.NotRated
                            )
                          : e.facePositions.push(!0),
                          e.qualityCheckFailed &&
                            (t.sampleDiagnostic =
                              p.Selphi.SampleDiagnostic.NotRated),
                          e.privateLastImage &&
                            (e.privateLastImage.extractionResult = t),
                          t.sampleDiagnostic === p.Selphi.SampleDiagnostic.Ok &&
                            !0 === e.faceAvailable &&
                            (e.privateImages.length < 5
                              ? e.privateImages.push(e.privateLastImage)
                              : e.betterSustitution(
                                  e,
                                  e.privateImages,
                                  e.privateLastImage
                                )),
                          this.tooManyFaces &&
                            ((this.livenessMoveFailReason = 4),
                            this.graph.sendMessage('TooManyFaces'),
                            (this.tooManyFaces = !1)),
                          (e.workerWorking = !1);
                      })
                      .catch((t) => {
                        console.error(t), (e.workerWorking = !1);
                      }))
                : 17 === e.livenessMoveLastStabilizedStatus
                ? ((e.livenessMoveFailReason = 2),
                  e.livenessMoveActualFailedGlassesAttempts++,
                  e.livenessMoveActualFailedAttempts++,
                  e.graph.sendMessage(
                    'LivenessMoveGlasses//' + e.livenessMoveActualFailedAttempts
                  ))
                : e.privateImages.length > 0 &&
                  e.graph.sendMessage('AuthenticationFinished'),
              e.tooManyFaces &&
                ((e.livenessMoveFailReason = 4),
                e.graph.sendMessage('TooManyFaces'),
                (e.tooManyFaces = !1));
            break;
          case 'UCWaitingEyeDetection':
            if (
              performance.now() - e.clockEyeDetection > e.detectionTimeout &&
              e.detectionTimeout > 0
            )
              return (
                (e.livenessDiagnostic = -1), void e.graph.sendMessage('Timeout')
              );
            let s = performance.now() - e.clockEyeDetection;
            if (
              s > 1e3 &&
              !e.clockEyeDetectionDetected &&
              s < 1e3 + 1e3 * e.liveness1Time
            )
              return;
            if (s > 1e3 + 1e3 * e.liveness1Time && e.clockEyeDetectionDetected)
              return void e.graph.sendMessage('ResetLivenessBlink');
            e.clockEyeDetectionDetected &&
              performance.now() - e.clockEyeDetectionDetected >
                1e3 * e.liveness3Time &&
              e.graph.sendMessage('Timer'),
              e.clockEyeDetectionDetected ||
                (!1 === e.workerWorking &&
                  (e.wasmReady || e.engineInstance) &&
                  (e.saveImageToCanvas(e, t),
                  (e.privateLastImage = e.getImageData(e.privateCanvas)),
                  e.postMessage(e, {
                    cmd: 'detect',
                    data: e.privateLastImage.pixels.data,
                    width: e.privateLastImage.width,
                    height: e.privateLastImage.height,
                    format: p.Selphi.ImageFormat.RGBA_32bpp,
                  }),
                  e.evaluateScenarioTimeout(e)));
            break;
          case 'UCLivenessDetectionStep1':
            performance.now() - e.clockLiveness1 > 1e3 * e.liveness1Time &&
              e.graph.sendMessage('Timer');
            break;
          case 'UCLivenessDetectionStep2':
            !1 === e.workerWorking &&
              (e.wasmReady || e.engineInstance) &&
              (e.saveImageToCanvas(e, t),
              (e.privateLivenessImageTemp = e.getImageData(e.privateCanvas)),
              e.postMessage(e, {
                cmd: 'livenessTimerAdd',
                milliseconds: performance.now() - e.clockLiveness2,
              }));
            break;
          case 'UCLivenessDetectionStep3':
            null !== e.clockLiveness3_finish &&
              performance.now() - e.clockLiveness3_finish >
                1e3 * e.liveness3Time &&
              e.graph.sendMessage('EyeDetectionNeeded');
            break;
          case 'UCLivenessMoveStabilizing':
            if (
              e.detectionTimeout > 0 &&
              1e3 * e.secondsState >= e.detectionTimeout
            ) {
              (e.livenessDiagnostic = -1),
                e.livenessMoveStabilizedStatusHistory.push(-1),
                e.graph.sendMessage('Timeout');
              let t = new CustomEvent('FPhi.UserControl.Stabilizing.event', {
                detail: -1,
              });
              e.divContainer && e.divContainer.dispatchEvent(t);
            } else
              (e.wasmReady || e.engineInstance) &&
                !1 === e.workerWorking &&
                (e.saveImageToCanvas(e, t),
                (e.privateLastImage = e.getImageData(e.privateCanvas)),
                (e.workerWorking = !0),
                e.engineInstance
                  .nextLivenessMoveStabilization(e.privateLastImage.pixels)
                  .then((t) => {
                    if (
                      (m.printDebug('Received data from engine!'),
                      m.printDebug(JSON.stringify(t)),
                      (e.livenessMoveLastStabilizedStatus = t.faceStabilized),
                      (e.faceTooFar = 3 === t.faceStabilized),
                      (e.faceAvailable = !1),
                      m.printDebug('Sending data to engine!'),
                      (e.lastExtractionResult = t),
                      t.face && null != e.drawer)
                    ) {
                      let i = e.fromCameraToScreenDetection(e, t.face);
                      (e.drawer.faceInsideCircle(i) ||
                        e.cm.getFaceTracking()) &&
                        ((e.faceAvailable = !0), (e.faceDataRect = i));
                    }
                    if (t.leftEye) {
                      let i = e.fromCameraToScreenDetection(e, {
                        x: t.leftEye.x,
                        y: t.leftEye.y,
                        width: 1,
                        height: 1,
                      });
                      (e.privateEyesYLevel = i.y), (e.leftEyeData = i);
                    }
                    if (t.rightEye) {
                      let i = e.fromCameraToScreenDetection(e, {
                        x: t.rightEye.x,
                        y: t.rightEye.y,
                        width: 1,
                        height: 1,
                      });
                      (e.privateEyesYLevel = i.y), (e.rightEyeData = i);
                    }
                    if (
                      ((e.privateLastImage.extractionResult = t),
                      (1 !== t.faceStabilized && 17 !== t.faceStabilized) ||
                        (e.livenessMoveStabilizedStatusHistory.push(
                          t.faceStabilized
                        ),
                        e.graph.sendMessage('FaceStabilized')),
                      4 === t.faceStabilized &&
                        (e.livenessMoveGlassesFail++,
                        (e.livenessMoveFailReason = 0),
                        e.livenessMoveStabilizedStatusHistory.push(
                          t.faceStabilized
                        ),
                        (t.sunGlassesScore = 1),
                        (e.livenessDiagnostic = -1),
                        e.graph.sendMessage('Timeout')),
                      null !== t.faceStabilized)
                    ) {
                      let i = new CustomEvent(
                        'FPhi.UserControl.Stabilizing.event',
                        { detail: t.faceStabilized }
                      );
                      e.divContainer && e.divContainer.dispatchEvent(i);
                    }
                    e.workerWorking = !1;
                  })
                  .catch((t) => {
                    console.error(t), (e.workerWorking = !1);
                  }));
            break;
          case 'UCWaitRecording':
            e.cm.getVideoRecord()
              ? e.recorderFinish && e.graph.sendMessage('Finish')
              : e.graph.sendMessage('Finish');
            break;
          case 'UCLivenessMoveInfo':
            e.secondsState > e.livenessMoveInfoTime &&
              ((e.livenessDiagnostic = -1), e.graph.sendMessage('Timeout'));
            break;
          case 'UCFinish':
            this.resetInternalVars();
        }
        if (
          (e.faceTooFar && (e.faceAvailable = !1),
          (e.oldFaceAvailableDelayed = e.faceAvailableDelayed),
          !0 === l && !1 === e.faceAvailable
            ? (e.clockWarningIn = e.actualTime)
            : !1 === l && !0 === e.faceAvailable
            ? (e.clockWarningOut = e.actualTime)
            : ((e.faceAvailable &&
                e.actualTime - e.clockWarningOut > 1e3 * e.warningOutTime) ||
                (!e.faceAvailable &&
                  e.actualTime - e.clockWarningIn > 1e3 * e.warningInTime)) &&
              (e.faceAvailableDelayed = e.faceAvailable),
          e.oldFaceAvailableDelayed !== e.faceAvailableDelayed &&
            e.divContainer)
        ) {
          let t = new CustomEvent('FPhi.UserControl.TrackStatus.event', {
            detail: {
              code: p.Selphi.TrackStatus.FaceState,
              timeStamp: e.secondsWidget,
              data: e.faceAvailableDelayed,
            },
          });
          e.divContainer.dispatchEvent(t);
        }
        if (
          e.cm.getVideoRecord() &&
          !e.recorderWorking &&
          e.recorder.frameReady(!1)
        ) {
          e.privateRecordCanvasContext.drawImage(
            t,
            0,
            0,
            e.privateRecordCanvas.width,
            e.privateRecordCanvas.height
          );
          let i = e.privateRecordCanvasContext.getImageData(
            0,
            0,
            e.privateRecordCanvas.width,
            e.privateRecordCanvas.height
          );
          if (((e.recorderWorking = !0), 0 !== this.cameraRotation)) {
            let t;
            1 === this.cameraRotation
              ? (t = 270)
              : 2 === this.cameraRotation
              ? (t = 180)
              : 3 === this.cameraRotation && (t = 90),
              (i = e.rotateImageData(i, t));
          }
          e.recorder.addFrame(i).then(() => {
            e.recorderWorking = !1;
          });
        }
      },
      evaluateScenarioTimeout: function (e) {
        0 === e.sceneTimeout ||
          (e.sceneTimeout > 0 &&
            performance.now() - e.clockNewScenario > 1e3 * e.sceneTimeout &&
            ((e.livenessDiagnostic = -1), e.graph.sendMessage('Timeout')));
      },
      rotateImageData: function (e, t) {
        const i = e.width,
          l = e.height,
          a = (t * Math.PI) / 180,
          c = Math.cos(a),
          s = Math.sin(a),
          d = new Uint8ClampedArray(e.data.length),
          h = i / 2,
          n = l / 2;
        for (let t = 0; t < l; t++)
          for (let a = 0; a < i; a++) {
            const m = c * (a - h) + s * (t - n) + h,
              o = -s * (a - h) + c * (t - n) + n,
              b = Math.round(m),
              Z = Math.round(o);
            if (b >= 0 && b < i && Z >= 0 && Z < l) {
              const l = 4 * (t * i + a),
                c = 4 * (Z * i + b);
              (d[c] = e.data[l]),
                (d[c + 1] = e.data[l + 1]),
                (d[c + 2] = e.data[l + 2]),
                (d[c + 3] = e.data[l + 3]);
            }
          }
        return new ImageData(d, i, l);
      },
      getVideoSources: function (e) {
        if (
          (navigator.mediaDevices
            ? navigator.mediaDevices.enumerateDevices().then(function (t) {
                t
                  .filter(function (e) {
                    return 'video' === e.kind;
                  })
                  .map(function (e, t) {
                    return e.id;
                  })[0],
                  e.setVideoInput(e);
              })
            : MediaStreamTrack.getSources(function (t) {
                t
                  .filter(function (e) {
                    return 'video' === e.kind;
                  })
                  .map(function (e, t) {
                    return e.id;
                  })[0],
                  e.setVideoInput(e);
              }),
          null === selectedSource)
        ) {
          FacePhiDisplayErrorImage(
            facePhiUserControl.config.width,
            folderPath + commonPath + '/Images/errorNoCamsEs.png',
            folderPath + commonPath + '/Images/errorNoCamsEn.png',
            'FacePhiWidgetWeb',
            e.divContainer,
            0,
            '',
            '',
            0,
            Poppins,
            'SemiBold',
            'black',
            0
          );
          let t = new CustomEvent('FPhi.UserControl.ExceptionCaptured.event', {
            detail: { message: 'Camera not found.', exceptionType: 0 },
          });
          e.divContainer.dispatchEvent(t);
        }
      },
      isPathAbsolute: function (e) {
        return /^(?:\/|.+:\/\/|http)/.test(e);
      },
      getScriptPath: function () {
        return (
          String(new Error().stack)
            .replace(/^Error.*\n/, '')
            .split('\n')[1]
            .match(/http.*\.js/)[0]
            .split('/')
            .slice(0, -1)
            .join('/') + '/'
        );
      },
      distAlgSustitution: function (e, t, i) {
        let l,
          a = Number.MAX_VALUE;
        for (let c = 1; c < t.length; c++) {
          let s = t.slice();
          (s[c] = i),
            s.sort(function (e, t) {
              return e.time - t.time;
            });
          let d = e.desviacionTipica(e, s);
          d < a && ((a = d), (l = s));
        }
        return l;
      },
      betterSustitution: function (e, t, i) {
        let l = Number.MAX_VALUE,
          a = 0;
        for (let e = 0; e < t.length; e++) {
          let i = t[e].extractionResult.facialScore;
          i < l && ((l = i), (a = e));
        }
        i.extractionResult.facialScore > l && (t[a] = i);
      },
      sortImagesByFacialScore: function (e, t) {
        t.sort(function (e, t) {
          let i =
            void 0 !== e.extractionResult ? e.extractionResult.facialScore : 0;
          return (
            (void 0 !== t.extractionResult
              ? t.extractionResult.facialScore
              : 0) - i
          );
        });
      },
      desviacionTipica: function (e, t) {
        let i = e.media(e, t),
          l = 0;
        for (let e = 1; e < t.length; e++) {
          let a = t[e].time - t[e - 1].time;
          l += (a - i) * (a - i);
        }
        return (l = Math.sqrt(l / (t.length - 2))), l;
      },
      media: function (e, t) {
        let i = 0;
        for (let e = 1; e < t.length; e++) i += t[e].time - t[e - 1].time;
        return i / (t.length - 1);
      },
      OnResourceManagerLoaded: function (e) {
        this.rm = new p.ResourceManager(
          this.baseURL,
          this.language,
          this,
          this.OnResourceManagerStatus,
          this.dpiList,
          window.devicePixelRatio,
          this.canvasSizeFactor
        );
      },
      OnResourceManagerStatus: function (e, t) {
        if (t && e) {
          (e.rmReady = !0), e.CheckDependencies(e);
          let t = 0.6 * e.canvas.height;
          (e.loadingMessage.style =
            'position: absolute; top:' +
            t +
            'px; width: 100%; text-align: center; font-size: 22.0px; color: #7C3295;'),
            (e.loadingMessage.innerHTML = e.rm.translate('loading_message'));
        }
      },
      OnGraphLoaded: function (e) {
        this.graph = new p.Graph(
          this.path + this.graphPath,
          this.OnGraphReady.bind(this),
          this.OnGraphNewState.bind(this)
        );
      },
      OnGraphReady: function (e) {
        (this.graphReady = !0), this.CheckDependencies(this);
      },
      OnDrawerLoaded: function (e) {
        (this.drawer = new p.Drawer(
          this.mode,
          this.livenessMode,
          this.stabilizationStage,
          this.canvasSizeFactor,
          this.fontSizeFactor
        )),
          this.CheckDependencies(this);
      },
      CheckDependencies: function (e) {
        if (
          (!0 === e.rmReady &&
            e.drawer &&
            !0 !== e.resourcesCached &&
            ((e.drawer.rm = e.rm),
            e.drawer.cacheResources(),
            (e.resourcesCached = !0)),
          !0 === e.rmReady &&
            e.drawer &&
            !0 === e.graphReady &&
            !0 === e.wasmReady &&
            !0 === e.cameraReady &&
            e.graph &&
            'UCNothing' !== e.graph.state)
        ) {
          let t = e.canvas;
          t && (t.style.display = 'none'),
            (e.video.style.display = 'inline-block'),
            e.drawer.setCanvasSize(t.clientWidth, t.clientHeight),
            e.graph.setInitialState('UCNothing');
          let i = new CustomEvent('FPhi.UserControl.ModuleLoaded.event', {
            detail: {
              cameraWidth: e.cameraWidth,
              cameraHeight: e.cameraHeight,
            },
          });
          e.divContainer.dispatchEvent(i),
            e.cameraContainer.contains(e.gifWait) &&
              (e.cameraContainer.removeChild(e.gifWait),
              e.cameraContainer.removeChild(e.loadingMessage)),
            setTimeout(e.draw.bind(e), e.samplePeriod);
        }
      },
      videoLoaded: function (e) {
        (this.cameraWidth = e.target.videoWidth),
          (this.cameraHeight = e.target.videoHeight),
          0 === this.cameraRotation || 2 === this.cameraRotation
            ? ((this.privateCanvas.width = this.cameraWidth),
              (this.privateCanvas.height = this.cameraHeight))
            : ((this.privateCanvas.width = this.cameraHeight),
              (this.privateCanvas.height = this.cameraWidth)),
          (this.cameraReady = !0),
          m.printDebug('Timing-Camera-ready: ' + performance.now()),
          this.video,
          this.canvas.getContext('2d', { alpha: !0 }),
          this.cm.getVideoRecord() &&
            (m.printDebug('Video recording enabled...'),
            (this.videoRecordWidth =
              this.cameraWidth * this.cm.getVideoRecordScale()),
            (this.videoRecordHeight =
              this.cameraHeight * this.cm.getVideoRecordScale()),
            (this.recorder = X.generateInstance(
              this.cm.getVideoRecordType() === p.Selphi.RecorderType.Local
                ? 'local'
                : 'remote',
              this.cameraWidth * this.cm.getVideoRecordScale(),
              this.cameraHeight * this.cm.getVideoRecordScale(),
              this.cm.getVideoRecordRate()
            )),
            (this.recorderWorking = !0),
            this.recorder.initializeEngine().then(() => {
              this.recorderWorking = !1;
            }),
            (this.privateRecordCanvas = document.createElement('canvas')),
            (this.privateRecordCanvas.width = this.videoRecordWidth),
            (this.privateRecordCanvas.height = this.videoRecordHeight),
            (this.privateRecordCanvasContext =
              this.privateRecordCanvas.getContext('2d'))),
          this.CheckDependencies(this);
      },
      videoFrame: function (e) {
        this.canvasVideoPlayer.getContext('2d').drawImage(e.target, 0, 0);
      },
      videoplayerEnded: function (e) {
        'UCWizardCompleted' === this.state
          ? this.graph.sendMessage('VideoFinished')
          : e.target.play();
      },
    }),
    (p.Selphi.CheckCapabilities = async function (e = { omit: [] }) {
      let t = {};
      if (e.omit.indexOf('camera') < 0)
        try {
          t.camera =
            (await navigator.mediaDevices.enumerateDevices()).filter(
              (e) => 'videoinput' == e.kind
            ).length > 0;
        } catch (e) {
          t.camera = !1;
        }
      else t.camera = null;
      if (e.omit.indexOf('wasm') < 0)
        try {
          if (
            'object' == typeof WebAssembly &&
            'function' == typeof WebAssembly.instantiate
          ) {
            const e = new WebAssembly.Module(
              Uint8Array.of(0, 97, 115, 109, 1, 0, 0, 0)
            );
            t.wasm =
              e instanceof WebAssembly.Module &&
              new WebAssembly.Instance(e) instanceof WebAssembly.Instance;
          } else t.wasm = !1;
        } catch (e) {
          t.wasm = !1;
        }
      else t.wasm = null;
      return (
        e.omit.indexOf('browser') < 0
          ? (t.browser =
              'undefined' != typeof WebAssembly &&
              void 0 !== WebAssembly.instantiate &&
              'undefined' != typeof CanvasRenderingContext2D &&
              'undefined' != typeof customElements &&
              'undefined' != typeof HTMLElement &&
              'undefined' != typeof Uint8ClampedArray)
          : (t.browser = null),
        t
      );
    }),
    (p.Selphi.Component = b),
    customElements.define('facephi-selphi', p.Selphi.Component);
})();
var a = l.l;
export { a as FPhi };
